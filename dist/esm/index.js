/* Copyright(c) 2023 SendBird, Inc.
SendBird Desk JavaScript SDK v1.1.3 */
/******************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
/* global Reflect, Promise, SuppressedError, Symbol */

var extendStatics = function(d, b) {
    extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
    return extendStatics(d, b);
};

function __extends(d, b) {
    if (typeof b !== "function" && b !== null)
        throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
    extendStatics(d, b);
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
}

var __assign = function() {
    __assign = Object.assign || function __assign(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};

function __awaiter(thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
}

function __generator(thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (g && (g = 0, op[0] && (_ = 0)), _) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
}

function __values(o) {
    var s = typeof Symbol === "function" && Symbol.iterator, m = s && o[s], i = 0;
    if (m) return m.call(o);
    if (o && typeof o.length === "number") return {
        next: function () {
            if (o && i >= o.length) o = void 0;
            return { value: o && o[i++], done: !o };
        }
    };
    throw new TypeError(s ? "Object is not iterable." : "Symbol.iterator is not defined.");
}

function __read(o, n) {
    var m = typeof Symbol === "function" && o[Symbol.iterator];
    if (!m) return o;
    var i = m.call(o), r, ar = [], e;
    try {
        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);
    }
    catch (error) { e = { error: error }; }
    finally {
        try {
            if (r && !r.done && (m = i["return"])) m.call(i);
        }
        finally { if (e) throw e.error; }
    }
    return ar;
}

function __spreadArray(to, from, pack) {
    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {
        if (ar || !(i in from)) {
            if (!ar) ar = Array.prototype.slice.call(from, 0, i);
            ar[i] = from[i];
        }
    }
    return to.concat(ar || Array.prototype.slice.call(from));
}

typeof SuppressedError === "function" ? SuppressedError : function (error, suppressed, message) {
    var e = new Error(message);
    return e.name = "SuppressedError", e.error = error, e.suppressed = suppressed, e;
};

var e$1=function(t,n){return e$1=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t;}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);},e$1(t,n)};function t(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t;}e$1(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r);}var n=function(){return n=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},n.apply(this,arguments)};function r(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);}return n}function i(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{c(r.next(e));}catch(e){o(e);}}function a(e){try{c(r.throw(e));}catch(e){o(e);}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t);}))).then(s,a);}c((r=r.apply(e,t||[])).next());}))}function o(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s);}catch(e){a=[6,e],r=0;}finally{n=i=0;}if(5&a[0])throw a[1];return {value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}function s(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return {next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function a(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value);}catch(e){i={error:e};}finally{try{r&&!r.done&&(n=o.return)&&n.call(o);}finally{if(i)throw i.error}}return s}function c(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}var u,l="4.9.6",h=function(){function e(){}return Object.defineProperty(e,"OS_VERSION",{get:function(){return "undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.replace(/,/g,"."):"noAgent"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"SDK_VERSION",{get:function(){return l},enumerable:!1,configurable:!0}),Object.defineProperty(e,"SDK_MAJOR_VERSION",{get:function(){return e.SDK_VERSION.split(".")[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e,"DEFAULT_MAX_UNREAD_COUNT_OF_SUPER_GROUP_CHANNEL",{get:function(){return 100},enumerable:!1,configurable:!0}),Object.defineProperty(e,"INTERNAL_CALL",{get:function(){return "ic"},enumerable:!1,configurable:!0}),e}();!function(e){e[e.STAT_LOG_NOT_ALLOWED=400108]="STAT_LOG_NOT_ALLOWED",e[e.NON_AUTHORIZED=400108]="NON_AUTHORIZED",e[e.INVALID_TOKEN=400111]="INVALID_TOKEN",e[e.NOT_FOUND_IN_DATABASE=400201]="NOT_FOUND_IN_DATABASE",e[e.USER_AUTH_DEACTIVATED=400300]="USER_AUTH_DEACTIVATED",e[e.USER_AUTH_DELETED_OR_NOT_FOUND=400301]="USER_AUTH_DELETED_OR_NOT_FOUND",e[e.SESSION_TOKEN_EXPIRED=400302]="SESSION_TOKEN_EXPIRED",e[e.SESSION_KEY_EXPIRED=400309]="SESSION_KEY_EXPIRED",e[e.SESSION_REVOKED=400310]="SESSION_REVOKED",e[e.STAT_UPLOAD_NOT_ALLOWED=403200]="STAT_UPLOAD_NOT_ALLOWED",e[e.INTERNAL_SERVER_ERROR=500901]="INTERNAL_SERVER_ERROR",e[e.RATE_LIMIT_EXCEEDED=500910]="RATE_LIMIT_EXCEEDED",e[e.UNKNOWN_SERVER_ERROR=900200]="UNKNOWN_SERVER_ERROR",e[e.DEBUG_MODE_REQUIRED=7e5]="DEBUG_MODE_REQUIRED",e[e.LOST_INSTANCE=700100]="LOST_INSTANCE",e[e.CONNECTION_RENEW=700102]="CONNECTION_RENEW",e[e.INVALID_CONNECTION_STATE_TRANSITION=700200]="INVALID_CONNECTION_STATE_TRANSITION",e[e.INVALID_COMMAND=700700]="INVALID_COMMAND",e[e.UNKNOWN_ERROR=77e4]="UNKNOWN_ERROR",e[e.INVALID_INITIALIZATION=800100]="INVALID_INITIALIZATION",e[e.CONNECTION_REQUIRED=800101]="CONNECTION_REQUIRED",e[e.CONNECTION_CANCELED=800102]="CONNECTION_CANCELED",e[e.INVALID_PARAMETER=800110]="INVALID_PARAMETER",e[e.NOT_SUPPORTED_ERROR=800111]="NOT_SUPPORTED_ERROR",e[e.NETWORK_ERROR=800120]="NETWORK_ERROR",e[e.NETWORK_ROUTING_ERROR=800121]="NETWORK_ROUTING_ERROR",e[e.MALFORMED_DATA=800130]="MALFORMED_DATA",e[e.MALFORMED_ERROR_DATA=800140]="MALFORMED_ERROR_DATA",e[e.WRONG_CHANNEL_TYPE=800150]="WRONG_CHANNEL_TYPE",e[e.MARK_AS_READ_RATE_LIMIT_EXCEEDED=800160]="MARK_AS_READ_RATE_LIMIT_EXCEEDED",e[e.QUERY_IN_PROGRESS=800170]="QUERY_IN_PROGRESS",e[e.ACK_TIMEOUT=800180]="ACK_TIMEOUT",e[e.LOGIN_TIMEOUT=800190]="LOGIN_TIMEOUT",e[e.WEBSOCKET_CONNECTION_CLOSED=800200]="WEBSOCKET_CONNECTION_CLOSED",e[e.WEBSOCKET_CONNECTION_FAILED=800210]="WEBSOCKET_CONNECTION_FAILED",e[e.REQUEST_FAILED=800220]="REQUEST_FAILED",e[e.FILE_UPLOAD_CANCEL_FAILED=800230]="FILE_UPLOAD_CANCEL_FAILED",e[e.REQUEST_CANCELED=800240]="REQUEST_CANCELED",e[e.REQUEST_DUPLICATED=800250]="REQUEST_DUPLICATED",e[e.FILE_SIZE_LIMIT_EXCEEDED=800260]="FILE_SIZE_LIMIT_EXCEEDED",e[e.SESSION_TOKEN_REQUEST_FAILED=800500]="SESSION_TOKEN_REQUEST_FAILED",e[e.SESSION_TOKEN_REFRESHED=800501]="SESSION_TOKEN_REFRESHED",e[e.SESSION_TOKEN_REFRESH_FAILED=800502]="SESSION_TOKEN_REFRESH_FAILED",e[e.COLLECTION_DISPOSED=800600]="COLLECTION_DISPOSED",e[e.DATABASE_ERROR=800700]="DATABASE_ERROR";}(u||(u={}));var d,_,f$2,p$1,E$1,g$1=function(e){return !(e instanceof v$1&&!e.shouldThrowOutside)},v$1=function(e){function n(t){var r=t.code,i=void 0===r?0:r,o=t.message,s=void 0===o?"":o,a=e.call(this,s)||this;return a.shouldThrowOutside=!1,a.name="SendbirdError",a.code=i,Object.setPrototypeOf(a,n.prototype),a}return t(n,e),Object.defineProperty(n.prototype,"isInvalidTokenError",{get:function(){return this.code===u.INVALID_TOKEN},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isSessionTokenExpiredError",{get:function(){return this.code===u.SESSION_TOKEN_EXPIRED},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isSessionKeyExpiredError",{get:function(){return this.code===u.SESSION_KEY_EXPIRED},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isSessionRevokedError",{get:function(){return this.code===u.SESSION_REVOKED},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isUserAuthDeactivedError",{get:function(){return this.code===u.USER_AUTH_DEACTIVATED},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isUserAuthDeletedOrNotFoundError",{get:function(){return this.code===u.USER_AUTH_DELETED_OR_NOT_FOUND},enumerable:!1,configurable:!0}),Object.defineProperty(n,"debugModeRequired",{get:function(){return new n({code:u.DEBUG_MODE_REQUIRED,message:"Cannot run this operation in production mode."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"lostInstance",{get:function(){return new n({code:u.LOST_INSTANCE,message:"Instance ID is missing. It should belong to an instance."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"invalidCommand",{get:function(){return new n({code:u.INVALID_COMMAND,message:"Cannot send invalid command."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"unknown",{get:function(){return new n({code:u.UNKNOWN_ERROR,message:"Unknown error occurred."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"connectionRenew",{get:function(){return new n({code:u.CONNECTION_RENEW,message:"Connection restarts."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"invalidConnectionStateTransition",{get:function(){return new n({code:u.INVALID_CONNECTION_STATE_TRANSITION,message:"Invalid connection state transition."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"connectionRequired",{get:function(){return new n({code:u.CONNECTION_REQUIRED,message:"Connection is required."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"connectionCanceled",{get:function(){return new n({code:u.CONNECTION_CANCELED,message:"Connection is canceled."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"invalidParameters",{get:function(){return new n({code:u.INVALID_PARAMETER,message:"Invalid parameters."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"notSupportedError",{get:function(){return new n({code:u.NOT_SUPPORTED_ERROR,message:"Given parameters are not supported."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"networkError",{get:function(){return new n({code:u.NETWORK_ERROR,message:"There was a network error."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"markAsReadAllRateLimitExceeded",{get:function(){return new n({code:u.MARK_AS_READ_RATE_LIMIT_EXCEEDED,message:"markAsRead rate limit exceeded."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"queryInProgress",{get:function(){return new n({code:u.QUERY_IN_PROGRESS,message:"Query in progress."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"noAckTimeout",{get:function(){return new n({code:u.ACK_TIMEOUT,message:"Command received no ack."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"loginTimeout",{get:function(){return new n({code:u.LOGIN_TIMEOUT,message:"Connection timeout."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"connectionClosed",{get:function(){return new n({code:u.WEBSOCKET_CONNECTION_CLOSED,message:"Connection is closed. Please reconnect."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"requestFailed",{get:function(){return new n({code:u.REQUEST_FAILED,message:"Request failed."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"fileUploadCanceled",{get:function(){return new n({code:u.FILE_UPLOAD_CANCEL_FAILED,message:"File upload has been canceled."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"requestCanceled",{get:function(){return new n({code:u.REQUEST_CANCELED,message:"Request has been canceled."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"sessionTokenRefreshFailed",{get:function(){return new n({code:u.SESSION_TOKEN_REFRESH_FAILED,message:"Failed to refresh the session key."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"sessionTokenRequestFailed",{get:function(){return new n({code:u.SESSION_TOKEN_REQUEST_FAILED,message:"Failed to get the session token."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"databaseError",{get:function(){return new n({code:u.DATABASE_ERROR,message:"Database error."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"fileSizeLimitExceededError",{get:function(){return new n({code:u.FILE_SIZE_LIMIT_EXCEEDED,message:"File size exceeds the file size limit."})},enumerable:!1,configurable:!0}),n.prototype.throwOutside=function(){throw this.shouldThrowOutside=!0,this},n}(Error),b=[u.CONNECTION_REQUIRED,u.NETWORK_ERROR,u.ACK_TIMEOUT,u.WEBSOCKET_CONNECTION_CLOSED,u.WEBSOCKET_CONNECTION_FAILED,u.FILE_UPLOAD_CANCEL_FAILED,u.REQUEST_CANCELED,u.INTERNAL_SERVER_ERROR,u.RATE_LIMIT_EXCEEDED,u.UNKNOWN_SERVER_ERROR],m=[u.WEBSOCKET_CONNECTION_CLOSED,u.WEBSOCKET_CONNECTION_FAILED,u.CONNECTION_REQUIRED],y=function(e,t){if(e!==t){var r=n({},e),i=n({},t);return (!r.hasOwnProperty("messageId")||!i.hasOwnProperty("messageId")||r.messageId===i.messageId)&&((!r.hasOwnProperty("reqId")||!i.hasOwnProperty("reqId")||r.reqId===i.reqId)&&(r.hasOwnProperty("messageId")&&delete r.messageId,r.hasOwnProperty("reqId")&&delete r.reqId,i.hasOwnProperty("messageId")&&delete i.messageId,i.hasOwnProperty("reqId")&&delete i.reqId,JSON.stringify(r)===JSON.stringify(i)))}return !0},w=function(e,t,n){return void 0===n&&(n=!1),!(!n||null!=t)||("string"!=typeof e?"object"==typeof e?N$1(e,t):T(e,t):typeof t===e)},N$1=function(e,t,n){return void 0===n&&(n=!1),!(!n||null!=t)||Object.values(e).includes(t)},T=function(e,t){return t instanceof e},S$1=function(e,t,n){return void 0===n&&(n=!1),!(!n||null!=t)||Array.isArray(t)&&t.every((function(t){return w(e,t)}))},A=function(e){return e>0&&b.indexOf(e)>=0},C$1=function(e){return e>0&&m.indexOf(e)>=0},k=function(e,t){if(void 0===t&&(t=!1),t&&null==e)return !0;var n="object"==typeof e&&null!==e&&e.hasOwnProperty("name")&&"string"==typeof e.name&&e.hasOwnProperty("uri")&&"string"==typeof e.uri&&e.hasOwnProperty("type")&&"string"==typeof e.type;if(!n){if("undefined"!=typeof Blob)return e instanceof Blob;if("undefined"!=typeof File)return e instanceof File}return n},I$1=function(){function e(e){var t=void 0===e?{}:e,n=t.useMemberInfoInMessage,r=void 0===n||n,i=t.typingIndicatorInvalidateTime,o=void 0===i?1e4:i,s=t.typingIndicatorThrottle,a=void 0===s?1e3:s,c=t.websocketResponseTimeout,u=void 0===c?1e4:c,l=t.websocketPayloadDecompression,h=void 0===l||l,d=t.sessionTokenRefreshTimeout,_=void 0===d?60:d;this._useMemberInfoInMessage=!0,this._typingIndicatorInvalidateTime=1e4,this._typingIndicatorThrottle=1e3,this._websocketResponseTimeout=1e4,this._sessionTokenRefreshTimeout=60,this._useMemberInfoInMessage=r,this._typingIndicatorInvalidateTime=o,this._typingIndicatorThrottle=a,this._websocketResponseTimeout=u,this._sessionTokenRefreshTimeout=_,this.websocketPayloadDecompression=h;}return Object.defineProperty(e.prototype,"useMemberInfoInMessage",{get:function(){return this._useMemberInfoInMessage},set:function(e){w("boolean",e)&&(this._useMemberInfoInMessage=e);},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"typingIndicatorInvalidateTime",{get:function(){return this._typingIndicatorInvalidateTime},set:function(e){w("number",e)&&(this._typingIndicatorInvalidateTime=e);},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"typingIndicatorThrottle",{get:function(){return this._typingIndicatorThrottle},set:function(e){w("number",e)&&e>=1e3&&e<=9e3&&(this._typingIndicatorThrottle=e);},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"websocketResponseTimeout",{get:function(){return this._websocketResponseTimeout},set:function(e){w("number",e)&&e>=5e3&&e<=3e4&&(this._websocketResponseTimeout=e);},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sessionTokenRefreshTimeout",{get:function(){return this._sessionTokenRefreshTimeout},set:function(e){w("number",e)&&(e<60?e=60:e>1800&&(e=1800),this._sessionTokenRefreshTimeout=e);},enumerable:!1,configurable:!0}),e}(),R$1={encrypt:function(e){return e},decrypt:function(e){return e}},D$1=function(){function e(e){var t=e.store;this._preference=new Map,this._store=t;}return e.prototype._savePreferenceKeys=function(){return i(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return [4,this._store.set({key:this._keysAddress,value:c([],a(this._preference.keys()),!1)})];case 1:return e.sent(),[2]}}))}))},e.prototype.init=function(e,t){var n;return void 0===t&&(t=1),i(this,void 0,void 0,(function(){var r,i,a,c,u,l,h,d,_,f;return o(this,(function(o){switch(o.label){case 0:return this._version=t,this._keysAddress=e,r="".concat(e,".metadata.version"),[4,this._store.get(r)];case 1:return i=o.sent(),[4,this._store.get(e)];case 2:return a=null!==(n=o.sent())&&void 0!==n?n:[],!i||i.version<this._version?[4,this._resetPreferenceData(a,r)]:[3,4];case 3:return o.sent(),[3,11];case 4:o.trys.push([4,9,10,11]),c=s(a),u=c.next(),o.label=5;case 5:return u.done?[3,8]:(l=u.value,[4,this._store.get(l)]);case 6:(h=o.sent())&&this._preference.set(l,h),o.label=7;case 7:return u=c.next(),[3,5];case 8:return [3,11];case 9:return d=o.sent(),_={error:d},[3,11];case 10:try{u&&!u.done&&(f=c.return)&&f.call(c);}finally{if(_)throw _.error}return [7];case 11:return [2]}}))}))},e.prototype._resetPreferenceData=function(e,t){return i(this,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return this._preference=new Map,[4,this._store.removeMany(e)];case 1:return n.sent(),[4,this._store.set({key:t,value:{version:this._version}})];case 2:return n.sent(),[2]}}))}))},e.prototype.get=function(e){return i(this,void 0,void 0,(function(){return o(this,(function(t){return [2,this._preference.get(e)]}))}))},e.prototype.set=function(e,t){return i(this,void 0,void 0,(function(){var n;return o(this,(function(r){switch(r.label){case 0:return n=!this._preference.has(e),[4,this._store.set({key:e,value:t})];case 1:return r.sent(),this._preference.set(e,t),n?[4,this._savePreferenceKeys()]:[3,3];case 2:r.sent(),r.label=3;case 3:return [2]}}))}))},e.prototype.remove=function(e){return i(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return [4,this._store.remove(e)];case 1:return t.sent(),this._preference.delete(e),[4,this._savePreferenceKeys()];case 2:return t.sent(),[2]}}))}))},e.prototype.clear=function(){return i(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return [4,this._store.removeMany(c([],a(this._preference.keys()),!1))];case 1:return e.sent(),this._preference.clear(),[4,this._savePreferenceKeys()];case 2:return e.sent(),[2]}}))}))},e}(),L$1=function(){function e(e){var t=e.encryption,n=e.store,r=e.localCacheEnabled,i=e.localCacheConfig;this.store=n,this.preference=new D$1({store:n}),this.encryption=null!=t?t:R$1,this.localCacheEnabled=r,this.localCacheConfig=i;}return e.prototype.replaceStore=function(e){this.store=e,this.preference=new D$1({store:e});},e}();!function(e){e.SUCCESS="success",e.PENDING="pending",e.ERROR="error";}(d||(d={})),function(e){e.DEFAULT="default",e.ALL="all",e.MENTION_ONLY="mention_only",e.OFF="off";}(_||(_={})),function(e){e.FCM="gcm",e.APNS="apns",e.UNKNOWN="unknown";}(f$2||(f$2={})),function(e){e.ALTERNATIVE="alternative",e.DEFAULT="default";}(p$1||(p$1={})),function(e){e.CUSTOM="custom",e.MESSAGE_COLLECTION_ACCESSED_AT="messagecollection_accessed_at";}(E$1||(E$1={}));var x,U,M,P,z,F,H,V,G,q,K=function(){function e(e){var t=void 0===e?{}:e,n=t.maxSize,r=void 0===n?256:n,i=t.clearOrder,o=void 0===i?E$1.MESSAGE_COLLECTION_ACCESSED_AT:i,s=t.customClearOrderComparator;this._clearOrderComparatorUseMessageCollectionAccessedAt=function(e,t){return e.channel.messageCollectionLastAccessedAt===t.channel.messageCollectionLastAccessedAt?e.channel.lastMessage&&!t.channel.lastMessage?1:!e.channel.lastMessage&&t.channel.lastMessage?-1:e.channel.lastMessage||t.channel.lastMessage?e.channel.lastMessage.createdAt-t.channel.lastMessage.createdAt:0:e.channel.messageCollectionLastAccessedAt>t.channel.messageCollectionLastAccessedAt?1:-1},this._maxSize=Math.max(r,64),s?(this._clearOrder=o,this._customClearOrderComparator=s):this._clearOrder=E$1.MESSAGE_COLLECTION_ACCESSED_AT;}return Object.defineProperty(e.prototype,"maxSize",{get:function(){return this._maxSize},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"clearOrder",{get:function(){return this._clearOrder},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"clearOrderComparator",{get:function(){var e;return this._clearOrder===E$1.MESSAGE_COLLECTION_ACCESSED_AT?this._clearOrderComparatorUseMessageCollectionAccessedAt:null!==(e=this._customClearOrderComparator)&&void 0!==e?e:this._clearOrderComparatorUseMessageCollectionAccessedAt},enumerable:!1,configurable:!0}),e}(),B=function(){function e(){}return Object.defineProperty(e.prototype,"hasSession",{get:function(){return !!this.sessionKey},enumerable:!1,configurable:!0}),e.prototype.clear=function(){this.authToken=void 0,this.sessionKey=void 0;},e}(),Z=function(){var e=(new Date).getTime();return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)}))},W=function(){function e(e){var t=e.container;this._container={},this._container=t,this.key=Z();}return e.prototype._register=function(e,t,n){var r;return e in this._container||(this._container[e]=new Map),null===(r=this._container[e])||void 0===r||r.set(this.key,{occurence:t,handler:n}),this},e.prototype.on=function(e,t){return this._register(e,-1,t)},e.prototype.once=function(e,t){return this._register(e,1,t)},e.prototype.close=function(){var e;for(var t in this._container)null===(e=this._container[t])||void 0===e||e.delete(this.key);},e}(),Q=function(){function e(){this._container={};}return e.prototype.on=function(e,t){return new W({container:this._container}).on(e,t)},e.prototype.once=function(e,t){return new W({container:this._container}).once(e,t)},e.prototype.dispatch=function(e,t){var n,r,i=this._container[e];if(i){var o=[];try{for(var a=s(i.keys()),c=a.next();!c.done;c=a.next()){var u=c.value,l=i.get(u);l.handler(t),l.occurence>0&&(l.occurence--,0===l.occurence&&o.push(u));}}catch(e){n={error:e};}finally{try{c&&!c.done&&(r=a.return)&&r.call(a);}finally{if(n)throw n.error}}o.forEach((function(e){return i.delete(e)}));}},e}(),Y=function(){function e(){this._dispatcher=new Q;}return e.prototype.on=function(e){return this._dispatcher.on("event",e)},e.prototype.once=function(e){return this._dispatcher.once("event",e)},e.prototype.dispatch=function(e){this._dispatcher.dispatch("event",e);},e}(),X=function(){},J=function(e){var t={};return e&&Object.keys(e).forEach((function(n){void 0===e[n]||Number.isNaN(e[n])||null===e[n]||(t[n]=e[n]);})),t},$=function(e){if(null!=e){if("object"==typeof e){if(Array.isArray(e)){var t=c([],a(e),!1);for(var n in t)t[n]=$(t[n]);return t}for(var r in e)null===e[r]&&delete e[r];return e}return e}};!function(e){e.BASE="base",e.GROUP="group",e.OPEN="open",e.FEED="feed";}(x||(x={})),function(e){e.OPERATOR="operator",e.NONE="none";}(U||(U={})),function(e){e.MUTED="muted",e.UNMUTED="unmuted";}(M||(M={})),function(e){e.BASE="base",e.USER="user",e.FILE="file",e.ADMIN="admin";}(P||(P={})),function(e){e.ALL="",e.USER="MESG",e.FILE="FILE",e.ADMIN="ADMM";}(z||(z={})),function(e){e.USER="MESG",e.FILE="FILE",e.ADMIN="ADMM";}(F||(F={})),function(e){e.USERS="users",e.CHANNEL="channel";}(H||(H={})),function(e){e.ALL="all",e.NONE="none",e.ONLY_REPLY_TO_CHANNEL="only_reply_to_channel";}(V||(V={})),function(e){e.DEFAULT="default",e.SUPPRESS="suppress";}(G||(G={})),function(e){e.PENDING="pending",e.SCHEDULED="scheduled",e.SUCCEEDED="succeeded",e.FAILED="failed",e.CANCELED="canceled";}(q||(q={}));var ee,te="v3",ne="/".concat(te,"/users"),re="/".concat(te,"/storage/file"),ie="/".concat(te,"/group_channels"),se="/".concat(te,"/open_channels"),ce="/".concat(te,"/search"),ue="/".concat(te,"/report"),le="/".concat(te,"/emojis"),he="/".concat(te,"/emoji_categories"),de="/".concat(te,"/polls"),fe="/".concat(te,"/sdk/ui_kit/configuration"),pe="/".concat(te,"/sdk/statistics"),ge=function(e){switch(e){case x.FEED:case x.GROUP:return ie;case x.OPEN:return se;default:return null}},ve=function(e){switch(e){case x.GROUP:return "".concat(ue,"/group_channels");case x.OPEN:return "".concat(ue,"/open_channels");default:return null}},be=function(e,t,n){var r,i;switch(e){case H.CHANNEL:return !0;case H.USERS:if(t)try{for(var o=s(t),a=o.next();!a.done;a=o.next()){if(a.value===n)return !0}}catch(e){r={error:e};}finally{try{a&&!a.done&&(i=o.return)&&i.call(o);}finally{if(r)throw r.error}}}return !1},me=function(e,t,n){var r,i,o,s,a=be(null!==(r=e.mentionType)&&void 0!==r?r:null,null!==(i=e.mentionedUserIds)&&void 0!==i?i:[],n),c=be(null!==(o=t.mentionType)&&void 0!==o?o:null,null!==(s=t.mentionedUserIds)&&void 0!==s?s:[],n);return !a&&c?1:a&&!c?-1:0},ye=function(e,t,n){var r,i=t||new FormData;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var s=e[o],a=n?"".concat(n,"[").concat(o,"]"):o;k(s)?i.append(a,s,null!==(r=s.name)&&void 0!==r?r:"filename"):"object"!=typeof s||null===s||Array.isArray(s)||s instanceof Blob?i.append(a,String(s)):i=ye(s,i,a);}return i};!function(e){e.GET="GET",e.POST="POST",e.PUT="PUT",e.DELETE="DELETE";}(ee||(ee={}));var we$1,Ne$1=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.params={},t.requireAuth=!0,t.headers={},t.requestId=Z(),t}return t(n,e),n.prototype.encodeParams=function(e){var t=this;return null==e||""===e?encodeURIComponent(""):Array.isArray(e)?e.map((function(e){return t.encodeParams(e)})).join(","):"object"==typeof e?encodeURIComponent(JSON.stringify(e)):encodeURIComponent(String(e))},Object.defineProperty(n.prototype,"query",{get:function(){var e=this,t=J(this.params);return "?".concat(Object.keys(t).map((function(n){return "".concat(encodeURIComponent(n),"=").concat(e.encodeParams(t[n]))})).join("&"))},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"payload",{get:function(){var e=J(this.params);return Object.keys(e).some((function(t){return k(e[t])}))?ye(e):JSON.stringify(e)},enumerable:!1,configurable:!0}),n}(X),Te$1=function(e){function r(t,n){var r=e.call(this)||this;return r._iid=t,r._payload=n,r}return t(r,e),Object.defineProperty(r.prototype,"payload",{get:function(){return n({},this._payload)},enumerable:!1,configurable:!0}),r.prototype.as=function(e){return new e(this._iid,this.payload)},r}(X),Se$1=function(e){function n(t){var n=e.call(this)||this;return n.requestId=t,n}return t(n,e),n}(X),Ae$1=function(e){function n(t){var n=t.expires_in,r=t.reason,i=void 0===r?u.SESSION_KEY_EXPIRED:r,o=e.call(this)||this;switch(o.expiresIn=null!=n?n:0,i){case u.SESSION_KEY_EXPIRED:case u.SESSION_TOKEN_EXPIRED:case u.SESSION_REVOKED:case u.USER_AUTH_DEACTIVATED:case u.USER_AUTH_DELETED_OR_NOT_FOUND:o.error=new v$1({code:i});}return o}return t(n,e),Object.defineProperty(n.prototype,"invalidateSessionToken",{get:function(){var e;return !!(null===(e=this.error)||void 0===e?void 0:e.isSessionTokenExpiredError)},enumerable:!1,configurable:!0}),n}(X),Ce$1=function(e){function n(t){var n=e.call(this)||this;return n.statLog=t,n}return t(n,e),n}(X);!function(e){e.FEATURE_LOCALCACHE="feature:local_cache",e.WEBSOCKET_CONNECT="ws:connect",e.API_RESULT="api:result";}(we$1||(we$1={}));var ke$1,Oe$1,Ie,Re$1=function(){function e(e){var t=e.type,n=e.data,r=e.ts,i=void 0===r?Date.now():r;this.type=t,this.createdAt=i,this.data=n;}return e.payloadify=function(e){return J({stat_type:e.type,ts:e.createdAt,data:J(e.data)})},e}(),De$1=function(){return "undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"==navigator.product},Le$1=function(){return !("undefined"==typeof navigator||!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Windows Phone/i.test(navigator.userAgent))};!function(e){e.CHAT="chat",e.CALLS="calls",e.DESK="desk",e.LIVE="live",e.UIKIT_CHAT="uikit-chat",e.UIKIT_LIVE="uikit-live";}(ke$1||(ke$1={})),function(e){e.ANDROID="android",e.IOS="ios",e.JS="js",e.UNREAL="unreal",e.UNITY="unity",e.REACT_NATIVE="react-native",e.FLUTTER="flutter";}(Oe$1||(Oe$1={})),function(e){e.ANDROID="android",e.IOS="ios",e.WEB="web",e.MOBILE_WEB="mobile_web",e.WINDOWS="windows";}(Ie||(Ie={}));var xe$1="^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$",Ue$1=function(){function e(){}return e.sendbirdSdkUserAgentWithExtension=function(e){var t=De$1()?Oe$1.REACT_NATIVE:Oe$1.JS,r={main_sdk_info:"chat/".concat(t,"/").concat(h.SDK_VERSION),device_os_platform:Le$1()?"mobile-web":"web",os_version:h.OS_VERSION};if(e){var i=e.sendbirdExtensions,o=e.deviceOS,s=e.customData,c=void 0===s?{}:s;o.version&&(r.os_version=o.version),o.platform&&(r.device_os_platform=o.platform),i.length>0&&(r.extension_sdk_info=i.map((function(e){var t=e.product,n=e.platform,r=e.version;return "".concat(t,"/").concat(n,"/").concat(r)})).join(",")),Object.keys(r).forEach((function(e){return delete c[e]})),Object.keys(c).length>0&&(r=n(n({},r),c));}return Object.entries(r).map((function(e){var t=a(e,2),n=t[0],r=t[1];return "".concat(n,"=").concat(r)})).join("&")},e.userAgentWithExtension=function(e){var t=De$1()?"reactnative":"JS",n=e.sb_syncmanager?"s".concat(e.sb_syncmanager):"",r=e.sb_uikit?"u".concat(e.sb_uikit):"",i=e["device-os-platform"]?"o".concat(e["device-os-platform"]):Le$1()?"omobile-web":"oweb";return "".concat(t,"/c").concat(h.SDK_VERSION,"/").concat(n,"/").concat(r,"/").concat(i)},e}(),Me$1=function(){function e(e,t){var n=t.auth,r=t.sdkState,i=t.dispatcher,o=t.logger,s=t.useFetchCompat,a=void 0!==s&&s,c=this;this._abortControl=new Map,this._shouldImportFetchCompat=!1,this._iid=e,this._auth=n,this._sdkState=r,this._dispatcher=i,this._dispatcher.on((function(e){e instanceof Se$1&&c.cancel(e.requestId);})),this._logger=o,this._shouldImportFetchCompat=a;}return e.prototype._createHeader=function(e,t){var r=this._sdkState,i=r.appId,o=r.appVersion,s=r.sendbirdRuntimeEnvironment,a=n(n({},e.headers),{SendBird:"JS,".concat(h.OS_VERSION,",").concat(h.SDK_VERSION,",").concat(i).concat(o?",".concat(o):""),"SB-User-Agent":Ue$1.userAgentWithExtension(this._sdkState.extensions),"Request-Sent-Timestamp":Date.now().toString(),"SB-SDK-User-Agent":Ue$1.sendbirdSdkUserAgentWithExtension(s)});return t||(a["Content-Type"]="application/json; charset=utf-8"),e.requireAuth&&this._auth.hasSession&&(a["Session-Key"]=this._auth.sessionKey),this._auth&&this._auth.authToken&&(a["App-Id"]=i,a["Access-Token"]=this._auth.authToken),a},e.prototype._statLogApiResult=function(e,t,n){this._dispatcher.dispatch(new Ce$1(new Re$1({type:we$1.API_RESULT,data:{endpoint:e.path,method:e.method,success:!n,latency:Date.now()-t,error_code:null==n?void 0:n.code,error_description:null==n?void 0:n.message}})));},e.prototype.send=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,s,a,c,u,l,h,d,_,f,p,E;return o(this,(function(o){switch(o.label){case 0:t=e.path,n=e.method,r=![ee.GET,ee.DELETE].includes(n),i=this._sdkState.api,s="".concat(i.host).concat(t).concat(r?"":e.query),a=r?e.payload:null,c=this._createHeader(e,a instanceof FormData?a:void 0),u=new AbortController,l=u.signal,this._abortControl.set(e.requestId,u),h=Date.now(),o.label=1;case 1:return o.trys.push([1,8,,9]),this._shouldImportFetchCompat&&(this._shouldImportFetchCompat=!1,("undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||"undefined"!=typeof global&&global||{fetch:null}).fetch=null),"undefined"!=typeof AbortController?[3,3]:[4,import('./__bundle-2aa1a987-43644888.js')];case 2:o.sent(),o.label=3;case 3:return "function"==typeof fetch?[3,5]:[4,import('./__bundle-57274663-cef6f45b.js')];case 4:o.sent(),o.label=5;case 5:return [4,fetch(s,{method:n,body:a,headers:c,signal:l})];case 6:return [4,(d=o.sent()).json()];case 7:if(_=o.sent(),d.ok||d.redirected)return this._logger.debug("receive api response",e.requestId),this._statLogApiResult(e,h),[2,new Te$1(this._iid,_)];throw _?(((f=new v$1(_)).isSessionKeyExpiredError||f.isSessionTokenExpiredError)&&this._dispatcher.dispatch(new Ae$1({reason:f.code})),this._statLogApiResult(e,h,f),f):(f=v$1.requestFailed,this._statLogApiResult(e,h,f),f);case 8:throw p=o.sent(),this._statLogApiResult(e,h,p),p instanceof v$1?(this._logger.debug("fail api request",p),p):"AbortError"===p.name?v$1.requestCanceled:(E=v$1.networkError,this._logger.debug("fail api request",E),E);case 9:return [2]}}))}))},e.prototype.cancel=function(e){this._abortControl.has(e)&&(this._abortControl.get(e).abort(),this._abortControl.delete(e));},e.prototype.cancelAll=function(){var e,t;try{for(var n=s(this._abortControl.values()),r=n.next();!r.done;r=n.next()){r.value.abort();}}catch(t){e={error:t};}finally{try{r&&!r.done&&(t=n.return)&&t.call(n);}finally{if(e)throw e.error}}this._abortControl.clear();},e}(),Pe$1=function(e){function n(t,n,r,i){void 0===i&&(i="");var o,s=this;return (s=e.call(this)||this)._iid=t,s.code=n,s.payload=r,s.requestId=null!==(o=r.req_id)&&void 0!==o?o:i,s}return t(n,e),n.createFromRawMessage=function(e,t){var r=t.substring(0,4),i={};try{i=JSON.parse(t.substring(4));}catch(e){r="NOOP";}finally{return new n(e,r,i)}},n.prototype.convertToMessage=function(){return "".concat(this.code).concat(JSON.stringify(this.payload),"\n")},n.prototype.as=function(e){return new e(this._iid,this.code,this.payload)},n}(X),ze$1=function(){};function Fe$1(e){let t=e.length;for(;--t>=0;)e[t]=0;}const He$1=256,Ve=286,Ge$1=30,qe$1=15,je$1=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Ke$1=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Be$1=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Ze$1=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),We$1=new Array(576);Fe$1(We$1);const Qe$1=new Array(60);Fe$1(Qe$1);const Ye$1=new Array(512);Fe$1(Ye$1);const Xe$1=new Array(256);Fe$1(Xe$1);const Je$1=new Array(29);Fe$1(Je$1);const $e$1=new Array(Ge$1);function et$1(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length;}let tt$1,nt$1,rt$1;function it$2(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t;}Fe$1($e$1);const ot$2=e=>e<256?Ye$1[e]:Ye$1[256+(e>>>7)],st$2=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255;},at$2=(e,t,n)=>{e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,st$2(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n);},ct$2=(e,t,n)=>{at$2(e,n[2*t],n[2*t+1]);},ut$2=(e,t)=>{let n=0;do{n|=1&e,e>>>=1,n<<=1;}while(--t>0);return n>>>1},lt$2=(e,t,n)=>{const r=new Array(16);let i,o,s=0;for(i=1;i<=qe$1;i++)s=s+n[i-1]<<1,r[i]=s;for(o=0;o<=t;o++){let t=e[2*o+1];0!==t&&(e[2*o]=ut$2(r[t]++,t));}},ht$2=e=>{let t;for(t=0;t<Ve;t++)e.dyn_ltree[2*t]=0;for(t=0;t<Ge$1;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0;},dt$2=e=>{e.bi_valid>8?st$2(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0;},_t$1=(e,t,n,r)=>{const i=2*t,o=2*n;return e[i]<e[o]||e[i]===e[o]&&r[t]<=r[n]},ft$2=(e,t,n)=>{const r=e.heap[n];let i=n<<1;for(;i<=e.heap_len&&(i<e.heap_len&&_t$1(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!_t$1(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r;},pt$2=(e,t,n)=>{let r,i,o,s,a=0;if(0!==e.sym_next)do{r=255&e.pending_buf[e.sym_buf+a++],r+=(255&e.pending_buf[e.sym_buf+a++])<<8,i=e.pending_buf[e.sym_buf+a++],0===r?ct$2(e,i,t):(o=Xe$1[i],ct$2(e,o+He$1+1,t),s=je$1[o],0!==s&&(i-=Je$1[o],at$2(e,i,s)),r--,o=ot$2(r),ct$2(e,o,n),s=Ke$1[o],0!==s&&(r-=$e$1[o],at$2(e,r,s)));}while(a<e.sym_next);ct$2(e,256,t);},Et$2=(e,t)=>{const n=t.dyn_tree,r=t.stat_desc.static_tree,i=t.stat_desc.has_stree,o=t.stat_desc.elems;let s,a,c,u=-1;for(e.heap_len=0,e.heap_max=573,s=0;s<o;s++)0!==n[2*s]?(e.heap[++e.heap_len]=u=s,e.depth[s]=0):n[2*s+1]=0;for(;e.heap_len<2;)c=e.heap[++e.heap_len]=u<2?++u:0,n[2*c]=1,e.depth[c]=0,e.opt_len--,i&&(e.static_len-=r[2*c+1]);for(t.max_code=u,s=e.heap_len>>1;s>=1;s--)ft$2(e,n,s);c=o;do{s=e.heap[1],e.heap[1]=e.heap[e.heap_len--],ft$2(e,n,1),a=e.heap[1],e.heap[--e.heap_max]=s,e.heap[--e.heap_max]=a,n[2*c]=n[2*s]+n[2*a],e.depth[c]=(e.depth[s]>=e.depth[a]?e.depth[s]:e.depth[a])+1,n[2*s+1]=n[2*a+1]=c,e.heap[1]=c++,ft$2(e,n,1);}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const n=t.dyn_tree,r=t.max_code,i=t.stat_desc.static_tree,o=t.stat_desc.has_stree,s=t.stat_desc.extra_bits,a=t.stat_desc.extra_base,c=t.stat_desc.max_length;let u,l,h,d,_,f,p=0;for(d=0;d<=qe$1;d++)e.bl_count[d]=0;for(n[2*e.heap[e.heap_max]+1]=0,u=e.heap_max+1;u<573;u++)l=e.heap[u],d=n[2*n[2*l+1]+1]+1,d>c&&(d=c,p++),n[2*l+1]=d,l>r||(e.bl_count[d]++,_=0,l>=a&&(_=s[l-a]),f=n[2*l],e.opt_len+=f*(d+_),o&&(e.static_len+=f*(i[2*l+1]+_)));if(0!==p){do{for(d=c-1;0===e.bl_count[d];)d--;e.bl_count[d]--,e.bl_count[d+1]+=2,e.bl_count[c]--,p-=2;}while(p>0);for(d=c;0!==d;d--)for(l=e.bl_count[d];0!==l;)h=e.heap[--u],h>r||(n[2*h+1]!==d&&(e.opt_len+=(d-n[2*h+1])*n[2*h],n[2*h+1]=d),l--);}})(e,t),lt$2(n,u,e.bl_count);},gt$2=(e,t,n)=>{let r,i,o=-1,s=t[1],a=0,c=7,u=4;for(0===s&&(c=138,u=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)i=s,s=t[2*(r+1)+1],++a<c&&i===s||(a<u?e.bl_tree[2*i]+=a:0!==i?(i!==o&&e.bl_tree[2*i]++,e.bl_tree[32]++):a<=10?e.bl_tree[34]++:e.bl_tree[36]++,a=0,o=i,0===s?(c=138,u=3):i===s?(c=6,u=3):(c=7,u=4));},vt$2=(e,t,n)=>{let r,i,o=-1,s=t[1],a=0,c=7,u=4;for(0===s&&(c=138,u=3),r=0;r<=n;r++)if(i=s,s=t[2*(r+1)+1],!(++a<c&&i===s)){if(a<u)do{ct$2(e,i,e.bl_tree);}while(0!=--a);else 0!==i?(i!==o&&(ct$2(e,i,e.bl_tree),a--),ct$2(e,16,e.bl_tree),at$2(e,a-3,2)):a<=10?(ct$2(e,17,e.bl_tree),at$2(e,a-3,3)):(ct$2(e,18,e.bl_tree),at$2(e,a-11,7));a=0,o=i,0===s?(c=138,u=3):i===s?(c=6,u=3):(c=7,u=4);}};let bt$2=!1;const mt$2=(e,t,n,r)=>{at$2(e,0+(r?1:0),3),dt$2(e),st$2(e,n),st$2(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n;};var yt$2=(e,t,n,r)=>{let i,o,s=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<He$1;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),Et$2(e,e.l_desc),Et$2(e,e.d_desc),s=(e=>{let t;for(gt$2(e,e.dyn_ltree,e.l_desc.max_code),gt$2(e,e.dyn_dtree,e.d_desc.max_code),Et$2(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*Ze$1[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),i=e.opt_len+3+7>>>3,o=e.static_len+3+7>>>3,o<=i&&(i=o)):i=o=n+5,n+4<=i&&-1!==t?mt$2(e,t,n,r):4===e.strategy||o===i?(at$2(e,2+(r?1:0),3),pt$2(e,We$1,Qe$1)):(at$2(e,4+(r?1:0),3),((e,t,n,r)=>{let i;for(at$2(e,t-257,5),at$2(e,n-1,5),at$2(e,r-4,4),i=0;i<r;i++)at$2(e,e.bl_tree[2*Ze$1[i]+1],3);vt$2(e,e.dyn_ltree,t-1),vt$2(e,e.dyn_dtree,n-1);})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,s+1),pt$2(e,e.dyn_ltree,e.dyn_dtree)),ht$2(e),r&&dt$2(e);},wt$2={_tr_init:e=>{bt$2||((()=>{let e,t,n,r,i;const o=new Array(16);for(n=0,r=0;r<28;r++)for(Je$1[r]=n,e=0;e<1<<je$1[r];e++)Xe$1[n++]=r;for(Xe$1[n-1]=r,i=0,r=0;r<16;r++)for($e$1[r]=i,e=0;e<1<<Ke$1[r];e++)Ye$1[i++]=r;for(i>>=7;r<Ge$1;r++)for($e$1[r]=i<<7,e=0;e<1<<Ke$1[r]-7;e++)Ye$1[256+i++]=r;for(t=0;t<=qe$1;t++)o[t]=0;for(e=0;e<=143;)We$1[2*e+1]=8,e++,o[8]++;for(;e<=255;)We$1[2*e+1]=9,e++,o[9]++;for(;e<=279;)We$1[2*e+1]=7,e++,o[7]++;for(;e<=287;)We$1[2*e+1]=8,e++,o[8]++;for(lt$2(We$1,287,o),e=0;e<Ge$1;e++)Qe$1[2*e+1]=5,Qe$1[2*e]=ut$2(e,5);tt$1=new et$1(We$1,je$1,257,Ve,qe$1),nt$1=new et$1(Qe$1,Ke$1,0,Ge$1,qe$1),rt$1=new et$1(new Array(0),Be$1,0,19,7);})(),bt$2=!0),e.l_desc=new it$2(e.dyn_ltree,tt$1),e.d_desc=new it$2(e.dyn_dtree,nt$1),e.bl_desc=new it$2(e.bl_tree,rt$1),e.bi_buf=0,e.bi_valid=0,ht$2(e);},_tr_stored_block:mt$2,_tr_flush_block:yt$2,_tr_tally:(e,t,n)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(Xe$1[n]+He$1+1)]++,e.dyn_dtree[2*ot$2(t)]++),e.sym_next===e.sym_end),_tr_align:e=>{at$2(e,2,3),ct$2(e,256,We$1),(e=>{16===e.bi_valid?(st$2(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8);})(e);}};var Nt$2=(e,t,n,r)=>{let i=65535&e|0,o=e>>>16&65535|0,s=0;for(;0!==n;){s=n>2e3?2e3:n,n-=s;do{i=i+t[r++]|0,o=o+i|0;}while(--s);i%=65521,o%=65521;}return i|o<<16|0};const Tt$2=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e;}return t})());var St$2=(e,t,n,r)=>{const i=Tt$2,o=r+n;e^=-1;for(let n=r;n<o;n++)e=e>>>8^i[255&(e^t[n])];return -1^e},At$2={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Ct$2={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:kt$2,_tr_stored_block:Ot$2,_tr_flush_block:It$2,_tr_tally:Rt$2,_tr_align:Dt$2}=wt$2,{Z_NO_FLUSH:Lt$2,Z_PARTIAL_FLUSH:xt$2,Z_FULL_FLUSH:Ut$2,Z_FINISH:Mt$2,Z_BLOCK:Pt$2,Z_OK:zt$2,Z_STREAM_END:Ft$2,Z_STREAM_ERROR:Ht$2,Z_DATA_ERROR:Vt$2,Z_BUF_ERROR:Gt$2,Z_DEFAULT_COMPRESSION:qt$2,Z_FILTERED:jt$2,Z_HUFFMAN_ONLY:Kt$2,Z_RLE:Bt$2,Z_FIXED:Zt$2,Z_DEFAULT_STRATEGY:Wt$2,Z_UNKNOWN:Qt$2,Z_DEFLATED:Yt$2}=Ct$2,Xt$2=258,Jt$2=262,$t$2=42,en$2=113,tn$2=666,nn$1=(e,t)=>(e.msg=At$2[t],t),rn$2=e=>2*e-(e>4?9:0),on$2=e=>{let t=e.length;for(;--t>=0;)e[t]=0;},sn$2=e=>{let t,n,r,i=e.w_size;t=e.hash_size,r=t;do{n=e.head[--r],e.head[r]=n>=i?n-i:0;}while(--t);t=i,r=t;do{n=e.prev[--r],e.prev[r]=n>=i?n-i:0;}while(--t)};let an$2=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask;const cn$2=e=>{const t=e.state;let n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0));},un$2=(e,t)=>{It$2(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,cn$2(e.strm);},ln$2=(e,t)=>{e.pending_buf[e.pending++]=t;},hn$1=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t;},dn$2=(e,t,n,r)=>{let i=e.avail_in;return i>r&&(i=r),0===i?0:(e.avail_in-=i,t.set(e.input.subarray(e.next_in,e.next_in+i),n),1===e.state.wrap?e.adler=Nt$2(e.adler,t,i,n):2===e.state.wrap&&(e.adler=St$2(e.adler,t,i,n)),e.next_in+=i,e.total_in+=i,i)},_n=(e,t)=>{let n,r,i=e.max_chain_length,o=e.strstart,s=e.prev_length,a=e.nice_match;const c=e.strstart>e.w_size-Jt$2?e.strstart-(e.w_size-Jt$2):0,u=e.window,l=e.w_mask,h=e.prev,d=e.strstart+Xt$2;let _=u[o+s-1],f=u[o+s];e.prev_length>=e.good_match&&(i>>=2),a>e.lookahead&&(a=e.lookahead);do{if(n=t,u[n+s]===f&&u[n+s-1]===_&&u[n]===u[o]&&u[++n]===u[o+1]){o+=2,n++;do{}while(u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&o<d);if(r=Xt$2-(d-o),o=d-Xt$2,r>s){if(e.match_start=t,s=r,r>=a)break;_=u[o+s-1],f=u[o+s];}}}while((t=h[t&l])>c&&0!=--i);return s<=e.lookahead?s:e.lookahead},fn$1=e=>{const t=e.w_size;let n,r,i;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-Jt$2)&&(e.window.set(e.window.subarray(t,t+t-r),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),sn$2(e),r+=t),0===e.strm.avail_in)break;if(n=dn$2(e.strm,e.window,e.strstart+e.lookahead,r),e.lookahead+=n,e.lookahead+e.insert>=3)for(i=e.strstart-e.insert,e.ins_h=e.window[i],e.ins_h=an$2(e,e.ins_h,e.window[i+1]);e.insert&&(e.ins_h=an$2(e,e.ins_h,e.window[i+3-1]),e.prev[i&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=i,i++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Jt$2&&0!==e.strm.avail_in)},pn=(e,t)=>{let n,r,i,o=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,s=0,a=e.strm.avail_in;do{if(n=65535,i=e.bi_valid+42>>3,e.strm.avail_out<i)break;if(i=e.strm.avail_out-i,r=e.strstart-e.block_start,n>r+e.strm.avail_in&&(n=r+e.strm.avail_in),n>i&&(n=i),n<o&&(0===n&&t!==Mt$2||t===Lt$2||n!==r+e.strm.avail_in))break;s=t===Mt$2&&n===r+e.strm.avail_in?1:0,Ot$2(e,0,0,s),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,cn$2(e.strm),r&&(r>n&&(r=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+r),e.strm.next_out),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r,e.block_start+=r,n-=r),n&&(dn$2(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n);}while(0===s);return a-=e.strm.avail_in,a&&(a>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=a&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-a,e.strm.next_in),e.strstart),e.strstart+=a,e.insert+=a>e.w_size-e.insert?e.w_size-e.insert:a),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),s?4:t!==Lt$2&&t!==Mt$2&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(i=e.window_size-e.strstart,e.strm.avail_in>i&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,i+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),i>e.strm.avail_in&&(i=e.strm.avail_in),i&&(dn$2(e.strm,e.window,e.strstart,i),e.strstart+=i,e.insert+=i>e.w_size-e.insert?e.w_size-e.insert:i),e.high_water<e.strstart&&(e.high_water=e.strstart),i=e.bi_valid+42>>3,i=e.pending_buf_size-i>65535?65535:e.pending_buf_size-i,o=i>e.w_size?e.w_size:i,r=e.strstart-e.block_start,(r>=o||(r||t===Mt$2)&&t!==Lt$2&&0===e.strm.avail_in&&r<=i)&&(n=r>i?i:r,s=t===Mt$2&&0===e.strm.avail_in&&n===r?1:0,Ot$2(e,e.block_start,n,s),e.block_start+=n,cn$2(e.strm)),s?3:1)},En=(e,t)=>{let n,r;for(;;){if(e.lookahead<Jt$2){if(fn$1(e),e.lookahead<Jt$2&&t===Lt$2)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=an$2(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-Jt$2&&(e.match_length=_n(e,n)),e.match_length>=3)if(r=Rt$2(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=an$2(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;}while(0!=--e.match_length);e.strstart++;}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=an$2(e,e.ins_h,e.window[e.strstart+1]);else r=Rt$2(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(un$2(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===Mt$2?(un$2(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(un$2(e,!1),0===e.strm.avail_out)?1:2},gn$1=(e,t)=>{let n,r,i;for(;;){if(e.lookahead<Jt$2){if(fn$1(e),e.lookahead<Jt$2&&t===Lt$2)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=an$2(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-Jt$2&&(e.match_length=_n(e,n),e.match_length<=5&&(e.strategy===jt$2||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,r=Rt$2(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=an$2(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(un$2(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(r=Rt$2(e,0,e.window[e.strstart-1]),r&&un$2(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--;}return e.match_available&&(r=Rt$2(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===Mt$2?(un$2(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(un$2(e,!1),0===e.strm.avail_out)?1:2};function vn$1(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i;}const bn=[new vn$1(0,0,0,0,pn),new vn$1(4,4,8,4,En),new vn$1(4,5,16,8,En),new vn$1(4,6,32,32,En),new vn$1(4,4,16,16,gn$1),new vn$1(8,16,32,32,gn$1),new vn$1(8,16,128,128,gn$1),new vn$1(8,32,128,256,gn$1),new vn$1(32,128,258,1024,gn$1),new vn$1(32,258,258,4096,gn$1)];function mn$1(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Yt$2,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),on$2(this.dyn_ltree),on$2(this.dyn_dtree),on$2(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),on$2(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),on$2(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0;}const yn$1=e=>{if(!e)return 1;const t=e.state;return !t||t.strm!==e||t.status!==$t$2&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==en$2&&t.status!==tn$2?1:0},wn=e=>{if(yn$1(e))return nn$1(e,Ht$2);e.total_in=e.total_out=0,e.data_type=Qt$2;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?$t$2:en$2,e.adler=2===t.wrap?0:1,t.last_flush=-2,kt$2(t),zt$2},Nn$1=e=>{const t=wn(e);var n;return t===zt$2&&((n=e.state).window_size=2*n.w_size,on$2(n.head),n.max_lazy_match=bn[n.level].max_lazy,n.good_match=bn[n.level].good_length,n.nice_match=bn[n.level].nice_length,n.max_chain_length=bn[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0),t},Tn$1=(e,t,n,r,i,o)=>{if(!e)return Ht$2;let s=1;if(t===qt$2&&(t=6),r<0?(s=0,r=-r):r>15&&(s=2,r-=16),i<1||i>9||n!==Yt$2||r<8||r>15||t<0||t>9||o<0||o>Zt$2||8===r&&1!==s)return nn$1(e,Ht$2);8===r&&(r=9);const a=new mn$1;return e.state=a,a.strm=e,a.status=$t$2,a.wrap=s,a.gzhead=null,a.w_bits=r,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=i+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+3-1)/3),a.window=new Uint8Array(2*a.w_size),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<i+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new Uint8Array(a.pending_buf_size),a.sym_buf=a.lit_bufsize,a.sym_end=3*(a.lit_bufsize-1),a.level=t,a.strategy=o,a.method=n,Nn$1(e)};var Sn={deflateInit:(e,t)=>Tn$1(e,t,Yt$2,15,8,Wt$2),deflateInit2:Tn$1,deflateReset:Nn$1,deflateResetKeep:wn,deflateSetHeader:(e,t)=>yn$1(e)||2!==e.state.wrap?Ht$2:(e.state.gzhead=t,zt$2),deflate:(e,t)=>{if(yn$1(e)||t>Pt$2||t<0)return e?nn$1(e,Ht$2):Ht$2;const n=e.state;if(!e.output||0!==e.avail_in&&!e.input||n.status===tn$2&&t!==Mt$2)return nn$1(e,0===e.avail_out?Gt$2:Ht$2);const r=n.last_flush;if(n.last_flush=t,0!==n.pending){if(cn$2(e),0===e.avail_out)return n.last_flush=-1,zt$2}else if(0===e.avail_in&&rn$2(t)<=rn$2(r)&&t!==Mt$2)return nn$1(e,Gt$2);if(n.status===tn$2&&0!==e.avail_in)return nn$1(e,Gt$2);if(n.status===$t$2&&0===n.wrap&&(n.status=en$2),n.status===$t$2){let t=Yt$2+(n.w_bits-8<<4)<<8,r=-1;if(r=n.strategy>=Kt$2||n.level<2?0:n.level<6?1:6===n.level?2:3,t|=r<<6,0!==n.strstart&&(t|=32),t+=31-t%31,hn$1(n,t),0!==n.strstart&&(hn$1(n,e.adler>>>16),hn$1(n,65535&e.adler)),e.adler=1,n.status=en$2,cn$2(e),0!==n.pending)return n.last_flush=-1,zt$2}if(57===n.status)if(e.adler=0,ln$2(n,31),ln$2(n,139),ln$2(n,8),n.gzhead)ln$2(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),ln$2(n,255&n.gzhead.time),ln$2(n,n.gzhead.time>>8&255),ln$2(n,n.gzhead.time>>16&255),ln$2(n,n.gzhead.time>>24&255),ln$2(n,9===n.level?2:n.strategy>=Kt$2||n.level<2?4:0),ln$2(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(ln$2(n,255&n.gzhead.extra.length),ln$2(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=St$2(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(ln$2(n,0),ln$2(n,0),ln$2(n,0),ln$2(n,0),ln$2(n,0),ln$2(n,9===n.level?2:n.strategy>=Kt$2||n.level<2?4:0),ln$2(n,3),n.status=en$2,cn$2(e),0!==n.pending)return n.last_flush=-1,zt$2;if(69===n.status){if(n.gzhead.extra){let t=n.pending,r=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+r>n.pending_buf_size;){let i=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+i),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>t&&(e.adler=St$2(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex+=i,cn$2(e),0!==n.pending)return n.last_flush=-1,zt$2;t=0,r-=i;}let i=new Uint8Array(n.gzhead.extra);n.pending_buf.set(i.subarray(n.gzindex,n.gzindex+r),n.pending),n.pending+=r,n.gzhead.hcrc&&n.pending>t&&(e.adler=St$2(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex=0;}n.status=73;}if(73===n.status){if(n.gzhead.name){let t,r=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>r&&(e.adler=St$2(e.adler,n.pending_buf,n.pending-r,r)),cn$2(e),0!==n.pending)return n.last_flush=-1,zt$2;r=0;}t=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,ln$2(n,t);}while(0!==t);n.gzhead.hcrc&&n.pending>r&&(e.adler=St$2(e.adler,n.pending_buf,n.pending-r,r)),n.gzindex=0;}n.status=91;}if(91===n.status){if(n.gzhead.comment){let t,r=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>r&&(e.adler=St$2(e.adler,n.pending_buf,n.pending-r,r)),cn$2(e),0!==n.pending)return n.last_flush=-1,zt$2;r=0;}t=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,ln$2(n,t);}while(0!==t);n.gzhead.hcrc&&n.pending>r&&(e.adler=St$2(e.adler,n.pending_buf,n.pending-r,r));}n.status=103;}if(103===n.status){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(cn$2(e),0!==n.pending))return n.last_flush=-1,zt$2;ln$2(n,255&e.adler),ln$2(n,e.adler>>8&255),e.adler=0;}if(n.status=en$2,cn$2(e),0!==n.pending)return n.last_flush=-1,zt$2}if(0!==e.avail_in||0!==n.lookahead||t!==Lt$2&&n.status!==tn$2){let r=0===n.level?pn(n,t):n.strategy===Kt$2?((e,t)=>{let n;for(;;){if(0===e.lookahead&&(fn$1(e),0===e.lookahead)){if(t===Lt$2)return 1;break}if(e.match_length=0,n=Rt$2(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(un$2(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Mt$2?(un$2(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(un$2(e,!1),0===e.strm.avail_out)?1:2})(n,t):n.strategy===Bt$2?((e,t)=>{let n,r,i,o;const s=e.window;for(;;){if(e.lookahead<=Xt$2){if(fn$1(e),e.lookahead<=Xt$2&&t===Lt$2)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(i=e.strstart-1,r=s[i],r===s[++i]&&r===s[++i]&&r===s[++i])){o=e.strstart+Xt$2;do{}while(r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&i<o);e.match_length=Xt$2-(o-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead);}if(e.match_length>=3?(n=Rt$2(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=Rt$2(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(un$2(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Mt$2?(un$2(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(un$2(e,!1),0===e.strm.avail_out)?1:2})(n,t):bn[n.level].func(n,t);if(3!==r&&4!==r||(n.status=tn$2),1===r||3===r)return 0===e.avail_out&&(n.last_flush=-1),zt$2;if(2===r&&(t===xt$2?Dt$2(n):t!==Pt$2&&(Ot$2(n,0,0,!1),t===Ut$2&&(on$2(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),cn$2(e),0===e.avail_out))return n.last_flush=-1,zt$2}return t!==Mt$2?zt$2:n.wrap<=0?Ft$2:(2===n.wrap?(ln$2(n,255&e.adler),ln$2(n,e.adler>>8&255),ln$2(n,e.adler>>16&255),ln$2(n,e.adler>>24&255),ln$2(n,255&e.total_in),ln$2(n,e.total_in>>8&255),ln$2(n,e.total_in>>16&255),ln$2(n,e.total_in>>24&255)):(hn$1(n,e.adler>>>16),hn$1(n,65535&e.adler)),cn$2(e),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?zt$2:Ft$2)},deflateEnd:e=>{if(yn$1(e))return Ht$2;const t=e.state.status;return e.state=null,t===en$2?nn$1(e,Vt$2):zt$2},deflateSetDictionary:(e,t)=>{let n=t.length;if(yn$1(e))return Ht$2;const r=e.state,i=r.wrap;if(2===i||1===i&&r.status!==$t$2||r.lookahead)return Ht$2;if(1===i&&(e.adler=Nt$2(e.adler,t,n,0)),r.wrap=0,n>=r.w_size){0===i&&(on$2(r.head),r.strstart=0,r.block_start=0,r.insert=0);let e=new Uint8Array(r.w_size);e.set(t.subarray(n-r.w_size,n),0),t=e,n=r.w_size;}const o=e.avail_in,s=e.next_in,a=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,fn$1(r);r.lookahead>=3;){let e=r.strstart,t=r.lookahead-2;do{r.ins_h=an$2(r,r.ins_h,r.window[e+3-1]),r.prev[e&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=e,e++;}while(--t);r.strstart=e,r.lookahead=2,fn$1(r);}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=s,e.input=a,e.avail_in=o,r.wrap=i,zt$2},deflateInfo:"pako deflate (from Nodeca project)"};const An$1=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var Cn$1={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(const t in n)An$1(n,t)&&(e[t]=n[t]);}}return e},flattenChunks:e=>{let t=0;for(let n=0,r=e.length;n<r;n++)t+=e[n].length;const n=new Uint8Array(t);for(let t=0,r=0,i=e.length;t<i;t++){let i=e[t];n.set(i,r),r+=i.length;}return n}};let kn$1=!0;try{String.fromCharCode.apply(null,new Uint8Array(1));}catch(e){kn$1=!1;}const On$1=new Uint8Array(256);for(let e=0;e<256;e++)On$1[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;On$1[254]=On$1[254]=1;var In$1={string2buf:e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return (new TextEncoder).encode(e);let t,n,r,i,o,s=e.length,a=0;for(i=0;i<s;i++)n=e.charCodeAt(i),55296==(64512&n)&&i+1<s&&(r=e.charCodeAt(i+1),56320==(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),i++)),a+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(a),o=0,i=0;o<a;i++)n=e.charCodeAt(i),55296==(64512&n)&&i+1<s&&(r=e.charCodeAt(i+1),56320==(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),i++)),n<128?t[o++]=n:n<2048?(t[o++]=192|n>>>6,t[o++]=128|63&n):n<65536?(t[o++]=224|n>>>12,t[o++]=128|n>>>6&63,t[o++]=128|63&n):(t[o++]=240|n>>>18,t[o++]=128|n>>>12&63,t[o++]=128|n>>>6&63,t[o++]=128|63&n);return t},buf2string:(e,t)=>{const n=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return (new TextDecoder).decode(e.subarray(0,t));let r,i;const o=new Array(2*n);for(i=0,r=0;r<n;){let t=e[r++];if(t<128){o[i++]=t;continue}let s=On$1[t];if(s>4)o[i++]=65533,r+=s-1;else {for(t&=2===s?31:3===s?15:7;s>1&&r<n;)t=t<<6|63&e[r++],s--;s>1?o[i++]=65533:t<65536?o[i++]=t:(t-=65536,o[i++]=55296|t>>10&1023,o[i++]=56320|1023&t);}}return ((e,t)=>{if(t<65534&&e.subarray&&kn$1)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let n="";for(let r=0;r<t;r++)n+=String.fromCharCode(e[r]);return n})(o,i)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+On$1[e[n]]>t?n:t}};var Rn$1=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0;};const Dn=Object.prototype.toString,{Z_NO_FLUSH:Ln$1,Z_SYNC_FLUSH:xn$1,Z_FULL_FLUSH:Un$1,Z_FINISH:Mn$1,Z_OK:Pn$1,Z_STREAM_END:zn$1,Z_DEFAULT_COMPRESSION:Fn$1,Z_DEFAULT_STRATEGY:Hn$1,Z_DEFLATED:Vn$1}=Ct$2;function Gn$1(e){this.options=Cn$1.assign({level:Fn$1,method:Vn$1,chunkSize:16384,windowBits:15,memLevel:8,strategy:Hn$1},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Rn$1,this.strm.avail_out=0;let n=Sn.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==Pn$1)throw new Error(At$2[n]);if(t.header&&Sn.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?In$1.string2buf(t.dictionary):"[object ArrayBuffer]"===Dn.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,n=Sn.deflateSetDictionary(this.strm,e),n!==Pn$1)throw new Error(At$2[n]);this._dict_set=!0;}}function qn$1(e,t){const n=new Gn$1(t);if(n.push(e,!0),n.err)throw n.msg||At$2[n.err];return n.result}Gn$1.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize;let i,o;if(this.ended)return !1;for(o=t===~~t?t:!0===t?Mn$1:Ln$1,"string"==typeof e?n.input=In$1.string2buf(e):"[object ArrayBuffer]"===Dn.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;)if(0===n.avail_out&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),(o===xn$1||o===Un$1)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else {if(i=Sn.deflate(n,o),i===zn$1)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),i=Sn.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===Pn$1;if(0!==n.avail_out){if(o>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(0===n.avail_in)break}else this.onData(n.output);}return !0},Gn$1.prototype.onData=function(e){this.chunks.push(e);},Gn$1.prototype.onEnd=function(e){e===Pn$1&&(this.result=Cn$1.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg;};var jn$1={Deflate:Gn$1,deflate:qn$1,deflateRaw:function(e,t){return (t=t||{}).raw=!0,qn$1(e,t)},gzip:function(e,t){return (t=t||{}).gzip=!0,qn$1(e,t)},constants:Ct$2};const Kn$1=16209;var Bn$1=function(e,t){let n,r,i,o,s,a,c,u,l,h,d,_,f,p,E,g,v,b,m,y,w,N,T,S;const A=e.state;n=e.next_in,T=e.input,r=n+(e.avail_in-5),i=e.next_out,S=e.output,o=i-(t-e.avail_out),s=i+(e.avail_out-257),a=A.dmax,c=A.wsize,u=A.whave,l=A.wnext,h=A.window,d=A.hold,_=A.bits,f=A.lencode,p=A.distcode,E=(1<<A.lenbits)-1,g=(1<<A.distbits)-1;e:do{_<15&&(d+=T[n++]<<_,_+=8,d+=T[n++]<<_,_+=8),v=f[d&E];t:for(;;){if(b=v>>>24,d>>>=b,_-=b,b=v>>>16&255,0===b)S[i++]=65535&v;else {if(!(16&b)){if(0==(64&b)){v=f[(65535&v)+(d&(1<<b)-1)];continue t}if(32&b){A.mode=16191;break e}e.msg="invalid literal/length code",A.mode=Kn$1;break e}m=65535&v,b&=15,b&&(_<b&&(d+=T[n++]<<_,_+=8),m+=d&(1<<b)-1,d>>>=b,_-=b),_<15&&(d+=T[n++]<<_,_+=8,d+=T[n++]<<_,_+=8),v=p[d&g];n:for(;;){if(b=v>>>24,d>>>=b,_-=b,b=v>>>16&255,!(16&b)){if(0==(64&b)){v=p[(65535&v)+(d&(1<<b)-1)];continue n}e.msg="invalid distance code",A.mode=Kn$1;break e}if(y=65535&v,b&=15,_<b&&(d+=T[n++]<<_,_+=8,_<b&&(d+=T[n++]<<_,_+=8)),y+=d&(1<<b)-1,y>a){e.msg="invalid distance too far back",A.mode=Kn$1;break e}if(d>>>=b,_-=b,b=i-o,y>b){if(b=y-b,b>u&&A.sane){e.msg="invalid distance too far back",A.mode=Kn$1;break e}if(w=0,N=h,0===l){if(w+=c-b,b<m){m-=b;do{S[i++]=h[w++];}while(--b);w=i-y,N=S;}}else if(l<b){if(w+=c+l-b,b-=l,b<m){m-=b;do{S[i++]=h[w++];}while(--b);if(w=0,l<m){b=l,m-=b;do{S[i++]=h[w++];}while(--b);w=i-y,N=S;}}}else if(w+=l-b,b<m){m-=b;do{S[i++]=h[w++];}while(--b);w=i-y,N=S;}for(;m>2;)S[i++]=N[w++],S[i++]=N[w++],S[i++]=N[w++],m-=3;m&&(S[i++]=N[w++],m>1&&(S[i++]=N[w++]));}else {w=i-y;do{S[i++]=S[w++],S[i++]=S[w++],S[i++]=S[w++],m-=3;}while(m>2);m&&(S[i++]=S[w++],m>1&&(S[i++]=S[w++]));}break}}break}}while(n<r&&i<s);m=_>>3,n-=m,_-=m<<3,d&=(1<<_)-1,e.next_in=n,e.next_out=i,e.avail_in=n<r?r-n+5:5-(n-r),e.avail_out=i<s?s-i+257:257-(i-s),A.hold=d,A.bits=_;};const Zn$1=15,Wn$1=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Qn$1=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Yn$1=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Xn$1=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Jn$1=(e,t,n,r,i,o,s,a)=>{const c=a.bits;let u,l,h,d,_,f,p=0,E=0,g=0,v=0,b=0,m=0,y=0,w=0,N=0,T=0,S=null;const A=new Uint16Array(16),C=new Uint16Array(16);let k,O,I,R=null;for(p=0;p<=Zn$1;p++)A[p]=0;for(E=0;E<r;E++)A[t[n+E]]++;for(b=c,v=Zn$1;v>=1&&0===A[v];v--);if(b>v&&(b=v),0===v)return i[o++]=20971520,i[o++]=20971520,a.bits=1,0;for(g=1;g<v&&0===A[g];g++);for(b<g&&(b=g),w=1,p=1;p<=Zn$1;p++)if(w<<=1,w-=A[p],w<0)return -1;if(w>0&&(0===e||1!==v))return -1;for(C[1]=0,p=1;p<Zn$1;p++)C[p+1]=C[p]+A[p];for(E=0;E<r;E++)0!==t[n+E]&&(s[C[t[n+E]]++]=E);if(0===e?(S=R=s,f=20):1===e?(S=Wn$1,R=Qn$1,f=257):(S=Yn$1,R=Xn$1,f=0),T=0,E=0,p=g,_=o,m=b,y=0,h=-1,N=1<<b,d=N-1,1===e&&N>852||2===e&&N>592)return 1;for(;;){k=p-y,s[E]+1<f?(O=0,I=s[E]):s[E]>=f?(O=R[s[E]-f],I=S[s[E]-f]):(O=96,I=0),u=1<<p-y,l=1<<m,g=l;do{l-=u,i[_+(T>>y)+l]=k<<24|O<<16|I|0;}while(0!==l);for(u=1<<p-1;T&u;)u>>=1;if(0!==u?(T&=u-1,T+=u):T=0,E++,0==--A[p]){if(p===v)break;p=t[n+s[E]];}if(p>b&&(T&d)!==h){for(0===y&&(y=b),_+=g,m=p-y,w=1<<m;m+y<v&&(w-=A[m+y],!(w<=0));)m++,w<<=1;if(N+=1<<m,1===e&&N>852||2===e&&N>592)return 1;h=T&d,i[h]=b<<24|m<<16|_-o|0;}}return 0!==T&&(i[_+T]=p-y<<24|64<<16|0),a.bits=b,0};const{Z_FINISH:$n$1,Z_BLOCK:er$1,Z_TREES:tr$1,Z_OK:nr$1,Z_STREAM_END:rr$1,Z_NEED_DICT:ir$1,Z_STREAM_ERROR:or,Z_DATA_ERROR:sr$1,Z_MEM_ERROR:ar$1,Z_BUF_ERROR:cr$1,Z_DEFLATED:ur$1}=Ct$2,lr=16180,hr$1=16190,dr$1=16191,_r$1=16192,fr$1=16194,pr$1=16199,Er=16200,gr$1=16206,vr$1=16209,br$1=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function mr(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0;}const yr$1=e=>{if(!e)return 1;const t=e.state;return !t||t.strm!==e||t.mode<lr||t.mode>16211?1:0},wr$1=e=>{if(yr$1(e))return or;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=lr,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,nr$1},Nr$1=e=>{if(yr$1(e))return or;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,wr$1(e)},Tr$1=(e,t)=>{let n;if(yr$1(e))return or;const r=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?or:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,Nr$1(e))},Sr$1=(e,t)=>{if(!e)return or;const n=new mr;e.state=n,n.strm=e,n.window=null,n.mode=lr;const r=Tr$1(e,t);return r!==nr$1&&(e.state=null),r};let Ar$1,Cr$1,kr$1=!0;const Or$1=e=>{if(kr$1){Ar$1=new Int32Array(512),Cr$1=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(Jn$1(1,e.lens,0,288,Ar$1,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;Jn$1(2,e.lens,0,32,Cr$1,0,e.work,{bits:5}),kr$1=!1;}e.lencode=Ar$1,e.lenbits=9,e.distcode=Cr$1,e.distbits=5;},Ir=(e,t,n,r)=>{let i;const o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),r>=o.wsize?(o.window.set(t.subarray(n-o.wsize,n),0),o.wnext=0,o.whave=o.wsize):(i=o.wsize-o.wnext,i>r&&(i=r),o.window.set(t.subarray(n-r,n-r+i),o.wnext),(r-=i)?(o.window.set(t.subarray(n-r,n),0),o.wnext=r,o.whave=o.wsize):(o.wnext+=i,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=i))),0};var Rr$1={inflateReset:Nr$1,inflateReset2:Tr$1,inflateResetKeep:wr$1,inflateInit:e=>Sr$1(e,15),inflateInit2:Sr$1,inflate:(e,t)=>{let n,r,i,o,s,a,c,u,l,h,d,_,f,p,E,g,v,b,m,y,w,N,T=0;const S=new Uint8Array(4);let A,C;const k=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(yr$1(e)||!e.output||!e.input&&0!==e.avail_in)return or;n=e.state,n.mode===dr$1&&(n.mode=_r$1),s=e.next_out,i=e.output,c=e.avail_out,o=e.next_in,r=e.input,a=e.avail_in,u=n.hold,l=n.bits,h=a,d=c,N=nr$1;e:for(;;)switch(n.mode){case lr:if(0===n.wrap){n.mode=_r$1;break}for(;l<16;){if(0===a)break e;a--,u+=r[o++]<<l,l+=8;}if(2&n.wrap&&35615===u){0===n.wbits&&(n.wbits=15),n.check=0,S[0]=255&u,S[1]=u>>>8&255,n.check=St$2(n.check,S,2,0),u=0,l=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&u)<<8)+(u>>8))%31){e.msg="incorrect header check",n.mode=vr$1;break}if((15&u)!==ur$1){e.msg="unknown compression method",n.mode=vr$1;break}if(u>>>=4,l-=4,w=8+(15&u),0===n.wbits&&(n.wbits=w),w>15||w>n.wbits){e.msg="invalid window size",n.mode=vr$1;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&u?16189:dr$1,u=0,l=0;break;case 16181:for(;l<16;){if(0===a)break e;a--,u+=r[o++]<<l,l+=8;}if(n.flags=u,(255&n.flags)!==ur$1){e.msg="unknown compression method",n.mode=vr$1;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=vr$1;break}n.head&&(n.head.text=u>>8&1),512&n.flags&&4&n.wrap&&(S[0]=255&u,S[1]=u>>>8&255,n.check=St$2(n.check,S,2,0)),u=0,l=0,n.mode=16182;case 16182:for(;l<32;){if(0===a)break e;a--,u+=r[o++]<<l,l+=8;}n.head&&(n.head.time=u),512&n.flags&&4&n.wrap&&(S[0]=255&u,S[1]=u>>>8&255,S[2]=u>>>16&255,S[3]=u>>>24&255,n.check=St$2(n.check,S,4,0)),u=0,l=0,n.mode=16183;case 16183:for(;l<16;){if(0===a)break e;a--,u+=r[o++]<<l,l+=8;}n.head&&(n.head.xflags=255&u,n.head.os=u>>8),512&n.flags&&4&n.wrap&&(S[0]=255&u,S[1]=u>>>8&255,n.check=St$2(n.check,S,2,0)),u=0,l=0,n.mode=16184;case 16184:if(1024&n.flags){for(;l<16;){if(0===a)break e;a--,u+=r[o++]<<l,l+=8;}n.length=u,n.head&&(n.head.extra_len=u),512&n.flags&&4&n.wrap&&(S[0]=255&u,S[1]=u>>>8&255,n.check=St$2(n.check,S,2,0)),u=0,l=0;}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&n.flags&&(_=n.length,_>a&&(_=a),_&&(n.head&&(w=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(o,o+_),w)),512&n.flags&&4&n.wrap&&(n.check=St$2(n.check,r,_,o)),a-=_,o+=_,n.length-=_),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&n.flags){if(0===a)break e;_=0;do{w=r[o+_++],n.head&&w&&n.length<65536&&(n.head.name+=String.fromCharCode(w));}while(w&&_<a);if(512&n.flags&&4&n.wrap&&(n.check=St$2(n.check,r,_,o)),a-=_,o+=_,w)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&n.flags){if(0===a)break e;_=0;do{w=r[o+_++],n.head&&w&&n.length<65536&&(n.head.comment+=String.fromCharCode(w));}while(w&&_<a);if(512&n.flags&&4&n.wrap&&(n.check=St$2(n.check,r,_,o)),a-=_,o+=_,w)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&n.flags){for(;l<16;){if(0===a)break e;a--,u+=r[o++]<<l,l+=8;}if(4&n.wrap&&u!==(65535&n.check)){e.msg="header crc mismatch",n.mode=vr$1;break}u=0,l=0;}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=dr$1;break;case 16189:for(;l<32;){if(0===a)break e;a--,u+=r[o++]<<l,l+=8;}e.adler=n.check=br$1(u),u=0,l=0,n.mode=hr$1;case hr$1:if(0===n.havedict)return e.next_out=s,e.avail_out=c,e.next_in=o,e.avail_in=a,n.hold=u,n.bits=l,ir$1;e.adler=n.check=1,n.mode=dr$1;case dr$1:if(t===er$1||t===tr$1)break e;case _r$1:if(n.last){u>>>=7&l,l-=7&l,n.mode=gr$1;break}for(;l<3;){if(0===a)break e;a--,u+=r[o++]<<l,l+=8;}switch(n.last=1&u,u>>>=1,l-=1,3&u){case 0:n.mode=16193;break;case 1:if(Or$1(n),n.mode=pr$1,t===tr$1){u>>>=2,l-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=vr$1;}u>>>=2,l-=2;break;case 16193:for(u>>>=7&l,l-=7&l;l<32;){if(0===a)break e;a--,u+=r[o++]<<l,l+=8;}if((65535&u)!=(u>>>16^65535)){e.msg="invalid stored block lengths",n.mode=vr$1;break}if(n.length=65535&u,u=0,l=0,n.mode=fr$1,t===tr$1)break e;case fr$1:n.mode=16195;case 16195:if(_=n.length,_){if(_>a&&(_=a),_>c&&(_=c),0===_)break e;i.set(r.subarray(o,o+_),s),a-=_,o+=_,c-=_,s+=_,n.length-=_;break}n.mode=dr$1;break;case 16196:for(;l<14;){if(0===a)break e;a--,u+=r[o++]<<l,l+=8;}if(n.nlen=257+(31&u),u>>>=5,l-=5,n.ndist=1+(31&u),u>>>=5,l-=5,n.ncode=4+(15&u),u>>>=4,l-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=vr$1;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;l<3;){if(0===a)break e;a--,u+=r[o++]<<l,l+=8;}n.lens[k[n.have++]]=7&u,u>>>=3,l-=3;}for(;n.have<19;)n.lens[k[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,A={bits:n.lenbits},N=Jn$1(0,n.lens,0,19,n.lencode,0,n.work,A),n.lenbits=A.bits,N){e.msg="invalid code lengths set",n.mode=vr$1;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;T=n.lencode[u&(1<<n.lenbits)-1],E=T>>>24,g=T>>>16&255,v=65535&T,!(E<=l);){if(0===a)break e;a--,u+=r[o++]<<l,l+=8;}if(v<16)u>>>=E,l-=E,n.lens[n.have++]=v;else {if(16===v){for(C=E+2;l<C;){if(0===a)break e;a--,u+=r[o++]<<l,l+=8;}if(u>>>=E,l-=E,0===n.have){e.msg="invalid bit length repeat",n.mode=vr$1;break}w=n.lens[n.have-1],_=3+(3&u),u>>>=2,l-=2;}else if(17===v){for(C=E+3;l<C;){if(0===a)break e;a--,u+=r[o++]<<l,l+=8;}u>>>=E,l-=E,w=0,_=3+(7&u),u>>>=3,l-=3;}else {for(C=E+7;l<C;){if(0===a)break e;a--,u+=r[o++]<<l,l+=8;}u>>>=E,l-=E,w=0,_=11+(127&u),u>>>=7,l-=7;}if(n.have+_>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=vr$1;break}for(;_--;)n.lens[n.have++]=w;}}if(n.mode===vr$1)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=vr$1;break}if(n.lenbits=9,A={bits:n.lenbits},N=Jn$1(1,n.lens,0,n.nlen,n.lencode,0,n.work,A),n.lenbits=A.bits,N){e.msg="invalid literal/lengths set",n.mode=vr$1;break}if(n.distbits=6,n.distcode=n.distdyn,A={bits:n.distbits},N=Jn$1(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,A),n.distbits=A.bits,N){e.msg="invalid distances set",n.mode=vr$1;break}if(n.mode=pr$1,t===tr$1)break e;case pr$1:n.mode=Er;case Er:if(a>=6&&c>=258){e.next_out=s,e.avail_out=c,e.next_in=o,e.avail_in=a,n.hold=u,n.bits=l,Bn$1(e,d),s=e.next_out,i=e.output,c=e.avail_out,o=e.next_in,r=e.input,a=e.avail_in,u=n.hold,l=n.bits,n.mode===dr$1&&(n.back=-1);break}for(n.back=0;T=n.lencode[u&(1<<n.lenbits)-1],E=T>>>24,g=T>>>16&255,v=65535&T,!(E<=l);){if(0===a)break e;a--,u+=r[o++]<<l,l+=8;}if(g&&0==(240&g)){for(b=E,m=g,y=v;T=n.lencode[y+((u&(1<<b+m)-1)>>b)],E=T>>>24,g=T>>>16&255,v=65535&T,!(b+E<=l);){if(0===a)break e;a--,u+=r[o++]<<l,l+=8;}u>>>=b,l-=b,n.back+=b;}if(u>>>=E,l-=E,n.back+=E,n.length=v,0===g){n.mode=16205;break}if(32&g){n.back=-1,n.mode=dr$1;break}if(64&g){e.msg="invalid literal/length code",n.mode=vr$1;break}n.extra=15&g,n.mode=16201;case 16201:if(n.extra){for(C=n.extra;l<C;){if(0===a)break e;a--,u+=r[o++]<<l,l+=8;}n.length+=u&(1<<n.extra)-1,u>>>=n.extra,l-=n.extra,n.back+=n.extra;}n.was=n.length,n.mode=16202;case 16202:for(;T=n.distcode[u&(1<<n.distbits)-1],E=T>>>24,g=T>>>16&255,v=65535&T,!(E<=l);){if(0===a)break e;a--,u+=r[o++]<<l,l+=8;}if(0==(240&g)){for(b=E,m=g,y=v;T=n.distcode[y+((u&(1<<b+m)-1)>>b)],E=T>>>24,g=T>>>16&255,v=65535&T,!(b+E<=l);){if(0===a)break e;a--,u+=r[o++]<<l,l+=8;}u>>>=b,l-=b,n.back+=b;}if(u>>>=E,l-=E,n.back+=E,64&g){e.msg="invalid distance code",n.mode=vr$1;break}n.offset=v,n.extra=15&g,n.mode=16203;case 16203:if(n.extra){for(C=n.extra;l<C;){if(0===a)break e;a--,u+=r[o++]<<l,l+=8;}n.offset+=u&(1<<n.extra)-1,u>>>=n.extra,l-=n.extra,n.back+=n.extra;}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=vr$1;break}n.mode=16204;case 16204:if(0===c)break e;if(_=d-c,n.offset>_){if(_=n.offset-_,_>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=vr$1;break}_>n.wnext?(_-=n.wnext,f=n.wsize-_):f=n.wnext-_,_>n.length&&(_=n.length),p=n.window;}else p=i,f=s-n.offset,_=n.length;_>c&&(_=c),c-=_,n.length-=_;do{i[s++]=p[f++];}while(--_);0===n.length&&(n.mode=Er);break;case 16205:if(0===c)break e;i[s++]=n.length,c--,n.mode=Er;break;case gr$1:if(n.wrap){for(;l<32;){if(0===a)break e;a--,u|=r[o++]<<l,l+=8;}if(d-=c,e.total_out+=d,n.total+=d,4&n.wrap&&d&&(e.adler=n.check=n.flags?St$2(n.check,i,d,s-d):Nt$2(n.check,i,d,s-d)),d=c,4&n.wrap&&(n.flags?u:br$1(u))!==n.check){e.msg="incorrect data check",n.mode=vr$1;break}u=0,l=0;}n.mode=16207;case 16207:if(n.wrap&&n.flags){for(;l<32;){if(0===a)break e;a--,u+=r[o++]<<l,l+=8;}if(4&n.wrap&&u!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=vr$1;break}u=0,l=0;}n.mode=16208;case 16208:N=rr$1;break e;case vr$1:N=sr$1;break e;case 16210:return ar$1;default:return or}return e.next_out=s,e.avail_out=c,e.next_in=o,e.avail_in=a,n.hold=u,n.bits=l,(n.wsize||d!==e.avail_out&&n.mode<vr$1&&(n.mode<gr$1||t!==$n$1))&&Ir(e,e.output,e.next_out,d-e.avail_out),h-=e.avail_in,d-=e.avail_out,e.total_in+=h,e.total_out+=d,n.total+=d,4&n.wrap&&d&&(e.adler=n.check=n.flags?St$2(n.check,i,d,e.next_out-d):Nt$2(n.check,i,d,e.next_out-d)),e.data_type=n.bits+(n.last?64:0)+(n.mode===dr$1?128:0)+(n.mode===pr$1||n.mode===fr$1?256:0),(0===h&&0===d||t===$n$1)&&N===nr$1&&(N=cr$1),N},inflateEnd:e=>{if(yr$1(e))return or;let t=e.state;return t.window&&(t.window=null),e.state=null,nr$1},inflateGetHeader:(e,t)=>{if(yr$1(e))return or;const n=e.state;return 0==(2&n.wrap)?or:(n.head=t,t.done=!1,nr$1)},inflateSetDictionary:(e,t)=>{const n=t.length;let r,i,o;return yr$1(e)?or:(r=e.state,0!==r.wrap&&r.mode!==hr$1?or:r.mode===hr$1&&(i=1,i=Nt$2(i,t,n,0),i!==r.check)?sr$1:(o=Ir(e,t,n,n),o?(r.mode=16210,ar$1):(r.havedict=1,nr$1)))},inflateInfo:"pako inflate (from Nodeca project)"};var Dr$1=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1;};const Lr$1=Object.prototype.toString,{Z_NO_FLUSH:xr$1,Z_FINISH:Ur$1,Z_OK:Mr$1,Z_STREAM_END:Pr$1,Z_NEED_DICT:zr$1,Z_STREAM_ERROR:Fr$1,Z_DATA_ERROR:Hr$1,Z_MEM_ERROR:Vr$1}=Ct$2;function Gr$1(e){this.options=Cn$1.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Rn$1,this.strm.avail_out=0;let n=Rr$1.inflateInit2(this.strm,t.windowBits);if(n!==Mr$1)throw new Error(At$2[n]);if(this.header=new Dr$1,Rr$1.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=In$1.string2buf(t.dictionary):"[object ArrayBuffer]"===Lr$1.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=Rr$1.inflateSetDictionary(this.strm,t.dictionary),n!==Mr$1)))throw new Error(At$2[n])}function qr$1(e,t){const n=new Gr$1(t);if(n.push(e),n.err)throw n.msg||At$2[n.err];return n.result}Gr$1.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize,i=this.options.dictionary;let o,s,a;if(this.ended)return !1;for(s=t===~~t?t:!0===t?Ur$1:xr$1,"[object ArrayBuffer]"===Lr$1.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(0===n.avail_out&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),o=Rr$1.inflate(n,s),o===zr$1&&i&&(o=Rr$1.inflateSetDictionary(n,i),o===Mr$1?o=Rr$1.inflate(n,s):o===Hr$1&&(o=zr$1));n.avail_in>0&&o===Pr$1&&n.state.wrap>0&&0!==e[n.next_in];)Rr$1.inflateReset(n),o=Rr$1.inflate(n,s);switch(o){case Fr$1:case Hr$1:case zr$1:case Vr$1:return this.onEnd(o),this.ended=!0,!1}if(a=n.avail_out,n.next_out&&(0===n.avail_out||o===Pr$1))if("string"===this.options.to){let e=In$1.utf8border(n.output,n.next_out),t=n.next_out-e,i=In$1.buf2string(n.output,e);n.next_out=t,n.avail_out=r-t,t&&n.output.set(n.output.subarray(e,e+t),0),this.onData(i);}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(o!==Mr$1||0!==a){if(o===Pr$1)return o=Rr$1.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(0===n.avail_in)break}}return !0},Gr$1.prototype.onData=function(e){this.chunks.push(e);},Gr$1.prototype.onEnd=function(e){e===Mr$1&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Cn$1.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg;};var jr$1={Inflate:Gr$1,inflate:qr$1,inflateRaw:function(e,t){return (t=t||{}).raw=!0,qr$1(e,t)},ungzip:qr$1,constants:Ct$2};const{Deflate:Kr$1,deflate:Br$1,deflateRaw:Zr$1,gzip:Wr$1}=jn$1,{Inflate:Qr$1,inflate:Yr$1,inflateRaw:Xr$1,ungzip:Jr$1}=jr$1;var $r$1,ei$1={Deflate:Kr$1,deflate:Br$1,deflateRaw:Zr$1,gzip:Wr$1,Inflate:Qr$1,inflate:Yr$1,inflateRaw:Xr$1,ungzip:Jr$1,constants:Ct$2};!function(e){e.CONNECTING="CONNECTING",e.OPEN="OPEN",e.CLOSED="CLOSED";}($r$1||($r$1={}));var ti$1,ni$1=function(e){function n(t,n){var r=n.sdkState,i=n.dispatcher,o=n.logger,s=e.call(this)||this;return s.lastActive=0,s._iid=t,s._sdkState=r,s._dispatcher=i,s._logger=o,s}return t(n,e),Object.defineProperty(n.prototype,"isOpen",{get:function(){return this.connectionState===$r$1.OPEN},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"connectionState",{get:function(){if(this._ws)switch(this._ws.readyState){case 0:return $r$1.CONNECTING;case 1:return $r$1.OPEN}return $r$1.CLOSED},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"ws",{get:function(){var e;return null!==(e=this._ws)&&void 0!==e?e:null},enumerable:!1,configurable:!0}),n.prototype._handleMessage=function(e){var t=this;e.split("\n").forEach((function(e){if(e){var n=Pe$1.createFromRawMessage(t._iid,e);if(t._logger.debug("receive websocket event",n),"LOGI"===n.code)t.dispatch("message",n);else if("PONG"===n.code)t.dispatch("pong");else if("EXPR"===n.code){if(n.payload){var r=new Ae$1(n.payload);r.expiresIn>=0&&t._dispatcher.dispatch(r);}}else "NOOP"===n.code||t.dispatch("message",n);}}));},n.prototype.connect=function(e){var t=this;this._ws=new WebSocket(e),this._ws.onopen=function(){t._logger.debug("websocket open"),t.dispatch("open");},this._ws.onmessage=function(e){return i(t,void 0,void 0,(function(){var t,n,r=this;return o(this,(function(s){return (null===(n=this._sdkState.websocket)||void 0===n?void 0:n.compression)?e.data instanceof Blob?((t=new FileReader).readAsArrayBuffer(e.data),t.onloadend=function(){return i(r,void 0,void 0,(function(){var e;return o(this,(function(n){switch(n.label){case 0:return [4,(r=t.result,i(void 0,void 0,void 0,(function(){var e;return o(this,(function(t){return e=ei$1.ungzip(r),[2,String.fromCharCode.apply(null,e)]}))})))];case 1:return e=n.sent(),this._handleMessage(e),[2]}var r;}))}))}):"string"==typeof e.data&&this._handleMessage(e.data):this._handleMessage(e.data),[2]}))}))},this._ws.onerror=function(){t._logger.debug("websocket error"),t.dispatch("error",v$1.networkError);},this._ws.onclose=function(){t._logger.debug("websocket close"),t.dispatch("close");},this.lastActive=Date.now();},n.prototype.disconnect=function(){var e=this;return new Promise((function(t){e._logger.debug("websocket disconnect"),e._ws&&e.connectionState!==$r$1.CLOSED?(e._ws.onopen=ze$1,e._ws.onmessage=ze$1,e._ws.onerror=ze$1,e._ws.onclose=function(){e.dispatch("close"),t();},e._ws.close(),e._ws=void 0):t();}))},n.prototype.send=function(e){if(!this._ws)throw v$1.connectionClosed;"PING"!==e.code?this.dispatch("ping-refresh"):this._logger.debug("send ping",e),this._ws.send(e.convertToMessage());},n.prototype.error=function(e){this._logger.debug("websocket error",e),this.dispatch("error",e);},n}(Q),ri$1=function(e){function n(t){var n,r=t.code,i=t.ackRequired,o=t.payload,s=void 0===o?{}:o,a=this;return (a=e.call(this)||this).code=r,a.payload=s,a.requestId=null!==(n=a.payload.req_id)&&void 0!==n?n:Z(),a.ackRequired=i,a.payload.req_id=a.requestId,a}return t(n,e),n.prototype.convertToMessage=function(){return "".concat(this.code).concat(JSON.stringify(this.payload),"\n")},n}(X),ii$1=function(e){function n(t){var n=t.all,r=t.feed,i=t.custom_types,o=t.ts,s=e.call(this)||this;return s.all=n,s.feed=r,s.customTypes=i,s.ts=o,s}return t(n,e),n}(X),oi$1=function(){var e=this;this.promise=new Promise((function(t,n){e.resolve=t,e.reject=n;}));},si$1=function(){function e(e,t){var n=t.auth,r=t.sdkState,i=t.dispatcher,o=t.logger,s=t.useFetchCompat,a=void 0!==s&&s,c=this;this._ackStateMap=new Map,this._sdkState=r,this._dispatcher=i,this._logger=o,this.apiClient=new Me$1(e,{auth:n,sdkState:r,dispatcher:i,logger:o,useFetchCompat:a}),this.websocketClient=new ni$1(e,{sdkState:r,dispatcher:i,logger:o}),this.websocketClient.on("message",(function(e){if(e.payload.unread_cnt&&c._dispatcher.dispatch(new ii$1(e.payload.unread_cnt)),e.requestId){if(c._ackStateMap.has(e.requestId)){var t=c._ackStateMap.get(e.requestId);"EROR"!==e.code?t.resolve(e):t.reject(new v$1({code:e.payload.code,message:e.payload.message}));}}else c._dispatcher.dispatch(e);})).on("close",(function(){c._ackStateMap.forEach((function(e){e.reject(v$1.connectionClosed);})),c._ackStateMap.clear();}));}return e.prototype._sendApiRequest=function(e){return i(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return [4,this.apiClient.send(e)];case 1:return [2,t.sent()]}}))}))},e.prototype._sendWebsocketRequest=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i=this;return o(this,(function(o){if(!this._sdkState.websocket)throw v$1.connectionRequired;if(t=new oi$1,e.ackRequired){r=function(r,o){i._ackStateMap.has(e.requestId)&&(i._ackStateMap.delete(e.requestId),n&&(clearTimeout(n),n=null),r?(i._logger.debug("fail websocket request",r),t.reject(r)):(i._logger.debug("receive websocket ack",e.requestId),t.resolve(o)));};try{n=setTimeout((function(){return r(v$1.noAckTimeout)}),this._sdkState.websocket.responseTimeout),this._ackStateMap.set(e.requestId,{resolve:function(e){return r(void 0,e)},reject:function(e){return r(e)}}),this.websocketClient.send(e);}catch(e){r(e);}}else try{this.websocketClient.send(e),t.resolve();}catch(e){t.reject(e);}return [2,t.promise]}))}))},e.prototype.send=function(e){return i(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return e instanceof Ne$1?[4,this._sendApiRequest(e)]:[3,2];case 1:case 3:return [2,t.sent()];case 2:return e instanceof ri$1?[4,this._sendWebsocketRequest(e)]:[3,4];case 4:throw v$1.invalidParameters}}))}))},e.prototype.cancel=function(e){this.apiClient.cancel(e);},e.prototype.cancelAll=function(){this.apiClient.cancelAll();},e}();!function(e){e[e.NONE=0]="NONE",e[e.INITIALIZED=1]="INITIALIZED",e[e.CONNECTING=2]="CONNECTING",e[e.CONNECTED=3]="CONNECTED",e[e.RECONNECTING=4]="RECONNECTING",e[e.INTERNAL_DISCONNECTED=5]="INTERNAL_DISCONNECTED",e[e.EXTERNAL_DISCONNECTED=6]="EXTERNAL_DISCONNECTED",e[e.LOGOUT=7]="LOGOUT";}(ti$1||(ti$1={}));var ai$1=function(e){function n(t){var n=t.stateType,r=e.call(this)||this;return r.stateType=n,r}return t(n,e),n}(X),ci$1=function(){function e(e,t){var n=t.auth,r=t.sdkState,s=t.dispatcher,a=t.logger,c=t.useFetchCompat,u=void 0!==c&&c,l=this;this._currentConnectionStateType=ti$1.INITIALIZED,this._lazyCallQueue=[],this.commandRouter=new si$1(e,{auth:n,sdkState:r,dispatcher:s,logger:a,useFetchCompat:u}),this._auth=n,this._logger=a,this._dispatcher=s,this._dispatcher.on((function(e){if(e instanceof ai$1){var t=e.stateType;switch(l._currentConnectionStateType=t,t){case ti$1.CONNECTED:var n=l._lazyCallQueue;l._lazyCallQueue=[],n.forEach((function(e){return i(l,void 0,void 0,(function(){var t,n,r,i,s;return o(this,(function(o){switch(o.label){case 0:t=e.command,n=e.deferred,r=e.timeout,clearTimeout(r),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.send(t)];case 2:return i=o.sent(),n.resolve(i),[3,4];case 3:return s=o.sent(),n.reject(s),[3,4];case 4:return [2]}}))}))}));break;case ti$1.INITIALIZED:case ti$1.INTERNAL_DISCONNECTED:case ti$1.EXTERNAL_DISCONNECTED:case ti$1.LOGOUT:n=l._lazyCallQueue;l._lazyCallQueue=[],n.forEach((function(e){return i(l,void 0,void 0,(function(){var t,n;return o(this,(function(r){return t=e.deferred,n=e.timeout,clearTimeout(n),this._auth&&this._auth.hasSession?t.reject(v$1.connectionClosed):t.reject(v$1.connectionRequired),[2]}))}))}));}}}));}return Object.defineProperty(e.prototype,"isReady",{get:function(){return this._currentConnectionStateType===ti$1.CONNECTED},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isLazyCallActivated",{get:function(){return this._currentConnectionStateType===ti$1.CONNECTING||this._currentConnectionStateType===ti$1.RECONNECTING},enumerable:!1,configurable:!0}),e.prototype.send=function(e){return i(this,void 0,void 0,(function(){var t,n,r=this;return o(this,(function(i){switch(i.label){case 0:return e instanceof ri$1?this.isReady?(this._logger.debug("send websocket request",e),[4,this.commandRouter.send(e)]):[3,2]:[3,4];case 1:case 5:return [2,i.sent()];case 2:if(this.isLazyCallActivated)return this._logger.debug("wait websocket request",e),t=new oi$1,this._lazyCallQueue.push({command:e,deferred:t,timeout:setTimeout((function(){return r.timeout(e.requestId)}),1e4)}),[2,t.promise];throw this._logger.debug("fail websocket request"),v$1.connectionRequired;case 3:case 7:return [3,9];case 4:return e instanceof Ne$1?this._auth.hasSession?(this._logger.debug("send api request",e),[4,this.commandRouter.send(e)]):[3,6]:[3,8];case 6:if(this.isLazyCallActivated)return this._logger.debug("wait api request",e),t=new oi$1,this._lazyCallQueue.push({command:e,deferred:t,timeout:setTimeout((function(){return r.timeout(e.requestId)}),1e4)}),[2,t.promise];throw n=v$1.connectionRequired,this._logger.debug("fail api request",n),n;case 8:throw v$1.invalidCommand;case 9:return [2]}}))}))},e.prototype.forceSend=function(e){return i(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return this._logger.debug("send forced request",e),e instanceof ri$1||e instanceof Ne$1?[4,this.commandRouter.send(e)]:[3,2];case 1:return [2,t.sent()];case 2:throw v$1.invalidCommand}}))}))},e.prototype.timeout=function(e){this._logger.debug("timeout request",e);var t=this._lazyCallQueue.findIndex((function(t){return t.command.requestId===e}));t>-1&&(this._lazyCallQueue[t].deferred.reject(v$1.connectionRequired),this._lazyCallQueue.splice(t,1));},e.prototype.cancel=function(e){this._logger.debug("cancel api request",e),this.commandRouter.cancel(e);},e.prototype.cancelAll=function(){this._logger.debug("cancel all api requests"),this.commandRouter.cancelAll();},e}(),ui$1="sendbird@devicetokens",li$1=function(){function e(e){var t=e.type,n=e.token;this.type=t,this.token=n;}return e.payloadify=function(e){return J($({type:e.type,token:e.token}))},e}(),hi$1=function(e){function n(t){var n=t.userId,r=t.authToken,i=t.expiringSession,o=void 0===i||i,s=e.call(this)||this;return s.path="".concat(ne,"/").concat(n,"/session_key"),s.method=ee.POST,s.params={token:r,expiring_session:!!o},s.requireAuth=!1,s}return t(n,e),n}(Ne$1),di$1=function(e){function n(t){var n=t.authToken,r=t.expiringSession,i=void 0===r||r,o=t.requestId,s=void 0===o?"":o;return e.call(this,{code:"LOGI",payload:{token:n,expiring_session:i?1:0,req_id:s},ackRequired:!0})||this}return t(n,e),n}(ri$1),_i$1=function(e){function n(t,n){var r=e.call(this,t,n)||this,i=n.key;return r.key=i,r}return t(n,e),n}(Te$1),fi$1=function(e){function n(t,n,r){var i,o=this;return (o=e.call(this,t,"LOGI",r)||this).error=null,o.newKey=null,o.newKey=null!==(i=r.new_key)&&void 0!==i?i:null,o.error=r.error?new v$1(r.error):null,o}return t(n,e),n}(Pe$1),pi$1=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n}(X),Ei$1=function(e){return i(void 0,void 0,void 0,(function(){return o(this,(function(t){return [2,new Promise((function(t){return setTimeout(t,e)}))]}))}))},gi$1=function(){function e(){}return e.prototype.calcTimeout=function(){return 0},e}(),vi$1=function(e,t,n){return void 0===n&&(n=new gi$1),i(void 0,void 0,void 0,(function(){var r,i,s,a,c,u;return o(this,(function(o){switch(o.label){case 0:r=0,i=null,s=function(e){return i=null!=e?e:new Error("Halted")},a=function(){r=0;},o.label=1;case 1:if(!(-1===t||r<t))return [3,9];o.label=2;case 2:return o.trys.push([2,4,,8]),[4,e(s,a)];case 3:if(c=o.sent(),i)throw i;return [2,c];case 4:if(u=o.sent(),i)return [3,6];if(++r===t)throw u;return [4,Ei$1(n.calcTimeout(r))];case 5:return o.sent(),[3,7];case 6:throw i;case 7:return [3,8];case 8:return [3,1];case 9:throw "It should not happen."}}))}))},bi$1=function(e){return i(void 0,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,e()];case 1:return n.sent(),[3,3];case 2:if(!((t=n.sent())instanceof v$1))throw t;return t.throwOutside(),[3,3];case 3:return [2]}}))}))},mi$1=function(e){return i(void 0,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,e()];case 1:case 2:return t.sent(),[3,3];case 3:return [2]}}))}))},yi$1=new WeakMap,wi$1=function(e){function n(t){var n=t.auth,r=t.cacheContext,i=t.sdkState,o=t.dispatcher,s=t.requestQueue,a=t.logger,c=e.call(this)||this;return c._currentConnectionStateType=ti$1.INITIALIZED,c._isRefreshingAuthToken=!1,c._isRefreshingSessionKey=!1,c.currentUser=null,c.auth=n,c._cacheContext=r,c._sdkState=i,c._dispatcher=o,c._requestQueue=s,c._logger=a,c._deviceTokens=[],c._dispatcher.on((function(e){var t;if(e instanceof ai$1){var n=e.stateType;c._currentConnectionStateType=n;}else e instanceof Ae$1&&c.handler&&(e.invalidateSessionToken&&(c.auth.authToken=void 0),e.error&&(e.error.isSessionKeyExpiredError||e.error.isSessionTokenExpiredError)&&(c._logger.debug("session expired"),(null===(t=c.handler)||void 0===t?void 0:t.onSessionExpired)&&c.handler.onSessionExpired(),c.refresh()));})),c}return t(n,e),Object.defineProperty(n.prototype,"ekey",{get:function(){return yi$1.get(this)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"deviceTokens",{get:function(){return this._deviceTokens},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"deviceTokenLastDeletedAt",{get:function(){return this._deviceTokenLastDeletedAt},enumerable:!1,configurable:!0}),n.prototype.indexOfDeviceToken=function(e,t){return this._deviceTokens.findIndex((function(n){return n.type===e&&n.token===t}))},n.prototype.hasDeviceToken=function(e,t){return this.indexOfDeviceToken(e,t)>=0},n.prototype.createRefreshWebsocketCommand=function(e,t){return new di$1({authToken:e,expiringSession:!0,requestId:t})},n.prototype._refreshSessionKeyByWebSocket=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,s;return o(this,(function(o){switch(o.label){case 0:return t=this.createRefreshWebsocketCommand(e),[4,this._requestQueue.forceSend(t)];case 1:if(n=o.sent(),r=n.as(fi$1),i=r.newKey,s=r.error)throw s;return this.auth.sessionKey=null!=i?i:this.auth.sessionKey,[2]}}))}))},n.prototype._refreshSessionKeyByApi=function(e){return i(this,void 0,void 0,(function(){var t,n=this;return o(this,(function(r){switch(r.label){case 0:return t=new hi$1({userId:this._sdkState.userId,authToken:e,expiringSession:!0}),[4,vi$1((function(e){return i(n,void 0,void 0,(function(){var n,r,i;return o(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,this._requestQueue.forceSend(t)];case 1:return n=o.sent(),r=n.as(_i$1).key,this.auth.sessionKey=r,[3,3];case 2:if(i=o.sent(),!this._isSessionRelatedError(i))throw i;return e(i),[3,3];case 3:return [2]}}))}))}),3)];case 1:return r.sent(),[2]}}))}))},n.prototype._refreshSessionKey=function(e,t){return void 0===t&&(t=!0),i(this,void 0,void 0,(function(){var n,r,i;return o(this,(function(o){switch(o.label){case 0:if(this._currentConnectionStateType!==ti$1.CONNECTED)return [3,10];o.label=1;case 1:return o.trys.push([1,3,,10]),[4,this._refreshSessionKeyByWebSocket(e)];case 2:return o.sent(),this.complete(),[2];case 3:return n=o.sent(),this._isSessionRelatedError(n)&&t?[4,this._receiveNewAuthToken()]:[3,9];case 4:return (i=o.sent())?(this.auth.authToken=i,[4,this._refreshSessionKey(this.auth.authToken,!1)]):[3,6];case 5:return o.sent(),this.complete(),[3,8];case 6:return [4,this.clear()];case 7:o.sent(),this.close(),o.label=8;case 8:return [2];case 9:return [3,10];case 10:return o.trys.push([10,12,,22]),[4,this._refreshSessionKeyByApi(e)];case 11:return o.sent(),this.complete(),[3,22];case 12:return r=o.sent(),this._isSessionRelatedError(r)?t?[4,this._receiveNewAuthToken()]:[3,18]:[3,20];case 13:return (i=o.sent())?(this.auth.authToken=i,[4,this._refreshSessionKeyByApi(this.auth.authToken)]):[3,15];case 14:return o.sent(),this.complete(),[3,17];case 15:return [4,this.clear()];case 16:o.sent(),this.close(),o.label=17;case 17:return [3,19];case 18:throw r;case 19:return [3,21];case 20:throw r;case 21:return [3,22];case 22:return [2]}}))}))},n.prototype._receiveNewAuthToken=function(){var e=this,t=new oi$1;return bi$1((function(){return i(e,void 0,void 0,(function(){var e,n,r,i,s=this;return o(this,(function(o){return this._isRefreshingAuthToken=!0,this.auth.clear(),this.handler.onSessionTokenRequired?(e=null,n=function(){e&&(clearTimeout(e),e=null);},r=function(e){n(),s._isRefreshingAuthToken&&(s._isRefreshingAuthToken=!1,s.dispatch("refresh-authtoken"),t.resolve(e));},i=function(e){n(),s._isRefreshingAuthToken&&(s._isRefreshingAuthToken=!1,t.reject(e));},e=setTimeout((function(){return i()}),1e3*this._sdkState.sessionTokenRefreshTimeout),this.handler.onSessionTokenRequired(r,i)):t.resolve(null),[2]}))}))})),t.promise},n.prototype._isSessionRelatedError=function(e){return e instanceof v$1&&(e.isSessionKeyExpiredError||e.isSessionTokenExpiredError||e.isSessionRevokedError)},Object.defineProperty(n.prototype,"isSessionKeyRefreshing",{get:function(){return this._isRefreshingSessionKey},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isRefreshingAuthToken",{get:function(){return this._isRefreshingAuthToken},enumerable:!1,configurable:!0}),n.prototype.login=function(e){var t;return i(this,void 0,void 0,(function(){var n,r,i,s,a,c,u;return o(this,(function(o){switch(o.label){case 0:return n=e.key,r=e.ekey,i=e.userProfile,s=e.deviceTokenLastDeletedAt,a=void 0===s?0:s,this.auth.sessionKey=n,yi$1.set(this,r),this._deviceTokenCacheEnabled=null===(t=null==i?void 0:i.appInfo)||void 0===t?void 0:t.deviceTokenCache,c=this._cacheContext.preference,this._deviceTokenCacheEnabled?[4,c.get(ui$1)]:[3,5];case 1:return !(u=o.sent())||u.lastDeletedAt<a?(this._deviceTokens=[],this._deviceTokenLastDeletedAt=a,[4,this.saveDeviceToken()]):[3,3];case 2:return o.sent(),[3,4];case 3:this._deviceTokens=u.tokens.map((function(e){return new li$1(li$1.payloadify(e))})),this._deviceTokenLastDeletedAt=u.lastDeletedAt,o.label=4;case 4:return [3,7];case 5:return [4,c.remove(ui$1)];case 6:o.sent(),o.label=7;case 7:return [2]}}))}))},n.prototype.complete=function(){var e=this;this.dispatch("refresh"),bi$1((function(){return i(e,void 0,void 0,(function(){var e;return o(this,(function(t){return this._logger.debug("session refreshed"),(null===(e=this.handler)||void 0===e?void 0:e.onSessionRefreshed)&&this.handler.onSessionRefreshed(),[2]}))}))}));},n.prototype.error=function(e){var t=this;bi$1((function(){return i(t,void 0,void 0,(function(){var t;return o(this,(function(n){return (null===(t=this.handler)||void 0===t?void 0:t.onSessionError)&&this.handler.onSessionError(e),[2]}))}))}));},n.prototype.close=function(){var e=this;this.dispatch("close"),bi$1((function(){return i(e,void 0,void 0,(function(){var e;return o(this,(function(t){return this._logger.debug("session closed"),(null===(e=this.handler)||void 0===e?void 0:e.onSessionClosed)&&this.handler.onSessionClosed(),[2]}))}))}));},n.prototype.refresh=function(){return i(this,void 0,void 0,(function(){var e,t;return o(this,(function(n){switch(n.label){case 0:if(!this.handler)return [3,10];if(this._isRefreshingSessionKey)return [3,10];if(this._isRefreshingSessionKey=!0,this.auth.authToken)return [3,7];n.label=1;case 1:return n.trys.push([1,6,,7]),[4,this._receiveNewAuthToken()];case 2:return (e=n.sent())?(this._logger.debug("session refreshing.."),this.auth.authToken=e,[3,5]):[3,3];case 3:return [4,this.clear()];case 4:return n.sent(),this._isRefreshingSessionKey=!1,[2];case 5:return [3,7];case 6:throw n.sent(),t=v$1.sessionTokenRequestFailed,this._dispatcher.dispatch(new pi$1),this.error(t),this._isRefreshingSessionKey=!1,t;case 7:return n.trys.push([7,9,,10]),[4,this._refreshSessionKey(this.auth.authToken)];case 8:return n.sent(),this._isRefreshingSessionKey=!1,[3,10];case 9:throw n.sent(),t=v$1.sessionTokenRefreshFailed,this._dispatcher.dispatch(new pi$1),this.error(t),this._isRefreshingSessionKey=!1,t;case 10:return [2]}}))}))},n.prototype.setDeviceToken=function(e,t){if(this._deviceTokenCacheEnabled&&this.indexOfDeviceToken(e,t)<0)return this._deviceTokens.push(new li$1({type:e,token:t})),!0;return !1},n.prototype.unsetDeviceToken=function(e,t){if(this._deviceTokenCacheEnabled){var n=this.indexOfDeviceToken(e,t);n>=0&&this._deviceTokens.splice(n,1);}},n.prototype.unsetDeviceTokens=function(e){this._deviceTokenCacheEnabled&&(this._deviceTokens=e?this._deviceTokens.filter((function(t){return t.type!==e})):[]);},n.prototype.setDeviceTokenDeletedAt=function(e){e>0&&(this._deviceTokenLastDeletedAt=e);},n.prototype.saveDeviceToken=function(){return i(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return this._deviceTokenCacheEnabled?[4,this._cacheContext.preference.set(ui$1,{tokens:this._deviceTokens,lastDeletedAt:this._deviceTokenLastDeletedAt})]:[3,2];case 1:e.sent(),e.label=2;case 2:return [2]}}))}))},n.prototype.clear=function(){return i(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return this.currentUser=null,this.auth.clear(),this.close(),yi$1.delete(this),this._deviceTokens=[],this._deviceTokenLastDeletedAt=0,[4,this.saveDeviceToken()];case 1:return e.sent(),[2]}}))}))},n}(Q),Ni$1=function(){function e(){this.type=ti$1.NONE,this.name="none";}return e.prototype.run=function(e){return i(this,void 0,void 0,(function(){return o(this,(function(e){return [2]}))}))},e.prototype.onConnect=function(e,t){return i(this,void 0,void 0,(function(){return o(this,(function(e){return [2]}))}))},e.prototype.onReconnect=function(e,t){return t.resetReconnectCount,i(this,void 0,void 0,(function(){return o(this,(function(e){return [2]}))}))},e.prototype.onDisconnect=function(e,t){return t.error,t.autoReconnect,i(this,void 0,void 0,(function(){return o(this,(function(e){return [2]}))}))},e.prototype.onDisconnectWebSocket=function(e){return i(this,void 0,void 0,(function(){return o(this,(function(e){return [2]}))}))},e.prototype.onLogout=function(e){return i(this,void 0,void 0,(function(){return o(this,(function(e){return [2]}))}))},e}(),Ti$1=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=ti$1.LOGOUT,t.name="logout",t}return t(n,e),n.prototype.run=function(e){return i(this,void 0,void 0,(function(){var t,n,r=this;return o(this,(function(s){switch(s.label){case 0:return t=Date.now(),n=e.sdkState.userId,[4,e.logout()];case 1:return s.sent(),[4,e.changeState(new Ii$1,t)];case 2:return s.sent(),bi$1((function(){return i(r,void 0,void 0,(function(){return o(this,(function(t){return e.connectionHandlers.forEach((function(e){e.onDisconnected&&e.onDisconnected(n);})),[2]}))}))})),[2]}}))}))},n}(Ni$1),Si$1=function(e){function n(){var t=e.call(this)||this;return t.type=ti$1.EXTERNAL_DISCONNECTED,t.name="externaldisconnected",t}return t(n,e),n.prototype.run=function(e){return i(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return [4,e.disconnect()];case 1:return t.sent(),[2]}}))}))},n.prototype.onConnect=function(e,t){return i(this,void 0,void 0,(function(){var n;return o(this,(function(r){switch(r.label){case 0:return n=Date.now(),[4,e.disconnect()];case 1:return r.sent(),[4,e.changeState(new Oi$1({authToken:t}),n)];case 2:return r.sent(),[2]}}))}))},n.prototype.onReconnect=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return t=Date.now(),[4,e.changeState(new Ci$1,t)];case 1:return n.sent(),[2]}}))}))},n.prototype.onLogout=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return t=Date.now(),[4,e.changeState(new Ti$1,t)];case 1:return n.sent(),[2]}}))}))},n}(Ni$1),Ai$1=function(e){function n(t){var n=t.autoReconnect,r=e.call(this)||this;return r.type=ti$1.INTERNAL_DISCONNECTED,r.name="internaldisconnected",r._autoReconnect=!1,r._autoReconnect=n,r}return t(n,e),n.prototype.run=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return t=Date.now(),[4,e.disconnect()];case 1:return n.sent(),this._autoReconnect?[4,e.changeState(new Ci$1,t)]:[3,3];case 2:n.sent(),n.label=3;case 3:return [2]}}))}))},n.prototype.onConnect=function(e,t){return i(this,void 0,void 0,(function(){var n;return o(this,(function(r){switch(r.label){case 0:return n=Date.now(),[4,e.disconnect()];case 1:return r.sent(),[4,e.changeState(new Oi$1({authToken:t}),n)];case 2:return r.sent(),[2]}}))}))},n.prototype.onReconnect=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return t=Date.now(),[4,e.changeState(new Ci$1,t)];case 1:return n.sent(),[2]}}))}))},n.prototype.onDisconnectWebSocket=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return t=Date.now(),[4,e.changeState(new Si$1,t)];case 1:return n.sent(),[2]}}))}))},n.prototype.onLogout=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return t=Date.now(),[4,e.changeState(new Ti$1,t)];case 1:return n.sent(),[2]}}))}))},n}(Ni$1),Ci$1=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=ti$1.RECONNECTING,t.name="reconnecting",t._callbacks=[],t}return t(n,e),n.prototype._halt=function(e){this._haltConnect&&(this._haltConnect(e),this._haltConnect=void 0);},n.prototype._flushCallbacks=function(e){this._haltConnect=void 0,this._resetConnect=void 0,this._callbacks.forEach((function(t){return t(e)}));},n.prototype.run=function(e){return i(this,void 0,void 0,(function(){var t,n,r,s,a,c,l=this;return o(this,(function(h){switch(h.label){case 0:t=Date.now(),n=new oi$1,this._callbacks.push((function(e){return e?n.reject(e):n.resolve()})),bi$1((function(){return i(l,void 0,void 0,(function(){return o(this,(function(t){return e.connectionHandlers.forEach((function(e){e.onReconnectStarted&&e.onReconnectStarted();})),[2]}))}))})),h.label=1;case 1:return h.trys.push([1,4,,9]),r=e.sdkState.websocket,s=r.reconnectMaxRetry,a=r.reconnectRetryStrategy,[4,vi$1((function(t,n){return i(l,void 0,void 0,(function(){var r;return o(this,(function(i){switch(i.label){case 0:this._haltConnect=t,this._resetConnect=n,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,e.connect()];case 2:return i.sent(),[3,4];case 3:if(r=i.sent(),e.clearLoginTimer(),r instanceof v$1&&r.code===u.CONNECTION_CANCELED)return t(r),[2];throw r;case 4:return [2]}}))}))}),s,a)];case 2:return h.sent(),[4,e.changeState(new ki$1,t)];case 3:return h.sent(),bi$1((function(){return i(l,void 0,void 0,(function(){return o(this,(function(t){return this._flushCallbacks(),e.connectionHandlers.forEach((function(e){e.onReconnectSucceeded&&e.onReconnectSucceeded();})),[2]}))}))})),[3,9];case 4:return c=h.sent(),g$1(c)?[3,7]:c instanceof v$1?c.code===u.CONNECTION_CANCELED?[3,6]:[4,e.changeState(new Ai$1({autoReconnect:!1}),t)]:[3,6];case 5:h.sent(),h.label=6;case 6:return bi$1((function(){return i(l,void 0,void 0,(function(){return o(this,(function(t){return this._flushCallbacks(c),e.connectionHandlers.forEach((function(e){e.onReconnectFailed&&e.onReconnectFailed();})),[2]}))}))})),[3,8];case 7:throw c;case 8:return [3,9];case 9:return [2,n.promise]}}))}))},n.prototype.onConnect=function(e,t){return i(this,void 0,void 0,(function(){var n;return o(this,(function(r){return n=new oi$1,this._halt(v$1.connectionCanceled),e.cancelConnectForRetry(),this._callbacks.push((function(){var r=Date.now();e.changeState(new Oi$1({authToken:t}),r).then((function(){n.resolve();})).catch((function(e){n.reject(e);}));})),[2,n.promise]}))}))},n.prototype.onReconnect=function(e,t){var n=t.resetReconnectCount,r=void 0!==n&&n;return i(this,void 0,void 0,(function(){var e;return o(this,(function(t){return e=new oi$1,this._resetConnect&&r&&this._resetConnect(),this._callbacks.push((function(t){return t?e.reject(t):e.resolve()})),[2,e.promise]}))}))},n.prototype.onDisconnect=function(e,t){t.error;var n=t.autoReconnect,r=void 0===n||n;return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return t=Date.now(),this._halt(v$1.connectionCanceled),[4,e.changeState(new Ai$1({autoReconnect:r}),t)];case 1:return n.sent(),[2]}}))}))},n.prototype.onDisconnectWebSocket=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return t=Date.now(),this._halt(v$1.connectionCanceled),[4,e.changeState(new Si$1,t)];case 1:return n.sent(),[2]}}))}))},n.prototype.onLogout=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return t=Date.now(),this._halt(v$1.connectionCanceled),[4,e.changeState(new Ti$1,t)];case 1:return n.sent(),[2]}}))}))},n}(Ni$1),ki$1=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=ti$1.CONNECTED,t.name="connected",t}return t(n,e),n.prototype.onReconnect=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return t=Date.now(),[4,e.disconnect()];case 1:return n.sent(),[4,e.changeState(new Ci$1,t)];case 2:return n.sent(),[2]}}))}))},n.prototype.onDisconnect=function(e,t){var n=t.autoReconnect;return i(this,void 0,void 0,(function(){var t;return o(this,(function(r){switch(r.label){case 0:return t=Date.now(),[4,e.changeState(new Ai$1({autoReconnect:n}),t)];case 1:return r.sent(),[2]}}))}))},n.prototype.onDisconnectWebSocket=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return t=Date.now(),[4,e.changeState(new Si$1,t)];case 1:return n.sent(),[2]}}))}))},n.prototype.onLogout=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return t=Date.now(),[4,e.changeState(new Ti$1,t)];case 1:return n.sent(),[2]}}))}))},n}(Ni$1),Oi$1=function(e){function n(t){var n=t.authToken,r=e.call(this)||this;return r.type=ti$1.CONNECTING,r.name="connecting",r._authToken="",r._callbacks=[],r._authToken=n,r}return t(n,e),n.prototype._halt=function(e){this._haltConnect&&(this._haltConnect(e),this._haltConnect=void 0);},n.prototype._flushCallbacks=function(e){this._haltConnect=void 0,this._callbacks.forEach((function(t){return t(e)}));},n.prototype.run=function(e){return i(this,void 0,void 0,(function(){var t,n,r,s=this;return o(this,(function(a){switch(a.label){case 0:t=Date.now(),n=new oi$1,this._callbacks.push((function(e){return e?n.reject(e):n.resolve()})),a.label=1;case 1:return a.trys.push([1,4,,10]),[4,vi$1((function(t){return i(s,void 0,void 0,(function(){var n;return o(this,(function(r){switch(r.label){case 0:this._haltConnect=t,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,e.connect(this._authToken)];case 2:return r.sent(),[3,4];case 3:if(n=r.sent(),e.clearLoginTimer(),n instanceof v$1&&n.code===u.CONNECTION_CANCELED)return t(n),[2];throw n;case 4:return [2]}}))}))}),e.sdkState.websocket.connectMaxRetry)];case 2:return a.sent(),[4,e.changeState(new ki$1,t)];case 3:return a.sent(),bi$1((function(){return i(s,void 0,void 0,(function(){return o(this,(function(t){return this._flushCallbacks(),e.connectionHandlers.forEach((function(t){t.onConnected&&t.onConnected(e.sdkState.userId);})),[2]}))}))})),[3,10];case 4:return r=a.sent(),g$1(r)?[3,8]:[4,e.disconnect()];case 5:return a.sent(),r instanceof v$1?r.code===u.CONNECTION_CANCELED?[3,7]:[4,e.changeState(new Ii$1,t)]:[3,7];case 6:a.sent(),a.label=7;case 7:return bi$1((function(){return i(s,void 0,void 0,(function(){return o(this,(function(e){return this._flushCallbacks(r),[2]}))}))})),[3,9];case 8:throw r;case 9:return [3,10];case 10:return [2,n.promise]}}))}))},n.prototype.onConnect=function(e){return i(this,void 0,void 0,(function(){var e;return o(this,(function(t){return e=new oi$1,this._callbacks.push((function(t){return t?e.reject(t):e.resolve()})),[2,e.promise]}))}))},n.prototype.onDisconnect=function(e,t){var n=t.error,r=void 0===n?null:n,s=t.autoReconnect,a=void 0!==s&&s;return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return t=Date.now(),this._halt(null!=r?r:v$1.connectionCanceled),e.hasSession?[4,e.changeState(new Ai$1({autoReconnect:a}),t)]:[3,2];case 1:return n.sent(),[3,4];case 2:return [4,e.changeState(new Ti$1,t)];case 3:n.sent(),n.label=4;case 4:return [2]}}))}))},n.prototype.onDisconnectWebSocket=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return t=Date.now(),this._halt(v$1.connectionCanceled),e.hasSession?[4,e.changeState(new Si$1,t)]:[3,2];case 1:return n.sent(),[3,4];case 2:return [4,e.changeState(new Ti$1,t)];case 3:n.sent(),n.label=4;case 4:return [2]}}))}))},n.prototype.onLogout=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return t=Date.now(),this._halt(v$1.connectionCanceled),[4,e.changeState(new Ti$1,t)];case 1:return n.sent(),[2]}}))}))},n}(Ni$1),Ii$1=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=ti$1.INITIALIZED,t.name="initialized",t}return t(n,e),n.prototype.onConnect=function(e,t){return i(this,void 0,void 0,(function(){var n;return o(this,(function(r){switch(r.label){case 0:return n=Date.now(),[4,e.changeState(new Oi$1({authToken:t}),n)];case 1:return r.sent(),[2]}}))}))},n}(Ni$1),Ri$1=function(e){function n(){return e.call(this,{code:"PING",payload:{id:Date.now(),active:1},ackRequired:!1})||this}return t(n,e),n}(ri$1),Di$1=function(){function e(e){var t=e.pingDelegate,n=e.sdkState,r=e.logger;this.pingDelegate=t,this.sdkState=n,this._logger=r;}return Object.defineProperty(e.prototype,"isWaiting",{get:function(){return !!this._pingTimeoutTimer},enumerable:!1,configurable:!0}),e.prototype.ping=function(){var e,t=this;if(!this.sdkState.websocket)throw v$1.connectionRequired;var n=new Ri$1;try{var r=null!==(e=this.sdkState.websocket.pongTimeout)&&void 0!==e?e:5e3;this._pingTimeoutTimer=setTimeout((function(){t._logger.debug("pinger.ping() timeout"),t.pingDelegate.error();}),r),this.pingDelegate.send(n),this._logger.debug("pinger.ping()");}catch(e){this._logger.debug("pinger.ping() error",e),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=void 0),this.pingDelegate.error();}return n},e.prototype.pong=function(){this._logger.debug("pinger.pong()"),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=void 0);},e.prototype.refreshTimer=function(){var e,t=this;if(!this.sdkState.websocket)throw v$1.connectionRequired;this._logger.debug("pinger.refreshTimer()");var n=null!==(e=this.sdkState.websocket.pingInterval)&&void 0!==e?e:15e3;this.stop(),this._pingTimer=setInterval((function(){t.ping();}),n);},e.prototype.start=function(){this._logger.debug("pinger.start()"),this.refreshTimer(),this.ping();},e.prototype.stop=function(){this._logger.debug("pinger.stop()"),this._pingTimer&&(clearInterval(this._pingTimer),this._pingTimer=void 0),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=void 0);},e}(),Li$1=function(){function e(e){var t,n,r,i;this.isEnabled=null!==(t=e.enabled)&&void 0!==t&&t,this.feedChannels=null!==(n=e.feed_channels)&&void 0!==n?n:{},this.templateListToken=null!==(r=e.template_list_token)&&void 0!==r?r:null,this.settingsUpdatedAt=null!==(i=e.settings_updated_at)&&void 0!==i?i:0;}return e.payloadify=function(e){return J($({enabled:e.isEnabled,feed_channels:e.feedChannels,template_list_token:e.templateListToken,settings_updated_at:e.settingsUpdatedAt}))},e}(),xi$1=function(e){return "sendbird@".concat(e,"/changelog_include_chat_notifications")},Ui$1=function(){function e(e){var t;this.lastUpdatedAt=null!==(t=e.last_updated_at)&&void 0!==t?t:0;}return e.payloadify=function(e){return J($({last_updated_at:e.lastUpdatedAt}))},e}(),Mi$1=1048576,Pi$1=5,zi=function(){function e(e){var t,n,r,i,o;void 0===e&&(e={}),this.emojiHash=e.emoji_hash||"",this.uploadSizeLimit=e.file_upload_size_limit?e.file_upload_size_limit*Mi$1:Number.MAX_SAFE_INTEGER,this.useReaction=!!e.use_reaction,this.applicationAttributes=null!==(t=e.application_attributes)&&void 0!==t?t:[],this.premiumFeatureList=null!==(n=e.premium_feature_list)&&void 0!==n?n:[],this.deviceTokenCache=this.applicationAttributes.includes("sdk_device_token_cache"),this.enabledChannelMemberShipHistory=this.applicationAttributes.includes("channel_membership_history"),this.multipleFilesMessageFileCountLimit=null!==(r=e.multiple_file_send_max_size)&&void 0!==r?r:5,this.allowSdkStatsUpload=null===(i=e.allow_sdk_log_ingestion)||void 0===i||i,this.uikitConfigInfo=new Ui$1(null!==(o=e.uikit_config)&&void 0!==o?o:{}),this.notificationInfo=e.notifications?new Li$1(e.notifications):null;}return e.payloadify=function(e){return J($({emoji_hash:e.emojiHash,file_upload_size_limit:e.uploadSizeLimit/Mi$1,application_attributes:e.applicationAttributes,premium_feature_list:e.premiumFeatureList,use_reaction:e.useReaction,allow_sdk_log_ingestion:e.allowSdkStatsUpload,uikit_config:e.uikitConfigInfo?Ui$1.payloadify(e.uikitConfigInfo):null,notifications:e.notificationInfo?Li$1.payloadify(e.notificationInfo):null}))},e}(),Fi=function(){function e(e){this._iid="",this._iid=e;}return e.payloadify=function(e){return {}},e}(),Hi$1=function(e){function n(t){var n=t.userId,r=t.metadata,i=e.call(this)||this;return i.method=ee.POST,i.path="".concat(ne,"/").concat(n,"/metadata"),i.params={metadata:r},i}return t(n,e),n}(Ne$1),Vi$1=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.metaData=n,r}return t(n,e),n}(Te$1),Gi$1=function(e){function n(t){var n=t.userId,r=t.metadata,i=t.upsert,o=e.call(this)||this;return o.method=ee.PUT,o.path="".concat(ne,"/").concat(n,"/metadata"),o.params={metadata:r,upsert:i},o}return t(n,e),n}(Ne$1),qi$1=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.metadata=n,r}return t(n,e),n}(Te$1),ji$1=function(e){function n(t){var n=t.userId,r=t.metadataKey,i=e.call(this)||this;return i.method=ee.DELETE,i.path="".concat(ne,"/").concat(n,"/metadata/").concat(r),i}return t(n,e),n}(Ne$1);!function(e){function n(){return null!==e&&e.apply(this,arguments)||this}t(n,e);}(Te$1);var Ki=function(e){function n(t){var n=t.userId,r=e.call(this)||this;return r.method=ee.DELETE,r.path="".concat(ne,"/").concat(n,"/metadata"),r}return t(n,e),n}(Ne$1);!function(e){function n(){return null!==e&&e.apply(this,arguments)||this}t(n,e);}(Te$1);var Bi,Zi$1=function(e,t){var n=JSON.parse(JSON.stringify(e));return n._iid&&delete n._iid,t&&t(n),n},Wi$1=function(e,t){var n=JSON.parse(JSON.stringify(e));return t&&t(n),n},Qi$1=function(e){return {do:function(t){e||t();},throw:function(t){if(!e)throw t}}};!function(e){e.ONLINE="online",e.OFFLINE="offline",e.NON_AVAILABLE="nonavailable";}(Bi||(Bi={}));var Yi$1,Xi$1=function(e){function r(t,n){var r,i,o,s,u,l,h,d,_,f,p,E,g=this;return (g=e.call(this,t)||this).userId=null!==(i=null!==(r=n.guest_id)&&void 0!==r?r:n.user_id)&&void 0!==i?i:"",g.nickname=null!==(s=null!==(o=n.nickname)&&void 0!==o?o:n.name)&&void 0!==s?s:"",g.plainProfileUrl=null!==(l=null!==(u=n.profile_url)&&void 0!==u?u:n.image)&&void 0!==l?l:"",g.requireAuth=null!==(h=n.require_auth_for_profile_image)&&void 0!==h&&h,g.metaData=null!==(d=n.metadata)&&void 0!==d?d:{},g.connectionStatus=Bi.NON_AVAILABLE,N$1(Bi,n.is_online)?g.connectionStatus=n.is_online:w("boolean",n.is_online)&&(g.connectionStatus=n.is_online?Bi.ONLINE:Bi.OFFLINE),g.isActive=null===(_=n.is_active)||void 0===_||_,g.lastSeenAt=null!==(f=n.last_seen_at)&&void 0!==f?f:null,g.preferredLanguages=n.preferred_languages?c([],a(n.preferred_languages),!1):null,g.friendDiscoveryKey=null!==(p=n.friend_discovery_key)&&void 0!==p?p:null,g.friendName=null!==(E=n.friend_name)&&void 0!==E?E:null,g}return t(r,e),r.payloadify=function(t){return J($(n(n({},e.payloadify.call(this,t)),{user_id:t.userId,nickname:t.nickname,profile_url:t.plainProfileUrl,require_auth_for_profile_image:t.requireAuth,metadata:t.metaData,is_online:t.connectionStatus,is_active:t.isActive,last_seen_at:t.lastSeenAt,preferred_languages:t.preferredLanguages,friend_discovery_key:t.friendDiscoveryKey,friend_name:t.friendName})))},Object.defineProperty(r.prototype,"profileUrl",{get:function(){var e=_o.of(this._iid).sessionManager;return this.requireAuth?"".concat(this.plainProfileUrl,"?auth=").concat(e.ekey):this.plainProfileUrl},enumerable:!1,configurable:!0}),r.prototype.serialize=function(){return Zi$1(this)},r.prototype._isValidMetaData=function(e){return !Array.isArray(e)&&Object.keys(e).length>0&&Object.keys(e).map((function(t){return e[t]})).every((function(e){return w("string",e)}))},r.prototype._applyMetaData=function(e,t){var n=this;void 0===t&&(t=!1),Object.keys(e).forEach((function(r){t?delete n.metaData[r]:n.metaData[r]=e[r];}));},r.prototype.createMetaData=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,s,a;return o(this,(function(o){switch(o.label){case 0:return Qi$1(this._isValidMetaData(e)).throw(v$1.invalidParameters),t=_o.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new Hi$1({userId:n.userId,metadata:e}),[4,r.send(i)];case 1:return s=o.sent(),a=s.as(Vi$1).metaData,this._applyMetaData(a),[2,this.metaData]}}))}))},r.prototype.updateMetaData=function(e,t){return void 0===t&&(t=!1),i(this,void 0,void 0,(function(){var n,r,i,s,a,c;return o(this,(function(o){switch(o.label){case 0:return Qi$1(this._isValidMetaData(e)).throw(v$1.invalidParameters),n=_o.of(this._iid),r=n.sdkState,i=n.requestQueue,s=new Gi$1({userId:r.userId,metadata:e,upsert:t}),[4,i.send(s)];case 1:return a=o.sent(),c=a.as(qi$1).metadata,this._applyMetaData(c),[2,this.metaData]}}))}))},r.prototype.deleteMetaData=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,s;return o(this,(function(o){switch(o.label){case 0:return Qi$1(w("string",e)).throw(v$1.invalidParameters),t=_o.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new ji$1({userId:n.userId,metadataKey:e}),[4,r.send(i)];case 1:return o.sent(),this._applyMetaData(((s={})[e]=!0,s),!0),[2,this.metaData]}}))}))},r.prototype.deleteAllMetaData=function(){return i(this,void 0,void 0,(function(){var e,t,n,r;return o(this,(function(i){switch(i.label){case 0:return e=_o.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new Ki({userId:t.userId}),[4,n.send(r)];case 1:return i.sent(),this.metaData={},[2]}}))}))},r}(Fi),Ji$1=function(e){function n(t){var n=t.userProfile,r=e.call(this)||this;return r.userProfile=n,r}return t(n,e),n}(X),$i=function(){function e(e,t){var n,r,i,o,s,a,c,u,l,h,d,_,f,p;this._iid=e,this.appInfo=new zi(t),this.user=new Xi$1(e,t),this.connectedAt=null!==(n=t.login_ts)&&void 0!==n?n:0,this.firstConnectedAt=0,this.pingInterval=null!==(r=t.ping_interval)&&void 0!==r?r:15e3,this.pongTimeout=null!==(i=t.pong_timeout)&&void 0!==i?i:5e3,this.reconnectInterval=null!==(s=null===(o=t.reconnect)||void 0===o?void 0:o.interval)&&void 0!==s?s:3e3,this.reconnectMaxInterval=null!==(c=null===(a=t.reconnect)||void 0===a?void 0:a.max_interval)&&void 0!==c?c:6e4,this.reconnectRetryCount=null!==(l=null===(u=t.reconnect)||void 0===u?void 0:u.retry_cnt)&&void 0!==l?l:5,this.reconnectIntervalMultiple=null!==(d=null===(h=t.reconnect)||void 0===h?void 0:h.mul)&&void 0!==d?d:2,this.maxUnreadCountOnSuperGroup=null!==(_=t.max_unread_cnt_on_super_group)&&void 0!==_?_:100,this.profileImageEncryption=!!t.profile_image_encryption,this.concurrentCallLimit=null!==(f=t.concurrent_call_limit)&&void 0!==f?f:5,this.backOffDelay=null!==(p=t.back_off_delay)&&void 0!==p?p:100;}return e.payloadify=function(e){return J($(n(n(n({},Xi$1.payloadify(e.user)),zi.payloadify(e.appInfo)),{login_ts:e.connectedAt,ping_interval:e.pingInterval,pong_timeout:e.pongTimeout,reconnect:{interval:e.reconnectInterval,max_interval:e.reconnectMaxInterval,retry_cnt:e.reconnectRetryCount,mul:e.reconnectIntervalMultiple},max_unread_cnt_on_super_group:e.maxUnreadCountOnSuperGroup,profile_image_encryption:e.profileImageEncryption,concurrent_call_limit:e.concurrentCallLimit,back_off_delay:e.backOffDelay})))},e.prototype.apply=function(){var e=this.reconnectInterval,t=this.reconnectMaxInterval,n=this.reconnectIntervalMultiple,r=_o.of(this._iid);r.sdkState.websocket&&(r.sdkState.websocket.pingInterval=1e3*this.pingInterval,r.sdkState.websocket.pongTimeout=1e3*this.pongTimeout,r.sdkState.websocket.reconnectMaxRetry=this.reconnectRetryCount,r.sdkState.websocket.reconnectRetryStrategy={calcTimeout:function(r){return r>0?1e3*Math.min(e*Math.pow(n,r-1),t):10}}),r.appInfo=this.appInfo,r.sessionManager.currentUser=this.user,r.connectedAt=this.connectedAt,this.firstConnectedAt||(r.firstConnectedAt=this.connectedAt),r.maxSuperGroupChannelUnreadCount=this.maxUnreadCountOnSuperGroup,r.concurrentCallLimit=this.concurrentCallLimit,r.backOffDelay=this.backOffDelay,r.dispatcher.dispatch(new Ji$1({userProfile:this}));},e}(),eo=function(e){function r(t,n,r){var i,o,s,a=this;return (a=e.call(this,t,n,r)||this).error=null,a.userProfile=new $i(t,r),a.deviceTokenLastDeletedAt=null!==(i=r.device_token_last_deleted_at)&&void 0!==i?i:0,a.key=null!==(o=r.key)&&void 0!==o?o:"",a.ekey=null!==(s=r.ekey)&&void 0!==s?s:"",a.error=r.error?new v$1(r):null,a}return t(r,e),r.asError=function(e){return new r("","LOGI",n({user_id:"",error:!0},e))},r.prototype.applyTo=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return this.error?[3,4]:(t=_o.of(e))?[4,t.sessionManager.login(this)]:[3,2];case 1:return n.sent(),this.userProfile.apply(),[3,3];case 2:throw v$1.lostInstance;case 3:return [3,5];case 4:throw this.error;case 5:return [2]}}))}))},r}(Pe$1),to=function(e){function r(t){var r=t.request,i=void 0===r||r,o=t.features,s=void 0===o?{}:o,a=t.options,c=void 0===a?{}:a,u=e.call(this)||this;return u.request=i,u.features=n({localCache:!0},s),u.options=n({ingestion:!0},c),u}return t(r,e),r}(X),no=function(e){function n(t,n){var r,i=n.sdkState,o=n.cacheContext,s=n.connectionHandlers,a=n.sessionManager,c=n.websocketClient,u=n.dispatcher,l=n.logger,h=n.entryState,d=void 0===h?new Ii$1:h,_=this;return (_=e.call(this)||this)._stateUpdatedAt=0,_._connectingAt=0,_._connectionRequestQueue=[],_._iid=t,_.sdkState=i,_.cacheContext=o,_.connectionHandlers=s,_._sessionManager=a,_._websocketClient=c,_._dispatcher=u,_._logger=l,_._currentState=d,(null===(r=_.sdkState.websocket)||void 0===r?void 0:r.pingerDisabled)||(_._pinger=new Di$1({pingDelegate:{send:function(e){return _._websocketClient.send(e)},error:function(e){return _._websocketClient.error(e)}},sdkState:_.sdkState,logger:l})),_._websocketClient.on("open",(function(){_._tryResolveConnectionRequest();})).on("message",(function(e){if("LOGI"===e.code)_.clearLoginTimer(),_._dispatcher.dispatch(e.as(eo));})).on("ping-refresh",(function(){var e;return null===(e=_._pinger)||void 0===e?void 0:e.refreshTimer()})).on("pong",(function(){var e;return null===(e=_._pinger)||void 0===e?void 0:e.pong()})).on("error",(function(){var e;return null===(e=_._pinger)||void 0===e?void 0:e.stop()})).on("close",(function(){_._logiProcessingTimer=setTimeout((function(){_._logiProcessingTimer=void 0,_._unresolvedLogi||_._rejectConnectionRequest(v$1.networkError);}),500);})),_._dispatcher.on((function(e){e instanceof eo&&(_._unresolvedLogi=e,_._tryResolveConnectionRequest());})),_}return t(n,e),Object.defineProperty(n.prototype,"currentState",{get:function(){return this._currentState},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"hasSession",{get:function(){return this._sessionManager.auth.hasSession},enumerable:!1,configurable:!0}),n.prototype.changeState=function(e,t){return i(this,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return t>=this._stateUpdatedAt?(this._currentState=e,this._stateUpdatedAt=t,this._dispatcher.dispatch(new ai$1({stateType:e.type})),this._logger.debug("connection state changes to ".concat(e.name)),[4,this._currentState.run(this)]):[3,2];case 1:return n.sent(),[2,!0];case 2:return [2,!1]}}))}))},n.prototype._tryResolveConnectionRequest=function(){var e;return i(this,void 0,void 0,(function(){var t,n;return o(this,(function(r){switch(r.label){case 0:return t=this._unresolvedLogi,this._websocketClient.isOpen&&t?(this._unresolvedLogi=void 0,t.error?[3,2]:[4,t.applyTo(this._iid)]):[3,3];case 1:return r.sent(),n=t.userProfile,this._enableStatLog({request:n.appInfo.applicationAttributes.includes("allow_sdk_request_log_publish"),features:{localCache:n.appInfo.applicationAttributes.includes("allow_sdk_feature_local_cache_log_publish")},options:{ingestion:n.appInfo.allowSdkStatsUpload}}),this._statLogConnection(),null===(e=this._pinger)||void 0===e||e.start(),this._connectionRequestQueue.forEach((function(e){return e.resolve()})),this._connectionRequestQueue=[],this.sdkState.appState="foreground",[3,3];case 2:this._sessionManager.auth.authToken=void 0,(t.error.isSessionKeyExpiredError||t.error.isSessionTokenExpiredError)&&this._dispatcher.dispatch(new Ae$1({reason:t.error.code})),this._rejectConnectionRequest(t.error),r.label=3;case 3:return [2]}}))}))},n.prototype._rejectConnectionRequest=function(e){var t;if(null===(t=this._pinger)||void 0===t||t.stop(),this.clearLoginTimer(),this._connectionRequestQueue.length>0){var n=this._connectionRequestQueue;this._connectionRequestQueue=[],n.forEach((function(t){return t.reject(e)})),this._statLogConnection(e);}},n.prototype._url=function(e){var t,n;void 0===e&&(e="");var r=this.sdkState,i=r.appId,o=r.appVersion,s=r.userId,a=r.extensions,c=r.sendbirdRuntimeEnvironment,u=this.cacheContext.localCacheEnabled,l=this._sessionManager.auth,d=null===(t=this.sdkState.websocket)||void 0===t?void 0:t.compression,_=!!(null!==(n=this.sdkState.extensions)&&void 0!==n?n:{}).sb_uikit,f=Ue$1.userAgentWithExtension(a);return "".concat(this.sdkState.websocket.host,"/?p=JS&pv=").concat(encodeURIComponent(h.OS_VERSION),"&sv=").concat(encodeURIComponent(h.SDK_VERSION),"&ai=").concat(i).concat(o?"&av=".concat(o):"").concat(l.hasSession?"&key=".concat(encodeURIComponent(l.sessionKey)):"&user_id=".concat(encodeURIComponent(s),"&access_token=").concat(encodeURIComponent(e)),"&pmce=").concat(d?1:0,"&active=1&device_token_types=").concat(encodeURIComponent(["gcm","huawei","apns"].join(",")),"&SB-User-Agent=").concat(f,"&SB-SDK-User-Agent=").concat(encodeURIComponent(Ue$1.sendbirdSdkUserAgentWithExtension(c)),"&Request-Sent-Timestamp=").concat(Date.now().toString(),"&include_extra_data=").concat(encodeURIComponent(String(["premium_feature_list","file_upload_size_limit","application_attributes","emoji_hash","multiple_file_send_max_size","notifications"]))).concat(this._sessionManager.handler?"&expiring_session=1":"","&use_local_cache=").concat(u?1:0,"&include_poll_details=1").concat(_?"&uikit_config=1":"")},n.prototype._enableStatLog=function(e){var t=e.request,n=e.features,r=e.options,i=void 0===r?{}:r;this._dispatcher.dispatch(new to({request:t,features:n,options:i}));},n.prototype._statLogConnection=function(e){var t;this._dispatcher.dispatch(new Ce$1(new Re$1({type:we$1.WEBSOCKET_CONNECT,data:{host_url:null===(t=this.sdkState.websocket)||void 0===t?void 0:t.host,success:!e,latency:Date.now()-this._connectingAt,error_code:null==e?void 0:e.code,error_description:null==e?void 0:e.message}})));},n.prototype.connect=function(e){var t;return void 0===e&&(e=""),i(this,void 0,void 0,(function(){var n,r,i=this;return o(this,(function(o){return this._logiProcessingTimer&&(clearTimeout(this._logiProcessingTimer),this._logiProcessingTimer=void 0,this._rejectConnectionRequest(v$1.connectionCanceled)),n=this._url(e),r=new oi$1,this._connectionRequestQueue.push(r),1===this._connectionRequestQueue.length&&(this._connectingAt=Date.now(),this._loginTimer=setTimeout((function(){i._loginTimer=void 0,i._rejectConnectionRequest(v$1.loginTimeout);}),null===(t=this.sdkState.websocket)||void 0===t?void 0:t.responseTimeout),e&&(this._sessionManager.auth.authToken=e),this._websocketClient.connect(n)),[2,r.promise]}))}))},n.prototype.cancelConnectForRetry=function(){this._dispatcher.dispatch(eo.asError(v$1.connectionRenew));},n.prototype.disconnect=function(){return i(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return [4,this._websocketClient.disconnect()];case 1:return e.sent(),[2]}}))}))},n.prototype.logout=function(){return i(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return this.sdkState.userId=void 0,this._unresolvedLogi=void 0,[4,this._sessionManager.clear()];case 1:return e.sent(),[4,this.disconnect()];case 2:return e.sent(),[2]}}))}))},n.prototype.clearLoginTimer=function(){this._loginTimer&&(clearTimeout(this._loginTimer),this._loginTimer=void 0);},n}(Q),ro=function(){function e(e,t){var n=t.sdkState,r=t.cacheContext,i=t.connectionHandlers,o=t.sessionManager,s=t.websocketClient,a=t.dispatcher,c=t.logger,u=t.disableWebSocketCloseEventHandling,l=void 0!==u&&u;this._disableWebSocketCloseEventHandling=!1,this._externalCalledWebSocketClose=!1,this._logger=c,this._disableWebSocketCloseEventHandling=l,this._context=new no(e,{sdkState:n,cacheContext:r,connectionHandlers:i,sessionManager:o,websocketClient:s,dispatcher:a,logger:c}),this._sdkState=n,this._sessionManager=o,this._websocketClient=s;}return e.prototype._registerEventDispatcher=function(){var e=this;this._disableWebSocketCloseEventHandling||(this._clearEventDispatcher(),this._sessionEventDispatcherContext=this._sessionManager.on("refresh-authtoken",(function(){e.isConnected||(e._logger.debug("try reconnect by session token refresh"),e.reconnect());})).on("refresh",(function(){e.isConnecting||e.isConnected||(e._logger.debug("try reconnect by session key refresh"),e.reconnect());})),this._websocketEventDispatcherContext=this._websocketClient.on("close",(function(){"foreground"!==e._sdkState.appState||e._externalCalledWebSocketClose||e._sessionManager.isRefreshingAuthToken||(e._logger.debug("try reconnect by websocket connection closed"),e.reconnect());})));},e.prototype._clearEventDispatcher=function(){this._sessionEventDispatcherContext&&(this._sessionEventDispatcherContext.close(),this._sessionEventDispatcherContext=void 0),this._websocketEventDispatcherContext&&(this._websocketEventDispatcherContext.close(),this._websocketEventDispatcherContext=void 0);},Object.defineProperty(e.prototype,"isConnected",{get:function(){return this._context.currentState.type===ti$1.CONNECTED},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isConnecting",{get:function(){var e=this._context.currentState;return e.type===ti$1.CONNECTING||e.type===ti$1.RECONNECTING},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"websocketClient",{get:function(){return this._websocketClient},enumerable:!1,configurable:!0}),e.prototype.connect=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return t=this._context.currentState,this._externalCalledWebSocketClose=!1,[4,t.onConnect(this._context,e)];case 1:return n.sent(),this._registerEventDispatcher(),[2]}}))}))},e.prototype.reconnect=function(){return i(this,void 0,void 0,(function(){var e;return o(this,(function(t){switch(t.label){case 0:return e=this._context.currentState,this._externalCalledWebSocketClose=!1,[4,e.onReconnect(this._context,{})];case 1:return t.sent(),[2]}}))}))},e.prototype.resetAndReconnect=function(){return i(this,void 0,void 0,(function(){var e;return o(this,(function(t){switch(t.label){case 0:return e=this._context.currentState,this._externalCalledWebSocketClose=!1,[4,e.onReconnect(this._context,{resetReconnectCount:!0})];case 1:return t.sent(),[2]}}))}))},e.prototype.background=function(){return i(this,void 0,void 0,(function(){var e;return o(this,(function(t){switch(t.label){case 0:return e=this._context.currentState,this._externalCalledWebSocketClose=!0,[4,e.onDisconnect(this._context,{autoReconnect:!1})];case 1:return t.sent(),[2]}}))}))},e.prototype.disconnect=function(e){return i(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return [4,this._context.currentState.onDisconnect(this._context,{error:e,autoReconnect:!0})];case 1:return t.sent(),[2]}}))}))},e.prototype.disconnectWebSocket=function(){return i(this,void 0,void 0,(function(){var e;return o(this,(function(t){switch(t.label){case 0:return e=this._context.currentState,this._externalCalledWebSocketClose=!0,[4,e.onDisconnectWebSocket(this._context)];case 1:return t.sent(),[2]}}))}))},e.prototype.logout=function(){return i(this,void 0,void 0,(function(){var e;return o(this,(function(t){switch(t.label){case 0:return e=this._context.currentState,this._clearEventDispatcher(),[4,e.onLogout(this._context)];case 1:return t.sent(),[2]}}))}))},e}(),io=function(e){function n(t){var n,r,i,o,s=t.type,a=t.data,c=t.ts,u=void 0===c?Date.now():c,l=e.call(this,{type:s,data:a,ts:u})||this;return l.date=new Date(u),l.key="".concat((n=l.date,r=n.getFullYear(),i=String(n.getMonth()+1).padStart(2,"0"),o=String(n.getDate()).padStart(2,"0"),"".concat(r).concat(i).concat(o)),"_").concat(s),l}return t(n,e),n}(Re$1),oo=function(e){function n(t){var n=t.deviceId,r=t.statLogs,i=e.call(this)||this;return i.method=ee.POST,i.path="".concat(pe),i.params={device_id:n,log_entries:r.map((function(e){return Re$1.payloadify(e)}))},i}return t(n,e),n}(Ne$1),so=function(e,t){var n,r;if(null!==e&&null!==t){var i=Object.keys(e),o=Object.keys(t),u=c([],a(new Set(c(c([],a(i),!1),a(o),!1))),!1),l={};try{for(var h=s(u),d=h.next();!d.done;d=h.next()){var _=d.value,f=typeof e[_],p=typeof t[_];"undefined"===f?l[_]=t[_]:"undefined"===p?l[_]=e[_]:f!==p?l[_]=t[_]:"object"===f&&e[_]&&t[_]?l[_]=so(e[_],t[_]):l[_]=t[_];}}catch(e){n={error:e};}finally{try{d&&!d.done&&(r=h.return)&&r.call(h);}finally{if(n)throw n.error}}return l}return t};!function(e){e[e.PENDING=0]="PENDING",e[e.COLLECT_ONLY=1]="COLLECT_ONLY",e[e.ENABLED=2]="ENABLED",e[e.DISABLED=3]="DISABLED";}(Yi$1||(Yi$1={}));var ao,co=function(e){function n(t){var n=t.cacheContext,r=t.requestQueue,i=t.dispatcher,o=t.baseLimit,s=void 0===o?100:o,a=t.maxLimit,c=void 0===a?1e3:a,u=t.minLimit,l=void 0===u?10:u,h=e.call(this)||this;return h.queue=[],h.enabledState=Yi$1.PENDING,h.isFlushing=!1,h.generation=1,h.lastFlushedAt=0,h._collectRequestStat=!0,h._collectFeatureLocalCacheStat=!0,h.deviceId=Z(),h.cacheContext=n,h.requestQueue=r,h.dispatcher=i,h.baseLimit=s,h.limit=s,h.maxLimit=c,h.minLimit=l,h}return t(n,e),Object.defineProperty(n.prototype,"isEnabled",{get:function(){return this.enabledState===Yi$1.ENABLED},enumerable:!1,configurable:!0}),n.prototype._arrangeStat=function(){var e=[];this._collectRequestStat&&e.push.apply(e,c([],a(this.queue.filter((function(e){return e.type===we$1.API_RESULT||e.type===we$1.WEBSOCKET_CONNECT}))),!1)),this._collectFeatureLocalCacheStat&&e.push.apply(e,c([],a(this.queue.filter((function(e){return e.type===we$1.FEATURE_LOCALCACHE}))),!1)),this.queue=e;},n.prototype._save=function(){return i(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return this.enabledState!==Yi$1.ENABLED?[3,2]:[4,this.cacheContext.preference.set(this.key,{deviceId:this.deviceId,statLogs:this.queue.map((function(e){return Re$1.payloadify(e)})),generation:this.generation++,lastFlushedAt:this.lastFlushedAt})];case 1:e.sent(),this.dispatch("save",c([],a(this.queue),!1)),e.label=2;case 2:return [2]}}))}))},n.prototype._flush=function(){return i(this,void 0,void 0,(function(){var e,t,n,r,i;return o(this,(function(o){switch(o.label){case 0:if(!this.isEnabled)return [3,10];if(this.isFlushing)return [3,10];this.isFlushing=!0,o.label=1;case 1:return o.trys.push([1,5,9,10]),this._arrangeStat(),e=this.queue.filter((function(e){if(e instanceof io){var t=new Date,n=a([e.date.getFullYear(),t.getFullYear()],2),r=n[0],i=n[1];if(r<i)return !0;if(r===i){var o=a([e.date.getMonth(),t.getMonth()],2),s=o[0],c=o[1];if(s<c)return !0;if(s===c){var u=a([e.date.getDate(),t.getDate()],2);return u[0]<u[1]}}}return !1})),t=this.queue.filter((function(e){return !(e instanceof io)})),(n=c(c([],a(e),!1),a(t),!1).slice(0,Math.min(this.limit,this.maxLimit))).length>0?(r=new oo({deviceId:this.deviceId,statLogs:n}),[4,this.requestQueue.send(r)]):[3,4];case 2:return o.sent(),this.dispatch("flush",n),this.queue=c(c([],a(e),!1),a(t),!1).slice(n.length),[4,this._save()];case 3:o.sent(),o.label=4;case 4:return this.limit=this.baseLimit,this.lastFlushedAt=Date.now(),[3,10];case 5:return (i=o.sent())instanceof v$1?i.code!==u.STAT_LOG_NOT_ALLOWED?[3,7]:[4,this.clear()]:[3,8];case 6:return o.sent(),this.enabledState=Yi$1.DISABLED,[3,8];case 7:i.code===u.STAT_UPLOAD_NOT_ALLOWED&&(this.enabledState=Yi$1.COLLECT_ONLY),o.label=8;case 8:return this.limit=this.limit+20,[3,10];case 9:return this.isFlushing=!1,[7];case 10:return [2]}}))}))},n.prototype.init=function(e){return i(this,void 0,void 0,(function(){var t,n,r=this;return o(this,(function(i){switch(i.label){case 0:return this.key=e,[4,this.cacheContext.preference.get(this.key)];case 1:return (t=i.sent())?(this.deviceId=t.deviceId,this.queue=t.statLogs.map((function(e){return new Re$1({type:e.stat_type,ts:e.ts,data:e.data})})),this.generation=t.generation,this.lastFlushedAt=t.lastFlushedAt,Date.now()-this.lastFlushedAt>=108e5&&this.queue.length>=this.minLimit?(n=Math.min(Math.floor(18e4*Math.random()),100),[4,Ei$1(n)]):[3,4]):[3,4];case 2:return i.sent(),[4,this._flush()];case 3:i.sent(),i.label=4;case 4:return this.commandEventContext||(this.commandEventContext=this.dispatcher.on((function(e){if(e instanceof Ce$1){var t=e.statLog;r.put(t);}else if(e instanceof to){var n=e.request,i=e.features,o=e.options;r._collectRequestStat=n,r._collectFeatureLocalCacheStat=null==i?void 0:i.localCache,r._arrangeStat(),r._collectRequestStat||r._collectFeatureLocalCacheStat?r.enabledState=o.ingestion?Yi$1.ENABLED:Yi$1.COLLECT_ONLY:r.enabledState=Yi$1.DISABLED,r.isEnabled?r.queue.length>=r.limit&&r._flush():r.clear();}}))),[2]}}))}))},n.prototype.put=function(e){return i(this,void 0,void 0,(function(){var t,n;return o(this,(function(r){switch(r.label){case 0:return this.enabledState===Yi$1.DISABLED?[3,3]:(e instanceof io?this._collectFeatureLocalCacheStat&&(t=a(this.queue.filter((function(t){return t instanceof io&&t.key===e.key})),1),(n=t[0])?n.data=so(n.data,e.data):this.queue.push(e)):this._collectRequestStat&&this.queue.push(e),[4,this._save()]);case 1:return r.sent(),this.queue.length>=this.limit?[4,this._flush()]:[3,3];case 2:r.sent(),r.label=3;case 3:return [2]}}))}))},n.prototype.clear=function(){return i(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return this.queue=[],this.generation=1,[4,this._save()];case 1:return e.sent(),[2]}}))}))},n.prototype.close=function(){this.commandEventContext&&(this.commandEventContext.close(),this.commandEventContext=void 0);},n}(Q);!function(e){e[e.NONE=0]="NONE",e[e.VERBOSE=1]="VERBOSE",e[e.DEBUG=2]="DEBUG",e[e.INFO=3]="INFO",e[e.WARN=4]="WARN",e[e.ERROR=5]="ERROR";}(ao||(ao={}));var uo,lo=function(){function e(){this.level=ao.WARN;}return e.prototype.verbose=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level<=ao.VERBOSE&&console.log.apply(console,c(["[verbose]"],a(e),!1));},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level<=ao.DEBUG&&console.log.apply(console,c(["[debug]"],a(e),!1));},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level<=ao.INFO&&console.log.apply(console,c(["[info]"],a(e),!1));},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level<=ao.WARN&&console.warn.apply(console,c(["[warn]"],a(e),!1));},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level<=ao.ERROR&&console.error.apply(console,c(["[error]"],a(e),!1));},e}(),ho={},_o=function(){function e(e,t){var n,r,i,o,s,a,c,u,l,d;if(this.connectedAt=0,this.firstConnectedAt=0,this.connectionHandlers=new Map,this.userEventHandlers=new Map,!ho[e]){ho[e]=this;var _=null!==(n=t.options)&&void 0!==n?n:new I$1,f=this.sdkState={appId:t.appId,appVersion:null!==(r=t.appVersion)&&void 0!==r?r:"",appState:"foreground",userId:void 0,extensions:{},api:{host:null!==(i=t.apiHost)&&void 0!==i?i:"https://api-".concat(t.appId,".sendbird.com")},websocket:{host:null!==(o=t.websocketHost)&&void 0!==o?o:"wss://ws-".concat(t.appId,".sendbird.com"),pingerDisabled:!!t.noPingpong,pingInterval:void 0,pongTimeout:void 0,connectMaxRetry:2,compression:!0,reconnectMaxRetry:-1,reconnectRetryStrategy:new gi$1,responseTimeout:_.websocketResponseTimeout},sessionTokenRefreshTimeout:_.sessionTokenRefreshTimeout};this.appInfo=void 0,this.subscribedUnreadMessageCount={all:0,feed:0,customTypes:{},ts:0};var p=this.logger=new lo;this.logger.level=null!==(s=t.logLevel)&&void 0!==s?s:ao.WARN,this.connectedAt=0,this.firstConnectedAt=0,this.connectionHandlers=new Map,this.userEventHandlers=new Map;var E=this.cacheContext=new L$1({encryption:t.encryption,store:t.store,localCacheEnabled:null!==(a=t.localCacheEnabled)&&void 0!==a&&a,localCacheConfig:null!==(c=t.localCacheConfig)&&void 0!==c?c:new K});this.debugMode=null!==(u=t.debugMode)&&void 0!==u&&u,this.maxSuperGroupChannelUnreadCount=h.DEFAULT_MAX_UNREAD_COUNT_OF_SUPER_GROUP_CHANNEL,this.useMemberInfoInMessage=_.useMemberInfoInMessage,this.typingIndicatorInvalidateTime=_.typingIndicatorInvalidateTime,this.typingIndicatorThrottle=_.typingIndicatorThrottle,this.concurrentCallLimit=void 0,this.backOffDelay=void 0;var g=this.dispatcher=new Y,v=new B;this.requestQueue=new ci$1(e,{auth:v,sdkState:f,dispatcher:g,logger:p,useFetchCompat:t.useFetchCompat}),this.sessionManager=new wi$1({auth:v,cacheContext:E,sdkState:f,dispatcher:g,requestQueue:this.requestQueue,logger:p}),this.connectionManager=new ro(e,{sdkState:f,cacheContext:this.cacheContext,connectionHandlers:this.connectionHandlers,dispatcher:g,sessionManager:this.sessionManager,websocketClient:this.requestQueue.commandRouter.websocketClient,disableWebSocketCloseEventHandling:null!==(l=t.disableWebSocketCloseEventHandling)&&void 0!==l&&l,logger:p}),this.statLogCollector=new co({cacheContext:this.cacheContext,requestQueue:this.requestQueue,dispatcher:g}),this.appStateToggleEnabled=null===(d=t.appStateToggleEnabled)||void 0===d||d;}return ho[e]}return e.of=function(e){if(ho[e])return ho[e];throw v$1.lostInstance},e.clear=function(e){ho[e]&&delete ho[e];},e.prototype.hasExtension=function(e){return this.sdkState.extensions&&this.sdkState.extensions[e]},e}(),fo=function(){function e(){}return e.prototype.init=function(e,t){var n=t.sdkState,r=t.dispatcher,i=t.sessionManager,o=t.requestQueue,s=t.logger;t.onlineDetector;var a=t.cacheContext;this._iid=e,this._cacheContext=a,this._sdkState=n,this._dispatcher=r,this._sessionManager=i,this._requestQueue=o,this._logger=s;},e}();!function(e){e.OPEN="open",e.CLOSED="closed";}(uo||(uo={}));var po,go=function(e){switch(e){case"open":return uo.OPEN;case"closed":return uo.CLOSED;default:return null}},vo=function(e){return !e||!!e.text&&w("string",e.text)},bo=function(e){function r(t,n){var r,i,o,s,a,c,u,l=this;return (l=e.call(this,t)||this).pollId=0,l.id=0,l.text=null,l.voteCount=0,l.createdBy=null,l.createdAt=0,l.updatedAt=0,l._lastVotedAt=0,l.pollId=null!==(r=n.poll_id)&&void 0!==r?r:0,l.id=null!==(i=n.id)&&void 0!==i?i:0,l.text=null!==(o=n.text)&&void 0!==o?o:null,l.voteCount=null!==(s=n.vote_count)&&void 0!==s?s:0,l.createdBy=null!==(a=n.created_by)&&void 0!==a?a:null,l.createdAt=null!==(c=n.created_at)&&void 0!==c?c:0,l.updatedAt=null!==(u=n.updated_at)&&void 0!==u?u:0,l}return t(r,e),r.payloadify=function(t){return J($(n(n({},e.payloadify.call(this,t)),{vote_count:t.voteCount,poll_id:t.pollId,text:t.text,created_at:t.createdAt,id:t.id,created_by:t.createdBy,updated_at:t.updatedAt})))},r}(Fi),mo=function(e){function r(t,n){var r,i,o,s,a,c,u,l,h,d,_,f,p,E=this;return (E=e.call(this,t)||this).id=0,E.title=null,E.createdAt=0,E.updatedAt=0,E.closeAt=-1,E.status=uo.CLOSED,E.messageId=0,E.data=null,E.voterCount=-1,E.options=[],E.createdBy=null,E.allowUserSuggestion=!1,E.allowMultipleVotes=!1,E.votedPollOptionIds=[],E.id=null!==(r=n.id)&&void 0!==r?r:0,E.title=null!==(i=n.title)&&void 0!==i?i:null,E.createdAt=null!==(o=n.created_at)&&void 0!==o?o:0,E.updatedAt=null!==(s=n.updated_at)&&void 0!==s?s:0,E.closeAt=null!==(a=n.close_at)&&void 0!==a?a:-1,E.status=null!==(c=go(n.status))&&void 0!==c?c:uo.CLOSED,E.messageId=null!==(u=n.message_id)&&void 0!==u?u:0,E.data=null!==(l=n.data)&&void 0!==l?l:null,E.voterCount=null!==(h=n.voter_count)&&void 0!==h?h:-1,E.options=n.options?n.options.map((function(e){return new bo(E._iid,e)})):[],E.createdBy=null!==(d=n.created_by)&&void 0!==d?d:null,E.allowUserSuggestion=null!==(_=n.allow_user_suggestion)&&void 0!==_&&_,E.allowMultipleVotes=null!==(f=n.allow_multiple_votes)&&void 0!==f&&f,E.votedPollOptionIds=null!==(p=n.voted_option_ids)&&void 0!==p?p:[],E}return t(r,e),r.prototype._applyPollUpdatePayload=function(e){var t,n,r,i,o,s,a,c,u=this;this.title=null!==(t=e.title)&&void 0!==t?t:this.title,this.updatedAt=null!==(n=e.updated_at)&&void 0!==n?n:this.updatedAt,this.closeAt=null!==(r=e.close_at)&&void 0!==r?r:this.closeAt,this.status=null!==(i=go(e.status))&&void 0!==i?i:this.status,this.data=null!==(o=e.data)&&void 0!==o?o:this.data,this.voterCount=null!==(s=e.voter_count)&&void 0!==s?s:this.voterCount,e.options&&(this.options=e.options.map((function(e){return new bo(u._iid,e)})),this.votedPollOptionIds=e.options.filter((function(e){return e.vote_count>0})).map((function(e){return e.id}))),this.allowUserSuggestion=null!==(a=e.allow_user_suggestion)&&void 0!==a?a:this.allowUserSuggestion,this.allowMultipleVotes=null!==(c=e.allow_multiple_votes)&&void 0!==c?c:this.allowMultipleVotes;},r.payloadify=function(t){return J($(n(n({},e.payloadify.call(this,t)),{id:t.id,title:t.title,created_at:t.createdAt,updated_at:t.updatedAt,close_at:t.closeAt,status:t.status,message_id:t.messageId,data:t.data,voter_count:t.voterCount,options:t.options.map((function(e){return bo.payloadify(e)})),created_by:t.createdBy,allow_user_suggestion:t.allowUserSuggestion,allow_multiple_votes:t.allowMultipleVotes,voted_option_ids:t.votedPollOptionIds})))},r.prototype.applyPollUpdateEvent=function(e){var t=e._payload.poll;return !(!t||this.id!==t.id||t.updated_at<this.updatedAt)&&(this._applyPollUpdatePayload(t),!0)},r.prototype.applyPollVoteEvent=function(e){if(this.id!==e.pollId)return !1;var t=this.options,n=t.map((function(e){return e.id})),r=e._payload,i=Math.floor(r.ts/1e3);return r.updated_vote_counts.forEach((function(e){var r=n.indexOf(e.option_id);if(r>-1){var o=t[r];i>=o._lastVotedAt&&(o.voteCount=e.vote_count,o._lastVotedAt=i);}})),r.req_id&&r.voted_option_ids&&(this.votedPollOptionIds=r.voted_option_ids),"number"==typeof r.voter_count&&(this.voterCount=r.voter_count),!0},r.prototype.serialize=function(){return Zi$1(this)},r}(Fi);!function(e){e.UNKNOWN="UNKNOWN",e.EVENT_CHANNEL_CREATED="EVENT_CHANNEL_CREATED",e.EVENT_CHANNEL_UPDATED="EVENT_CHANNEL_UPDATED",e.EVENT_CHANNEL_DELETED="EVENT_CHANNEL_DELETED",e.EVENT_CHANNEL_READ="EVENT_CHANNEL_READ",e.EVENT_CHANNEL_DELIVERED="EVENT_CHANNEL_DELIVERED",e.EVENT_CHANNEL_INVITED="EVENT_CHANNEL_INVITED",e.EVENT_CHANNEL_JOINED="EVENT_CHANNEL_JOINED",e.EVENT_CHANNEL_LEFT="EVENT_CHANNEL_LEFT",e.EVENT_CHANNEL_ACCEPTED_INVITE="EVENT_CHANNEL_ACCEPTED_INVITE",e.EVENT_CHANNEL_DECLINED_INVITE="EVENT_CHANNEL_DECLINED_INVITE",e.EVENT_CHANNEL_OPERATOR_UPDATED="EVENT_CHANNEL_OPERATOR_UPDATED",e.EVENT_CHANNEL_BANNED="EVENT_CHANNEL_BANNED",e.EVENT_CHANNEL_UNBANNED="EVENT_CHANNEL_UNBANNED",e.EVENT_CHANNEL_MUTED="EVENT_CHANNEL_MUTED",e.EVENT_CHANNEL_UNMUTED="EVENT_CHANNEL_UNMUTED",e.EVENT_CHANNEL_FROZEN="EVENT_CHANNEL_FROZEN",e.EVENT_CHANNEL_UNFROZEN="EVENT_CHANNEL_UNFROZEN",e.EVENT_CHANNEL_HIDDEN="EVENT_CHANNEL_HIDDEN",e.EVENT_CHANNEL_UNHIDDEN="EVENT_CHANNEL_UNHIDDEN",e.EVENT_CHANNEL_RESET_HISTORY="EVENT_CHANNEL_RESET_HISTORY",e.EVENT_CHANNEL_TYPING_STATUS_UPDATE="EVENT_CHANNEL_TYPING_STATUS_UPDATE",e.EVENT_CHANNEL_MEMBER_COUNT_UPDATED="EVENT_CHANNEL_MEMBER_COUNT_UPDATED",e.EVENT_CHANNEL_METADATA_CREATED="EVENT_CHANNEL_METADATA_CREATED",e.EVENT_CHANNEL_METADATA_UPDATED="EVENT_CHANNEL_METADATA_UPDATED",e.EVENT_CHANNEL_METADATA_DELETED="EVENT_CHANNEL_METADATA_DELETED",e.EVENT_CHANNEL_METACOUNTER_CREATED="EVENT_CHANNEL_METACOUNTER_CREATED",e.EVENT_CHANNEL_METACOUNTER_UPDATED="EVENT_CHANNEL_METACOUNTER_UPDATED",e.EVENT_CHANNEL_METACOUNTER_DELETED="EVENT_CHANNEL_METACOUNTER_DELETED",e.EVENT_MESSAGE_SENT="EVENT_MESSAGE_SENT",e.EVENT_MESSAGE_RECEIVED="EVENT_MESSAGE_RECEIVED",e.EVENT_MESSAGE_UPDATED="EVENT_MESSAGE_UPDATED",e.EVENT_PINNED_MESSAGE_UPDATED="EVENT_PINNED_MESSAGE_UPDATED",e.REQUEST_CHANNEL="REQUEST_CHANNEL",e.REQUEST_CHANNEL_CHANGELOGS="REQUEST_CHANNEL_CHANGELOGS",e.REFRESH_CHANNEL="REFRESH_CHANNEL",e.CHANNEL_LASTACCESSEDAT_UPDATED="CHANNEL_LASTACCESSEDAT_UPDATED",e.SYNC_CHANNEL_BACKGROUND="SYNC_CHANNEL_BACKGROUND",e.SYNC_CHANNEL_CHANGELOGS="SYNC_CHANNEL_CHANGELOGS",e.EVENT_MESSAGE_SENT_SUCCESS="EVENT_MESSAGE_SENT_SUCCESS",e.EVENT_MESSAGE_SENT_FAILED="EVENT_MESSAGE_SENT_FAILED",e.EVENT_MESSAGE_SENT_PENDING="EVENT_MESSAGE_SENT_PENDING",e.EVENT_MESSAGE_DELETED="EVENT_MESSAGE_DELETED",e.EVENT_MESSAGE_READ="EVENT_MESSAGE_READ",e.EVENT_MESSAGE_DELIVERED="EVENT_MESSAGE_DELIVERED",e.EVENT_MESSAGE_REACTION_UPDATED="EVENT_MESSAGE_REACTION_UPDATED",e.EVENT_MESSAGE_THREADINFO_UPDATED="EVENT_MESSAGE_THREADINFO_UPDATED",e.EVENT_MESSAGE_OFFSET_UPDATED="EVENT_MESSAGE_OFFSET_UPDATED",e.REQUEST_MESSAGE="REQUEST_MESSAGE",e.EVENT_POLL_UPDATED="EVENT_POLL_UPDATED",e.EVENT_POLL_VOTED="EVENT_POLL_VOTED",e.SYNC_POLL_CHANGELOGS="SYNC_POLL_CHANGELOGS",e.REQUEST_RESEND_MESSAGE="REQUEST_RESEND_MESSAGE",e.REQUEST_THREADED_MESSAGE="REQUEST_THREADED_MESSAGE",e.REQUEST_MESSAGE_CHANGELOGS="REQUEST_MESSAGE_CHANGELOGS",e.SYNC_MESSAGE_FILL="SYNC_MESSAGE_FILL",e.SYNC_MESSAGE_BACKGROUND="SYNC_MESSAGE_BACKGROUND",e.SYNC_MESSAGE_CHANGELOGS="SYNC_MESSAGE_CHANGELOGS",e.LOCAL_MESSAGE_PENDING_CREATED="LOCAL_MESSAGE_PENDING_CREATED",e.LOCAL_MESSAGE_FAILED="LOCAL_MESSAGE_FAILED",e.LOCAL_MESSAGE_CANCELED="LOCAL_MESSAGE_CANCELED",e.LOCAL_MESSAGE_RESEND_STARTED="LOCAL_MESSAGE_RESEND_STARTED";}(po||(po={}));n({},po);var No=function(e){function n(t){var n=t.messages,r=t.source,i=t.isWebSocketEventComing,o=void 0!==i&&i,s=e.call(this)||this;return s.messages=n,s.source=r,s.isWebSocketEventComing=o,s}return t(n,e),n}(X),To=function(e){function n(t){var n=t.messageIds,r=t.source,i=t.isWebSocketEventComing,o=void 0!==i&&i,s=e.call(this)||this;return s.messageIds=n,s.source=r,s.isWebSocketEventComing=o,s}return t(n,e),n}(X),So=function(e){function n(t){var n=t.reqId,r=t.source,i=e.call(this)||this;return i.reqId=n,i.source=r,i}return t(n,e),n}(X),Ao=function(e){function n(t){var n=t.polls,r=t.source,i=e.call(this)||this;return i.polls=n,i.source=r,i}return t(n,e),n}(X),Co=function(e){function n(t){var n=t.event,r=t.source,i=e.call(this)||this;return i.event=n,i.source=r,i}return t(n,e),n}(X),ko=function(e){function n(t){var n=t.event,r=t.source,i=e.call(this)||this;return i.event=n,i.source=r,i}return t(n,e),n}(X),Oo=function(){function e(e,t){var n;this.limit=20,this._isLoading=!1,this._hasNext=!0,this._token="",this._iid=e,this.limit=null!==(n=t.limit)&&void 0!==n?n:20;}return Object.defineProperty(e.prototype,"hasNext",{get:function(){return this._hasNext},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isLoading",{get:function(){return this._isLoading},enumerable:!1,configurable:!0}),e.prototype._validate=function(){return w("number",this.limit)&&this.limit>0},e}(),Io=function(e){function n(t,n,r,i){var o=e.call(this,t,i)||this;return o.channelUrl=n,o.channelType=r,o}return t(n,e),n.prototype._validate=function(){return e.prototype._validate.call(this)&&w("string",this.channelUrl)&&N$1(x,this.channelType)},n}(Oo),Ro=function(e){this.pollId=0,this.messageId=0,this.pollId=e.poll_id,this.messageId=e.message_id,this._payload=e;},Do=function(e){function n(t){var n=t.title,r=t.optionTexts,i=t.data,o=t.allowUserSuggestion,s=t.allowMultipleVotes,a=t.closeAt,c=e.call(this)||this;return c.method=ee.POST,c.path=de,c.params={title:n,options:r,data:i,allow_user_suggestion:o,allow_multiple_votes:s,close_at:a},c}return t(n,e),n}(Ne$1),Lo=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.poll=new mo(t,n),r}return t(n,e),n}(Te$1),xo=function(e){function n(t){var n=t.channelUrl,r=t.channelType,i=t.pollId,o=e.call(this)||this;return o.method=ee.GET,o.path="".concat(de,"/").concat(encodeURIComponent(i)),o.params={channel_url:n,channel_type:r},o}return t(n,e),n}(Ne$1),Uo=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.poll=new mo(t,n),r}return t(n,e),n}(Te$1),Mo=function(e){function n(t){var n=t.channelUrl,r=t.channelType,i=t.pollId,o=t.pollOptionId,s=e.call(this)||this;return s.method=ee.GET,s.path="".concat(de,"/").concat(encodeURIComponent(i),"/options/").concat(encodeURIComponent(o)),s.params={channel_url:n,channel_type:r},s}return t(n,e),n}(Ne$1),Po=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.pollOption=new bo(t,n),r}return t(n,e),n}(Te$1),zo=function(e){function n(t){var n=t.channelType,r=t.channelUrl,i=t.timestamp,o=t.token,s=e.call(this)||this;return s.method=ee.GET,s.path="".concat(ge(n),"/").concat(encodeURIComponent(r),"/polls/changelogs"),s.params=J({change_ts:i,token:o}),s}return t(n,e),n}(Ne$1),Fo=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.updatedPolls=n.updated.map((function(e){return function(e,t){return new mo(e,t)}(t,e)})),r.deletedPollIds=n.deleted.map((function(e){return e})),r.hasMore=n.has_more,r.nextToken=n.next,r}return t(n,e),n}(Te$1),Ho={title:"",optionTexts:[],data:void 0,allowUserSuggestion:void 0,allowMultipleVotes:void 0,closeAt:-1},Vo=function(e){return w("string",e.title)&&(t=e.optionTexts,S$1("string",t)&&t.every((function(e){return ""!==e.trim()})))&&vo(e.data)&&w("boolean",e.allowUserSuggestion,!0)&&w("boolean",e.allowMultipleVotes,!0)&&w("number",e.closeAt,!0);var t;},Go={channelUrl:"",channelType:x.BASE,pollId:0,pollOptionId:0},qo=function(e){return w("string",e.channelUrl)&&""!==e.channelUrl&&N$1(x,e.channelType)&&w("number",e.pollId)&&e.pollId>0&&w("number",e.pollOptionId)&&e.pollOptionId>0},jo={channelUrl:"",channelType:x.BASE,pollId:0},Ko=function(e){return w("string",e.channelUrl)&&""!==e.channelUrl&&N$1(x,e.channelType)&&w("number",e.pollId)},Bo={},Zo=function(){function e(e,t){var n=t.sdkState,r=t.dispatcher,i=t.sessionManager,o=t.requestQueue,s=t.logger;this._iid=e,this._sdkState=n,this._sessionManager=i,this._requestQueue=o,this._dispatcher=r,this._logger=s,Bo[e]=this;}return e.of=function(e){return Bo[e]},e.prototype.buildPollFromSerializedData=function(e){var t=Wi$1(e);return new mo(this._iid,mo.payloadify(t))},e.prototype.get=function(e){return i(this,void 0,void 0,(function(){var t,r;return o(this,(function(i){switch(i.label){case 0:return Qi$1(Ko(e)).throw(v$1.invalidParameters),t=new xo(n({},e)),[4,this._requestQueue.send(t)];case 1:return r=i.sent(),[2,r.as(Uo).poll]}}))}))},e.prototype.create=function(e){return i(this,void 0,void 0,(function(){var t,r;return o(this,(function(i){switch(i.label){case 0:return Qi$1(Vo(e)).throw(v$1.invalidParameters),t=new Do(n({},e)),[4,this._requestQueue.send(t)];case 1:return r=i.sent(),[2,r.as(Lo).poll]}}))}))},e.prototype.getOption=function(e){return i(this,void 0,void 0,(function(){var t,r;return o(this,(function(i){switch(i.label){case 0:return Qi$1(qo(e)).throw(v$1.invalidParameters),t=new Mo(n({},e)),[4,this._requestQueue.send(t)];case 1:return r=i.sent(),[2,r.as(Po).pollOption]}}))}))},e.prototype.getPollChangeLogs=function(e,t,n,r){return void 0===r&&(r=po.SYNC_POLL_CHANGELOGS),i(this,void 0,void 0,(function(){var i,s,a,c,u,l,h;return o(this,(function(o){switch(o.label){case 0:return i=new zo($({channelType:t,channelUrl:e,timestamp:"number"==typeof n?n:null,token:"string"==typeof n?n:null})),[4,this._requestQueue.send(i)];case 1:return s=o.sent(),a=s.as(Fo),c=a.updatedPolls,u=a.deletedPollIds,l=a.hasMore,h=a.nextToken,c.length>0&&this._dispatcher.dispatch(new Ao({polls:c,source:r})),[2,{updatedPolls:c,deletedPollIds:u,hasMore:l,token:h}]}}))}))},e}(),Wo=function(e){function n(t){var n=t.channelUrl,r=t.channelType,i=t.token,o=t.limit,s=e.call(this)||this;return s.method=ee.GET,s.path=de,s.params={channel_url:n,channel_type:r,token:i,limit:o},s}return t(n,e),n}(Ne$1),Qo=function(e){function n(t,n){var r,i=this;return (i=e.call(this,t,n)||this).polls=(null!==(r=n.polls)&&void 0!==r?r:[]).map((function(e){return new mo(t,e)})),i.token=n.next,i}return t(n,e),n}(Te$1),Yo=function(e){function r(t,n){return e.call(this,t,n.channelUrl,n.channelType,n)||this}return t(r,e),r.prototype.next=function(){return i(this,void 0,void 0,(function(){var e,t,r,i,s,a;return o(this,(function(o){switch(o.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=_o.of(this._iid).requestQueue,t=new Wo(n(n({},this),{token:this._token})),[4,e.send(t)]):[3,2]:[3,5];case 1:return r=o.sent(),i=r.as(Qo),s=i.polls,a=i.token,this._token=a,this._hasNext=!!a,this._isLoading=!1,[2,s];case 2:return [2,[]];case 3:throw v$1.queryInProgress;case 4:return [3,6];case 5:throw v$1.invalidParameters;case 6:return [2]}}))}))},r}(Io),Xo=function(e){function n(t){var n=t.channelUrl,r=t.channelType,i=t.pollId,o=t.pollOptionId,s=t.token,a=t.limit,c=e.call(this)||this;return c.method=ee.GET,c.path="".concat(de,"/").concat(encodeURIComponent(i),"/options/").concat(encodeURIComponent(o),"/voters"),c.params={channel_url:n,channel_type:r,token:s,limit:a},c}return t(n,e),n}(Ne$1),Jo=function(e){function n(t,n){var r,i=this;return (i=e.call(this,t,n)||this).voters=(null!==(r=n.voters)&&void 0!==r?r:[]).map((function(e){return new Xi$1(t,e)})),i.token=n.next,i}return t(n,e),n}(Te$1),$o=function(e){function r(t,n){var r=e.call(this,t,n.channelUrl,n.channelType,n)||this;return r.pollId=n.pollId,r.pollOptionId=n.pollOptionId,r}return t(r,e),r.prototype._validate=function(){return e.prototype._validate.call(this)&&w("number",this.pollId)&&w("number",this.pollOptionId)},r.prototype.next=function(){return i(this,void 0,void 0,(function(){var e,t,r,i,s,a;return o(this,(function(o){switch(o.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=_o.of(this._iid).requestQueue,t=new Xo(n(n({},this),{pollId:this.pollId,pollOptionId:this.pollOptionId,token:this._token})),[4,e.send(t)]):[3,2]:[3,5];case 1:return r=o.sent(),i=r.as(Jo),s=i.voters,a=i.token,this._token=a,this._hasNext=!!a,this._isLoading=!1,[2,s];case 2:return [2,[]];case 3:throw v$1.queryInProgress;case 4:return [3,6];case 5:throw v$1.invalidParameters;case 6:return [2]}}))}))},r}(Io);

var Ee,Te=function(i){function s(e){var s=i.call(this)||this;if(s.method=ee.POST,s.path="".concat(re),s.params=J({file:e.file,channel_url:e.channelUrl}),e.thumbnailSizes)for(var a=0;a<e.thumbnailSizes.length;a++){var o=e.thumbnailSizes[a],u=o.maxWidth,c=o.maxHeight;s.params["thumbnail".concat(a+1)]="".concat(u,",").concat(c);}return s.requestId=e.requestId,s}return t(s,i),s}(Ne$1),we=function(t$1){function n(e,n){var r,i,s,a=this;return (a=t$1.call(this,e,n)||this).url=n.url,a.fileSize=null!==(r=n.file_size)&&void 0!==r?r:0,a.thumbnailSizes=null!==(i=n.thumbnails)&&void 0!==i?i:[],a.requireAuth=null!==(s=n.require_auth)&&void 0!==s&&s,a}return t(n,t$1),n}(Te$1),Me=function(t$1){function n$1(e,n){var r,i,s,a=this;return (a=t$1.call(this,e)||this).replyCount=0,a.lastRepliedAt=0,a.updatedAt=0,a.replyCount=null!==(r=n.reply_count)&&void 0!==r?r:0,a.mostRepliedUsers=n.most_replies&&S$1("object",n.most_replies)?n.most_replies.map((function(e){return new Xi$1(a._iid,e)})):[],a.lastRepliedAt=null!==(i=n.last_replied_at)&&void 0!==i?i:0,a.updatedAt=null!==(s=n.updated_at)&&void 0!==s?s:0,a}return t(n$1,t$1),n$1.payloadify=function(e){return J($(n(n({},t$1.payloadify.call(this,e)),{reply_count:e.replyCount,most_replies:Array.isArray(e.mostRepliedUsers)?e.mostRepliedUsers.map((function(e){return Xi$1.payloadify(e)})):[],last_replied_at:e.lastRepliedAt,updated_at:e.updatedAt})))},n$1}(Fi);!function(e){e.ADD="add",e.DELETE="delete";}(Ee||(Ee={}));var Se,Ae,Ne=function(e){this.messageId=0,this.operation=null,this.updatedAt=0;var t=w("string",e.msg_id)?parseInt(e.msg_id):e.msg_id,n=e.user_id,r=e.operation?e.operation.toLowerCase():null,i=e.reaction,s=e.updated_at;t&&w("string",n)&&w("string",r)&&N$1(Ee,r)&&w("string",i)&&i&&w("number",s)&&(this.messageId=t,this.userId=n,this.key=i,this.operation=r,this.updatedAt=s);},Ue=function(){function e(e){var t,n,r,i=e.key,s$1=null!==(r=c([],a(e.user_ids),!1))&&void 0!==r?r:[],a$1=e.updated_at;w("string",i)&&i&&S$1("string",s$1)&&s$1.length>0&&w("number",a$1)&&(this.key=i,this.userIds=s$1,this.updatedAt=a$1);var o={};try{for(var u=s(this.userIds),c$1=u.next();!c$1.done;c$1=u.next()){o[c$1.value]=this.updatedAt;}}catch(e){t={error:e};}finally{try{c$1&&!c$1.done&&(n=u.return)&&n.call(u);}finally{if(t)throw t.error}}this._version=o;}return Object.defineProperty(e.prototype,"isEmpty",{get:function(){return 0===this.userIds.length},enumerable:!1,configurable:!0}),e.payloadify=function(e){return J($({key:e.key,user_ids:e.userIds,updated_at:e.updatedAt}))},e.prototype.applyEvent=function(e){if(e.key===this.key&&this.updatedAt<=e.updatedAt){if(!this._version[e.userId]||this._version[e.userId]<=e.updatedAt){var t=this.userIds.indexOf(e.userId);switch(e.operation){case Ee.ADD:t<0&&this.userIds.push(e.userId);break;case Ee.DELETE:t>=0&&this.userIds.splice(t,1);}this._version[e.userId]=e.updatedAt;}this.updatedAt=Math.max(this.updatedAt,e.updatedAt);}},e}(),Oe=function(){function e(e){this.key=e.key,this.value=S$1("string",e.value)?c([],a(e.value),!1):[];}return e.payloadify=function(e){var t;return J($({key:e.key,value:null!==(t=e.value)&&void 0!==t?t:[]}))},e}(),Ce=function(){function e(e){this.secureUrl=null,this.type=null,this.width=0,this.height=0,this.alt=null,this.url=e.url,e.secure_url&&(this.secureUrl=e.secure_url),e.type&&(this.type=e.type),e.width&&(this.width=e.width),e.height&&(this.height=e.height),e.alt&&(this.alt=e.alt);}return e.payloadify=function(e){var t,n;return J($({url:e.url,secure_url:e.secureUrl,type:e.type,width:null!==(t=e.width)&&void 0!==t?t:0,height:null!==(n=e.height)&&void 0!==n?n:0,alt:e.alt}))},e}(),Pe=function(){function e(e){this.title=null,this.url=null,this.description=null,this.defaultImage=null,e["og:title"]&&(this.title=e["og:title"]),e["og:url"]&&(this.url=e["og:url"]),e["og:description"]&&(this.description=e["og:description"]),e["og:image"]&&(this.defaultImage=new Ce(e["og:image"]));}return e.payloadify=function(e){return J($({"og:title":e.title,"og:url":e.url,"og:description":e.description,"og:image":e.defaultImage?Ce.payloadify(e.defaultImage):null}))},e}(),ke=function(){function e(e){var t,n;this.volume=0,this.name=null!==(t=e.name)&&void 0!==t?t:"default",this.volume=null!==(n=e.volume)&&void 0!==n?n:1;}return e.prototype.serialize=function(){return {name:this.name,volume:this.volume}},e.payloadify=function(e){return J($({name:e.name,volume:e.volume}))},e}(),Re=function(t$1){function n$1(e,n){var r,i=this;return (i=t$1.call(this,e,n)||this).isBlockedByMe=!1,i.role=N$1(U,n.role)?n.role:U.NONE,i.isBlockedByMe=null!==(r=n.is_blocked_by_me)&&void 0!==r&&r,i}return t(n$1,t$1),n$1.payloadify=function(e){return J($(n(n({},t$1.payloadify.call(this,e)),{role:e.role,is_blocked_by_me:e.isBlockedByMe})))},n$1}(Xi$1);!function(e){e.PENDING="pending",e.SENT="sent",e.FAILED="failed",e.CANCELED="canceled";}(Se||(Se={})),function(e){e.PENDING="pending",e.IN_QUEUE="in_queue",e.SENT="sent",e.FAILED="failed",e.CANCELED="canceled",e.REMOVED="removed";}(Ae||(Ae={}));var xe=function(e){switch(e){case P.BASE:return "";case P.USER:return "MESG";case P.FILE:return "FILE";case P.ADMIN:return "ADMM"}},Le=function(t$1){function n$1(e,n){var r,i,s,a,o,c,l,d,f,p,m,v,y,g,E,T,w=this;(w=t$1.call(this,e)||this).channelType=x.BASE,w.parentMessage=null,w.silent=!1,w.isOperatorMessage=!1,w.messageType=P.BASE,w.mentionType=null,w.threadInfo=null,w.reactions=[],w.metaArrays=[],w.appleCriticalAlertOptions=null,w.createdAt=0,w.updatedAt=0,w.scheduledInfo=null,w.extendedMessage={},w._isContinuousMessages=!1,w._scheduledStatus=null,w.messageId=null!==(i=null!==(r=n.msg_id)&&void 0!==r?r:n.message_id)&&void 0!==i?i:0,w.channelUrl=n.channel_url,w.channelType=N$1(x,n.channel_type)?n.channel_type:x.GROUP,n.channel&&(n.channel.channel_url&&(w.channelUrl=n.channel.channel_url),n.channel.channel_type&&(w.channelType=n.channel.channel_type)),w.parentMessageId=null!==(s="string"==typeof n.parent_message_id?parseInt(n.parent_message_id):n.parent_message_id)&&void 0!==s?s:0,w.data=null!==(a=n.data)&&void 0!==a?a:"",w.customType=null!==(o=n.custom_type)&&void 0!==o?o:"",w.mentionType=N$1(H,n.mention_type)?n.mention_type:null,w.mentionedUsers=n.mentioned_users?n.mentioned_users.map((function(e){return new Xi$1(w._iid,e)})):null,w.mentionedUserIds=null!==(c=n.mentioned_user_ids)&&void 0!==c?c:null,w.mentionedUsers&&!w.mentionedUserIds&&(w.mentionedUserIds=w.mentionedUsers.map((function(e){return e.userId}))),w.mentionedMessageTemplate=null!==(l=n.mentioned_message_template)&&void 0!==l?l:"",w.threadInfo=n.thread_info?new Me(w._iid,n.thread_info):null,w.reactions=n.reactions?n.reactions.map((function(e){return new Ue(e)})):[];var M=null!==(d=n.metaarray)&&void 0!==d?d:{},S=null!==(f=n.metaarray_key_order)&&void 0!==f?f:Object.keys(M).sort((function(e,t){return e.localeCompare(t)}));w.metaArrays=[];for(var A=0;A<S.length;A++){var N=S[A];w.metaArrays.push(new Oe({key:N,value:M[N]||[]}));}return n.sorted_metaarray&&(w.metaArrays=n.sorted_metaarray.map((function(e){return new Oe(e)}))),w.ogMetaData=n.og_tag?new Pe(n.og_tag):null,w.silent=null!==(p=n.silent)&&void 0!==p&&p,w.isOperatorMessage=null!==(m=n.is_op_msg)&&void 0!==m&&m,w.appleCriticalAlertOptions=n.apple_critical_alert_options?new ke(n.apple_critical_alert_options):null,w.createdAt=null!==(y=null!==(v=n.created_at)&&void 0!==v?v:n.ts)&&void 0!==y?y:0,w.updatedAt=null!==(g=n.updated_at)&&void 0!==g?g:0,"number"==typeof n.scheduled_message_id&&"number"==typeof n.scheduled_at&&n.scheduled_status&&(w.scheduledInfo={scheduledMessageId:n.scheduled_message_id,scheduledAt:n.scheduled_at},w._scheduledStatus=n.scheduled_status),w.extendedMessage=null!==(E=n.extended_message)&&void 0!==E?E:{},w._isContinuousMessages=null!==(T=n.is_continuous_messages)&&void 0!==T&&T,w}return t(n$1,t$1),n$1.payloadify=function(e){var n$1,i,s,c;return J($(n(n({},t$1.payloadify.call(this,e)),{channel_url:e.channelUrl,channel_type:e.channelType,message_id:e.messageId,type:xe(e.messageType),parent_message_id:e.parentMessageId,data:e.data,custom_type:e.customType,mention_type:e.mentionType,mentioned_user_ids:e.mentionedUserIds,mentioned_users:null===(n$1=e.mentionedUsers)||void 0===n$1?void 0:n$1.map((function(e){return Xi$1.payloadify(e)})),mentioned_message_template:e.mentionedMessageTemplate,thread_info:e.threadInfo?Me.payloadify(e.threadInfo):null,reactions:e.reactions.map((function(e){return Ue.payloadify(e)})),sorted_metaarray:null===(i=e.metaArrays)||void 0===i?void 0:i.map((function(e){return Oe.payloadify(e)})),og_tag:e.ogMetaData?Pe.payloadify(e.ogMetaData):null,silent:e.silent,is_op_msg:e.isOperatorMessage,apple_critical_alert_options:e.appleCriticalAlertOptions?ke.payloadify(e.appleCriticalAlertOptions):null,created_at:e.createdAt,updated_at:e.updatedAt,scheduled_message_id:null===(s=e.scheduledInfo)||void 0===s?void 0:s.scheduledMessageId,scheduled_at:null===(c=e.scheduledInfo)||void 0===c?void 0:c.scheduledAt,scheduled_status:e._scheduledStatus,extended_message:e.extendedMessage})))},n$1._getParentMessageInfoPayload=function(e){return J($({type:xe(e.messageType),ts:e.createdAt,user:e.sender?Re.payloadify(e.sender):null,message:e.message,file:{url:e.plainUrl,name:e.name,type:e.type,require_auth:e.requireAuth}}))},n$1.prototype.isIdentical=function(e){return this.messageId===e.messageId},n$1.prototype.isEqual=function(e){return y(this,e)},n$1.prototype.isUserMessage=function(){return this.messageType===P.USER},n$1.prototype.isFileMessage=function(){return this.messageType===P.FILE&&!Object.prototype.hasOwnProperty.call(this,"fileInfoList")},n$1.prototype.isMultipleFilesMessage=function(){return this.messageType===P.FILE&&Object.prototype.hasOwnProperty.call(this,"fileInfoList")},n$1.prototype.isAdminMessage=function(){return this.messageType===P.ADMIN},n$1.prototype.serialize=function(){return Zi$1(this)},n$1.prototype.getMetaArraysByKeys=function(e){return this.metaArrays.filter((function(t){return e.includes(t.key)}))},n$1.prototype.applyThreadInfoUpdateEvent=function(e){return this.messageId===e.targetMessageId&&(this.threadInfo=e.threadInfo),!1},n$1.prototype.applyReactionEvent=function(e){if(this.messageId===e.messageId){for(var t=!1,n=0;n<this.reactions.length;n++)if(this.reactions[n].key===e.key){this.reactions[n].applyEvent(e),this.reactions[n].isEmpty&&this.reactions.splice(n,1),t=!0;break}t||"add"!==e.operation||this.reactions.push(new Ue(Ue.payloadify({key:e.key,userIds:[e.userId],updatedAt:e.updatedAt})));}},n$1.prototype.applyParentMessage=function(e){if(!this.parentMessage)return this.parentMessage=e,!0;if(this.parentMessageId===e.messageId){var t=this.parentMessage.updatedAt;if(e.updatedAt>=t)return this.parentMessage=e,!0}return !1},n$1}(Fi),De=function(t$1){function n$1(e,n){var r,i,s,a,o=this;if((o=t$1.call(this,e,n)||this).reqId="",o.replyToChannel=!1,o.errorCode=0,o.sender=n.user?new Re(o._iid,n.user):n.sender_id,o.reqId=null!==(i=null!==(r=n.req_id)&&void 0!==r?r:n.request_id)&&void 0!==i?i:"",o.replyToChannel=null!==(s=n.is_reply_to_channel)&&void 0!==s&&s,n.request_state&&N$1(q,n.request_state)&&(o.sendingStatus=n.request_state),!o.sendingStatus)if(o.messageId>0)o.sendingStatus=q.SUCCEEDED;else if(o.scheduledInfo)switch(n.scheduled_status&&(o._scheduledStatus=n.scheduled_status),n.scheduled_status){case Ae.SENT:case Ae.IN_QUEUE:o.sendingStatus=q.SUCCEEDED;break;case Ae.PENDING:o.sendingStatus=q.SCHEDULED;break;case Ae.FAILED:case Ae.REMOVED:o.sendingStatus=q.FAILED;break;case Ae.CANCELED:o.sendingStatus=q.CANCELED;}else o.sendingStatus=q.PENDING;return o.errorCode=null!==(a=n.error_code)&&void 0!==a?a:0,o}return t(n$1,t$1),n$1.payloadify=function(e){return J($(n(n({},t$1.payloadify.call(this,e)),{user:Re.payloadify(e.sender),req_id:e.reqId,is_reply_to_channel:e.replyToChannel,request_state:e.sendingStatus,error_code:e.errorCode})))},Object.defineProperty(n$1.prototype,"isResendable",{get:function(){return this.sendingStatus===q.FAILED&&A(this.errorCode)},enumerable:!1,configurable:!0}),n$1.prototype.isIdentical=function(e){return this.messageId>0&&e.messageId>0?this.messageId===e.messageId:this.reqId===e.reqId},n$1}(Le),qe=function(){function e(e){var t,n;this.width=0,this.height=0,this.realWidth=0,this.realHeight=0,this.url=e.url,this.width=e.width,this.height=e.height,this.realWidth=null!==(t=e.real_width)&&void 0!==t?t:e.width,this.realHeight=null!==(n=e.real_height)&&void 0!==n?n:e.height;}return e.payloadify=function(e){return J($({url:"",width:e.maxWidth,height:e.maxHeight,real_width:0,real_height:0}))},Object.defineProperty(e.prototype,"plainUrl",{get:function(){return this.url.split("?auth=")[0]},enumerable:!1,configurable:!0}),e}(),Fe={prevResultSize:0,nextResultSize:0,isInclusive:!1,reverse:!1,messageTypeFilter:z.ALL,customTypesFilter:void 0,senderUserIdsFilter:void 0,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1},ze=function(e){return w("number",e.prevResultSize)&&w("number",e.nextResultSize)&&w("boolean",e.isInclusive)&&w("boolean",e.reverse)&&w("string",e.messageTypeFilter)&&N$1(z,e.messageTypeFilter)&&S$1("string",e.customTypesFilter,!0)&&S$1("string",e.senderUserIdsFilter,!0)&&w("boolean",e.includeMetaArray)&&w("boolean",e.includeReactions)&&w("boolean",e.includeParentMessageInfo)},Be=function(t$1){function n$1(e,n$1){var i,s,u,c,l=this;if((l=t$1.call(this,e,n$1)||this).translations={},l.message=null!==(i=n$1.message)&&void 0!==i?i:"",l.messageType=P.ADMIN,l.translations=null!==(s=n$1.translations)&&void 0!==s?s:{},n$1.parent_message_info){var d=n$1.parent_message_info;l.parentMessage=We(e,J($(n(n({},d),{message_id:l.parentMessageId,channel_url:l.channelUrl,channel_type:l.channelType,file:d.file,url:null===(u=d.file)||void 0===u?void 0:u.url,require_auth:null===(c=d.file)||void 0===c?void 0:c.require_auth}))));}return l}return t(n$1,t$1),n$1.payloadify=function(e){return J($(n(n({},t$1.payloadify.call(this,e)),{message:e.message,translations:e.translations,parent_message_info:e.parentMessage?t$1._getParentMessageInfoPayload.call(this,e.parentMessage):null})))},n$1.prototype.getThreadedMessagesByTimestamp=function(e,t){return i(this,void 0,void 0,(function(){var n$1;return o(this,(function(r){switch(r.label){case 0:return n$1=n(n({},Fe),t),Qi$1(this.messageId>0&&w("number",e)&&ze(n$1)).throw(v$1.invalidParameters),[4,Zi.of(this._iid).getThreadedMessagesByTimestamp(this,e,n$1)];case 1:return [2,r.sent()]}}))}))},n$1}(Le),Ke=function(){function e(e){var t,n;this.detail={},this.type=null!==(t=e.type)&&void 0!==t?t:"",this.vendor=null!==(n=e.vendor)&&void 0!==n?n:"",e.detail&&w("object",e.detail)&&!Array.isArray(e.detail)&&(this.detail=e.detail);}return e.payloadify=function(e){return J($({type:e.type,vendor:e.vendor,detail:e.detail}))},e}(),je=function(t$1){function n$1(e,n$1){var i,s$1,u,c,l,d,h,f=this;if((f=t$1.call(this,e,n$1)||this).message="",f.messageParams=null,f.translations={},f.translationTargetLanguages=[],f.messageSurvivalSeconds=-1,f.plugins=[],f._poll=null,f.message=n$1.message,f.messageType=P.USER,f.translations=null!==(u=n$1.translations)&&void 0!==u?u:{},f.translationTargetLanguages=null!==(c=n$1.target_langs)&&void 0!==c?c:[],0===Object.keys(f.translations).length&&f.translationTargetLanguages.length>0)try{for(var p=s(f.translationTargetLanguages),v=p.next();!v.done;v=p.next()){var y=v.value;f.translations[y]="";}}catch(e){i={error:e};}finally{try{v&&!v.done&&(s$1=p.return)&&s$1.call(p);}finally{if(i)throw i.error}}if(f.messageSurvivalSeconds=null!==(l=n$1.message_survival_seconds)&&void 0!==l?l:-1,f.plugins=n$1.plugins?n$1.plugins.map((function(e){return new Ke(e)})):[],f._poll=n$1.poll?new mo(f._iid,n$1.poll):null,n$1.parent_message_info){var g=n$1.parent_message_info;f.parentMessage=We(e,J($(n(n({},g),{created_at:g.ts,message_id:f.parentMessageId,channel_url:f.channelUrl,channel_type:f.channelType,file:g.file,url:null===(d=g.file)||void 0===d?void 0:d.url,require_auth:null===(h=g.file)||void 0===h?void 0:h.require_auth}))));}return f}return t(n$1,t$1),n$1.payloadify=function(e){return J($(n(n({},t$1.payloadify.call(this,e)),{message:e.message,translations:e.translations,message_survival_seconds:e.messageSurvivalSeconds,plugins:e.plugins.map((function(e){return Ke.payloadify(e)})),poll:e._poll?mo.payloadify(e._poll):null,parent_message_info:e.parentMessage?t$1._getParentMessageInfoPayload.call(this,e.parentMessage):null})))},n$1.prototype.getThreadedMessagesByTimestamp=function(e,t){return i(this,void 0,void 0,(function(){var n$1;return o(this,(function(r){switch(r.label){case 0:return n$1=n(n({},Fe),t),Qi$1(this.messageId>0&&w("number",e)&&ze(n$1)).throw(v$1.invalidParameters),[4,Zi.of(this._iid).getThreadedMessagesByTimestamp(this,e,n$1)];case 1:return [2,r.sent()]}}))}))},n$1.prototype.applyPoll=function(e){return !(this._poll&&this._poll.id===e.id&&this._poll.updatedAt>e.updatedAt)&&(this._poll=e,!0)},Object.defineProperty(n$1.prototype,"poll",{get:function(){return this._poll},enumerable:!1,configurable:!0}),n$1}(De),Qe=function(t$1){function n$1(e,n$1){var r,i,s,a,u,c=this;(c=t$1.call(this,e)||this).plainUrl="",c.fileName=null,c.mimeType=null,c.fileSize=0,c.thumbnails=[],c._requireAuth=!1,c.plainUrl=null!==(r=n$1.url)&&void 0!==r?r:"",c.fileName=null!==(i=n$1.file_name)&&void 0!==i?i:null,c.mimeType=null!==(s=n$1.file_type)&&void 0!==s?s:null,c.fileSize=null!==(a=n$1.file_size)&&void 0!==a?a:0,c._requireAuth=null!==(u=n$1.require_auth)&&void 0!==u&&u;var l=_o.of(c._iid).sessionManager;return c.thumbnails=n$1.thumbnails?n$1.thumbnails.map((function(e){return new qe(n(n({},e),{url:"".concat(e.url.split("?auth=")[0]).concat(c._requireAuth?"?auth=".concat(l.ekey):"")}))})):[],c}return t(n$1,t$1),n$1.payloadify=function(e){var t;return J($({url:e.plainUrl,file_name:e.fileName,file_type:e.mimeType,file_size:e.fileSize,thumbnails:null===(t=e.thumbnails)||void 0===t?void 0:t.map((function(e){return {url:e.url,width:e.width,height:e.height,real_width:e.realWidth,real_height:e.realHeight}})),require_auth:e._requireAuth}))},Object.defineProperty(n$1.prototype,"url",{get:function(){var e=_o.of(this._iid).sessionManager;return this._requireAuth?"".concat(this.plainUrl,"?auth=").concat(e.ekey):this.plainUrl},enumerable:!1,configurable:!0}),n$1}(Fi),Ge=function(t$1){function n$1(e,n$1){var i,s,u,c,l,d=this;if((d=t$1.call(this,e,n$1)||this).messageParams=null,d.fileInfoList=[],d.messageSurvivalSeconds=-1,d.messageType=P.FILE,d.fileInfoList=null!==(s=null===(i=n$1.files)||void 0===i?void 0:i.map((function(t){return new Qe(e,t)})))&&void 0!==s?s:[],d.messageSurvivalSeconds=null!==(u=n$1.message_survival_seconds)&&void 0!==u?u:-1,n$1.parent_message_info){var h=n$1.parent_message_info;d.parentMessage=We(e,J($(n(n({},h),{created_at:h.ts,message_id:d.parentMessageId,channel_url:d.channelUrl,channel_type:d.channelType,file:h.file,url:null===(c=h.file)||void 0===c?void 0:c.url,require_auth:null===(l=h.file)||void 0===l?void 0:l.require_auth}))));}return d}return t(n$1,t$1),n$1.prototype.getThreadedMessagesByTimestamp=function(e,t){return i(this,void 0,void 0,(function(){var n$1;return o(this,(function(r){switch(r.label){case 0:return n$1=n(n({},Fe),t),Qi$1(this.messageId>0&&w("number",e)&&ze(n$1)).throw(v$1.invalidParameters),[4,Zi.of(this._iid).getThreadedMessagesByTimestamp(this,e,n$1)];case 1:return [2,r.sent()]}}))}))},n$1.payloadify=function(e){return J($(n(n({},t$1.payloadify.call(this,e)),{files:e.fileInfoList&&e.fileInfoList&&Array.isArray(e.fileInfoList)?e.fileInfoList.map((function(e){return Qe.payloadify(e)})):null,message_survival_seconds:e.messageSurvivalSeconds,parent_message_info:e.parentMessage?t$1._getParentMessageInfoPayload.call(this,e.parentMessage):null})))},n$1._isMultipleFilesMessagePayload=function(e){var t=e.files;return Array.isArray(t)&&t.length>=2},n$1._isMultipleFilesMessageSerializedData=function(e){var t=e.fileInfoList;return Array.isArray(t)},n$1}(De),We=function(e,t){switch(t.type){case"MESG":return new je(e,t);case"FILE":return Ge._isMultipleFilesMessagePayload(t)?new Ge(e,t):new He(e,t);case"ADMM":case"BRDM":return new Be(e,t)}throw v$1.unknown},He=function(t$1){function n$1(e,n$1){var i,s,u,c,l,d,h,f,p,m,v,y,g,b,I=this;(I=t$1.call(this,e,n$1)||this).messageParams=null,I.plainUrl="",I.requireAuth=!1,I.thumbnails=[],I.messageSurvivalSeconds=-1,I.messageType=P.FILE;var E=n$1.file;I.plainUrl=(null!==(s=null!==(i=null==E?void 0:E.url)&&void 0!==i?i:n$1.url)&&void 0!==s?s:"").split("?auth=")[0],I.name=null!==(c=null!==(u=null==E?void 0:E.name)&&void 0!==u?u:n$1.name)&&void 0!==c?c:"File",I.size=null!==(d=null!==(l=null==E?void 0:E.size)&&void 0!==l?l:n$1.size)&&void 0!==d?d:0,I.data=null!==(f=null!==(h=null==E?void 0:E.data)&&void 0!==h?h:n$1.custom)&&void 0!==f?f:"",I.type=E?null!==(p=E.type)&&void 0!==p?p:"":null!==(m=n$1.type)&&void 0!==m?m:"";var T=_o.of(I._iid).sessionManager;if(I.requireAuth=null!==(v=n$1.require_auth)&&void 0!==v&&v,I.thumbnails=n$1.thumbnails?n$1.thumbnails.map((function(e){return new qe(n(n({},e),{url:"".concat(e.url.split("?auth=")[0]).concat(I.requireAuth?"?auth=".concat(T.ekey):"")}))})):[],I.messageSurvivalSeconds=null!==(y=n$1.message_survival_seconds)&&void 0!==y?y:-1,n$1.parent_message_info){var w=n$1.parent_message_info;I.parentMessage=We(e,J($(n(n({},w),{created_at:w.ts,message_id:I.parentMessageId,channel_url:I.channelUrl,channel_type:I.channelType,file:w.file,url:null===(g=w.file)||void 0===g?void 0:g.url,require_auth:null===(b=w.file)||void 0===b?void 0:b.require_auth}))));}return I}return t(n$1,t$1),n$1.payloadify=function(e){var n$1;return J($(n(n({},t$1.payloadify.call(this,e)),{url:e.plainUrl,require_auth:e.requireAuth,file:{name:e.name,size:e.size,type:e.type,data:e.data},thumbnails:null===(n$1=e.thumbnails)||void 0===n$1?void 0:n$1.map((function(e){return {url:e.url,width:e.width,height:e.height,real_width:e.realWidth,real_height:e.realHeight}})),message_survival_seconds:e.messageSurvivalSeconds,parent_message_info:e.parentMessage?t$1._getParentMessageInfoPayload.call(this,e.parentMessage):null})))},Object.defineProperty(n$1.prototype,"url",{get:function(){var e=_o.of(this._iid).sessionManager;return this.requireAuth?"".concat(this.plainUrl,"?auth=").concat(e.ekey):this.plainUrl},enumerable:!1,configurable:!0}),n$1.prototype.getThreadedMessagesByTimestamp=function(e,t){return i(this,void 0,void 0,(function(){var n$1;return o(this,(function(r){switch(r.label){case 0:return n$1=n(n({},Fe),t),Qi$1(this.messageId>0&&w("number",e)&&ze(n$1)).throw(v$1.invalidParameters),[4,Zi.of(this._iid).getThreadedMessagesByTimestamp(this,e,n$1)];case 1:return [2,r.sent()]}}))}))},n$1}(De),Ye=function(t$1){function n(e){var n,i,s,o=[];return e.mentionType===H.USERS&&(e.mentionedUserIds?o=e.mentionedUserIds:e.mentionedUsers&&(o=e.mentionedUsers.map((function(e){return e.userId})))),t$1.call(this,{code:"FILE",ackRequired:!0,payload:J($({channel_url:e.channelUrl,files:e.files?$e(e.files):null,url:e.url,name:null!==(n=e.fileName)&&void 0!==n?n:"",type:null!==(i=e.mimeType)&&void 0!==i?i:"",size:null!==(s=e.fileSize)&&void 0!==s?s:0,custom:e.data,custom_type:e.customType,thumbnails:e.thumbnailSizes,require_auth:e.requireAuth,metaarray:e.metaArrays,mention_type:e.mentionType,mentioned_user_ids:o,push_option:e.pushNotificationDeliveryOption&&e.pushNotificationDeliveryOption!==G.DEFAULT?e.pushNotificationDeliveryOption:void 0,apple_critical_alert_options:e.appleCriticalAlertOptions?ke.payloadify(e.appleCriticalAlertOptions):null,silent:e.silent,reply_to_channel:e.isReplyToChannel,parent_message_id:e.parentMessageId?e.parentMessageId:null,req_id:e.reqId,pin_message:e.isPinnedMessage}))})||this}return t(n,t$1),n}(ri$1),Je=function(n){function i(e){var i,s,o=this;o=n.call(this)||this;var u=[];return e.mentionType===H.USERS&&(e.mentionedUserIds?u=e.mentionedUserIds:e.mentionedUsers&&(u=e.mentionedUsers.map((function(e){return e.userId})))),o.method=ee.POST,o.path="".concat(ge(e.channelType),"/").concat(encodeURIComponent(e.channelUrl),"/messages"),o.params=J($({message_type:P.FILE,user_id:e.userId,files:e.files?$e(e.files):null,url:e.fileUrl,mention_type:e.mentionType,mentioned_user_ids:u,file_name:e.fileName,file_size:e.fileSize,file_type:e.mimeType,data:e.data,custom_type:e.customType,thumbnails:null===(i=e.thumbnailSizes)||void 0===i?void 0:i.map((function(e){return qe.payloadify(e)})),require_auth:e.requireAuth,sorted_metaarray:null===(s=e.metaArrays)||void 0===s?void 0:s.map((function(e){return Oe.payloadify(e)})),push_option:e.pushNotificationDeliveryOption,parent_message_id:e.parentMessageId?e.parentMessageId:null,apple_critical_alert_options:e.appleCriticalAlertOptions?ke.payloadify(e.appleCriticalAlertOptions):null,reply_to_channel:e.isReplyToChannel,req_id:e.reqId,pin_message:e.isPinnedMessage})),o}return t(i,n),i}(Ne$1),Xe=function(t$1){function n(e,n,r){var i,s,a,o,u=this;(u=t$1.call(this,e,"FILE",r)||this).message=r.files&&r.files.length>=2?new Ge(e,r):new He(e,r);var c=_o.of(e).sdkState;return u.isMentioned=be(u.message.mentionType,null!==(a=null!==(i=u.message.mentionedUserIds)&&void 0!==i?i:null===(s=u.message.mentionedUsers)||void 0===s?void 0:s.map((function(e){return e.userId})))&&void 0!==a?a:[],c.userId),u.forceUpdateLastMessage=null!==(o=r.force_update_last_message)&&void 0!==o&&o,u}return t(n,t$1),n}(Pe$1),Ze=function(t$1){function n(e,n){var r,i,s,a,o=this;(o=t$1.call(this,e,n)||this).message=n.files&&n.files.length>=2?new Ge(e,n):new He(e,n);var u=_o.of(e).sdkState;return o.isMentioned=be(o.message.mentionType,null!==(s=null!==(r=o.message.mentionedUserIds)&&void 0!==r?r:null===(i=o.message.mentionedUsers)||void 0===i?void 0:i.map((function(e){return e.userId})))&&void 0!==s?s:[],u.userId),o.forceUpdateLastMessage=null!==(a=n.force_update_last_message)&&void 0!==a&&a,o}return t(n,t$1),n}(Te$1);function $e(e){return e.map((function(e){var t,n;return J($({url:e.fileUrl,file_name:e.fileName,file_type:e.mimeType,file_size:e.fileSize,thumbnails:null===(t=e.thumbnailSizes)||void 0===t?void 0:t.map((function(e){return qe.payloadify(e)})),require_auth:null===(n=e._uploadedMetaData)||void 0===n?void 0:n.requireAuth}))}))}var et;!function(e){e[e.PENDING=0]="PENDING",e[e.UPLOADING=1]="UPLOADING",e[e.UPLOADED=2]="UPLOADED",e[e.SENDING=3]="SENDING",e[e.FAILED=4]="FAILED";}(et||(et={}));var tt=function(){function e(e,t){var n=t.sdkState,r=t.dispatcher,i=t.requestQueue,s=t.onlineDetector,a=t.cacheContext,o=this;this._queueMap=new Map,this._iid=e,this._sdkState=n,this._requestQueue=i,this._cacheContext=a,this._dispatcher=r,this._dispatcher.on((function(e){e instanceof ai$1&&(o._connectionState=e.stateType);})),this._onlineDetector=s;}return Object.defineProperty(e.prototype,"_shouldSendThroughWebSocket",{get:function(){return this._connectionState===ti$1.CONNECTED||this._connectionState===ti$1.CONNECTING||this._connectionState===ti$1.RECONNECTING},enumerable:!1,configurable:!0}),e.prototype._sendFileMessage=function(e,t){return i(this,void 0,void 0,(function(){var n$1,r,i;return o(this,(function(s){switch(s.label){case 0:return n$1=this._createSendFileMessageRequestParams(e,t),this._shouldSendThroughWebSocket?(r=new Ye(n$1),[4,this._requestQueue.send(r)]):[3,2];case 1:return i=s.sent(),[2,i.as(Xe).message];case 2:return r=new Je(n(n({},n$1),{userId:this._sdkState.userId})),[4,this._requestQueue.send(r)];case 3:return i=s.sent(),[2,i.as(Ze).message]}}))}))},e.prototype._createSendFileMessageRequestParams=function(e,t){var n$1=n(n({},t.params),{channelUrl:e.url,channelType:e.channelType,reqId:t.requestId,url:""});if(t.multipleFileUploadInfo){var r=t.params;n$1.files=r.fileInfoList;}else {r=t.params;n$1.url=r.fileUrl,n$1.requireAuth=r.requireAuth;}return n$1},e.prototype._resolveMessageQueue=function(e){var t;return i(this,void 0,void 0,(function(){var n,r,i,s$1,a,o$1,u$1,c,l,d,h,f,p;return o(this,(function(v){switch(v.label){case 0:if(!(n=this._queueMap.get(e.url)))return [3,21];if(n.isResolving)return [3,20];n.isResolving=!0,r=[],i=!0,v.label=1;case 1:v.trys.push([1,15,16,17]),s$1=s(n.messageQueue),a=s$1.next(),v.label=2;case 2:if(a.done)return [3,14];switch(o$1=a.value,o$1.state){case et.PENDING:case et.UPLOADING:return [3,3];case et.UPLOADED:return [3,4];case et.FAILED:return [3,12]}return [3,13];case 3:return i=!1,r.push(o$1),[3,13];case 4:if(!i)return [3,10];v.label=5;case 5:return v.trys.push([5,8,,9]),o$1.state=et.SENDING,[4,this._sendFileMessage(e,o$1)];case 6:return u$1=v.sent(),o$1.deferred.resolve(u$1),[4,Ei$1(100)];case 7:return v.sent(),[3,9];case 8:return c=v.sent(),o$1.deferred.reject(c),[3,9];case 9:return [3,11];case 10:r.push(o$1),v.label=11;case 11:return [3,13];case 12:return l=null!==(t=o$1.error)&&void 0!==t?t:v$1.unknown,o$1.deferred.reject(l.code===u.REQUEST_CANCELED?v$1.fileUploadCanceled:l),[3,13];case 13:return a=s$1.next(),[3,2];case 14:return [3,17];case 15:return d=v.sent(),f={error:d},[3,17];case 16:try{a&&!a.done&&(p=s$1.return)&&p.call(s$1);}finally{if(f)throw f.error}return [7];case 17:return h=n.isResolveRequestPending,n.messageQueue=r,n.isResolving=!1,n.isResolveRequestPending=!1,h?[4,this._resolveMessageQueue(e)]:[3,19];case 18:v.sent(),v.label=19;case 19:return [3,21];case 20:n.isResolveRequestPending=!0,v.label=21;case 21:return [2]}}))}))},e.prototype._uploadNextPendingItem=function(e){var t;return i(this,void 0,void 0,(function(){var n,r,i,s,a,o$1,u,c,l;return o(this,(function(d){switch(d.label){case 0:return (n=this._queueMap.get(e.url))&&(r=n.messageQueue.find((function(e){return e.state===et.PENDING})))?r.multipleFileUploadInfo?(i=r.multipleFileUploadInfo,s=i.uploadIndex,a=i.uploadCount,o$1=i.requestHandler,l=r.params,u=l.fileInfoList[s],!k(u.file)||(null===(t=u._uploadedMetaData)||void 0===t?void 0:t.isUploaded)?[3,2]:[4,this._tryUploadNextItemAndUpdateItemState(e,n,r)]):[3,4]:[3,9];case 1:return d.sent(),[3,3];case 2:r.state=s<a-1?et.PENDING:et.UPLOADED,d.label=3;case 3:return c=s,null==o$1||o$1._triggerOnFileUploaded(r.requestId,c,u,r.error),r.multipleFileUploadInfo.uploadIndex++,[3,7];case 4:return l=r.params,k(l.file)?[4,this._tryUploadNextItemAndUpdateItemState(e,n,r)]:[3,6];case 5:return d.sent(),[3,7];case 6:l.thumbnailSizes=[],r.state=et.UPLOADED,d.label=7;case 7:return this._uploadNextPendingItem(e),[4,this._resolveMessageQueue(e)];case 8:d.sent(),d.label=9;case 9:return [2]}}))}))},e.prototype._tryUploadNextItemAndUpdateItemState=function(e,t,n){return i(this,void 0,void 0,(function(){var r,i,s,a,o$1,u$1;return o(this,(function(c){switch(c.label){case 0:return [4,this._onlineDetector.isOnline()];case 1:if(r=c.sent(),!_o.of(this._iid).sessionManager.currentUser||!r)return n.error=v$1.connectionRequired,n.state=et.FAILED,[2];if(!(t.uploadQueue.length<6))return [3,9];n.state=et.UPLOADING,t.uploadQueue.push(n),c.label=2;case 2:return c.trys.push([2,7,,8]),n.multipleFileUploadInfo?(i=n.multipleFileUploadInfo,s=i.uploadIndex,a=i.uploadCount,o$1=n.params,[4,this._uploadNextFileForMultipleFilesItemAndUpdateParams(e,n,o$1)]):[3,4];case 3:return c.sent(),n.state=s<a-1?et.PENDING:et.UPLOADED,[3,6];case 4:return o$1=n.params,[4,this._uploadNextFileForSingleFileItemAndUpdateParams(e,n,o$1)];case 5:c.sent(),n.state=et.UPLOADED,c.label=6;case 6:return [3,8];case 7:return u$1=c.sent(),n.error=u$1.code===u.REQUEST_FAILED?new v$1({code:u.NETWORK_ERROR,message:"Failed to upload a file."}):u$1,n.state=et.FAILED,[3,8];case 8:this._dequeueUploadItem(t,n),c.label=9;case 9:return [2]}}))}))},e.prototype._dequeueUploadItem=function(e,t){var n=e.uploadQueue.findIndex((function(e){return e.requestId===t.requestId}));n>=0&&e.uploadQueue.splice(n,1);},e.prototype._uploadNextFileForSingleFileItemAndUpdateParams=function(e,t,n){var r,i$1,s;return i(this,void 0,void 0,(function(){var a,o$1,u,c,l,d,h,f,p,m;return o(this,(function(v){switch(v.label){case 0:return a=new Te({file:n.file,channelUrl:e.url,thumbnailSizes:n.thumbnailSizes,requestId:t.requestId}),[4,this._requestQueue.send(a)];case 1:return o$1=v.sent(),u=o$1.as(we),c=u.url,l=u.fileSize,d=void 0===l?n.fileSize:l,h=u.thumbnailSizes,f=void 0===h?n.thumbnailSizes:h,p=u.requireAuth,m=void 0!==p&&p,n.fileName=null!==(r=n.fileName)&&void 0!==r?r:n.file.name,n.mimeType=null!==(i$1=n.mimeType)&&void 0!==i$1?i$1:n.file.type,n.fileSize=null!==(s=n.fileSize)&&void 0!==s?s:n.file.size,n.fileUrl=c,n.fileSize=d,n.thumbnailSizes=f,n.requireAuth=m,[2]}}))}))},e.prototype._uploadNextFileForMultipleFilesItemAndUpdateParams=function(e,t,n$1){var r,i$1,s;return i(this,void 0,void 0,(function(){var a,u,c,l,d,h,f,p,m,v,y,_;return o(this,(function(g){switch(g.label){case 0:return a=t.multipleFileUploadInfo.uploadIndex,u=n$1.fileInfoList[a],c=new Te({file:u.file,channelUrl:e.url,thumbnailSizes:u.thumbnailSizes,requestId:t.requestId}),[4,this._requestQueue.send(c)];case 1:return l=g.sent(),d=l.as(we),h=d.url,f=d.fileSize,p=void 0===f?u.fileSize:f,m=d.thumbnailSizes,v=void 0===m?u.thumbnailSizes:m,y=d.requireAuth,_=void 0!==y&&y,u.fileName=null!==(r=u.fileName)&&void 0!==r?r:u.file.name,u.mimeType=null!==(i$1=u.mimeType)&&void 0!==i$1?i$1:u.file.type,u.fileSize=null!==(s=u.fileSize)&&void 0!==s?s:u.file.size,u.file=void 0,u.fileUrl=h,u.fileSize=p,u.thumbnailSizes=v,u._uploadedMetaData=n(n({},u._uploadedMetaData),{requireAuth:_,isUploaded:!0}),[2]}}))}))},e.prototype.request=function(e,t,n,r){return i(this,void 0,void 0,(function(){var i,s,a,o$1,u;return o(this,(function(c){return this._queueMap.has(e.url)||(i={messageQueue:[],uploadQueue:[],isResolving:!1,isResolveRequestPending:!1},this._queueMap.set(e.url,i)),s=this._queueMap.get(e.url),a=new oi$1,o$1={requestId:t,params:n,state:et.PENDING,deferred:a},function(e){return "fileInfoList"in e}(n)&&(u={uploadIndex:0,uploadCount:n.fileInfoList.length,requestHandler:r},o$1.multipleFileUploadInfo=u),s.messageQueue.push(o$1),this._uploadNextPendingItem(e),[2,a.promise]}))}))},e.prototype.cancel=function(e,t){var n,r,i=this._queueMap.get(e.url);if(i){var s$1=t?[i.messageQueue.find((function(e){return e.requestId===t}))]:c([],a(i.messageQueue),!1);try{for(var a$1=s(s$1),o=a$1.next();!o.done;o=a$1.next()){var u=o.value;if(u)switch(u.state){case et.PENDING:u.state=et.FAILED,u.error=v$1.requestCanceled,this._resolveMessageQueue(e);break;case et.UPLOADING:this._requestQueue.cancel(u.requestId);}}}catch(e){n={error:e};}finally{try{o&&!o.done&&(r=a$1.return)&&r.call(a$1);}finally{if(n)throw n.error}}}},e}();var nt,rt={prevResultSize:0,nextResultSize:0,isInclusive:!1,reverse:!1,messageTypeFilter:z.ALL,customTypesFilter:void 0,senderUserIdsFilter:void 0,replyType:V.NONE,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1,includeThreadInfo:!1,showSubchannelMessagesOnly:!1},it$1=function(e){return w("number",e.prevResultSize)&&w("number",e.nextResultSize)&&w("boolean",e.isInclusive)&&w("boolean",e.reverse)&&w("string",e.messageTypeFilter)&&N$1(z,e.messageTypeFilter)&&S$1("string",e.customTypesFilter,!0)&&S$1("string",e.senderUserIdsFilter,!0)&&N$1(V,e.replyType)&&w("boolean",e.includeMetaArray)&&w("boolean",e.includeReactions)&&w("boolean",e.includeParentMessageInfo)&&w("boolean",e.includeThreadInfo)&&w("boolean",e.showSubchannelMessagesOnly)},st$1={replyType:V.NONE,includeReactions:!1,includeThreadInfo:!1,includeMetaArray:!1,includeParentMessageInfo:!1},at$1=function(e){return N$1(V,e.replyType)&&w("boolean",e.includeReactions)&&w("boolean",e.includeMetaArray)&&w("boolean",e.includeParentMessageInfo)&&w("boolean",e.includeThreadInfo)},ot$1=function(n){function r(e){var r=e.channelType,i=e.channelUrl,s=e.messageId,a=e.includeMetaArray,o=e.includeReactions,u=e.includeThreadInfo,c=e.includeParentMessageInfo,l=n.call(this)||this;return l.method=ee.GET,l.path="".concat(ge(r),"/").concat(encodeURIComponent(i),"/messages/").concat(encodeURIComponent(s)),l.params={is_sdk:!0,with_sorted_meta_array:a,include_reactions:o,include_thread_info:u,include_parent_message_info:c,include_poll_details:!0},l}return t(r,n),r}(Ne$1),ut$1=function(t$1){function n$1(e,n$1){var r=t$1.call(this,e,n$1)||this;return r.message=n$1?We(e,n({},n$1)):null,r}return t(n$1,t$1),n$1}(Te$1),ct$1=function(n){function i(e){var i=e.channelType,s=e.channelUrl,o=e.timestamp,u=e.token,c=e.prevResultSize,l=e.nextResultSize,d=e.isInclusive,h=e.reverse,f=e.messageTypeFilter,p=e.customTypesFilter,m=e.senderUserIdsFilter,v=e.replyType,y=e.includeMetaArray,_=e.includeReactions,g=e.parentMessageId,b=e.includeThreadInfo,I=e.includeParentMessageInfo,E=e.showSubchannelMessagesOnly,T=e.checkingContinuousMessages,w=n.call(this)||this;return w.method=ee.GET,w.path="".concat(ge(i),"/").concat(encodeURIComponent(s),"/messages"),w.params=J($({is_sdk:!0,prev_limit:c,next_limit:l,include:d,reverse:h,message_ts:o,message_id:u,message_type:null!=f?f:null,custom_types:p,sender_ids:m,include_reply_type:v,with_sorted_meta_array:y,include_reactions:_,parent_message_id:g,include_thread_info:b,include_parent_message_info:I,show_subchannel_message_only:E,include_poll_details:!0,checking_continuous_messages:T})),w}return t(i,n),i}(Ne$1),lt$1=function(t$1){function n(e,n){var r=t$1.call(this,e,n)||this;return r.messages=n.messages.map((function(t){return We(e,t)})),r}return t(n,t$1),n}(Te$1),dt$1=function(n){function r(e){var r=e.channelType,i=e.channelUrl,s=e.timestamp,a=e.token,o=e.replyType,u=e.includeMetaArray,c=e.includeReactions,l=e.includeThreadInfo,d=e.includeParentMessageInfo,h=n.call(this)||this;return h.method=ee.GET,h.path="".concat(ge(r),"/").concat(encodeURIComponent(i),"/messages/changelogs"),h.params={change_ts:s,token:a,with_sorted_meta_array:u,include_reactions:c,include_thread_info:l,include_reply_type:o,include_parent_message_info:d,include_poll_details:!0},h}return t(r,n),r}(Ne$1),ht$1=function(t$1){function n(e,n){var r=t$1.call(this,e,n)||this;return r.updatedMessages=n.updated.map((function(t){return We(e,t)})),r.deletedMessagesInfo=n.deleted.map((function(e){return {messageId:e.message_id,deletedAt:e.deleted_at}})),r.hasMore=n.has_more,r.nextToken=n.next,r}return t(n,t$1),n}(Te$1),ft$1=function(n){function r(e){var r=e.channelUrl,i=e.scheduledMessageId,s=n.call(this)||this;return s.method=ee.GET,s.path="".concat(ie,"/").concat(encodeURIComponent(r),"/scheduled_messages/").concat(encodeURIComponent(i)),s.params={},s}return t(r,n),r}(Ne$1),pt$1=function(t$1){function n$1(e,n$1){var r=t$1.call(this,e,n$1)||this;return r.message=n$1?We(e,n({},n$1)):null,r}return t(n$1,t$1),n$1}(Te$1);!function(e){e.MUTED="muted",e.BANNED="banned";}(nt||(nt={}));var mt$1,vt$1=function(){function e(e){var t,n,r,i;this.restrictionType=null,N$1(nt,e.restriction_type)&&(this.restrictionType=e.restriction_type),this.description=null!==(t=e.description)&&void 0!==t?t:null,this.endAt=null!==(r=null!==(n=e.end_at)&&void 0!==n?n:e.muted_end_at)&&void 0!==r?r:-1,this.remainingDuration=null!==(i=e.remaining_duration)&&void 0!==i?i:-1;}return e.payloadify=function(e){return J($({restriction_type:e.restrictionType,description:e.description,end_at:e.endAt,remaining_duration:e.remainingDuration}))},e}(),yt$1=function(t$1){function n$1(e,n){var r=t$1.call(this,e,n)||this;return r.restrictionInfo=new vt$1(n),r}return t(n$1,t$1),n$1.payloadify=function(e){return J($(n(n({},t$1.payloadify.call(this,e)),vt$1.payloadify(e.restrictionInfo))))},n$1}(Xi$1);(function(t$1){function n(e,n){var r,i=this;return (i=t$1.call(this,e,n)||this).isMuted=!1,i.isMuted=null!==(r=n.is_muted)&&void 0!==r&&r,i}return t(n,t$1),n})(Xi$1);var gt$1=function(){function e(){this._onPending=ze$1,this._onFailed=ze$1,this._onSucceeded=ze$1;}return e.prototype._trigger=function(e){switch(null==e?void 0:e.sendingStatus){case q.PENDING:0===e.errorCode&&this._onPending(e);break;case q.SCHEDULED:case q.SUCCEEDED:this._onSucceeded(e);}},e.prototype._triggerFailed=function(e,t){switch(null==t?void 0:t.sendingStatus){case q.FAILED:case q.CANCELED:this._onFailed(e,t.scheduledInfo?null:t);}},e.prototype.onPending=function(e){return this._onPending=e,this},e.prototype.onFailed=function(e){return this._onFailed=e,this},e.prototype.onSucceeded=function(e){return this._onSucceeded=e,this},e}(),bt$1={data:void 0,customType:void 0,mentionType:H.USERS,mentionedUserIds:void 0,mentionedUsers:void 0,mentionedMessageTemplate:void 0,metaArrays:void 0,parentMessageId:void 0,isReplyToChannel:!1,pushNotificationDeliveryOption:void 0,appleCriticalAlertOptions:void 0,isPinnedMessage:!1},It$1=function(e){return w("string",e.data,!0)&&w("string",e.customType,!0)&&N$1(H,e.mentionType)&&S$1("string",e.mentionedUserIds,!0)&&S$1(Xi$1,e.mentionedUsers,!0)&&w("string",e.mentionedMessageTemplate,!0)&&S$1(Oe,e.metaArrays,!0)&&w("number",e.parentMessageId,!0)&&w("boolean",e.isReplyToChannel)&&N$1(G,e.pushNotificationDeliveryOption,!0)&&w(ke,e.appleCriticalAlertOptions,!0)&&w("boolean",e.isPinnedMessage,!0)},Et$1=function(e){return {isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption,pollId:e.pollId}},Tt$1=n(n({},bt$1),{message:"",translationTargetLanguages:void 0,pollId:void 0}),wt$1=function(e){return It$1(e)&&w("string",e.message)&&S$1("string",e.translationTargetLanguages,!0)&&w("number",e.pollId,!0)};!function(e){e.FILE="file",e.BLOB="blob",e.BLOB_LIKE_OBJECT="blobLikeObject",e.URL="url";}(mt$1||(mt$1={}));var Mt$1,St$1=function(e){return "undefined"!=typeof window&&"Blob"in window&&"undefined"!=typeof Blob&&e instanceof Blob},At$1=function(e){return e===mt$1.BLOB||e===mt$1.FILE},Nt$1=function(e){return {file:e.file,fileKey:e.fileKey,fileType:e.fileType,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption}},Ut$1=n(n({},bt$1),{file:void 0,fileKey:void 0,fileUrl:void 0,fileName:void 0,fileType:void 0,fileSize:void 0,mimeType:void 0,thumbnailSizes:void 0,requireAuth:!1}),Ot$1=function(e){return It$1(e)&&(k(e.file)||w("string",e.fileUrl))&&w("string",e.fileName,!0)&&w("string",e.mimeType,!0)&&w("number",e.fileSize,!0)&&(null===e.thumbnailSizes||void 0===e.thumbnailSizes||Array.isArray(e.thumbnailSizes)&&e.thumbnailSizes.every((function(e){return w("object",e)&&e.maxWidth>0&&e.maxHeight>0})))},Ct$1={data:void 0,customType:void 0,mentionType:H.USERS,mentionedUserIds:void 0,mentionedUsers:void 0,mentionedMessageTemplate:void 0,metaArrays:void 0,pushNotificationDeliveryOption:void 0,appleCriticalAlertOptions:void 0},Pt$1=function(e){return w("string",e.data,!0)&&w("string",e.customType,!0)&&N$1(H,e.mentionType)&&S$1("string",e.mentionedUserIds,!0)&&S$1(Xi$1,e.mentionedUsers,!0)&&w("string",e.mentionedMessageTemplate,!0)&&S$1(Oe,e.metaArrays,!0)&&N$1(G,e.pushNotificationDeliveryOption,!0)&&w(ke,e.appleCriticalAlertOptions,!0)},kt$1=n(n({},Ct$1),{message:void 0,translationTargetLanguages:void 0,pollId:void 0}),Rt$1=function(e){return Pt$1(e)&&w("string",e.message,!0)&&S$1("string",e.translationTargetLanguages,!0)&&w("number",e.pollId,!0)},xt$1=n({},Ct$1),Lt$1=function(n){function r(e){var r=e.channelUrl,i=e.channelType,s=e.token,a=e.limit,o=n.call(this)||this;return o.method=ee.GET,o.path="".concat(ge(i),"/").concat(encodeURIComponent(r),"/operators"),o.params={token:s,limit:a},o}return t(r,n),r}(Ne$1),Dt$1=function(t$1){function n(e,n){var r=t$1.call(this,e,n)||this;return r.operators=n.operators.map((function(t){return new Xi$1(e,t)})),r.token=n.next,r}return t(n,t$1),n}(Te$1),qt$1=function(t$1){function n$1(e,n,r,i){return t$1.call(this,e,n,r,i)||this}return t(n$1,t$1),n$1.prototype._validate=function(){return t$1.prototype._validate.call(this)},n$1.prototype.next=function(){return i(this,void 0,void 0,(function(){var e,t,n$1,r,i,s,a;return o(this,(function(u){switch(u.label){case 0:return this._validate()?this._isLoading?[3,3]:(e=[],this._hasNext?(this._isLoading=!0,t=_o.of(this._iid).requestQueue,n$1=new Lt$1(n(n({},this),{channelUrl:this.channelUrl,token:this._token})),[4,t.send(n$1)]):[3,2]):[3,5];case 1:return r=u.sent(),i=r.as(Dt$1),s=i.operators,a=i.token,this._token=a,this._hasNext=!!a,this._isLoading=!1,[2,s];case 2:return [2,e];case 3:throw v$1.queryInProgress;case 4:return [3,6];case 5:throw v$1.invalidParameters;case 6:return [2]}}))}))},n$1}(Io),Ft$1=function(t$1){function n(e,n,r,i){var s,a,o,u,c,l,d,h,f,p,m=this;return (m=t$1.call(this,e,n,r,i)||this).reverse=!1,m.messageTypeFilter=z.ALL,m.customTypesFilter=null,m.senderUserIdsFilter=null,m.replyType=V.NONE,m.includeMetaArray=!1,m.includeReactions=!1,m.includeParentMessageInfo=!1,m.includeThreadInfo=!1,m.showSubchannelMessagesOnly=!1,m._edge=Number.MAX_SAFE_INTEGER,m.reverse=null!==(s=i.reverse)&&void 0!==s&&s,m.messageTypeFilter=null!==(a=i.messageTypeFilter)&&void 0!==a?a:z.ALL,m.customTypesFilter=null!==(o=i.customTypesFilter)&&void 0!==o?o:null,m.senderUserIdsFilter=null!==(u=i.senderUserIdsFilter)&&void 0!==u?u:null,m.replyType=null!==(c=i.replyType)&&void 0!==c?c:V.NONE,m.includeMetaArray=null!==(l=i.includeMetaArray)&&void 0!==l&&l,m.includeReactions=null!==(d=i.includeReactions)&&void 0!==d&&d,m.includeParentMessageInfo=null!==(h=i.includeParentMessageInfo)&&void 0!==h&&h,m.includeThreadInfo=null!==(f=i.includeThreadInfo)&&void 0!==f&&f,m.showSubchannelMessagesOnly=null!==(p=i.showSubchannelMessagesOnly)&&void 0!==p&&p,m}return t(n,t$1),n.prototype._validate=function(){return t$1.prototype._validate.call(this)&&w("boolean",this.reverse)&&N$1(z,this.messageTypeFilter)&&N$1(V,this.replyType)&&S$1("string",this.customTypesFilter,!0)&&S$1("string",this.senderUserIdsFilter,!0)&&w("boolean",this.includeMetaArray)&&w("boolean",this.includeReactions)&&w("boolean",this.includeParentMessageInfo)&&w("boolean",this.includeThreadInfo)&&w("boolean",this.showSubchannelMessagesOnly)},n.prototype.load=function(){return i(this,void 0,void 0,(function(){var e;return o(this,(function(t){switch(t.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,[4,Zi.of(this._iid).getMessagesByTimestamp(this.channelUrl,this.channelType,this._edge,$({prevResultSize:this.limit,nextResultSize:0,isInclusive:!1,reverse:this.reverse,messageTypeFilter:this.messageTypeFilter,customTypesFilter:this.customTypesFilter,replyType:this.replyType,senderUserIdsFilter:this.senderUserIdsFilter,includeReactions:this.includeReactions,includeMetaArray:this.includeMetaArray,includeParentMessageInfo:this.includeParentMessageInfo,includeThreadInfo:this.includeThreadInfo,showSubchannelMessagesOnly:this.showSubchannelMessagesOnly}))]):[3,2]:[3,5];case 1:return e=t.sent(),this._edge=Math.min.apply(Math,c([Number.MAX_SAFE_INTEGER],a(e.map((function(e){return e.createdAt}))),!1)),this._hasNext=e.length>=this.limit,this._isLoading=!1,[2,e];case 2:return [2,[]];case 3:throw v$1.queryInProgress;case 4:return [3,6];case 5:throw v$1.invalidParameters;case 6:return [2]}}))}))},n}(Io),zt$1=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.limit,o=e.token;return (r=n.call(this)||this).method=ee.GET,r.path="".concat(ge(s),"/").concat(encodeURIComponent(i),"/mute"),r.params={limit:a,token:o},r}return t(r,n),r}(Ne$1),Bt$1=function(t$1){function n(e,n){var r=t$1.call(this,e,n)||this;r.mutedUsers=[];var i=n.next,s=n.muted_list;return r.token=i,s&&s.length>0&&(r.mutedUsers=s.map((function(t){return new yt$1(e,t)}))),r}return t(n,t$1),n}(Te$1),Kt$1=function(t$1){function n$1(e,n,r,i){return t$1.call(this,e,n,r,i)||this}return t(n$1,t$1),n$1.prototype.next=function(){return i(this,void 0,void 0,(function(){var e,t,n$1,r,i,s;return o(this,(function(a){switch(a.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=_o.of(this._iid).requestQueue,t=new zt$1(n(n({},this),{token:this._token})),[4,e.send(t)]):[3,2]:[3,5];case 1:return n$1=a.sent(),r=n$1.as(Bt$1),i=r.mutedUsers,s=r.token,this._token=s,this._hasNext=!!s,this._isLoading=!1,[2,i];case 2:return [2,[]];case 3:throw v$1.queryInProgress;case 4:return [3,6];case 5:throw v$1.invalidParameters;case 6:return [2]}}))}))},n$1}(Io),jt$1=function(n){function i(e){var i=this,s=e.channelUrl,a=e.channelType,o=e.limit,u=e.token;return (i=n.call(this)||this).method=ee.GET,i.path="".concat(ge(a),"/").concat(encodeURIComponent(s),"/ban"),i.params=J({limit:o,token:u}),i}return t(i,n),i}(Ne$1),Qt$1=function(t$1){function n(e,n){var r=t$1.call(this,e,n)||this;r.bannedUsers=[];var i=n.next,s=n.banned_list;return r.token=i,s&&s.length>0&&(r.bannedUsers=s.map((function(t){return new yt$1(e,t.user)}))),r}return t(n,t$1),n}(Te$1),Gt$1=function(t$1){function n$1(e,n,r,i){return t$1.call(this,e,n,r,i)||this}return t(n$1,t$1),n$1.prototype._validate=function(){return t$1.prototype._validate.call(this)},n$1.prototype.next=function(){return i(this,void 0,void 0,(function(){var e,t,n$1,r,i,s;return o(this,(function(a){switch(a.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=_o.of(this._iid).requestQueue,t=new jt$1(n(n({},this),{token:this._token})),[4,e.send(t)]):[3,2]:[3,5];case 1:return n$1=a.sent(),r=n$1.as(Qt$1),i=r.bannedUsers,s=r.token,this._token=s,this._hasNext=!!s,this._isLoading=!1,[2,i];case 2:return [2,[]];case 3:throw v$1.queryInProgress;case 4:return [3,6];case 5:throw v$1.invalidParameters;case 6:return [2]}}))}))},n$1}(Io);!function(e){e.SPAM="spam",e.HARASSING="harassing",e.SUSPICIOUS="suspicious",e.INAPPROPRIATE="inappropriate";}(Mt$1||(Mt$1={}));var Vt$1=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.operatorUserIds;return (r=n.call(this)||this).method=ee.POST,r.path="".concat(ge(s),"/").concat(encodeURIComponent(i),"/operators"),r.params={operator_ids:a},r}return t(r,n),r}(Ne$1);!function(t$1){function n(){return null!==t$1&&t$1.apply(this,arguments)||this}t(n,t$1);}(Te$1);var Wt$1=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.operatorUserIds;return (r=n.call(this)||this).method=ee.DELETE,r.path="".concat(ge(s),"/").concat(encodeURIComponent(i),"/operators"),r.params={operator_ids:a},r}return t(r,n),r}(Ne$1);!function(t$1){function n(e,n){return t$1.call(this,e,n)||this}t(n,t$1);}(Te$1);var Ht$1=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.userId;return (r=n.call(this)||this).method=ee.GET,r.path="".concat(ge(s),"/").concat(encodeURIComponent(i),"/mute/").concat(a),r}return t(r,n),r}(Ne$1),Yt$1=function(t$1){function n(e,n){var r=t$1.call(this,e,n)||this;r.isMuted=!1,r.startAt=0,r.endAt=0;var i=n.is_muted,s=n.start_at,a=n.end_at,o=n.remaining_duration,u=n.description;return r.isMuted=i,r.startAt=s,r.endAt=a,r.remainingDuration=o,r.description=u,r}return t(n,t$1),n}(Te$1),Jt$1=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.keys;return (r=n.call(this)||this).method=ee.GET,r.path="".concat(ge(s),"/").concat(encodeURIComponent(i),"/metadata"),r.params={keys:a,include_ts:!0},r}return t(r,n),r}(Ne$1),Xt$1=function(t$1){function n(e,n){var r=t$1.call(this,e,n)||this,i=n.metadata,s=n.ts;return r.metadata=i,r.ts=s,r}return t(n,t$1),n}(Te$1),Zt$1=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.metadata;return (r=n.call(this)||this).method=ee.POST,r.path="".concat(ge(s),"/").concat(encodeURIComponent(i),"/metadata"),r.params={metadata:a,include_ts:!0},r}return t(r,n),r}(Ne$1),$t$1=function(t$1){function n(e,n){var r,i,s=this;return (s=t$1.call(this,e,n)||this).metaData=null!==(r=n.metadata)&&void 0!==r?r:{},s.ts=null!==(i=n.ts)&&void 0!==i?i:null,s}return t(n,t$1),n}(Te$1),en$1=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.metadata,o=e.upsert;return (r=n.call(this)||this).method=ee.PUT,r.path="".concat(ge(s),"/").concat(encodeURIComponent(i),"/metadata"),r.params={metadata:a,include_ts:!0,upsert:null!=o&&o},r}return t(r,n),r}(Ne$1),tn$1=function(t$1){function n(e,n){var r=t$1.call(this,e,n)||this,i=n.metadata,s=n.ts;return r.metadata=i,r.ts=s,r}return t(n,t$1),n}(Te$1);(function(t$1){function n(e,n,r){var i=t$1.call(this,e,"SYEV",r)||this;return r.data&&(i.created=r.data.created,i.updated=r.data.updated,i.deleted=r.data.deleted),i}return t(n,t$1),n})(Pe$1);var rn$1=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.key;return (r=n.call(this)||this).method=ee.DELETE,r.path="".concat(ge(s),"/").concat(encodeURIComponent(i),"/metadata/").concat(a),r.params={include_ts:!0},r}return t(r,n),r}(Ne$1),sn$1=function(t$1){function n(e,n){var r=t$1.call(this,e,n)||this,i=n.ts;return r.ts=i,r}return t(n,t$1),n}(Te$1),an$1=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType;return (r=n.call(this)||this).method=ee.DELETE,r.path="".concat(ge(s),"/").concat(encodeURIComponent(i),"/metadata"),r.params={include_ts:!0},r}return t(r,n),r}(Ne$1),on$1=function(t$1){function n(e,n){var r=t$1.call(this,e,n)||this,i=n.ts;return r.ts=i,r}return t(n,t$1),n}(Te$1),un$1=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.keys;return (r=n.call(this)||this).method=ee.GET,r.path="".concat(ge(s),"/").concat(encodeURIComponent(i),"/metacounter"),r.params={keys:a},r}return t(r,n),r}(Ne$1),cn$1=function(t$1){function n(e,n){var r=t$1.call(this,e,n)||this;return r.metaCounter=n,r}return t(n,t$1),n}(Te$1),ln$1=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.metaCounter;return (r=n.call(this)||this).method=ee.POST,r.path="".concat(ge(s),"/").concat(encodeURIComponent(i),"/metacounter"),r.params={metacounter:a},r}return t(r,n),r}(Ne$1),dn$1=function(t$1){function n(e,n){var r=t$1.call(this,e,n)||this;return r.metaCounter=n,r}return t(n,t$1),n}(Te$1),hn=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.metaCounter,o=e.upsert,u=void 0!==o&&o,c=e.mode,l=void 0===c?"set":c;return (r=n.call(this)||this).method=ee.PUT,r.path="".concat(ge(s),"/").concat(encodeURIComponent(i),"/metacounter"),r.params={metacounter:a,upsert:u,mode:l},r}return t(r,n),r}(Ne$1),fn=function(t$1){function n(e,n){var r=t$1.call(this,e,n)||this;return r.metaCounter=n,r}return t(n,t$1),n}(Te$1);(function(t$1){function n(e,n,r){var i=t$1.call(this,e,"SYEV",r)||this;return r.data&&(i.created=r.data.created,i.updated=r.data.updated,i.deleted=r.data.deleted),i}return t(n,t$1),n})(Pe$1);var mn=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.key;return (r=n.call(this)||this).method=ee.DELETE,r.path="".concat(ge(s),"/").concat(encodeURIComponent(i),"/metacounter/").concat(a),r.params={},r}return t(r,n),r}(Ne$1);!function(t$1){function n(e,n){return t$1.call(this,e,n)||this}t(n,t$1);}(Te$1);var vn=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType;return (r=n.call(this)||this).method=ee.DELETE,r.path="".concat(ge(s),"/").concat(encodeURIComponent(i),"/metacounter"),r.params={},r}return t(r,n),r}(Ne$1);!function(t$1){function n(){return null!==t$1&&t$1.apply(this,arguments)||this}t(n,t$1);}(Te$1);var yn=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.userId,o=e.seconds,u=e.description;return (r=n.call(this)||this).method=ee.POST,r.path="".concat(ge(s),"/").concat(encodeURIComponent(i),"/mute"),r.params={user_id:a,seconds:o,description:u},r}return t(r,n),r}(Ne$1);!function(t$1){function n(e,n){return t$1.call(this,e,n)||this}t(n,t$1);}(Te$1);(function(t$1){function n(e,n,r){var i=t$1.call(this,e,"SYEV",r)||this;return i.user=new yt$1(e,r.data),i}return t(n,t$1),n})(Pe$1);var gn=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.userId;return (r=n.call(this)||this).method=ee.DELETE,r.path="".concat(ge(s),"/").concat(encodeURIComponent(i),"/mute/").concat(encodeURIComponent(a)),r}return t(r,n),r}(Ne$1);!function(t$1){function n(){return null!==t$1&&t$1.apply(this,arguments)||this}t(n,t$1);}(Te$1);(function(t$1){function n(e,n,r){var i=t$1.call(this,e,"SYEV",r)||this;return i.user=new yt$1(e,r.data),i}return t(n,t$1),n})(Pe$1);var In=function(n){function i(e){var i=this,s=e.channelUrl,a=e.channelType,o=e.userId,u=e.seconds,c=e.description;return (i=n.call(this)||this).method=ee.POST,i.path="".concat(ge(a),"/").concat(encodeURIComponent(s),"/ban"),i.params=J({user_id:o,seconds:u,description:c}),i}return t(i,n),i}(Ne$1);!function(t$1){function n(){return null!==t$1&&t$1.apply(this,arguments)||this}t(n,t$1);}(Te$1);(function(t$1){function n(e,n,r){var i=t$1.call(this,e,"SYEV",r)||this;return i.user=new yt$1(e,r.data),r.data.member_count&&(i.memberCount=r.data.member_count),r.data.joined_member_count&&(i.joinedMemberCount=r.data.joined_member_count),i}return t(n,t$1),n})(Pe$1);var Tn=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.userId;return (r=n.call(this)||this).method=ee.DELETE,r.path="".concat(ge(s),"/").concat(encodeURIComponent(i),"/ban/").concat(encodeURIComponent(a)),r}return t(r,n),r}(Ne$1);!function(t$1){function n(){return null!==t$1&&t$1.apply(this,arguments)||this}t(n,t$1);}(Te$1);(function(t$1){function n(e,n,r){var i=t$1.call(this,e,"SYEV",r)||this;return i.user=new yt$1(e,r.data),i}return t(n,t$1),n})(Pe$1);var Mn=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.freezing;return (r=n.call(this)||this).method=ee.PUT,r.path="".concat(ge(s),"/").concat(encodeURIComponent(i),"/freeze"),r.params={freeze:a},r}return t(r,n),r}(Ne$1);!function(t$1){function n(){return null!==t$1&&t$1.apply(this,arguments)||this}t(n,t$1);}(Te$1);(function(t$1){function n(e,n,r){var i=t$1.call(this,e,"SYEV",r)||this;return i.freeze=r.data.freeze,i}return t(n,t$1),n})(Pe$1);var An=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.category,o=e.userId,u=e.description;return (r=n.call(this)||this).method=ee.POST,r.path="".concat(ve(s),"/").concat(encodeURIComponent(i)),r.params={report_category:a,reporting_user_id:o,report_description:u},r}return t(r,n),r}(Ne$1),Nn=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.category,o=e.userId,u=e.offendingUserId,c=e.description;return (r=n.call(this)||this).method=ee.POST,r.path="".concat(ue,"/users/").concat(u),r.params={channel_url:i,channel_type:s===x.OPEN?"open_channels":"group_channels",report_category:a,reporting_user_id:o,report_description:c},r}return t(r,n),r}(Ne$1),Un=function(n){function r(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.category,o=e.userId,u=e.offendingUserId,c=e.messageId,l=e.description;return (r=n.call(this)||this).method=ee.POST,r.path="".concat(ve(s),"/").concat(encodeURIComponent(i),"/messages/").concat(c),r.params={report_category:a,reporting_user_id:o,report_description:l,offending_user_id:u},r}return t(r,n),r}(Ne$1),On=function(t$1){function n(e){var n=[];return e.mentionType===H.USERS&&(e.mentionedUserIds?n=e.mentionedUserIds:e.mentionedUsers&&(n=e.mentionedUsers.map((function(e){return e.userId})))),t$1.call(this,{code:"MESG",ackRequired:!0,payload:J($({channel_url:e.channelUrl,message:e.message,data:e.data,custom_type:e.customType,metaarray:e.metaArrays,mention_type:e.mentionType,mentioned_user_ids:n,mentioned_message_template:e.mentionedMessageTemplate,target_langs:e.translationTargetLanguages,push_option:e.pushNotificationDeliveryOption&&e.pushNotificationDeliveryOption!==G.DEFAULT?e.pushNotificationDeliveryOption:void 0,apple_critical_alert_options:e.appleCriticalAlertOptions,silent:e.silent,reply_to_channel:e.isReplyToChannel,parent_message_id:e.parentMessageId?e.parentMessageId:null,req_id:e.reqId,poll_id:e.pollId,pin_message:e.isPinnedMessage}))})||this}return t(n,t$1),n}(ri$1),Cn=function(t$1){function n(e,n,r){var i,s,a,o,u=this;(u=t$1.call(this,e,"MESG",r)||this).message=new je(e,r);var c=_o.of(e).sdkState;return u.isMentioned=be(u.message.mentionType,null!==(a=null!==(i=u.message.mentionedUserIds)&&void 0!==i?i:null===(s=u.message.mentionedUsers)||void 0===s?void 0:s.map((function(e){return e.userId})))&&void 0!==a?a:[],c.userId),u.forceUpdateLastMessage=null!==(o=r.force_update_last_message)&&void 0!==o&&o,u}return t(n,t$1),n}(Pe$1),Pn=function(t$1){function n(e){var n=null;return e.mentionType===H.USERS&&(e.mentionedUserIds?n=e.mentionedUserIds:e.mentionedUsers&&(n=e.mentionedUsers.map((function(e){return e.userId})))),t$1.call(this,{code:"MEDI",ackRequired:!0,payload:J($({channel_url:e.channelUrl,msg_id:e.messageId,message:e.message,data:e.data,custom_type:e.customType,metaarray:e.metaArrayParams,mention_type:e.mentionType,mentioned_user_ids:n,mentioned_message_template:e.mentionedMessageTemplate,apple_critical_alert_options:e.appleCriticalAlertOptions?ke.payloadify(e.appleCriticalAlertOptions):null,poll_id:e.pollId}))})||this}return t(n,t$1),n}(ri$1),kn=function(t$1){function n(e,n,r){var i,s,o,u,c,l=this;(l=t$1.call(this,e,"MEDI",r)||this).message=new je(e,r);var d=_o.of(e).sdkState;return l.mentionCountChange=me({mentionType:null===(i=r.old_values)||void 0===i?void 0:i.mention_type,mentionedUserIds:null!==(o=null===(s=r.old_values)||void 0===s?void 0:s.mentioned_user_ids)&&void 0!==o?o:[]},$({mentionType:l.message.mentionType,mentionedUserIds:null!==(u=l.message.mentionedUserIds)&&void 0!==u?u:null===(c=l.message.mentionedUsers)||void 0===c?void 0:c.map((function(e){return e.userId}))}),d.userId),l}return t(n,t$1),n}(Pe$1),Rn=function(t$1){function n(e){var n=null;return e.mentionType===H.USERS&&(e.mentionedUserIds?n=e.mentionedUserIds:e.mentionedUsers&&(n=e.mentionedUsers.map((function(e){return e.userId})))),t$1.call(this,{code:"FEDI",ackRequired:!0,payload:J($({channel_url:e.channelUrl,msg_id:e.messageId,data:e.data,custom_type:e.customType,metaarray:e.metaArrayParams,mention_type:e.mentionType,mentioned_user_ids:n,apple_critical_alert_options:e.appleCriticalAlertOptions}))})||this}return t(n,t$1),n}(ri$1),xn=function(t$1){function n(e,n,r){var i,s,o,u,c,l=this;(l=t$1.call(this,e,"FEDI",r)||this).message=new He(e,r);var d=_o.of(e).sdkState;return l.mentionCountChange=me({mentionType:null===(i=r.old_values)||void 0===i?void 0:i.mention_type,mentionedUserIds:null!==(o=null===(s=r.old_values)||void 0===s?void 0:s.mentioned_user_ids)&&void 0!==o?o:[]},$({mentionType:l.message.mentionType,mentionedUserIds:null!==(u=l.message.mentionedUserIds)&&void 0!==u?u:null===(c=l.message.mentionedUsers)||void 0===c?void 0:c.map((function(e){return e.userId}))}),d.userId),l}return t(n,t$1),n}(Pe$1),Ln=function(n){function r(e){var r=n.call(this)||this;return r.method=ee.DELETE,r.path="".concat(ge(e.channelType),"/").concat(e.channelUrl,"/messages/").concat(e.messageId),r}return t(r,n),r}(Ne$1);!function(t$1){function n(){return null!==t$1&&t$1.apply(this,arguments)||this}t(n,t$1);}(Te$1);(function(t$1){function n(e,n,r){var i=t$1.call(this,e,"DELM",r)||this;return i.channelUrl=r.channel_url,i.channelType=r.channel_type,i.messageId=Number(r.msg_id),i}return t(n,t$1),n})(Pe$1);var qn=function(n){function r(e){var r=e.channelType,i=e.channelUrl,s=e.messageId,a=e.reactionKey,o=n.call(this)||this;return o.method=ee.POST,o.path="".concat(ge(r),"/").concat(encodeURIComponent(i),"/messages/").concat(s,"/reactions"),o.params={reaction:a},o}return t(r,n),r}(Ne$1),Fn=function(t$1){function n(e,n){var r=t$1.call(this,e,n)||this;return r.reactionEvent=new Ne(n),r}return t(n,t$1),n}(Te$1),zn=function(n){function r(e){var r=e.channelType,i=e.channelUrl,s=e.messageId,a=e.reactionKey,o=n.call(this)||this;return o.method=ee.DELETE,o.path="".concat(ge(r),"/").concat(encodeURIComponent(i),"/messages/").concat(s,"/reactions"),o.params={reaction:a},o}return t(r,n),r}(Ne$1),Bn=function(t$1){function n$1(e,n$1){var r=t$1.call(this,e,n$1)||this;return r.reactionEvent=new Ne(n({},n$1)),r}return t(n$1,t$1),n$1}(Te$1),Kn=function(n){function r(e){var r=e.channelType,i=e.channelUrl,s=e.messageId,a=e.translationTargetLanguages,o=n.call(this)||this;return o.method=ee.POST,o.path="".concat(ge(r),"/").concat(encodeURIComponent(i),"/messages/").concat(encodeURIComponent(s),"/translation"),o.params={target_langs:a},o}return t(r,n),r}(Ne$1),jn=function(t$1){function n(e,n){var r=t$1.call(this,e,n)||this;return r.message=new je(e,n),r}return t(n,t$1),n}(Te$1),Qn=function(n){function i(e){var i,s=this;s=n.call(this)||this;var o=[];e.mentionType===H.USERS&&(e.mentionedUserIds?o=e.mentionedUserIds:e.mentionedUsers&&(o=e.mentionedUsers.map((function(e){return e.userId}))));var u=e.channelType,c=e.channelUrl;return s.method=ee.POST,s.path="".concat(ge(u),"/").concat(encodeURIComponent(c),"/scheduled_messages"),s.params=J($({req_id:e.reqId,scheduled_at:e.scheduledAt,message_type:F.USER,message:e.message,custom_type:e.customType,data:e.data,mention_type:e.mentionType,mentioned_user_ids:o,sorted_metaarray:null===(i=e.metaArrays)||void 0===i?void 0:i.map((function(e){return Oe.payloadify(e)})),apple_critical_alert_options:e.appleCriticalAlertOptions?ke.payloadify(e.appleCriticalAlertOptions):null,target_langs:e.translationTargetLanguages,push_option:e.pushNotificationDeliveryOption})),s}return t(i,n),i}(Ne$1),Gn=function(t$1){function n(e,n){var r=t$1.call(this,e,n)||this;return r.message=new je(e,n),r}return t(n,t$1),n}(Te$1),Vn=function(n){function r(e){var r,i=this;i=n.call(this)||this;var s=[];e.mentionType===H.USERS&&(e.mentionedUserIds?s=e.mentionedUserIds:e.mentionedUsers&&(s=e.mentionedUsers.map((function(e){return e.userId}))));var o=e.channelType,u=e.channelUrl;return i.method=ee.POST,i.path="".concat(ge(o),"/").concat(encodeURIComponent(u),"/scheduled_messages"),i.params=$({req_id:e.reqId,scheduled_at:e.scheduledAt,message_type:F.FILE,url:e.fileUrl,file_name:e.fileName,file_size:e.fileSize,file_type:e.mimeType,thumbnails:e.thumbnailSizes?e.thumbnailSizes.map((function(e){return qe.payloadify(e)})):[],custom_type:e.customType,data:e.data,require_auth:e.requireAuth,mention_type:e.mentionType,mentioned_user_ids:s,sorted_metaarray:null===(r=e.metaArrays)||void 0===r?void 0:r.map((function(e){return Oe.payloadify(e)})),apple_critical_alert_options:e.appleCriticalAlertOptions?ke.payloadify(e.appleCriticalAlertOptions):null,push_option:e.pushNotificationDeliveryOption}),i}return t(r,n),r}(Ne$1),Wn=function(t$1){function n(e,n){var r=t$1.call(this,e,n)||this;return r.message=new He(e,n),r}return t(n,t$1),n}(Te$1),Hn=function(n){function r(e){var r=e.pollId,i=e.title,s=e.data,a=e.allowUserSuggestion,o=e.allowMultipleVotes,u=e.closeAt,c=n.call(this)||this;return c.method=ee.PUT,c.path="".concat(de,"/").concat(encodeURIComponent(r)),c.params={title:i,data:s,allow_user_suggestion:a,allow_multiple_votes:o,close_at:u},c}return t(r,n),r}(Ne$1),Yn=function(t$1){function n(e,n){var r=t$1.call(this,e,n)||this;return r.poll=new mo(e,n),r}return t(n,t$1),n}(Te$1),Jn=function(n){function r(e){var r=e.pollId,i=n.call(this)||this;return i.method=ee.DELETE,i.path="".concat(de,"/").concat(encodeURIComponent(r)),i}return t(r,n),r}(Ne$1);!function(t$1){function n(){return null!==t$1&&t$1.apply(this,arguments)||this}t(n,t$1);}(Te$1);var Xn=function(n){function r(e){var r=e.pollId,i=n.call(this)||this;return i.method=ee.PUT,i.path="".concat(de,"/").concat(encodeURIComponent(r),"/close"),i}return t(r,n),r}(Ne$1),Zn=function(t$1){function n(e,n){var r=t$1.call(this,e,n)||this;return r.poll=new mo(e,n),r}return t(n,t$1),n}(Te$1),$n=function(n){function r(e){var r=e.channelUrl,i=e.channelType,s=e.pollId,a=e.optionText,o=n.call(this)||this;return o.method=ee.POST,o.path="".concat(de,"/").concat(encodeURIComponent(s),"/options"),o.params={channel_url:r,channel_type:i,text:a},o}return t(r,n),r}(Ne$1),er=function(t$1){function n(e,n){var r=t$1.call(this,e,n)||this;return r.poll=new mo(e,n),r}return t(n,t$1),n}(Te$1),tr=function(n){function r(e){var r=e.pollId,i=e.pollOptionId,s=e.optionText,a=n.call(this)||this;return a.method=ee.PUT,a.path="".concat(de,"/").concat(encodeURIComponent(r),"/options/").concat(encodeURIComponent(i)),a.params={text:s},a}return t(r,n),r}(Ne$1),nr=function(t$1){function n(e,n){var r=t$1.call(this,e,n)||this;return r.poll=new mo(e,n),r}return t(n,t$1),n}(Te$1),rr=function(n){function r(e){var r=e.pollId,i=e.pollOptionId,s=n.call(this)||this;return s.method=ee.DELETE,s.path="".concat(de,"/").concat(encodeURIComponent(r),"/options/").concat(encodeURIComponent(i)),s}return t(r,n),r}(Ne$1);!function(t$1){function n(){return null!==t$1&&t$1.apply(this,arguments)||this}t(n,t$1);}(Te$1);var ir,sr=function(t$1){function n(e){var n=e.reqId,i=e.channelType,s=e.channelUrl,a=e.pollId,o=e.pollOptionIds;return t$1.call(this,{code:"VOTE",ackRequired:!0,payload:J({req_id:n,channel_type:i===x.OPEN?"open_channels":"group_channels",channel_url:s,poll_id:a,option_ids:o})})||this}return t(n,t$1),n}(ri$1),ar=function(t$1){function n(e,n,r){var i=t$1.call(this,e,"VOTE",r)||this;return i.event=new Ro(r),i.channelUrl=r.channel_url,i.channelType=r.channel_type,i}return t(n,t$1),n}(Pe$1),ur="GroupChannel",cr="url",dr="Message",hr="messageId",fr="Poll",pr="pollId",vr="FeedChannel",yr="url",_r=n(n({},bt$1),{fileInfoList:[]}),gr=function(e){return (k(e.file)||w("string",e.fileUrl))&&w("string",e.fileName,!0)&&w("string",e.mimeType,!0)&&w("number",e.fileSize,!0)&&(void 0===e.thumbnailSizes||Array.isArray(e.thumbnailSizes)&&e.thumbnailSizes.every((function(e){return e.maxWidth>0&&e.maxHeight>0})))},br=function(t$1){function n(){var e=null!==t$1&&t$1.apply(this,arguments)||this;return e._onFileUploaded=ze$1,e}return t(n,t$1),n.prototype._triggerOnFileUploaded=function(e,t,n,r){this._onFileUploaded(e,t,n,r);},n.prototype.onFileUploaded=function(e){return this._onFileUploaded=e,this},n.prototype.onPending=function(e){return t$1.prototype.onPending.call(this,e),this},n.prototype.onFailed=function(e){return t$1.prototype.onFailed.call(this,e),this},n.prototype.onSucceeded=function(e){return t$1.prototype.onSucceeded.call(this,e),this},n}(gt$1);(function(t$1){function n$1(e,n){var r,i,s,a,o,c,l=this;return (l=t$1.call(this,e)||this)._name="",l._createdAt=0,l.channelType=x.BASE,l.coverUrl="",l.customType="",l.data="",l.isFrozen=!1,l.isEphemeral=!1,l.creator=null,l._messageCollectionLastAccessedAt=0,l._url=n.channel_url,l._name=null!==(r=n.name)&&void 0!==r?r:"",l._createdAt=1e3*n.created_at,l.coverUrl=null!==(i=n.cover_url)&&void 0!==i?i:"",l.customType=null!==(s=n.custom_type)&&void 0!==s?s:"",l.data=null!==(a=n.data)&&void 0!==a?a:"",l.isFrozen=null!==(o=n.freeze)&&void 0!==o&&o,l.isEphemeral=null!==(c=n.is_ephemeral)&&void 0!==c&&c,l.creator=n.created_by?new Xi$1(l._iid,n.created_by):null,n.metadata&&Object.keys(n.metadata).length>0&&n.ts&&(l._cachedMetaData=new Map,Object.keys(n.metadata).forEach((function(e){l._cachedMetaData.set(e,{value:n.metadata[e],isRemoved:!1,updatedAt:n.ts});}))),l}return t(n$1,t$1),Object.defineProperty(n$1.prototype,"url",{get:function(){return this._url},enumerable:!1,configurable:!0}),Object.defineProperty(n$1.prototype,"name",{get:function(){return this._name},set:function(e){this._name=e;},enumerable:!1,configurable:!0}),Object.defineProperty(n$1.prototype,"createdAt",{get:function(){return this._createdAt},enumerable:!1,configurable:!0}),n$1.prototype.toJSON=function(){return n(n({},this),{url:this._url,name:this._name,createdAt:this._createdAt})},n$1.payloadify=function(e){return J($(n(n({},t$1.payloadify.call(this,e)),{channel_url:e.url,name:e.name,cover_url:e.coverUrl,custom_type:e.customType,data:e.data,freeze:e.isFrozen,is_ephemeral:e.isEphemeral,created_by:e.creator?Xi$1.payloadify(e.creator):null,created_at:e.createdAt/1e3})))},n$1.prototype.isGroupChannel=function(){return this.channelType===x.GROUP},n$1.prototype.isOpenChannel=function(){return this.channelType===x.OPEN},n$1.prototype.isFeedChannel=function(){return this.channelType===x.FEED},Object.defineProperty(n$1.prototype,"cachedMetaData",{get:function(){var e={};return this._cachedMetaData?(this._cachedMetaData.forEach((function(t,n){t.isRemoved||(e[n]=t.value);})),e):e},enumerable:!1,configurable:!0}),Object.defineProperty(n$1.prototype,"messageCollectionLastAccessedAt",{get:function(){return this._messageCollectionLastAccessedAt},enumerable:!1,configurable:!0}),n$1.prototype._updateMessageCollectionLastAccessedAt=function(){this._messageCollectionLastAccessedAt=Date.now();},n$1.prototype._update=function(e){var t=J(e);Object.assign(this,t);},n$1.prototype._upsertCachedMetaData=function(e,t){var n=this;Object.keys(e).forEach((function(r){n._cachedMetaData||(n._cachedMetaData=new Map);var i=n._cachedMetaData.get(r);(!i||i.updatedAt<=t)&&n._cachedMetaData.set(r,{value:e[r],isRemoved:!1,updatedAt:t});}));},n$1.prototype._updateCachedMetaData=function(e,t){var n=this;this._cachedMetaData?this._cachedMetaData.forEach((function(r,i){var s;r.updatedAt<=t&&n._cachedMetaData.set(i,{value:null!==(s=e[i])&&void 0!==s?s:r.value,isRemoved:!e[i],updatedAt:t});})):(this._cachedMetaData=new Map,Object.keys(e).forEach((function(r){n._cachedMetaData.set(r,{value:e[r],isRemoved:!1,updatedAt:t});})));},n$1.prototype._removeFromCachedMetaData=function(e,t){var n=this;this._cachedMetaData&&e.forEach((function(e){var r=n._cachedMetaData.get(e);r&&r.updatedAt<t&&(r.isRemoved=!0,r.updatedAt=t);}));},n$1.prototype._runIfHandleableWithGroupChannel=function(e){this.isGroupChannel()?e(this):this.isFeedChannel()&&e(this.groupChannel);},n$1.prototype._generateRequestId=function(){return "rq-".concat(Z())},n$1.prototype.isIdentical=function(e){return e&&this.url===e.url},n$1.prototype.isEqual=function(e){return y(this,e)},n$1.prototype.createOperatorListQuery=function(e){return void 0===e&&(e={}),new qt$1(this._iid,this.url,this.channelType,e)},n$1.prototype.createMutedUserListQuery=function(e){return void 0===e&&(e={}),new Kt$1(this._iid,this.url,this.channelType,e)},n$1.prototype.createBannedUserListQuery=function(e){return void 0===e&&(e={}),new Gt$1(this._iid,this.url,this.channelType,e)},n$1.prototype.createPreviousMessageListQuery=function(e){return void 0===e&&(e={}),new Ft$1(this._iid,this.url,this.channelType,e)},n$1.prototype.addOperators=function(e){return i(this,void 0,void 0,(function(){var t,n;return o(this,(function(r){switch(r.label){case 0:return Qi$1(S$1("string",e)).throw(v$1.invalidParameters),t=_o.of(this._iid).requestQueue,n=new Vt$1({channelUrl:this.url,channelType:this.channelType,operatorUserIds:e}),[4,t.send(n)];case 1:return r.sent(),[2]}}))}))},n$1.prototype.removeOperators=function(e){return i(this,void 0,void 0,(function(){var t,n;return o(this,(function(r){switch(r.label){case 0:return Qi$1(S$1("string",e)).throw(v$1.invalidParameters),t=_o.of(this._iid).requestQueue,n=new Wt$1({channelUrl:this.url,channelType:this.channelType,operatorUserIds:e}),[4,t.send(n)];case 1:return r.sent(),[2]}}))}))},n$1.prototype.getMyMutedInfo=function(){return i(this,void 0,void 0,(function(){var e,t,n,r,i,s,a,o$1,u,c,l;return o(this,(function(d){switch(d.label){case 0:return e=_o.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new Ht$1({channelUrl:this.url,channelType:this.channelType,userId:t.userId}),[4,n.send(r)];case 1:return i=d.sent(),s=i.as(Yt$1),a=s.isMuted,o$1=s.startAt,u=s.endAt,c=s.remainingDuration,l=s.description,[2,{isMuted:a,startAt:o$1,endAt:u,remainingDuration:c,description:l}]}}))}))},n$1.prototype.getMetaData=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,s,a;return o(this,(function(o){switch(o.label){case 0:return Qi$1(S$1("string",e)).throw(v$1.invalidParameters),t=_o.of(this._iid).requestQueue,n=new Jt$1({channelUrl:this.url,channelType:this.channelType,keys:e}),[4,t.send(n)];case 1:return r=o.sent(),i=r.as(Xt$1),s=i.metadata,a=i.ts,this._upsertCachedMetaData(s,a),[2,s]}}))}))},n$1.prototype.getAllMetaData=function(){return i(this,void 0,void 0,(function(){var e,t,n,r,i,s;return o(this,(function(a){switch(a.label){case 0:return e=_o.of(this._iid).requestQueue,t=new Jt$1({channelUrl:this.url,channelType:this.channelType,keys:[]}),[4,e.send(t)];case 1:return n=a.sent(),r=n.as(Xt$1),i=r.metadata,s=r.ts,this._updateCachedMetaData(i,s),[2,i]}}))}))},n$1.prototype.createMetaData=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i;return o(this,(function(s){switch(s.label){case 0:return t=_o.of(this._iid).requestQueue,n=new Zt$1({channelUrl:this.url,channelType:this.channelType,metadata:e}),[4,t.send(n)];case 1:return r=s.sent(),i=r.as($t$1).metaData,this._upsertCachedMetaData(i,0),[2,i]}}))}))},n$1.prototype.updateMetaData=function(e,t){return void 0===t&&(t=!1),i(this,void 0,void 0,(function(){var n,r,i,s,a,o$1;return o(this,(function(u){switch(u.label){case 0:return n=_o.of(this._iid).requestQueue,r=new en$1({channelUrl:this.url,channelType:this.channelType,metadata:e,upsert:t}),[4,n.send(r)];case 1:return i=u.sent(),s=i.as(tn$1),a=s.metadata,o$1=s.ts,this._upsertCachedMetaData(a,o$1),[2,a]}}))}))},n$1.prototype.deleteMetaData=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i;return o(this,(function(s){switch(s.label){case 0:return Qi$1(w("string",e)).throw(v$1.invalidParameters),t=_o.of(this._iid).requestQueue,n=new rn$1({channelUrl:this.url,channelType:this.channelType,key:e}),[4,t.send(n)];case 1:return r=s.sent(),i=r.as(sn$1).ts,this._removeFromCachedMetaData([e],i),[2]}}))}))},n$1.prototype.deleteAllMetaData=function(){return i(this,void 0,void 0,(function(){var e,t,n,r;return o(this,(function(i){switch(i.label){case 0:return e=_o.of(this._iid).requestQueue,t=new an$1({channelUrl:this.url,channelType:this.channelType}),[4,e.send(t)];case 1:return n=i.sent(),r=n.as(on$1).ts,this._removeFromCachedMetaData(c([],a(this._cachedMetaData.keys()),!1),r),[2]}}))}))},n$1.prototype.getMetaCounters=function(e){return i(this,void 0,void 0,(function(){var t,n,r;return o(this,(function(i){switch(i.label){case 0:return Qi$1(S$1("string",e)).throw(v$1.invalidParameters),t=_o.of(this._iid).requestQueue,n=new un$1({channelUrl:this.url,channelType:this.channelType,keys:e}),[4,t.send(n)];case 1:return r=i.sent(),[2,r.as(cn$1).metaCounter]}}))}))},n$1.prototype.getAllMetaCounters=function(){return i(this,void 0,void 0,(function(){var e,t,n;return o(this,(function(r){switch(r.label){case 0:return e=_o.of(this._iid).requestQueue,t=new un$1({channelUrl:this.url,channelType:this.channelType,keys:[]}),[4,e.send(t)];case 1:return n=r.sent(),[2,n.as(cn$1).metaCounter]}}))}))},n$1.prototype.createMetaCounters=function(e){return i(this,void 0,void 0,(function(){var t,n,r;return o(this,(function(i){switch(i.label){case 0:return t=_o.of(this._iid).requestQueue,n=new ln$1({channelUrl:this.url,channelType:this.channelType,metaCounter:e}),[4,t.send(n)];case 1:return r=i.sent(),[2,r.as(dn$1).metaCounter]}}))}))},n$1.prototype.updateMetaCounters=function(e,t){return void 0===t&&(t=!1),i(this,void 0,void 0,(function(){var n,r,i;return o(this,(function(s){switch(s.label){case 0:return n=_o.of(this._iid).requestQueue,r=new hn({channelUrl:this.url,channelType:this.channelType,metaCounter:e,upsert:t}),[4,n.send(r)];case 1:return i=s.sent(),[2,i.as(fn).metaCounter]}}))}))},n$1.prototype.increaseMetaCounters=function(e){return i(this,void 0,void 0,(function(){var t,n,r;return o(this,(function(i){switch(i.label){case 0:return t=_o.of(this._iid).requestQueue,n=new hn({channelUrl:this.url,channelType:this.channelType,metaCounter:e,upsert:!1,mode:"increase"}),[4,t.send(n)];case 1:return r=i.sent(),[2,r.as(fn).metaCounter]}}))}))},n$1.prototype.decreaseMetaCounters=function(e){return i(this,void 0,void 0,(function(){var t,n,r;return o(this,(function(i){switch(i.label){case 0:return t=_o.of(this._iid).requestQueue,n=new hn({channelUrl:this.url,channelType:this.channelType,metaCounter:e,upsert:!1,mode:"decrease"}),[4,t.send(n)];case 1:return r=i.sent(),[2,r.as(fn).metaCounter]}}))}))},n$1.prototype.deleteMetaCounter=function(e){return i(this,void 0,void 0,(function(){var t,n;return o(this,(function(r){switch(r.label){case 0:return Qi$1(w("string",e)).throw(v$1.invalidParameters),t=_o.of(this._iid).requestQueue,n=new mn({channelUrl:this.url,channelType:this.channelType,key:e}),[4,t.send(n)];case 1:return r.sent(),[2]}}))}))},n$1.prototype.deleteAllMetaCounters=function(){return i(this,void 0,void 0,(function(){var e,t;return o(this,(function(n){switch(n.label){case 0:return e=_o.of(this._iid).requestQueue,t=new vn({channelUrl:this.url,channelType:this.channelType}),[4,e.send(t)];case 1:return n.sent(),[2]}}))}))},n$1.prototype.muteUser=function(e,t,n){return i(this,void 0,void 0,(function(){return o(this,(function(r){return [2,this.muteUserWithUserId(e.userId,t,n)]}))}))},n$1.prototype.muteUserWithUserId=function(e,t,n){return i(this,void 0,void 0,(function(){var r,i;return o(this,(function(s){switch(s.label){case 0:return Qi$1(w("string",e)&&w("number",t,!0)&&w("string",n,!0)).throw(v$1.invalidParameters),r=_o.of(this._iid).requestQueue,i=new yn({channelUrl:this.url,channelType:this.channelType,userId:e,seconds:t,description:n}),[4,r.send(i)];case 1:return s.sent(),[2]}}))}))},n$1.prototype.unmuteUser=function(e){return i(this,void 0,void 0,(function(){return o(this,(function(t){return [2,this.unmuteUserWithUserId(e.userId)]}))}))},n$1.prototype.unmuteUserWithUserId=function(e){return i(this,void 0,void 0,(function(){var t,n;return o(this,(function(r){switch(r.label){case 0:return Qi$1(w("string",e)).throw(v$1.invalidParameters),t=_o.of(this._iid).requestQueue,n=new gn({channelUrl:this.url,channelType:this.channelType,userId:e}),[4,t.send(n)];case 1:return r.sent(),[2]}}))}))},n$1.prototype.banUser=function(e,t,n){return i(this,void 0,void 0,(function(){return o(this,(function(r){return [2,this.banUserWithUserId(e.userId,t,n)]}))}))},n$1.prototype.banUserWithUserId=function(e,t,n){return i(this,void 0,void 0,(function(){var r,i;return o(this,(function(s){switch(s.label){case 0:return Qi$1(w("string",e)&&w("number",t,!0)&&w("string",n,!0)).throw(v$1.invalidParameters),r=_o.of(this._iid).requestQueue,i=new In({channelUrl:this.url,channelType:this.channelType,userId:e,seconds:t,description:n}),[4,r.send(i)];case 1:return s.sent(),[2]}}))}))},n$1.prototype.unbanUser=function(e){return i(this,void 0,void 0,(function(){return o(this,(function(t){return [2,this.unbanUserWithUserId(e.userId)]}))}))},n$1.prototype.unbanUserWithUserId=function(e){return i(this,void 0,void 0,(function(){var t,n;return o(this,(function(r){switch(r.label){case 0:return Qi$1(w("string",e)).throw(v$1.invalidParameters),t=_o.of(this._iid).requestQueue,n=new Tn({channelUrl:this.url,channelType:this.channelType,userId:e}),[4,t.send(n)];case 1:return r.sent(),[2]}}))}))},n$1.prototype.freeze=function(){return i(this,void 0,void 0,(function(){var e,t;return o(this,(function(n){switch(n.label){case 0:return e=_o.of(this._iid).requestQueue,t=new Mn({channelUrl:this.url,channelType:this.channelType,freezing:!0}),[4,e.send(t)];case 1:return n.sent(),this.isFrozen=!0,[2]}}))}))},n$1.prototype.unfreeze=function(){return i(this,void 0,void 0,(function(){var e,t;return o(this,(function(n){switch(n.label){case 0:return e=_o.of(this._iid).requestQueue,t=new Mn({channelUrl:this.url,channelType:this.channelType,freezing:!1}),[4,e.send(t)];case 1:return n.sent(),this.isFrozen=!1,[2]}}))}))},n$1.prototype.getMessagesByMessageId=function(e,t){return i(this,void 0,void 0,(function(){var n$1;return o(this,(function(r){switch(r.label){case 0:return n$1=n(n({},rt),t),Qi$1(w("number",e)&&it$1(n$1)).throw(v$1.invalidParameters),[4,Zi.of(this._iid).getMessagesByMessageId(this.url,this.channelType,e,n$1)];case 1:return [2,r.sent()]}}))}))},n$1.prototype.getMessagesByTimestamp=function(e,t){return i(this,void 0,void 0,(function(){var n$1;return o(this,(function(r){switch(r.label){case 0:return n$1=n(n({},rt),t),Qi$1(w("number",e)&&it$1(n$1)).throw(v$1.invalidParameters),[4,Zi.of(this._iid).getMessagesByTimestamp(this.url,this.channelType,e,n$1)];case 1:return [2,r.sent()]}}))}))},n$1.prototype.getMessageChangeLogsSinceTimestamp=function(e,t){return void 0===t&&(t={}),i(this,void 0,void 0,(function(){var n$1;return o(this,(function(r){switch(r.label){case 0:return n$1=n(n({},st$1),t),Qi$1(w("number",e)&&at$1(n$1)).throw(v$1.invalidParameters),[4,Zi.of(this._iid).getMessageChangelogs(this.url,this.channelType,e,n$1)];case 1:return [2,r.sent()]}}))}))},n$1.prototype.getMessageChangeLogsSinceToken=function(e,t){return void 0===t&&(t={}),i(this,void 0,void 0,(function(){var n$1;return o(this,(function(r){switch(r.label){case 0:return n$1=n(n({},st$1),t),Qi$1(w("string",e)&&at$1(n$1)).throw(v$1.invalidParameters),[4,Zi.of(this._iid).getMessageChangelogs(this.url,this.channelType,e,n$1)];case 1:return [2,r.sent()]}}))}))},n$1.prototype._createPendingSendableMessagePayload=function(e,t,n){var i,s=_o.of(this._iid).sessionManager;return J($({channel_url:this.url,channel_type:this.channelType,msg_id:0,parent_message_id:e.parentMessageId,data:e.data,custom_type:e.customType,mention_type:e.mentionType,sorted_metaarray:e.metaArrays?e.metaArrays.map((function(e){return Oe.payloadify(e)})):null,apple_critical_alert_options:e.appleCriticalAlertOptions?ke.payloadify(e.appleCriticalAlertOptions):null,created_at:n,user:s.currentUser?Re.payloadify(s.currentUser):null,req_id:t,request_state:q.PENDING,mentioned_user_ids:e.mentionedUserIds,mentioned_users:null===(i=e.mentionedUsers)||void 0===i?void 0:i.map((function(e){return Xi$1.payloadify(e)}))}))},n$1.prototype._createPendingUserMessage=function(e,t,n$1){var i,s$1,a={};if(e.translationTargetLanguages)try{for(var u=s(e.translationTargetLanguages),c=u.next();!c.done;c=u.next()){a[c.value]="";}}catch(e){i={error:e};}finally{try{c&&!c.done&&(s$1=u.return)&&s$1.call(u);}finally{if(i)throw i.error}}var l=J(n(n({},this._createPendingSendableMessagePayload(e,t,n$1)),{type:P.USER,message:e.message,translations:a})),d=new je(this._iid,l);return d.messageParams=e,d},n$1.prototype._createPendingScheduledUserMessage=function(e,t,n){var r=this._createPendingUserMessage(e,t,n);return r.scheduledInfo={scheduledMessageId:0,scheduledAt:e.scheduledAt,scheduledMessageParams:e},r},n$1.prototype._createPendingFileMessage=function(e,t,n$1){var i,s,a,u,c,l,d=J(n(n({},this._createPendingSendableMessagePayload(e,t,n$1)),{type:P.FILE,url:e.fileUrl,file:{name:null!==(i=e.fileName)&&void 0!==i?i:null===(s=e.file)||void 0===s?void 0:s.name,size:null!==(a=e.fileSize)&&void 0!==a?a:null===(u=e.file)||void 0===u?void 0:u.size,type:null!==(c=e.mimeType)&&void 0!==c?c:null===(l=e.file)||void 0===l?void 0:l.type,data:e.data},thumbnails:e.thumbnailSizes?e.thumbnailSizes.map((function(e){return {url:"",width:e.maxWidth,height:e.maxHeight}})):[]})),h=new He(this._iid,d);return h.messageParams=e,h},n$1.prototype._createPendingMultipleFilesMessage=function(e,t,n$1){var i=J(n(n({},this._createPendingSendableMessagePayload(e,t,n$1)),{type:P.FILE})),s=new Ge(this._iid,i);return s.messageParams=e,s},n$1.prototype._createPendingScheduledFileMessage=function(e,t,n){var r=this._createPendingFileMessage(e,t,n);return r.scheduledInfo={scheduledMessageId:0,scheduledAt:e.scheduledAt,scheduledMessageParams:e},r},n$1.prototype._markMessageAsFailed=function(e,t,n){void 0===n&&(n=!1),e.errorCode=t.code,t.code===u.REQUEST_CANCELED||t.code===u.FILE_UPLOAD_CANCEL_FAILED?e.sendingStatus=q.CANCELED:n||(e.sendingStatus=q.FAILED);},n$1.prototype.sendUserMessage=function(e){var t=n(n({},Tt$1),e);return Qi$1(wt$1(t)).throw(v$1.invalidParameters),this._sendUserMessage(t)},n$1.prototype._sendUserMessage=function(e,t,n$1){var r=this;void 0===n$1&&(n$1=!1);var i$1=_o.of(this._iid),s=i$1.dispatcher,a=i$1.requestQueue,u=null!=t?t:this._generateRequestId(),c=Date.now(),l=new gt$1;return u||(u=this._generateRequestId()),Ei$1(2).then((function(){var t=r._createPendingUserMessage(e,u,c);s.dispatch(new No({messages:[t],source:n$1?po.LOCAL_MESSAGE_RESEND_STARTED:po.EVENT_MESSAGE_SENT_PENDING})),bi$1((function(){return i(r,void 0,void 0,(function(){return o(this,(function(e){return [2,l._trigger(t)]}))}))}));var i$1=new On(n(n({},e),{channelUrl:r.url,channelType:r.channelType,reqId:u}));a.send(i$1).then((function(e){var t=e.as(Cn).message;s.dispatch(new No({messages:[t],source:po.EVENT_MESSAGE_SENT_SUCCESS})),bi$1((function(){return i(r,void 0,void 0,(function(){return o(this,(function(e){return [2,l._trigger(t)]}))}))}));})).catch((function(t){if(g$1(t))throw t;Ei$1(2).then((function(){var n=r._createPendingUserMessage(e,u,c),i$1=_o.of(r._iid).cacheContext.localCacheEnabled&&C$1(t.code);r._markMessageAsFailed(n,t,i$1),s.dispatch(new No({messages:[n],source:n.sendingStatus===q.PENDING?po.REQUEST_RESEND_MESSAGE:po.EVENT_MESSAGE_SENT_FAILED})),bi$1((function(){return i(r,void 0,void 0,(function(){return o(this,(function(e){return [2,l._triggerFailed(t,n)]}))}))}));}));}));})),l},n$1.prototype._autoResendUserMessage=function(e){return Qi$1(e instanceof je&&!!e.messageParams).throw(v$1.invalidParameters),this._sendUserMessage(e.messageParams,e.reqId)},n$1.prototype.resendUserMessage=function(e){var t;return i(this,void 0,void 0,(function(){var n,i;return o(this,(function(s){return Qi$1(e instanceof je&&!e.scheduledInfo).throw(v$1.invalidParameters),n=new oi$1,i=null!==(t=e.messageParams)&&void 0!==t?t:function(e){var t;return J($({data:e.data,customType:e.customType,mentionType:e.mentionType,mentionedUsers:e.mentionedUsers,mentionedUserIds:e.mentionedUserIds,mentionedMessageTemplate:e.mentionedMessageTemplate,metaArrays:e.metaArrays,pollId:null===(t=e.poll)||void 0===t?void 0:t.id,parentMessageId:e.parentMessageId,appleCriticalAlertOptions:e.appleCriticalAlertOptions,message:e.message,translationTargetLanguages:Object.keys(e.translations)}))}(e),this._sendUserMessage(i,e.reqId,!0).onFailed((function(e){return n.reject(e)})).onSucceeded((function(e){return n.resolve(e)})),[2,n.promise]}))}))},n$1.prototype.updateUserMessage=function(e,t){return i(this,void 0,void 0,(function(){var n$1,r,i,s;return o(this,(function(a){switch(a.label){case 0:return n$1=n(n({},kt$1),t),Qi$1(w("number",e)&&Rt$1(n$1)).throw(v$1.invalidParameters),r=_o.of(this._iid).requestQueue,i=new Pn(n({channelType:this.channelType,channelUrl:this.url,messageId:e},n$1)),[4,r.send(i)];case 1:return s=a.sent(),[2,s.as(kn).message]}}))}))},n$1.prototype.copyUserMessage=function(e,t){var r,i$1,s;return i(this,void 0,void 0,(function(){var u,c;return o(this,(function(l){return Qi$1(e instanceof n$1&&t instanceof je&&t.sendingStatus===q.SUCCEEDED&&this.url===t.channelUrl&&!t.scheduledInfo).throw(v$1.invalidParameters),Qi$1(!t.poll).throw(v$1.notSupportedError),u=new oi$1,c=null!==(r=t.messageParams)&&void 0!==r?r:$(n(n({},t),{mentionType:t.mentionType,mentionedUserIds:null!==(i$1=t.mentionedUserIds)&&void 0!==i$1?i$1:null===(s=t.mentionedUsers)||void 0===s?void 0:s.map((function(e){return e.userId})),translationTargetLanguages:Object.keys(t.translations),pushNotificationDeliveryOption:G.DEFAULT,parentMessageId:null,isReplyToChannel:!1,isPinnedMessage:!1})),e._sendUserMessage(c).onSucceeded((function(e){u.resolve(e);})).onFailed((function(e){return u.reject(e)})),[2,u.promise]}))}))},n$1.prototype.translateUserMessage=function(e,t){return i(this,void 0,void 0,(function(){var n,r,i;return o(this,(function(s){switch(s.label){case 0:return Qi$1(e instanceof je&&e.messageId>0&&S$1("string",t)).throw(v$1.invalidParameters),n=_o.of(this._iid).requestQueue,r=new Kn({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId,translationTargetLanguages:t}),[4,n.send(r)];case 1:return i=s.sent(),[2,i.as(jn).message]}}))}))},n$1.prototype._createScheduledUserMessage=function(e,t){var n$1=this,r=_o.of(this._iid).requestQueue,i$1=Date.now(),s=this._generateRequestId();Ei$1(2).then((function(){var r=n$1._createPendingScheduledUserMessage(e,s,i$1);bi$1((function(){return i(n$1,void 0,void 0,(function(){return o(this,(function(e){return [2,t._trigger(r)]}))}))}));}));var a=new Qn(n({reqId:s,channelType:this.channelType,channelUrl:this.url},e));r.send(a).then((function(e){var r=e.as(Gn).message;bi$1((function(){return i(n$1,void 0,void 0,(function(){return o(this,(function(e){return [2,t._trigger(r)]}))}))}));})).catch((function(r){if(g$1(r))throw r;Ei$1(2).then((function(){var a=n$1._createPendingScheduledUserMessage(e,s,i$1);n$1._markMessageAsFailed(a,r),bi$1((function(){return i(n$1,void 0,void 0,(function(){return o(this,(function(e){return [2,t._trigger(a)]}))}))}));}));}));},n$1.prototype.sendFileMessage=function(e){var t=n(n({},Ut$1),e);return Qi$1(Ot$1(t)).throw(v$1.invalidParameters),this._sendFileMessage(t)},n$1.prototype.sendMultipleFilesMessage=function(e){var t,n$1=n(n({},_r),e),r=_o.of(this._iid);Qi$1(function(e,t){return void 0===t&&(t=Pi$1),It$1(e)&&Array.isArray(e.fileInfoList)&&e.fileInfoList.length>=2&&e.fileInfoList.length<=t&&e.fileInfoList.every((function(e){return gr(e)}))}(n$1,null===(t=r.appInfo)||void 0===t?void 0:t.multipleFilesMessageFileCountLimit)).throw(v$1.invalidParameters);var i=!!e.fileInfoList.find((function(e){var t=r.appInfo.uploadSizeLimit;return e.file instanceof Blob&&e.file.size>t||e.fileSize>t}));return Qi$1(!i).throw(v$1.fileSizeLimitExceededError),this._sendMultipleFilesMessage(n$1)},n$1.prototype._sendFileMessage=function(e,t,n){var r=this;void 0===n&&(n=!1);var i$1=_o.of(this._iid).dispatcher,s=Zi.of(this._iid).fileMessageQueue,a=null!=t?t:this._generateRequestId(),o$1=Date.now(),u$1=new gt$1;return a||(a=this._generateRequestId()),Ei$1(2).then((function(){var t=r._createPendingFileMessage(e,a,o$1);i$1.dispatch(new No({messages:[t],source:n?po.LOCAL_MESSAGE_RESEND_STARTED:po.EVENT_MESSAGE_SENT_PENDING})),bi$1((function(){return i(r,void 0,void 0,(function(){return o(this,(function(e){return [2,u$1._trigger(t)]}))}))})),s.request(r,a,e).then((function(e){i$1.dispatch(new No({messages:[e],source:po.EVENT_MESSAGE_SENT_SUCCESS})),bi$1((function(){return i(r,void 0,void 0,(function(){return o(this,(function(t){return [2,u$1._trigger(e)]}))}))}));})).catch((function(t){if(g$1(t))throw t;Ei$1(2).then((function(){var n=r._createPendingFileMessage(e,a,o$1),s=_o.of(r._iid).cacheContext.localCacheEnabled&&C$1(t.code);r._markMessageAsFailed(n,t,s),i$1.dispatch(new No({messages:[n],source:n.sendingStatus===q.PENDING?po.REQUEST_RESEND_MESSAGE:t.code===u.FILE_UPLOAD_CANCEL_FAILED?po.LOCAL_MESSAGE_CANCELED:po.EVENT_MESSAGE_SENT_FAILED})),bi$1((function(){return i(r,void 0,void 0,(function(){return o(this,(function(e){return [2,u$1._triggerFailed(t,n)]}))}))}));}));}));})),u$1},n$1.prototype._autoResendFileMessage=function(e){Qi$1(e instanceof He&&!!e.messageParams).throw(v$1.invalidParameters);var t=_o.of(this._iid).logger;return t.debug("autoResendFileMessage pending",e),this._sendFileMessage(e.messageParams,e.reqId).onFailed((function(e){t.debug("autoResendFileMessage failed",e);})).onSucceeded((function(e){t.debug("autoResendFileMessage success",e);}))},n$1.prototype._sendMultipleFilesMessage=function(e,t){var n=this,r=_o.of(this._iid).dispatcher,i$1=Zi.of(this._iid).fileMessageQueue,s=null!=t?t:this._generateRequestId(),a=Date.now(),o$1=new br;return s||(s=this._generateRequestId()),Ei$1(2).then((function(){var t=n._createPendingMultipleFilesMessage(e,s,a);r.dispatch(new No({messages:[t],source:po.EVENT_MESSAGE_SENT_PENDING})),bi$1((function(){return i(n,void 0,void 0,(function(){return o(this,(function(e){return [2,o$1._trigger(t)]}))}))})),i$1.request(n,s,e,o$1).then((function(e){r.dispatch(new No({messages:[e],source:po.EVENT_MESSAGE_SENT_SUCCESS})),bi$1((function(){return i(n,void 0,void 0,(function(){return o(this,(function(t){return [2,o$1._trigger(e)]}))}))}));})).catch((function(t){if(g$1(t))throw t;Ei$1(2).then((function(){var i$1=n._createPendingMultipleFilesMessage(e,s,a);n._markMessageAsFailed(i$1,t),r.dispatch(new No({messages:[i$1],source:po.EVENT_MESSAGE_SENT_FAILED})),bi$1((function(){return i(n,void 0,void 0,(function(){return o(this,(function(e){return [2,o$1._triggerFailed(t,i$1)]}))}))}));}));}));})),o$1},n$1.prototype._createScheduledFileMessage=function(e,t,n$1,r){var i$1=this,s=_o.of(this._iid).requestQueue,a=new Vn(n(n({reqId:n$1,channelType:this.channelType,channelUrl:this.url},e),{fileUrl:e.fileUrl,requireAuth:e.requireAuth}));s.send(a).then((function(e){var n=e.as(Wn).message;bi$1((function(){return i(i$1,void 0,void 0,(function(){return o(this,(function(e){return [2,t._trigger(n)]}))}))}));})).catch((function(s){if(g$1(s))throw s;Ei$1(2).then((function(){var a=i$1._createPendingScheduledFileMessage(e,n$1,r);i$1._markMessageAsFailed(a,s),bi$1((function(){return i(i$1,void 0,void 0,(function(){return o(this,(function(e){return [2,t._triggerFailed(s,a)]}))}))}));}));}));},n$1.prototype.sendFileMessages=function(e){var t,n$1;Qi$1(e.every((function(e){return Ot$1(n(n({},Ut$1),e))}))).throw(v$1.invalidParameters);var r=new gt$1;try{for(var i=s(e),s$1=i.next();!s$1.done;s$1=i.next()){var a=s$1.value;this.sendFileMessage(a).onPending((function(e){return r._trigger(e)})).onFailed((function(e,t){return r._triggerFailed(e,t)})).onSucceeded((function(e){return r._trigger(e)}));}}catch(e){t={error:e};}finally{try{s$1&&!s$1.done&&(n$1=i.return)&&n$1.call(i);}finally{if(t)throw t.error}}return r},n$1.prototype.resendFileMessage=function(e,t){var n;return i(this,void 0,void 0,(function(){var i,s,o$1;return o(this,(function(u){return i=Boolean(e.url)||k(t)||k(null===(n=e.messageParams)||void 0===n?void 0:n.file),Qi$1(e instanceof He&&i&&!e.scheduledInfo).throw(v$1.invalidParameters),s=new oi$1,o$1=function(e,t){var n;return e.messageParams?(!e.url&&k(t)&&(e.messageParams.file=t),e.messageParams):J($({data:e.data,customType:e.customType,mentionType:e.mentionType,mentionedUsers:e.mentionedUsers,mentionedUserIds:e.mentionedUserIds,metaArrays:e.metaArrays,parentMessageId:e.parentMessageId,appleCriticalAlertOptions:e.appleCriticalAlertOptions,file:t,fileUrl:e.url,fileName:e.name,fileSize:e.size,mimeType:e.type,thumbnailSizes:null===(n=e.thumbnails)||void 0===n?void 0:n.map((function(e){return {maxWidth:e.width,maxHeight:e.height}}))}))}(e,t),this._sendFileMessage(o$1,e.reqId,!0).onFailed((function(e){return s.reject(e)})).onSucceeded((function(e){return s.resolve(e)})),[2,s.promise]}))}))},n$1.prototype.updateFileMessage=function(e,t){return i(this,void 0,void 0,(function(){var n$1,r,i,s;return o(this,(function(a){switch(a.label){case 0:return n$1=n(n({},xt$1),t),Qi$1(w("number",e)&&function(e){return Pt$1(e)}(n$1)).throw(v$1.invalidParameters),r=_o.of(this._iid).requestQueue,i=new Rn(n({channelType:this.channelType,channelUrl:this.url,messageId:e},n$1)),[4,r.send(i)];case 1:return s=a.sent(),[2,s.as(xn).message]}}))}))},n$1.prototype.cancelUploadingFileMessage=function(e){return i(this,void 0,void 0,(function(){return o(this,(function(t){return Qi$1(w("string",e)).throw(v$1.invalidParameters),Zi.of(this._iid).fileMessageQueue.cancel(this,e),[2,!0]}))}))},n$1.prototype.copyFileMessage=function(e,t){var r,i$1,s;return i(this,void 0,void 0,(function(){var u,c;return o(this,(function(l){return Qi$1(e instanceof n$1&&t instanceof He&&t.sendingStatus===q.SUCCEEDED&&this.url===t.channelUrl&&!t.scheduledInfo).throw(v$1.invalidParameters),u=new oi$1,c=$(n(n({},t),{fileUrl:t.url,fileName:t.name,fileSize:t.size,mimeType:t.type,mentionType:t.mentionType,mentionedUserIds:null!==(r=t.mentionedUserIds)&&void 0!==r?r:null===(i$1=t.mentionedUsers)||void 0===i$1?void 0:i$1.map((function(e){return e.userId})),pushNotificationDeliveryOption:G.DEFAULT,parentMessageId:null,isReplyToChannel:!1,thumbnailSizes:null===(s=t.thumbnails)||void 0===s?void 0:s.map((function(e){return {maxWidth:e.width,maxHeight:e.height}})),requireAuth:t.requireAuth,isPinnedMessage:!1})),e._sendFileMessage(c).onSucceeded((function(e){return u.resolve(e)})).onFailed((function(e){return u.reject(e)})),[2,u.promise]}))}))},n$1.prototype.deleteMessage=function(e){return i(this,void 0,void 0,(function(){var t,n;return o(this,(function(r){switch(r.label){case 0:return Qi$1(e instanceof Le).throw(v$1.invalidParameters),e.messageId>0?(t=_o.of(this._iid).requestQueue,n=new Ln({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId}),[4,t.send(n)]):[3,2];case 1:r.sent(),r.label=2;case 2:return [2]}}))}))},n$1.prototype.addReaction=function(e,t){return i(this,void 0,void 0,(function(){var n,r,i;return o(this,(function(s){switch(s.label){case 0:return Qi$1(e instanceof Le&&e.messageId>0&&w("string",t)).throw(v$1.invalidParameters),n=_o.of(this._iid).requestQueue,r=new qn({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId,reactionKey:t}),[4,n.send(r)];case 1:return i=s.sent(),[2,i.as(Fn).reactionEvent]}}))}))},n$1.prototype.deleteReaction=function(e,t){return i(this,void 0,void 0,(function(){var n,r,i;return o(this,(function(s){switch(s.label){case 0:return Qi$1(e instanceof Le&&e.messageId>0&&w("string",t)).throw(v$1.invalidParameters),n=_o.of(this._iid).requestQueue,r=new zn({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId,reactionKey:t}),[4,n.send(r)];case 1:return i=s.sent(),[2,i.as(Bn).reactionEvent]}}))}))},n$1.prototype._updateUserMessageMetaArray=function(e,t,n,r){return i(this,void 0,void 0,(function(){var i,s,a,o$1,u,c;return o(this,(function(l){switch(l.label){case 0:return i=_o.of(this._iid),s=i.dispatcher,a=i.requestQueue,o$1=new Pn({channelType:this.channelType,channelUrl:this.url,messageId:e,metaArrayParams:{array:t,mode:n,upsert:r}}),[4,a.send(o$1)];case 1:return u=l.sent(),c=u.as(kn).message,s.dispatch(new No({messages:[c],source:po.EVENT_MESSAGE_UPDATED})),[2,c]}}))}))},n$1.prototype._updateFileMessageMetaArray=function(e,t,n,r){return i(this,void 0,void 0,(function(){var i,s,a,o$1,u,c;return o(this,(function(l){switch(l.label){case 0:return i=_o.of(this._iid),s=i.dispatcher,a=i.requestQueue,o$1=new Rn({channelType:this.channelType,channelUrl:this.url,messageId:e,metaArrayParams:{array:t,mode:n,upsert:r}}),[4,a.send(o$1)];case 1:return u=l.sent(),c=u.as(xn).message,s.dispatch(new No({messages:[c],source:po.EVENT_MESSAGE_UPDATED})),[2,c]}}))}))},n$1.prototype.createMessageMetaArrayKeys=function(e,t){return i(this,void 0,void 0,(function(){var n;return o(this,(function(r){return Qi$1(e instanceof Le&&e.messageId>0&&S$1("string",t)).throw(v$1.invalidParameters),n=t.map((function(e){return new Oe({key:e})})),e instanceof He?[2,this._updateFileMessageMetaArray(e.messageId,n,"add",!0)]:[2,this._updateUserMessageMetaArray(e.messageId,n,"add",!0)]}))}))},n$1.prototype.deleteMessageMetaArrayKeys=function(e,t){return i(this,void 0,void 0,(function(){var n;return o(this,(function(r){return Qi$1(e instanceof Le&&e.messageId>0&&S$1("string",t)).throw(v$1.invalidParameters),n=t.map((function(e){return new Oe({key:e})})),e instanceof He?[2,this._updateFileMessageMetaArray(e.messageId,n,"remove",!0)]:[2,this._updateUserMessageMetaArray(e.messageId,n,"remove",!0)]}))}))},n$1.prototype.addMessageMetaArrayValues=function(e,t){return i(this,void 0,void 0,(function(){return o(this,(function(n){return Qi$1(e instanceof Le&&e.messageId>0&&t.every((function(e){return e instanceof Oe}))).throw(v$1.invalidParameters),e instanceof He?[2,this._updateFileMessageMetaArray(e.messageId,t,"add",!0)]:[2,this._updateUserMessageMetaArray(e.messageId,t,"add",!0)]}))}))},n$1.prototype.removeMessageMetaArrayValues=function(e,t){return i(this,void 0,void 0,(function(){return o(this,(function(n){return Qi$1(e instanceof Le&&e.messageId>0&&t.every((function(e){return e instanceof Oe}))).throw(v$1.invalidParameters),e instanceof He?[2,this._updateFileMessageMetaArray(e.messageId,t,"remove",!0)]:[2,this._updateUserMessageMetaArray(e.messageId,t,"remove",!0)]}))}))},n$1.prototype.report=function(e,t){return i(this,void 0,void 0,(function(){var n,r,i,s;return o(this,(function(a){switch(a.label){case 0:return Qi$1(N$1(Mt$1,e)&&w("string",t)).throw(v$1.invalidParameters),n=_o.of(this._iid),r=n.sdkState,i=n.requestQueue,s=new An({channelUrl:this.url,channelType:this.channelType,userId:r.userId,category:e,description:t}),[4,i.send(s)];case 1:return a.sent(),[2]}}))}))},n$1.prototype.reportUser=function(e,t,n){return i(this,void 0,void 0,(function(){var r,i,s,a;return o(this,(function(o){switch(o.label){case 0:return Qi$1(e instanceof Xi$1&&N$1(Mt$1,t)&&w("string",n)).throw(v$1.invalidParameters),r=_o.of(this._iid),i=r.sdkState,s=r.requestQueue,a=new Nn({channelUrl:this.url,channelType:this.channelType,userId:i.userId,offendingUserId:e.userId,category:t,description:n}),[4,s.send(a)];case 1:return o.sent(),[2]}}))}))},n$1.prototype.reportMessage=function(e,t,n){return i(this,void 0,void 0,(function(){var r,i,s,a;return o(this,(function(o){switch(o.label){case 0:return Qi$1(e instanceof De&&N$1(Mt$1,t)&&w("string",n)).throw(v$1.invalidParameters),r=_o.of(this._iid),i=r.sdkState,s=r.requestQueue,a=new Un({channelUrl:this.url,channelType:this.channelType,userId:i.userId,offendingUserId:e.sender.userId,messageId:e.messageId,category:t,description:n}),[4,s.send(a)];case 1:return o.sent(),[2]}}))}))},n$1.prototype.updatePoll=function(e,t){return i(this,void 0,void 0,(function(){var n$1,r,i;return o(this,(function(s){switch(s.label){case 0:return Qi$1(w("number",e)&&function(e){return w("string",e.title,!0)&&vo(e.data)&&w("boolean",e.allowUserSuggestion,!0)&&w("boolean",e.allowMultipleVotes,!0)&&w("number",e.closeAt,!0)}(t)).throw(v$1.invalidParameters),n$1=_o.of(this._iid).requestQueue,r=new Hn(n({pollId:e},t)),[4,n$1.send(r)];case 1:return i=s.sent(),[2,i.as(Yn).poll]}}))}))},n$1.prototype.deletePoll=function(e){return i(this,void 0,void 0,(function(){var t,n,r;return o(this,(function(i){switch(i.label){case 0:return t=w("number",e),Qi$1(t).throw(v$1.invalidParameters),n=_o.of(this._iid).requestQueue,r=new Jn({pollId:e}),[4,n.send(r)];case 1:return i.sent(),[2]}}))}))},n$1.prototype.closePoll=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i;return o(this,(function(s){switch(s.label){case 0:return t=w("number",e),Qi$1(t).throw(v$1.invalidParameters),n=_o.of(this._iid).requestQueue,r=new Xn({pollId:e}),[4,n.send(r)];case 1:return i=s.sent(),[2,i.as(Zn).poll]}}))}))},n$1.prototype.addPollOption=function(e,t){return i(this,void 0,void 0,(function(){var n,r,i,s;return o(this,(function(a){switch(a.label){case 0:return n=w("number",e)&&w("string",t)&&""!==t.trim(),Qi$1(n).throw(v$1.invalidParameters),r=_o.of(this._iid).requestQueue,i=new $n({channelUrl:this.url,channelType:this.channelType,pollId:e,optionText:t}),[4,r.send(i)];case 1:return s=a.sent(),[2,s.as(er).poll]}}))}))},n$1.prototype.updatePollOption=function(e,t,n){return i(this,void 0,void 0,(function(){var r,i,s,a;return o(this,(function(o){switch(o.label){case 0:return r=w("number",e)&&w("number",t)&&w("string",n)&&""!==n.trim(),Qi$1(r).throw(v$1.invalidParameters),i=_o.of(this._iid).requestQueue,s=new tr({pollId:e,pollOptionId:t,optionText:n}),[4,i.send(s)];case 1:return a=o.sent(),[2,a.as(nr).poll]}}))}))},n$1.prototype.deletePollOption=function(e,t){return i(this,void 0,void 0,(function(){var n,r,i;return o(this,(function(s){switch(s.label){case 0:return n=w("number",e)&&w("number",t),Qi$1(n).throw(v$1.invalidParameters),r=_o.of(this._iid).requestQueue,i=new rr({pollId:e,pollOptionId:t}),[4,r.send(i)];case 1:return s.sent(),[2]}}))}))},n$1.prototype.votePoll=function(e,t){return i(this,void 0,void 0,(function(){var n,r,i,s,a,o$1,u;return o(this,(function(c){switch(c.label){case 0:return n=w("number",e)&&S$1("number",t),Qi$1(n).throw(v$1.invalidParameters),r=_o.of(this._iid),i=r.requestQueue,s=r.dispatcher,a=new sr({reqId:this._generateRequestId(),channelUrl:this.url,channelType:this.channelType,pollId:e,pollOptionIds:t}),[4,i.send(a)];case 1:return o$1=c.sent(),u=o$1.as(ar).event,s.dispatch(new ko({event:u,source:po.EVENT_POLL_VOTED})),[2,u]}}))}))},n$1.prototype.getPollChangeLogsSinceTimestamp=function(e){return i(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return Qi$1(w("number",e)).throw(v$1.invalidParameters),[4,Zo.of(this._iid).getPollChangeLogs(this.url,this.channelType,e)];case 1:return [2,t.sent()]}}))}))},n$1.prototype.getPollChangeLogsSinceToken=function(e){return i(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return Qi$1(w("string",e,!0)),[4,Zo.of(this._iid).getPollChangeLogs(this.url,this.channelType,e)];case 1:return [2,t.sent()]}}))}))},n$1.prototype.createPollListQuery=function(e){return void 0===e&&(e=10),new Yo(this._iid,{channelUrl:this.url,channelType:this.channelType,limit:e})},n$1.prototype.createPollVoterListQuery=function(e,t,n){return void 0===n&&(n=20),new $o(this._iid,{channelUrl:this.url,channelType:this.channelType,pollId:e,pollOptionId:t,limit:n})},n$1})(Fi);var Tr=function(t$1){function n(e){void 0===e&&(e={});var n=t$1.call(this)||this;return Object.keys(e).forEach((function(t){n.hasOwnProperty(t)&&(n[t]=e[t]);})),n}return t(n,t$1),n}((function(){this.onConnected=ze$1,this.onReconnectStarted=ze$1,this.onReconnectSucceeded=ze$1,this.onReconnectFailed=ze$1,this.onDisconnected=ze$1;})),wr=function(t$1){function n(e){void 0===e&&(e={});var n=t$1.call(this)||this;return Object.keys(e).forEach((function(t){n.hasOwnProperty(t)&&(n[t]=e[t]);})),n}return t(n,t$1),n}((function(){this.onSessionExpired=ze$1,this.onSessionTokenRequired=function(e){return e(null)},this.onSessionError=ze$1,this.onSessionRefreshed=ze$1,this.onSessionClosed=ze$1;})),Mr=function(t$1){function n(e){void 0===e&&(e={});var n=t$1.call(this)||this;return Object.keys(e).forEach((function(t){n.hasOwnProperty(t)&&(n[t]=e[t]);})),n}return t(n,t$1),n}((function(){this.onFriendsDiscovered=ze$1,this.onTotalUnreadMessageCountChanged=ze$1,this.onTotalUnreadMessageCountUpdated=ze$1;})),Sr=function(n){function i(e){var i=e.limit,s=e.token,a=e.userIdsFilter,o=e.metaDataKeyFilter,u=e.metaDataValuesFilter,c=e.nicknameStartsWithFilter,l=n.call(this)||this;return l.method=ee.GET,l.path=ne,l.params=J({limit:i,token:s,user_ids:a,metadatakey:o,metadatavalues_in:u,nickname_startswith:c}),l}return t(i,n),i}(Ne$1),Ar=function(t$1){function n(e,n){var r=t$1.call(this,e,n)||this;return r.users=n.users.map((function(t){return new Xi$1(e,t)})),r.next=n.next,r}return t(n,t$1),n}(Te$1),Nr=function(t$1){function n$1(e,n){var r,i,s,a=this;return (a=t$1.call(this,e,n)||this).userIdsFilter=null,a.metaDataKeyFilter=null,a.metaDataValuesFilter=null,a.nicknameStartsWithFilter=null,a.userIdsFilter=null!==(r=n.userIdsFilter)&&void 0!==r?r:null,a.metaDataKeyFilter=null!==(i=n.metaDataKeyFilter)&&void 0!==i?i:null,a.metaDataValuesFilter=null!==(s=n.metaDataValuesFilter)&&void 0!==s?s:null,a.nicknameStartsWithFilter=n.nicknameStartsWithFilter||null,a}return t(n$1,t$1),n$1.prototype._validate=function(){return t$1.prototype._validate.call(this)&&S$1("string",this.userIdsFilter,!0)&&w("string",this.metaDataKeyFilter,!0)&&S$1("string",this.metaDataValuesFilter,!0)&&w("string",this.metaDataKeyFilter,!0)},n$1.prototype.next=function(){return i(this,void 0,void 0,(function(){var e,t,n$1,r,i,s;return o(this,(function(u){switch(u.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=_o.of(this._iid).requestQueue,t=new Sr($(n(n({},this),{token:this._token}))),[4,e.send(t)]):[3,2]:[3,5];case 1:return n$1=u.sent(),r=n$1.as(Ar),i=r.users,s=r.next,this._token=s,this._hasNext=!!s,this._isLoading=!1,[2,i];case 2:return [2,[]];case 3:throw v$1.queryInProgress;case 4:return [3,6];case 5:throw v$1.invalidParameters;case 6:return [2]}}))}))},n$1}(Oo),Ur=function(n){function i(e){var i=e.userId,s=e.limit,a=e.token,o=e.userIdsFilter,u=n.call(this)||this;return u.method=ee.GET,u.path="".concat(ne,"/").concat(i,"/block"),u.params=J({limit:s,token:a,user_ids:o}),u}return t(i,n),i}(Ne$1),Or=function(t$1){function n(e,n){var r=t$1.call(this,e,n)||this;return r.users=n.users.map((function(t){return new Xi$1(e,t)})),r.next=n.next,r}return t(n,t$1),n}(Te$1),Cr=function(t$1){function n$1(e,n){var r,i=this;return (i=t$1.call(this,e,n)||this).userIdsFilter=null,i.userIdsFilter=null!==(r=n.userIdsFilter)&&void 0!==r?r:null,i}return t(n$1,t$1),n$1.prototype._validate=function(){return t$1.prototype._validate.call(this)&&S$1("string",this.userIdsFilter,!0)},n$1.prototype.next=function(){return i(this,void 0,void 0,(function(){var e,t,n$1,r,i,s,u,c;return o(this,(function(l){switch(l.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=_o.of(this._iid),t=e.sdkState,n$1=e.requestQueue,r=new Ur($(n(n({},this),{userId:t.userId,token:this._token}))),[4,n$1.send(r)]):[3,2]:[3,5];case 1:return i=l.sent(),s=i.as(Or),u=s.users,c=s.next,this._token=c,this._hasNext=!!c,this._isLoading=!1,[2,u];case 2:return [2,[]];case 3:throw v$1.queryInProgress;case 4:return [3,6];case 5:throw v$1.invalidParameters;case 6:return [2]}}))}))},n$1}(Oo),Pr=function(n){function r(e){var r=e.userId,i=e.limit,s=e.token,a=n.call(this)||this;return a.method=ee.GET,a.path="".concat(ne,"/").concat(encodeURIComponent(r),"/friends"),a.params={limit:i,token:s},a}return t(r,n),r}(Ne$1),kr=function(t$1){function n(e,n){var r=t$1.call(this,e,n)||this;return r.hasMore=n.has_more,r.users=n.users.map((function(t){return new Xi$1(e,t)})),r.next=n.next,r}return t(n,t$1),n}(Te$1),Rr=function(t$1){function n$1(){return null!==t$1&&t$1.apply(this,arguments)||this}return t(n$1,t$1),n$1.prototype._validate=function(){return t$1.prototype._validate.call(this)},n$1.prototype.next=function(){return i(this,void 0,void 0,(function(){var e,t,n$1,r,i,s,a,u,c;return o(this,(function(l){switch(l.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=_o.of(this._iid),t=e.sdkState,n$1=e.requestQueue,r=new Pr(n(n({},this),{userId:t.userId,token:this._token})),[4,n$1.send(r)]):[3,2]:[3,5];case 1:return i=l.sent(),s=i.as(kr),a=s.users,u=s.hasMore,c=s.next,this._token=c,this._hasNext=u,this._isLoading=!1,[2,a];case 2:return [2,[]];case 3:throw v$1.queryInProgress;case 4:return [3,6];case 5:throw v$1.invalidParameters;case 6:return [2]}}))}))},n$1}(Oo),xr={},Lr=function(){function e(e){var t=e.dbname,n=e.itemSizeLimit,r=void 0===n?1048576:n,i=e.cacheLimit,s=void 0===i?256:i,a=e.blockHashBase,o=void 0===a?2:a,u=e.blockHashMultiplier,c=void 0===u?10:u,l=e.blockHashConstant,d=void 0===l?11:l,h=e.transactionApplyDelay,f=void 0===h?200:h,p=e.disableLogger,m=void 0!==p&&p;return xr[t]||(this.itemSizeLimit=r,this.cacheLimit=s,this.blockHashBase=o,this.blockHashMultiplier=c,this.blockHashConstant=d,this.transactionApplyDelay=f,this.disableLogger=m,xr[t]=this),xr[t]}return e.get=function(e){return xr[e]},e}();!function(e){e[e.UNKNOWN_ERROR=6e7]="UNKNOWN_ERROR",e[e.STORE_NOT_DEFINED=61001e3]="STORE_NOT_DEFINED",e[e.STORE_NOT_AVAILABLE=61001001]="STORE_NOT_AVAILABLE",e[e.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING=61001002]="STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING",e[e.STORE_IS_FULL=61001003]="STORE_IS_FULL",e[e.STORE_NOT_INITIALIZED=61001004]="STORE_NOT_INITIALIZED",e[e.STORE_INVALID_KEY_TYPE=61002e3]="STORE_INVALID_KEY_TYPE",e[e.STORE_BROKEN_INTEGRITY=61002001]="STORE_BROKEN_INTEGRITY",e[e.STORE_BROKEN_BLOB=61002002]="STORE_BROKEN_BLOB",e[e.STORE_ENCRYPTION_INVALID=61002003]="STORE_ENCRYPTION_INVALID",e[e.STORE_ITEM_SIZE_LIMIT_EXCEEDED=61017e3]="STORE_ITEM_SIZE_LIMIT_EXCEEDED",e[e.STORE_READ_FAILED=61017001]="STORE_READ_FAILED",e[e.STORE_WRITE_FAILED=61017002]="STORE_WRITE_FAILED",e[e.DATABASE_SCHEMA_NOT_ON_UPGRADE=62002e3]="DATABASE_SCHEMA_NOT_ON_UPGRADE",e[e.COLLECTION_NOT_READY=63001e3]="COLLECTION_NOT_READY",e[e.COLLECTION_KEY_NOT_MATCH=63002e3]="COLLECTION_KEY_NOT_MATCH",e[e.COLLECTION_QUERY_NOT_VALID=63002001]="COLLECTION_QUERY_NOT_VALID",e[e.COLLECTION_KEY_NOT_FOUND=63004e3]="COLLECTION_KEY_NOT_FOUND",e[e.COLLECTION_KEY_NOT_GIVEN=63004001]="COLLECTION_KEY_NOT_GIVEN",e[e.COLLECTION_INSERT_DUPLICATE=63009e3]="COLLECTION_INSERT_DUPLICATE",e[e.COLLECTION_WRITE_FAILED=63017e3]="COLLECTION_WRITE_FAILED",e[e.COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED=63017001]="COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED",e[e.INDEX_TABLE_IS_REQUIRED=65001e3]="INDEX_TABLE_IS_REQUIRED",e[e.INDEX_TYPE_NOT_MATCH=65002e3]="INDEX_TYPE_NOT_MATCH",e[e.COMPARE_TYPE_NOT_MATCH=69002001]="COMPARE_TYPE_NOT_MATCH",e[e.CIRCULAR_REFERENCE_FOUND=69002002]="CIRCULAR_REFERENCE_FOUND";}(ir||(ir={}));var Dr,qr=function(t$1){function n(e){var r=e.code,i=void 0===r?ir.UNKNOWN_ERROR:r,s=e.message,a=void 0===s?"Unknown error occurred.":s,o=t$1.call(this,a)||this;return o.code=i,Object.setPrototypeOf(o,n.prototype),o}return t(n,t$1),Object.defineProperty(n,"storeNotDefined",{get:function(){return new n({code:ir.STORE_NOT_DEFINED,message:"Store is not defined. Specify the store on NestDB()"})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"storeNotAvailable",{get:function(){return new n({code:ir.STORE_NOT_AVAILABLE,message:"Store is not available. Check your environment settings."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"storeNotAvailableInPrivateBrowsing",{get:function(){return new n({code:ir.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING,message:"Store is not available because it is in private browsing."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"storeIsFull",{get:function(){return new n({code:ir.STORE_IS_FULL,message:"Store is full."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"storeNotInitialized",{get:function(){return new n({code:ir.STORE_NOT_INITIALIZED,message:"Store is not initialized."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"storeKeyTypeIsInvalid",{get:function(){return new n({code:ir.STORE_INVALID_KEY_TYPE,message:"Store key should be string type."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"storeBrokenIntegrity",{get:function(){return new n({code:ir.STORE_BROKEN_INTEGRITY,message:"Data should be in a store but it does not. Integrity is broken."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"storeBrokenBlob",{get:function(){return new n({code:ir.STORE_BROKEN_BLOB,message:"Data should be in a store but it does not. Blob data is broken."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"storeEncryptionInvalid",{get:function(){return new n({code:ir.STORE_ENCRYPTION_INVALID,message:"Encryption algorithm has changed. All the store should reset."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"storeItemSizeExceeded",{get:function(){return new n({code:ir.STORE_ITEM_SIZE_LIMIT_EXCEEDED,message:"The size of the item exceeds the limit that the store allows."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"storeReadFailed",{get:function(){return new n({code:ir.STORE_READ_FAILED,message:"Failed to read from store."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"storeWriteFailed",{get:function(){return new n({code:ir.STORE_WRITE_FAILED,message:"Failed to write to store."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"databaseSchemaNotOnUpgrade",{get:function(){return new n({code:ir.DATABASE_SCHEMA_NOT_ON_UPGRADE,message:"Committing schema is not allowed when upgrade is not running."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"collectionNotReady",{get:function(){return new n({code:ir.COLLECTION_NOT_READY,message:"Collection is not ready due to an error during initialization."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"collectionKeyNotMatch",{get:function(){return new n({code:ir.COLLECTION_KEY_NOT_MATCH,message:"keyName of collection could not change."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"collectionQueryNotValid",{get:function(){return new n({code:ir.COLLECTION_QUERY_NOT_VALID,message:"Query parameter is not a valid format."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"collectionInsertDuplicate",{get:function(){return new n({code:ir.COLLECTION_INSERT_DUPLICATE,message:"The key already exists."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"collectionKeyNotFound",{get:function(){return new n({code:ir.COLLECTION_KEY_NOT_FOUND,message:"The key is not found."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"collectionKeyNotGiven",{get:function(){return new n({code:ir.COLLECTION_KEY_NOT_GIVEN,message:"The item should contain [keyName] property."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"collectionWriteFailed",{get:function(){return new n({code:ir.COLLECTION_WRITE_FAILED,message:"Failed to write an item."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"collectionItemSizeExceeded",{get:function(){return new n({code:ir.COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED,message:"The size of the item exceeds the limit that a collection allows."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"indexTableIsRequired",{get:function(){return new n({code:ir.INDEX_TABLE_IS_REQUIRED,message:"Index table is required."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"indexTypesNotMatch",{get:function(){return new n({code:ir.INDEX_TYPE_NOT_MATCH,message:"Indexed column should have primitive type."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"compareTypesNotMatch",{get:function(){return new n({code:ir.COMPARE_TYPE_NOT_MATCH,message:"Values to compare have different types."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"circularReferenceFound",{get:function(){return new n({code:ir.CIRCULAR_REFERENCE_FOUND,message:"Cannot handle circular referenced object."})},enumerable:!1,configurable:!0}),n}(Error);!function(e){e.INIT="init",e.READY="ready",e.CLOSED="closed";}(Dr||(Dr={}));var Fr,zr=function(e,t){if(void 0===t&&(t=new WeakMap),"object"==typeof e&&null!==e){if(t.has(e))throw qr.circularReferenceFound;t.set(e,!0);var n=void 0;if(Array.isArray(e))n=e.map((function(e){return zr(e,t)}));else if(e instanceof RegExp)n=e;else if(e instanceof Date)n=e;else for(var r in n={},e)n[r]=zr(e[r],t);return t.delete(e),n}return e},Br=function(e,t){if(null==t)return 1;if(null==e)return -1;if(typeof e!=typeof t)throw qr.compareTypesNotMatch;var n=0;switch(typeof e){case"boolean":case"number":n=e-t;break;case"string":n=e.localeCompare(t);}return n},Kr=function(e,t){for(var n=0,r=0;r<e.length;r++)n=e.charCodeAt(r)+(n<<6)+(n<<16)-n;return (n>>>0)%t},jr=function(e){return new Promise((function(t){setTimeout((function(){return t()}),e);}))},Qr=function(e,t){if(!t)return !1;if("function"!=typeof e){for(var n in e){if(["/and","&&"].includes(n)){if(e[n].some((function(e){return !Qr(e,t)})))return !1}else if(["/or","||"].includes(n)){if(e[n].every((function(e){return !Qr(e,t)})))return !1}else if("/where"===n){if(!(0, e[n])(t))return !1}else {var r=n;if("object"==typeof e[r]){var i=e[r];for(var s in i)switch(s){case"/eq":case"=":if((a=t[r])!==(o=i[s]))return !1;break;case"/neq":case"!=":if((a=t[r])===(o=i[s]))return !1;break;case"/gt":case">":var a=t[r],o=i[s];if(!(Br(a,o)>0))return !1;break;case"/gte":case">=":a=t[r],o=i[s];if(!(Br(a,o)>=0))return !1;break;case"/lt":case"<":a=t[r],o=i[s];if(!(Br(a,o)<0))return !1;break;case"/lte":case"<=":a=t[r],o=i[s];if(!(Br(a,o)<=0))return !1;break;case"/in":a=t[r];if(!(o=i[s]).includes(a))return !1;break;case"/nin":a=t[r];if((o=i[s]).includes(a))return !1;break;case"/contain":a=t[r],o=i[s];if(!a.includes(o))return !1;break;case"/regex":a=t[r];if(!(o=i[s]).test(a))return !1;break;case"/where":a=t[r];if(!(0, i[s])(a))return !1}}else if("function"==typeof e[r]){if(!e[r](t[r]))return !1}else if(e[r]!==t[r])return !1}}return !0}return e(t)},Gr=function(){},Vr=function(){return Promise.resolve()},Wr=function(e){return e},Hr=function(e,t){t();};!function(e){e[e.FORWARD=0]="FORWARD",e[e.BACKWARD=1]="BACKWARD";}(Fr||(Fr={}));var Yr,Jr,Xr,Zr=function(){function e(e){var t=e.initialPrevValue,n=void 0===t?null:t,r=e.initialNextValue,i=void 0===r?null:r,s=e.iterator,a=e.map,o=void 0===a?Wr:a,u=e.backward,c=void 0===u?Vr:u,l=e.forward,d=void 0===l?Vr:l,h=e.complete,f=void 0===h?Gr:h;this._prevValue=n,this._nextValue=i,this._error=null,this._map=o,this._backward=c,this._forward=d,this._iterator=s,this._complete=f;}return Object.defineProperty(e.prototype,"prevValue",{get:function(){return this._map(this._prevValue)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nextValue",{get:function(){return this._map(this._nextValue)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"error",{get:function(){return this._error},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasPrevious",{get:function(){return !!this._prevValue},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasNext",{get:function(){return !!this._nextValue},enumerable:!1,configurable:!0}),e.prototype.prev=function(){return i(this,void 0,void 0,(function(){var e,t,n;return o(this,(function(r){switch(r.label){case 0:if(!this.hasPrevious)return [3,6];r.label=1;case 1:return r.trys.push([1,3,,4]),e=this._prevValue,t=this,[4,this._backward()];case 2:return t._prevValue=r.sent()||null,this._nextValue=e,[3,4];case 3:return n=r.sent(),this._error=n,[3,4];case 4:return [4,this._iterator(this)];case 5:return [2,r.sent()];case 6:this._complete(),r.label=7;case 7:return [2]}}))}))},e.prototype.next=function(){return i(this,void 0,void 0,(function(){var e,t,n;return o(this,(function(r){switch(r.label){case 0:if(!this.hasNext)return [3,6];r.label=1;case 1:return r.trys.push([1,3,,4]),e=this._nextValue,t=this,[4,this._forward()];case 2:return t._nextValue=r.sent()||null,this._prevValue=e,[3,4];case 3:return n=r.sent(),this._error=n,[3,4];case 4:return [4,this._iterator(this)];case 5:return [2,r.sent()];case 6:this._complete(),r.label=7;case 7:return [2]}}))}))},e.prototype.stop=function(){this._prevValue=null,this._nextValue=null,this._complete();},e}(),$r=function(){function e(e){var t=e.condition,n=void 0===t?{}:t,r=e.backward,i=void 0!==r&&r,s=e.blockManager,a=e.indexer;this.condition=n,this.backward=i,this._blockManager=s,this._indexer=a;}return e.prototype.findOptimizedStartPosition=function(){var e=this,t=["=","/eq",">",">=","/gt","/gte"],n=["=","/eq","<","<=","/lt","/lte"];if(this.backward){var r=this._indexer.origin.length-1;if("function"!=typeof this.condition)for(var i in this._indexer.fields){var s=this._indexer.fields[i],a=1;if("-"===s[0]&&(s=s.slice(1),a=-1),this.condition[s])if("object"==typeof this.condition[s]){var o=a>0?n:t;for(var u in this.condition[s])if(o.includes(u))for(var c=r;c>=0;c--)if(a*Br(this._indexer.origin[c].columnValues[i],this.condition[s][u])<=0){r=c;break}}else for(c=r;c>=0;c--)if(a*Br(this._indexer.origin[c].columnValues[i],this.condition[s])<=0){r=c;break}}return Math.min(r+1,this._indexer.origin.length-1)}var l=0;if("function"!=typeof this.condition)for(var d=function(r){var i=h._indexer.fields[r],s=1;if("-"===i[0]&&(i=i.slice(1),s=-1),h.condition[i])if("object"==typeof h.condition[i])Object.keys(h.condition[i]).forEach((function(a){if((s>0?t:n).includes(a))for(var o=l;o<e._indexer.origin.length;o++)if(s*Br(e._indexer.origin[o].columnValues[r],e.condition[i][a])>=0){l=o;break}}));else for(var a=l;a<h._indexer.origin.length;a++)if(s*Br(h._indexer.origin[a].columnValues[r],h.condition[i])>=0){l=a;break}},h=this,i=0;i<this._indexer.fields.length;i++)d(i);return Math.max(l-1,0)},e.prototype.each=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i$1,s,a,o$1,u=this;return o(this,(function(c){switch(c.label){case 0:if(t=this.findOptimizedStartPosition(),n=0,this.backward&&this._indexer.origin[t]&&(n=this._indexer.origin[t].keys.length-1),r=function(){if(u._indexer.origin[t]){if(!u._indexer.origin[t].keys[++n]){if(!u._indexer.origin[++t])return !1;n=0;}return !0}return !1},i$1=function(){if(u._indexer.origin[t]){if(!u._indexer.origin[t].keys[--n]){if(!u._indexer.origin[--t])return !1;n=u._indexer.origin[t].keys.length-1;}return !0}return !1},s=null,!this._indexer.origin[t])return [3,4];a=this.backward?i$1:r,c.label=1;case 1:return [4,this._blockManager.getFromBlock(this._indexer.origin[t].keys[n])];case 2:if((o$1=c.sent())&&Qr(this.condition,o$1))return s=o$1,[3,4];c.label=3;case 3:if(a())return [3,1];c.label=4;case 4:return [4,new Promise((function(a){var o$1=new Zr({initialNextValue:zr(s),iterator:e,forward:function(){return i(u,void 0,void 0,(function(){var e,s;return o(this,(function(a){switch(a.label){case 0:e=this.backward?i$1:r,a.label=1;case 1:return e()?[4,this._blockManager.getFromBlock(this._indexer.origin[t].keys[n])]:[3,3];case 2:return (s=a.sent())&&Qr(this.condition,s)?[2,zr(s)]:[3,1];case 3:return [2,null]}}))}))},backward:function(){return i(u,void 0,void 0,(function(){var e,s;return o(this,(function(a){switch(a.label){case 0:e=this.backward?r:i$1,a.label=1;case 1:return e()?[4,this._blockManager.getFromBlock(this._indexer.origin[t].keys[n])]:[3,3];case 2:return (s=a.sent())&&Qr(this.condition,s)?[2,zr(s)]:[3,1];case 3:return [2,null]}}))}))},complete:a});e(o$1);}))];case 5:return [2,c.sent()]}}))}))},e}(),ei=function(){function e(e){var t=e.condition,n=void 0===t?{}:t,r=e.backward,i=void 0!==r&&r,s=e.mutex,a=e.blockManager,o=e.indexer;this._mutex=s,this._iterator=new $r({condition:n,backward:i,blockManager:a,indexer:o});}return e.prototype.fetch=function(e){return void 0===e&&(e={}),i(this,void 0,void 0,(function(){var t,n,r,i$1,s=this;return o(this,(function(a){switch(a.label){case 0:if(t=Math.max(e.offset||0,0),0===(n="number"==typeof e.limit?e.limit:Number.MAX_SAFE_INTEGER))return [2,[]];if(n<0)throw qr.collectionQueryNotValid;a.label=1;case 1:return a.trys.push([1,4,,5]),r=[],[4,this._mutex.lock()];case 2:return a.sent(),[4,this._iterator.each((function(e){return i(s,void 0,void 0,(function(){return o(this,(function(i){return e.error?e.stop():e.hasNext?0===t?(r.push(e.nextValue),0<n&&n<=r.length?e.stop():e.next()):(t--,e.next()):e.stop(),[2]}))}))}))];case 3:return a.sent(),this._mutex.unlock(),[2,r];case 4:throw i$1=a.sent(),this._mutex.unlock(),i$1;case 5:return [2]}}))}))},e.prototype.count=function(){return i(this,void 0,void 0,(function(){var e,t,n=this;return o(this,(function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),e=0,[4,this._mutex.lock()];case 1:return r.sent(),[4,this._iterator.each((function(t){return i(n,void 0,void 0,(function(){return o(this,(function(n){return t.error?t.stop():t.hasNext?(e++,t.next()):t.stop(),[2]}))}))}))];case 2:return r.sent(),this._mutex.unlock(),[2,e];case 3:throw t=r.sent(),this._mutex.unlock(),t;case 4:return [2]}}))}))},e}(),ti=function(e){return "".concat("nest","@").concat(e)},ni=function(e,t){return "".concat(ti(e),"/").concat(t)},ri=function(e,t){return "".concat(ni(e,t),".metadata")},ii=function(e,t){return "".concat(ni(e,t),"/block.")},si=function(e,t){return "".concat(ni(e,t),"/blob.")},ai=function(){function e(e){var t=e.dbname,n=e.collectionName,r=e.store;this.dbname=t,this.collectionName=n,this.store=r;}return e.prototype.get=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,s,a,o$1,u,c;return o(this,(function(l){switch(l.label){case 0:return [4,this.store.get(e)];case 1:return (t=l.sent())?(n=t.data,r=t.type,"undefined"==typeof fetch?[3,4]:[4,fetch(n)]):[3,5];case 2:return [4,l.sent().blob()];case 3:return [2,l.sent()];case 4:for(i=[],s=atob(n.split(",")[1]),a=0;a<s.length;a+=512){for(o$1=s.slice(a,a+512),u=new Array(o$1.length),c=0;c<o$1.length;c++)u[c]=o$1.charCodeAt(c);i.push(new Uint8Array(u));}return [2,new Blob(i,{type:r})];case 5:return [2,null]}}))}))},e.prototype.save=function(e,t){return void 0===t&&(t="".concat(Date.now())),i(this,void 0,void 0,(function(){var n,r,i,s,a=this;return o(this,(function(o){switch(o.label){case 0:return [4,new Promise((function(n){var r=function(e,t,n,r){return void 0===r&&(r=0),"".concat(si(e,t)).concat(n,".").concat(r)}(a.dbname,a.collectionName,t),i=new FileReader;i.onload=function(){n({blobId:r,data:i.result,type:e.type});},i.readAsDataURL(e);}))];case 1:return n=o.sent(),r=n.blobId,i=n.data,s=n.type,[4,this.store.set({key:r,value:{data:i,type:s}})];case 2:return o.sent(),[2,r]}}))}))},e.prototype.remove=function(e){return i(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return [4,this.store.remove(e)];case 1:return t.sent(),[2]}}))}))},e.prototype.clear=function(){return i(this,void 0,void 0,(function(){var e,t,n=this;return o(this,(function(r){switch(r.label){case 0:return e=si(this.dbname,this.collectionName),[4,this.store.getAllKeys()];case 1:return t=r.sent(),[4,Promise.all(t.filter((function(t){return t.startsWith(e)})).map((function(e){return i(n,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return [4,this.store.remove(e)];case 1:return [2,t.sent()]}}))}))})))];case 2:return r.sent(),[2]}}))}))},e}();!function(e){e[e.COMMIT=0]="COMMIT",e[e.WRITE=1]="WRITE",e[e.ERROR=2]="ERROR";}(Yr||(Yr={})),function(e){e.PENDING="pending",e.PERSISTENT="persistent",e.VOLATILE="volatile";}(Jr||(Jr={})),function(e){e[e.NO_CACHE=0]="NO_CACHE",e[e.DEFAULT=1]="DEFAULT",e[e.PERSISTENT=2]="PERSISTENT";}(Xr||(Xr={}));var oi,ui,ci=[Jr.PENDING,Jr.VOLATILE],li={},di=function(){function e(e){var t=e.dbname,n=e.limit,r=void 0===n?256:n;return li[t]||(this.dbname=t,this._items=[],this._limit=r,li[t]=this),li[t]}return e.get=function(e){return li[e]},Object.defineProperty(e.prototype,"items",{get:function(){return this._items},enumerable:!1,configurable:!0}),e.prototype.find=function(e,t,n){return void 0===n&&(n=Xr.DEFAULT),i(this,void 0,void 0,(function(){var r,i;return o(this,(function(s){switch(s.label){case 0:return (r=this.get(t))?[3,2]:[4,e.get(t)];case 1:return (i=s.sent())&&(r={key:t,value:i,state:n===Xr.PERSISTENT?Jr.PERSISTENT:Jr.VOLATILE},this.put(r)),[3,3];case 2:n===Xr.PERSISTENT&&(r.state=Jr.PERSISTENT),s.label=3;case 3:return [2,r]}}))}))},e.prototype.get=function(e,t){void 0===t&&(t=Xr.DEFAULT);var n=this._items.map((function(e){return e.key})).indexOf(e);if(n>-1){var r=this._items[n];return t===Xr.PERSISTENT&&(r.state=Jr.PERSISTENT),t!==Xr.NO_CACHE&&this.put(r),r}return null},e.prototype.put=function(e){var t,n;if(this._limit>0){var r=this._items.map((function(e){return e.key})).indexOf(e.key);if(r>-1)ci.includes(this._items[r].state)&&ci.includes(e.state)?(this._items.splice(r,1),this._items.push(e)):(this._items[r].state=e.state,this._items[r].value=e.value);else {this._items.push(e);var i=this._items.filter((function(e){return e.state===Jr.VOLATILE})),s$1=i.length-this._limit;if(s$1>0){var a=[];try{for(var o=s(this._items),u=o.next();!u.done;u=o.next()){var c=u.value;c.state===Jr.VOLATILE&&s$1>0?s$1--:a.push(c);}}catch(e){t={error:e};}finally{try{u&&!u.done&&(n=o.return)&&n.call(o);}finally{if(t)throw t.error}}this._items=a;}}}},e.prototype.remove=function(e){var t=this._items.map((function(e){return e.key})).indexOf(e);t>-1&&this._items.splice(t,1);},e.prototype.clearByCondition=function(e){this._items=this._items.filter((function(t){return !e(t)}));},e.prototype.clear=function(e){void 0===e&&(e=!1),this._items=e?[]:this._items.filter((function(e){return e.state!==Jr.VOLATILE}));},e}(),hi=function(){function e(e){var t=e.dbname,n=e.collectionName,r=e.store;this._requests=[],this._onCommit=new Map,this._onWrite=new Map,this._onError=new Map,this.dbname=t,this.collectionName=n,this.metadataKey=function(e,t){return "".concat(ni(e,t),"/trans.metadata")}(t,n),this.recordsetKey=function(e,t){return "".concat(ni(e,t),"/trans.recordset")}(t,n),this._store=r;}return Object.defineProperty(e.prototype,"generation",{get:function(){return this._metadata?this._metadata.generation:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"requestCount",{get:function(){return this._requests.length},enumerable:!1,configurable:!0}),e.prototype._getReducedRecordset=function(e){return void 0===e&&(e=[]),i(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return [4,this._store.get(this.recordsetKey)];case 1:return (t=n.sent()||[]).push.apply(t,c([],a(e),!1)),[2,this._reduceRecordSet(t)]}}))}))},e.prototype._reduceRecordSet=function(e){for(var t=[],n={},r=e.length-1;r>=0;r--){for(var i=e[r],s=[],a=i.requests.length-1;a>=0;a--){var o=i.requests[a],u=o.data;n[u.key]||(s.unshift(o),n[u.key]=!0);}s.length>0&&(i.requests=s,t.unshift(i));}return t},e.prototype._applyRecord=function(e,t){return i(this,void 0,void 0,(function(){var n$1,r,i,s,a,u,c,l,d;return o(this,(function(h){switch(h.label){case 0:n$1=di.get(this.dbname),r=t.generation,i=t.requests,s=null,h.label=1;case 1:return h.trys.push([1,3,,4]),[4,this._store.setMany(i.map((function(e){return n(n({},e.data),{generation:r})})))];case 2:for(a=h.sent(),u=0;u<i.length;u++)a[u]instanceof Error&&(s||(s=a[u]),c=i[u].data,n$1.put(n(n({},c),{state:Jr.PERSISTENT})));return [3,4];case 3:return l=h.sent(),s=l,[3,4];case 4:return s?[3,6]:(d=e.filter((function(e){return e.generation!==r})),[4,this._store.set({key:this.recordsetKey,value:d})]);case 5:return h.sent(),this._onWrite.forEach((function(e){e(i.map((function(e){return e.data})));})),[3,7];case 6:this._onError.forEach((function(e){s&&e(s);})),h.label=7;case 7:return [2]}}))}))},e.prototype.init=function(){return i(this,void 0,void 0,(function(){var e,t,n,r,i,s$1,a,o$1;return o(this,(function(u){switch(u.label){case 0:return e=this,[4,this._store.get(this.metadataKey)];case 1:return e._metadata=u.sent()||{generation:1},[4,this._getReducedRecordset()];case 2:t=u.sent(),u.label=3;case 3:u.trys.push([3,8,9,10]),n=s(t),r=n.next(),u.label=4;case 4:return r.done?[3,7]:(i=r.value,[4,this._applyRecord(t,i)]);case 5:u.sent(),u.label=6;case 6:return r=n.next(),[3,4];case 7:return [3,10];case 8:return s$1=u.sent(),a={error:s$1},[3,10];case 9:try{r&&!r.done&&(o$1=n.return)&&o$1.call(n);}finally{if(a)throw a.error}return [7];case 10:return [2]}}))}))},e.prototype.on=function(e,t,n){switch(e){case Yr.COMMIT:this._onCommit.set(t,n);break;case Yr.WRITE:this._onWrite.set(t,n);break;case Yr.ERROR:this._onError.set(t,n);}},e.prototype.requestWrite=function(e,t){this._requests.push({data:e,options:t}),di.get(this.dbname).put(n({state:Jr.PENDING},e));},e.prototype.requestMultipleWrite=function(e,t){var n$1,r,i=di.get(this.dbname);try{for(var s$1=s(e),a=s$1.next();!a.done;a=s$1.next()){var u=a.value;this._requests.push({data:u,options:t}),i.put(n({state:Jr.PENDING},u));}}catch(e){n$1={error:e};}finally{try{a&&!a.done&&(r=s$1.return)&&r.call(s$1);}finally{if(n$1)throw n$1.error}}},e.prototype.clear=function(){return i(this,void 0,void 0,(function(){return o(this,(function(e){return di.get(this.dbname).clearByCondition((function(e){return e.state===Jr.PENDING})),this._requests=[],[2]}))}))},e.prototype.commit=function(){return i(this,void 0,void 0,(function(){var e,t,n$1,r,i,s,a,u,c,l,d,h,f=this;return o(this,(function(p){switch(p.label){case 0:if(!((e=this._requests).length>0))return [3,4];for(t=[],n$1={},u=e.length-1;u>=0;u--)r=e[u],l=r.data,n$1[l.key]||(n$1[l.key]=!0,t.unshift(r));return i={generation:this.generation,requests:t},[4,this._getReducedRecordset([i])];case 1:return s=p.sent(),[4,this._store.set({key:this.recordsetKey,value:s})];case 2:return p.sent(),this._metadata.generation++,[4,this._store.set({key:this.metadataKey,value:this._metadata})];case 3:for(p.sent(),a=di.get(this.dbname),u=0;u<t.length;u++)c=t[u],l=c.data,d=c.options,a.put(n(n({},l),{state:d&&d.persistent?Jr.PERSISTENT:Jr.VOLATILE}));this._requests=[],this._onCommit.forEach((function(t){t(e.map((function(e){return e.data})));})),h=Lr.get(this.dbname),setTimeout((function(){try{f._applyRecord(s,i);}catch(e){f._onError.forEach((function(t){return t(e)}));}}),h.transactionApplyDelay),p.label=4;case 4:return [2]}}))}))},e}(),fi=function(){function e(e){var t=e.blockId,n=e.keyName,r=e.items,i=void 0===r?[]:r,s=e.limit;this.blockId=t,this.keyName=n,this.limit=s,this._items=c([],a(i),!1);}return e.createFromCacheItem=function(t){return t?new e(t.value):null},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return 0===this._items.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"items",{get:function(){return this._items},enumerable:!1,configurable:!0}),e.prototype.serialize=function(){return {blockId:this.blockId,keyName:this.keyName,limit:this.limit,items:this._items}},e.prototype.getItemByKey=function(e){var t=this,n=this._items.find((function(n){var r=n[t.keyName];return e===r}));return null!=n?n:null},e.prototype.has=function(e){var t=this;return this._items.map((function(e){return e[t.keyName]})).includes(e)},e.prototype.add=function(e){var t=this,n=this._items.map((function(e){return e[t.keyName]})).indexOf(e[this.keyName]);return n<0?this._items.length<this.limit&&(this._items.push(e),!0):(this._items[n]=e,!0)},e.prototype.remove=function(e){for(var t in this._items)if(this._items[t][this.keyName]===e)return this._items.splice(parseInt(t),1),!0;return !1},e.prototype.clear=function(){this._items=[];},e}(),pi=function(){function e(e){var t=e.dbname,n=e.collectionName,r=e.metadata,i=e.hashFunction,s=void 0===i?Kr:i,a=e.transaction,o=e.store;this.dbname=t,this.collectionName=n,this.hashFunction=s,this.metadata=r,this._transaction=a,this._store=o;}return Object.defineProperty(e.prototype,"keyName",{get:function(){return this.metadata.keyName},enumerable:!1,configurable:!0}),e.prototype.createBlockId=function(e,t){return void 0===t&&(t=this.metadata.blockLevel),n=this.dbname,r=this.collectionName,i=t,s="".concat(function(e,t,n){var r=n.base*Math.pow(n.multiplier,t)+n.constant;return (n.hashFunction||Kr)(e,r)}(e,t,{hashFunction:this.hashFunction,base:this.metadata.blockHashBase,multiplier:this.metadata.blockHashMultiplier,constant:this.metadata.blockHashConstant})),"".concat(ii(n,r)).concat(i,".").concat(s);var n,r,i,s;},e.prototype._findBlock=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,s;return o(this,(function(a){switch(a.label){case 0:t=di.get(this.dbname),n=this.metadata.blockLevel,a.label=1;case 1:return n>0?(r=this.createBlockId(e,n),[4,t.find(this._store,r)]):[3,4];case 2:if((i=a.sent())&&(s=fi.createFromCacheItem(i),null==s?void 0:s.getItemByKey(e)))return [2,s];a.label=3;case 3:return n--,[3,1];case 4:return [2,null]}}))}))},e.prototype.getFromBlock=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return [4,this._findBlock(e)];case 1:return [2,(t=n.sent())?t.getItemByKey(e):null]}}))}))},e.prototype.putToBlock=function(e,t){return i(this,void 0,void 0,(function(){var n,r,i,s,a;return o(this,(function(o){switch(o.label){case 0:return n=Lr.get(this.dbname),r=this.createBlockId(e),i=Math.floor(this._store.itemSizeLimit/n.itemSizeLimit),[4,di.get(this.dbname).find(this._store,r)];case 1:return s=o.sent(),(null==(a=s?fi.createFromCacheItem(s):new fi({blockId:r,keyName:this.keyName,items:[],limit:i}))?void 0:a.add(t))?(this._transaction.requestWrite({key:a.blockId,value:a.serialize()}),[2,!0]):[2,!1]}}))}))},e.prototype.removeFromBlock=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return [4,this._findBlock(e)];case 1:return (t=n.sent())&&t.remove(e)?(this._transaction.requestWrite({key:t.blockId,value:t.serialize()}),[2,!0]):[2,!1]}}))}))},e.prototype.clearAllBlocks=function(){return i(this,void 0,void 0,(function(){var e,t,n;return o(this,(function(r){switch(r.label){case 0:return e=ii(this.dbname,this.collectionName),[4,this._store.getAllKeys()];case 1:return t=r.sent(),n=t.filter((function(t){return t.startsWith(e)})),[4,this._store.removeMany(n)];case 2:return r.sent(),[4,this._transaction.clear()];case 3:return r.sent(),di.get(this.dbname).clearByCondition((function(t){return t.key.startsWith(e)})),[2]}}))}))},e}(),mi={},vi=function(){function e(e){var t=e.dbname,n=e.collectionName,r=e.keyName,i=e.fields,s=e.transaction,a=e.store,o=this;this._origin=[],this._table=[];var u=function(e,t,n){return "".concat(ni(e,t),"/index.").concat(n)}(t,n,i.join(">"));return mi[u]||(this.dbname=t,this.collectionName=n,this.keyName=r,this.fields=i,this.indexerKey=u,this._transaction=s,this._store=a,this._transaction.on(Yr.COMMIT,this.indexerKey,(function(){return o.commit()})),this._transaction.on(Yr.ERROR,this.indexerKey,(function(){return o.abort()}))),mi[u]}return e.createKey=function(e){return e.join(">")},e.parseKey=function(e){return e.split(">")},e.clearIndexerMap=function(){for(var e in mi)delete mi[e];},e.prototype._addItem=function(e){var t=e[this.keyName],n=this.getColumnValues(e),r=a(this.indexOf(n),2),i=r[0];return r[1]?!this._table[i].keys.includes(t)&&(this._table[i].keys.push(t),!0):(this._table.splice(i,0,{columnValues:n,keys:[t]}),!0)},e.prototype._removeItem=function(e){var t=e[this.keyName],n=this.getColumnValues(e),r=a(this.indexOf(n),2),i=r[0];if(r[1]){var s=this._table[i].keys.indexOf(t);if(s>-1)return this._table[i].keys.splice(s,1),0===this._table[i].keys.length&&this._table.splice(i,1),!0}return !1},Object.defineProperty(e.prototype,"origin",{get:function(){return this._origin},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"table",{get:function(){return this._table},enumerable:!1,configurable:!0}),e.prototype.getColumnValues=function(e){var t,n,r,i,s$1=[];try{for(var a=s(this.fields),o=a.next();!o.done;o=a.next()){var u=o.value;if("-"===u[0]&&(u=u.slice(1)),r=e[u],i=void 0,i=typeof r,null!==r&&"undefined"!==i&&"boolean"!==i&&"number"!==i&&"string"!==i)throw qr.indexTypesNotMatch;s$1.push(e[u]);}}catch(e){t={error:e};}finally{try{o&&!o.done&&(n=a.return)&&n.call(a);}finally{if(t)throw t.error}}return s$1},e.prototype.diff=function(e,t){for(var n in this.fields){var r="-"===this.fields[n][0]?-1:1,i=Br(e[n],t[n]);if(0!==i)return r*i}return 0},e.prototype.indexOf=function(e){if(this._table.length>0){for(var t=0,n=this._table.length-1;t<=n;){var r=Math.floor((t+n)/2),i=this.diff(e,this._table[r].columnValues);if(i>0)t=r+1;else {if(!(i<0))return [r,!0];n=r-1;}}return [t,!1]}return [0,!1]},e.prototype.ensure=function(){return i(this,void 0,void 0,(function(){var e,t,n,r,i,s$1,a,o$1,u,c,l,d,h,f,p,v,y;return o(this,(function(_){switch(_.label){case 0:return [4,(e=di.get(this.dbname)).find(this._store,this.indexerKey,Xr.PERSISTENT)];case 1:return (t=_.sent())?[3,11]:(n=ii(this.dbname,this.collectionName),[4,this._store.getAllKeys()]);case 2:r=_.sent(),_.label=3;case 3:_.trys.push([3,8,9,10]),i=s(r),s$1=i.next(),_.label=4;case 4:return s$1.done?[3,7]:(a=s$1.value).startsWith(n)?[4,e.find(this._store,a,Xr.NO_CACHE)]:[3,6];case 5:if(o$1=_.sent(),u=fi.createFromCacheItem(o$1))try{for(v=void 0,c=s(u.items),l=c.next();!l.done;l=c.next())d=l.value,this._addItem(d);}catch(e){v={error:e};}finally{try{l&&!l.done&&(y=c.return)&&y.call(c);}finally{if(v)throw v.error}}_.label=6;case 6:return s$1=i.next(),[3,4];case 7:return [3,10];case 8:return h=_.sent(),f={error:h},[3,10];case 9:try{s$1&&!s$1.done&&(p=i.return)&&p.call(i);}finally{if(f)throw f.error}return [7];case 10:return this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[3,12];case 11:this._origin=t.value,this._table=zr(this._origin),_.label=12;case 12:return mi[this.indexerKey]=this,[2]}}))}))},e.prototype.drop=function(){return i(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return di.get(this.dbname).remove(this.indexerKey),[4,this._store.remove(this.indexerKey)];case 1:return e.sent(),delete mi[this.indexerKey],[2]}}))}))},e.prototype.addItem=function(e){return i(this,void 0,void 0,(function(){return o(this,(function(t){return this._addItem(e)&&this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[2]}))}))},e.prototype.removeItem=function(e){return i(this,void 0,void 0,(function(){return o(this,(function(t){return this._removeItem(e)&&this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[2]}))}))},e.prototype.clear=function(){return i(this,void 0,void 0,(function(){return o(this,(function(e){return this._table=[],this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[2]}))}))},e.prototype.commit=function(){this._origin=this._table,this._table=zr(this._origin);},e.prototype.abort=function(){this._table=zr(this._origin);},e}(),yi=function(){return "undefined"!=typeof document&&"undefined"!=typeof navigator&&"ReactNative"!==navigator.product},_i=function(){var e=(new Date).getTime();return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)}))};!function(e){e[e.PROCESSING=0]="PROCESSING",e[e.DONE=1]="DONE";}(oi||(oi={})),function(e){e.NEWNODE="newnode",e.REMOVENODE="removenode",e.CLAIM_HOST="claimhost",e.SYNC_HOST="synchost",e.REQUEST_LOCK="requestlock",e.ACQUIRE_LOCK="acquirelock",e.RELEASE_LOCK="releaselock";}(ui||(ui={}));var gi,bi={},Ii=function(){function e(e,t){void 0===t&&(t={});var n=this;return this._state=oi.PROCESSING,this._queue=[],this._activationQueue=[],bi[e]&&!t.forceCreate||(this.nodeId=_i(),this.key=e,yi()&&(t.startAsInvisible?this.registerNode():"visible"===document.visibilityState?this.claimHost():this.registerNode(),document.addEventListener("visibilitychange",(function(){"visible"===document.visibilityState&&n.claimHost();})),window.addEventListener("message",(function(e){var t,r,i=e.data,s$1=i.nodeId,a=i.requestId,o=i.key,u=i.op,c=i.data;if(s$1!==n.nodeId&&o===n.key)switch(u){case ui.NEWNODE:n._sendSync();break;case ui.CLAIM_HOST:n._sendSync(),n._hostId=s$1;break;case ui.SYNC_HOST:if(!n.isInSync){n._activationTimeout&&clearTimeout(n._activationTimeout);var l=c,d=l.currentItemRequestId,h=l.queue,f=function(e){var t=n._queue.findIndex((function(t){return t.requestId===e.requestId}));t<0&&n._requestLock({nodeId:e.nodeId,requestId:e.requestId,key:n.key,op:ui.REQUEST_LOCK,ts:e.ts});};try{for(var p=s(h),v=p.next();!v.done;v=p.next()){f(v.value);}}catch(e){t={error:e};}finally{try{v&&!v.done&&(r=p.return)&&r.call(p);}finally{if(t)throw t.error}}n._currentItem=n._queue.find((function(e){return e.requestId===d})),n._completeSync();}break;case ui.REMOVENODE:n._queue=n._queue.filter((function(e){return e.nodeId!==i.nodeId})),n._currentItem&&n._currentItem.nodeId===i.nodeId&&(n._currentItem=void 0,n._acquire(n._queue[0]));break;case ui.REQUEST_LOCK:n._requestLock(i);break;case ui.ACQUIRE_LOCK:var y=n._queue.find((function(e){return e.requestId===a}));n._acquire(y);break;case ui.RELEASE_LOCK:n._release(a);}})),window.addEventListener("beforeunload",(function(){n._send(ui.REMOVENODE);}))),bi[e]=this),bi[e]}return Object.defineProperty(e.prototype,"locked",{get:function(){return !!this._currentItem},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isHost",{get:function(){return this._hostId===this.nodeId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isInSync",{get:function(){return this._state==oi.DONE},enumerable:!1,configurable:!0}),e.prototype._send=function(e,t){var n;void 0===t&&(t={});var r={nodeId:this.nodeId,requestId:null!==(n=null==t?void 0:t.requestId)&&void 0!==n?n:_i(),key:this.key,op:e,data:t.data,ts:Date.now()};return yi()&&window.postMessage(r,"*"),r},e.prototype._acquire=function(e){e?(this._currentItem=e,this._currentItem.onAcquired&&this._currentItem.onAcquired(e.requestId)):this._currentItem=void 0;},e.prototype._release=function(e){if(this._currentItem&&this._currentItem.requestId===e){var t=this._currentItem;this._currentItem=void 0,t.nodeId===this.nodeId&&this._send(ui.RELEASE_LOCK,{requestId:t.requestId});var n=this._queue.findIndex((function(t){return t.requestId===e}));n>-1&&this._queue.splice(n,1),t.onReleased&&t.onReleased(e);}},e.prototype._requestLock=function(e){var t=this;return new Promise((function(n){var r={nodeId:e.nodeId,requestId:e.requestId,ts:e.ts,onAcquired:function(e){t.isHost&&t._send(ui.ACQUIRE_LOCK,{requestId:e}),n();},onReleased:function(){t._acquire(t._queue[0]);}},i=!1;for(var s in t._queue)if(t._queue[s].ts>r.ts){t._queue.splice(parseInt(s),0,r),i=!0;break}i||t._queue.push(r),t._currentItem||t._acquire(t._queue[0]);}))},e.prototype._sendSync=function(){var e;this.isHost&&this._send(ui.SYNC_HOST,{data:{currentItemRequestId:null===(e=this._currentItem)||void 0===e?void 0:e.requestId,queue:this._queue.map((function(e){return {nodeId:e.nodeId,requestId:e.requestId,ts:e.ts}}))}});},e.prototype._waitUntilSyncCompleted=function(){return i(this,void 0,void 0,(function(){var e=this;return o(this,(function(t){return this.isHost&&!this.isInSync?[2,new Promise((function(t){e._activationQueue.push(t);}))]:[2]}))}))},e.prototype._waitSync=function(){var e=this;this.isInSync||(this._activationTimeout=setTimeout((function(){e._completeSync();}),8));},e.prototype._completeSync=function(){this.isInSync||(this._state=oi.DONE,this._activationQueue.forEach((function(e){return e()})),this._activationQueue=[]);},e.prototype.registerNode=function(){this._send(ui.NEWNODE),this._waitSync();},e.prototype.claimHost=function(){this._hostId=this.nodeId,this._send(ui.CLAIM_HOST),this._waitSync();},e.prototype.lock=function(){return i(this,void 0,void 0,(function(){var e;return o(this,(function(t){switch(t.label){case 0:return [4,this._waitUntilSyncCompleted()];case 1:return t.sent(),e=this._send(ui.REQUEST_LOCK),[4,this._requestLock(e)];case 2:return t.sent(),[2]}}))}))},e.prototype.unlock=function(){var e;(null===(e=this._currentItem)||void 0===e?void 0:e.requestId)&&this._release(this._currentItem.requestId);},e}(),Ei=function(){function e(e){var t=e.dbname,n=e.collectionName,r=e.keyName,i=e.keyHash,s=e.indexes,a$1=e.store,o=this;this._state=Dr.INIT,this._indexers=[],this.dbname=t,this.name=n,this.keyName=r,this.indexes=c([[r]],a(s.filter((function(e){return vi.createKey(e)!==o.keyName}))),!1),this._keyHash=i,this._store=a$1,this._mutex=new Ii(function(e,t){return "".concat(ni(e,t),".lock")}(t,n)),this._blobContainer=new ai({dbname:t,collectionName:n,store:a$1}),this._transaction=new hi({dbname:t,collectionName:n,store:a$1});}return e.metadataOf=function(e,t,n){return i(this,void 0,void 0,(function(){var r;return o(this,(function(i){switch(i.label){case 0:return r=ri(e,t),[4,n.get(r)];case 1:return [2,i.sent()]}}))}))},Object.defineProperty(e.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isReady",{get:function(){return this._state===Dr.READY},enumerable:!1,configurable:!0}),e.prototype.init=function(){return i(this,void 0,void 0,(function(){var t,n,r,i,s$1,a$1,o$1,u,c$1,l,d,h,v,y,_=this;return o(this,(function(g){switch(g.label){case 0:return [4,this._mutex.lock()];case 1:g.sent(),g.label=2;case 2:return g.trys.push([2,9,,10]),t=Lr.get(this.dbname),[4,e.metadataOf(this.dbname,this.name,this._store)];case 3:return n=g.sent(),this._metadata=n||{keyName:this.keyName,blockLevel:1,blockHashBase:t.blockHashBase,blockHashMultiplier:t.blockHashMultiplier,blockHashConstant:t.blockHashConstant,indexes:this.indexes},[4,this._transaction.init()];case 4:g.sent(),this._blockManager=new pi({dbname:this.dbname,collectionName:this.name,hashFunction:this._keyHash,metadata:this._metadata,transaction:this._transaction,store:this._store}),r=c([],a(this.indexes),!1),i=[],s$1=r.map((function(e){return vi.createKey(e)})),a$1=n?n.indexes.map((function(e){return vi.createKey(e)})):[];try{for(o$1=s(a$1),u=o$1.next();!u.done;u=o$1.next())c$1=u.value,s$1.includes(c$1)||i.push(vi.parseKey(c$1));}catch(e){v={error:e};}finally{try{u&&!u.done&&(y=o$1.return)&&y.call(o$1);}finally{if(v)throw v.error}}return (l=[]).push.apply(l,c([],a(r.map((function(e){var t=new vi({dbname:_.dbname,collectionName:_.name,keyName:_.keyName,fields:e,transaction:_._transaction,store:_._store});return _._indexers.push(t),t.ensure()}))),!1)),l.push.apply(l,c([],a(i.map((function(e){return new vi({dbname:_.dbname,collectionName:_.name,keyName:_.keyName,fields:e,transaction:_._transaction,store:_._store}).drop()}))),!1)),[4,Promise.all(l)];case 5:return g.sent(),[4,this._transaction.commit()];case 6:return g.sent(),s$1.sort().join(",")===a$1.sort().join(",")?[3,8]:(d=ri(this.dbname,this.name),this._metadata.indexes=r,[4,this._store.set({key:d,value:this._metadata})]);case 7:g.sent(),g.label=8;case 8:return this._state=Dr.READY,this._mutex.unlock(),[3,10];case 9:throw h=g.sent(),this._mutex.unlock(),h;case 10:return [2]}}))}))},e.prototype.close=function(){this._state=Dr.CLOSED;},e.prototype._hasPropertyOfKeyName=function(e){var t=e[this.keyName];return "string"==typeof t&&!!t},e.prototype._getIndexerBy=function(e){var t,n;void 0===e&&(e=null),e||(e=[this.keyName]);var r=vi.createKey(e);try{for(var i=s(this._indexers),s$1=i.next();!s$1.done;s$1=i.next()){var a=s$1.value;if(r===vi.createKey(a.fields))return a}}catch(e){t={error:e};}finally{try{s$1&&!s$1.done&&(n=i.return)&&n.call(i);}finally{if(t)throw t.error}}throw qr.indexTableIsRequired},e.prototype._upgradeBlockLevel=function(){return i(this,void 0,void 0,(function(){var e;return o(this,(function(t){switch(t.label){case 0:return e=ri(this.dbname,this.name),this._metadata.blockLevel++,[4,this._store.set({key:e,value:this._metadata})];case 1:return t.sent(),[2]}}))}))},e.prototype._requestInsert=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,s$1,a;return o(this,(function(o){switch(o.label){case 0:return t=e[this.keyName],[4,this._blockManager.getFromBlock(t)];case 1:return o.sent()?[3,13]:[4,this._blockManager.putToBlock(t,e)];case 2:return o.sent()?[3,5]:[4,this._upgradeBlockLevel()];case 3:return o.sent(),[4,this._blockManager.putToBlock(t,e)];case 4:o.sent(),o.label=5;case 5:o.trys.push([5,10,11,12]),n=s(this._indexers),r=n.next(),o.label=6;case 6:return r.done?[3,9]:[4,r.value.addItem(e)];case 7:o.sent(),o.label=8;case 8:return r=n.next(),[3,6];case 9:return [3,12];case 10:return i=o.sent(),s$1={error:i},[3,12];case 11:try{r&&!r.done&&(a=n.return)&&a.call(n);}finally{if(s$1)throw s$1.error}return [7];case 12:return [3,14];case 13:throw qr.collectionInsertDuplicate;case 14:return [2]}}))}))},e.prototype._requestUpsert=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,s$1,a,o$1,u,c,l,d,h,f;return o(this,(function(p){switch(p.label){case 0:return t=e[this.keyName],[4,this._blockManager.getFromBlock(t)];case 1:return (n=p.sent())?[3,13]:[4,this._blockManager.putToBlock(t,e)];case 2:return p.sent()?[3,5]:[4,this._upgradeBlockLevel()];case 3:return p.sent(),[4,this._blockManager.putToBlock(t,e)];case 4:p.sent(),p.label=5;case 5:p.trys.push([5,10,11,12]),r=s(this._indexers),i=r.next(),p.label=6;case 6:return i.done?[3,9]:[4,(u=i.value).addItem(e)];case 7:p.sent(),p.label=8;case 8:return i=r.next(),[3,6];case 9:return [3,12];case 10:return s$1=p.sent(),l={error:s$1},[3,12];case 11:try{i&&!i.done&&(d=r.return)&&d.call(r);}finally{if(l)throw l.error}return [7];case 12:return [3,23];case 13:return [4,this._blockManager.putToBlock(t,e)];case 14:p.sent(),p.label=15;case 15:p.trys.push([15,21,22,23]),a=s(this._indexers),o$1=a.next(),p.label=16;case 16:return o$1.done?[3,20]:0===(u=o$1.value).diff(u.getColumnValues(n),u.getColumnValues(e))?[3,19]:[4,u.removeItem(n)];case 17:return p.sent(),[4,u.addItem(e)];case 18:p.sent(),p.label=19;case 19:return o$1=a.next(),[3,16];case 20:return [3,23];case 21:return c=p.sent(),h={error:c},[3,23];case 22:try{o$1&&!o$1.done&&(f=a.return)&&f.call(a);}finally{if(h)throw h.error}return [7];case 23:return [2]}}))}))},e.prototype._requestUpdate=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,s$1,a,o$1,u;return o(this,(function(c){switch(c.label){case 0:return t=e[this.keyName],[4,this._blockManager.getFromBlock(t)];case 1:return (n=c.sent())?[4,this._blockManager.putToBlock(t,e)]:[3,11];case 2:c.sent(),c.label=3;case 3:c.trys.push([3,9,10,11]),r=s(this._indexers),i=r.next(),c.label=4;case 4:return i.done?[3,8]:0===(s$1=i.value).diff(s$1.getColumnValues(n),s$1.getColumnValues(e))?[3,7]:[4,s$1.removeItem(n)];case 5:return c.sent(),[4,s$1.addItem(e)];case 6:c.sent(),c.label=7;case 7:return i=r.next(),[3,4];case 8:return [3,11];case 9:return a=c.sent(),o$1={error:a},[3,11];case 10:try{i&&!i.done&&(u=r.return)&&u.call(r);}finally{if(o$1)throw o$1.error}return [7];case 11:return [2]}}))}))},e.prototype._requestRemove=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,s$1,a;return o(this,(function(o){switch(o.label){case 0:return [4,this._blockManager.getFromBlock(e)];case 1:return (t=o.sent())?[4,this._blockManager.removeFromBlock(e)]:[3,10];case 2:o.sent(),o.label=3;case 3:o.trys.push([3,8,9,10]),n=s(this._indexers),r=n.next(),o.label=4;case 4:return r.done?[3,7]:[4,r.value.removeItem(t)];case 5:o.sent(),o.label=6;case 6:return r=n.next(),[3,4];case 7:return [3,10];case 8:return i=o.sent(),s$1={error:i},[3,10];case 9:try{r&&!r.done&&(a=n.return)&&a.call(n);}finally{if(s$1)throw s$1.error}return [7];case 10:return [2]}}))}))},e.prototype._requestClear=function(){return i(this,void 0,void 0,(function(){var e,t,n,r,i;return o(this,(function(s$1){switch(s$1.label){case 0:return [4,this._blockManager.clearAllBlocks()];case 1:s$1.sent(),s$1.label=2;case 2:s$1.trys.push([2,7,8,9]),e=s(this._indexers),t=e.next(),s$1.label=3;case 3:return t.done?[3,6]:[4,t.value.clear()];case 4:s$1.sent(),s$1.label=5;case 5:return t=e.next(),[3,3];case 6:return [3,9];case 7:return n=s$1.sent(),r={error:n},[3,9];case 8:try{t&&!t.done&&(i=e.return)&&i.call(e);}finally{if(r)throw r.error}return [7];case 9:return [2]}}))}))},e.prototype.getByKey=function(e){return i(this,void 0,void 0,(function(){var t,n;return o(this,(function(r){switch(r.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,6];case 1:r.sent(),r.label=2;case 2:return r.trys.push([2,4,,5]),[4,this._blockManager.getFromBlock(e)];case 3:return t=r.sent(),this._mutex.unlock(),[2,zr(t)];case 4:throw n=r.sent(),this._mutex.unlock(),n;case 5:return [3,7];case 6:throw qr.collectionNotReady;case 7:return [2]}}))}))},e.prototype.query=function(e){if(void 0===e&&(e={}),this.isReady)return new ei({condition:e.where,mutex:this._mutex,blockManager:this._blockManager,indexer:this._getIndexerBy(e.index),backward:!!e.backward});throw qr.collectionNotReady},e.prototype.insertOne=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:n.sent(),n.label=2;case 2:if(n.trys.push([2,5,,7]),!this._hasPropertyOfKeyName(e))throw qr.collectionKeyNotGiven;return [4,this._requestInsert(zr(e))];case 3:return n.sent(),[4,this._transaction.commit()];case 4:return n.sent(),this._mutex.unlock(),[2,e];case 5:return t=n.sent(),[4,this._transaction.clear()];case 6:throw n.sent(),this._mutex.unlock(),t;case 7:return [3,9];case 8:throw qr.collectionNotReady;case 9:return [2]}}))}))},e.prototype.insertMany=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,s$1,a,o$1,u=this;return o(this,(function(c){switch(c.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,15];case 1:c.sent(),c.label=2;case 2:if(c.trys.push([2,12,,14]),e.some((function(e){return !u._hasPropertyOfKeyName(e)})))throw qr.collectionKeyNotGiven;c.label=3;case 3:c.trys.push([3,8,9,10]),t=s(e),n=t.next(),c.label=4;case 4:return n.done?[3,7]:(r=n.value,[4,this._requestInsert(zr(r))]);case 5:c.sent(),c.label=6;case 6:return n=t.next(),[3,4];case 7:return [3,10];case 8:return i=c.sent(),a={error:i},[3,10];case 9:try{n&&!n.done&&(o$1=t.return)&&o$1.call(t);}finally{if(a)throw a.error}return [7];case 10:return [4,this._transaction.commit()];case 11:return c.sent(),this._mutex.unlock(),[2,e];case 12:return s$1=c.sent(),[4,this._transaction.clear()];case 13:throw c.sent(),this._mutex.unlock(),s$1;case 14:return [3,16];case 15:throw qr.collectionNotReady;case 16:return [2]}}))}))},e.prototype.upsertOne=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:n.sent(),n.label=2;case 2:if(n.trys.push([2,5,,7]),!this._hasPropertyOfKeyName(e))throw qr.collectionKeyNotGiven;return [4,this._requestUpsert(zr(e))];case 3:return n.sent(),[4,this._transaction.commit()];case 4:return n.sent(),this._mutex.unlock(),[2,e];case 5:return t=n.sent(),[4,this._transaction.clear()];case 6:throw n.sent(),this._mutex.unlock(),t;case 7:return [3,9];case 8:throw qr.collectionNotReady;case 9:return [2]}}))}))},e.prototype.upsertMany=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,s$1,a,o$1,u=this;return o(this,(function(c){switch(c.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,15];case 1:c.sent(),c.label=2;case 2:if(c.trys.push([2,12,,14]),e.some((function(e){return !u._hasPropertyOfKeyName(e)})))throw qr.collectionKeyNotGiven;c.label=3;case 3:c.trys.push([3,8,9,10]),t=s(e),n=t.next(),c.label=4;case 4:return n.done?[3,7]:(r=n.value,[4,this._requestUpsert(zr(r))]);case 5:c.sent(),c.label=6;case 6:return n=t.next(),[3,4];case 7:return [3,10];case 8:return i=c.sent(),a={error:i},[3,10];case 9:try{n&&!n.done&&(o$1=t.return)&&o$1.call(t);}finally{if(a)throw a.error}return [7];case 10:return [4,this._transaction.commit()];case 11:return c.sent(),this._mutex.unlock(),[2,e];case 12:return s$1=c.sent(),[4,this._transaction.clear()];case 13:throw c.sent(),this._mutex.unlock(),s$1;case 14:return [3,16];case 15:throw qr.collectionNotReady;case 16:return [2]}}))}))},e.prototype.update=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:n.sent(),n.label=2;case 2:if(n.trys.push([2,5,,7]),!this._hasPropertyOfKeyName(e))throw qr.collectionKeyNotGiven;return [4,this._requestUpdate(zr(e))];case 3:return n.sent(),[4,this._transaction.commit()];case 4:return n.sent(),this._mutex.unlock(),[2,e];case 5:return t=n.sent(),[4,this._transaction.clear()];case 6:throw n.sent(),this._mutex.unlock(),t;case 7:return [3,9];case 8:throw qr.collectionNotReady;case 9:return [2]}}))}))},e.prototype.updateIf=function(e,t){return i(this,void 0,void 0,(function(){var n,r,i$1,s$1,a,o$1,u,c,l,d,h,f,p,v,y=this;return o(this,(function(_){switch(_.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,16];case 1:_.sent(),_.label=2;case 2:return _.trys.push([2,13,,15]),n=e.where,r=void 0===n?{}:n,i$1=e.index,s$1=void 0===i$1?null:i$1,a=e.backward,o$1=void 0!==a&&a,u=[],[4,new $r({condition:r,blockManager:this._blockManager,backward:o$1,indexer:this._getIndexerBy(s$1)}).each((function(e){return i(y,void 0,void 0,(function(){var n,i;return o(this,(function(s){if(e.error)throw e.stop(),e.error;if(e.hasNext){if(n=e.nextValue,Qr(r,n)&&t.set){if("function"!=typeof t.set)for(i in t.set)n[i]=t.set[i];else t.set(n);u.push(n);}e.next();}else e.stop();return [2]}))}))}))];case 3:_.sent(),_.label=4;case 4:_.trys.push([4,9,10,11]),c=s(u),l=c.next(),_.label=5;case 5:return l.done?[3,8]:(d=l.value,[4,this._requestUpdate(zr(d))]);case 6:_.sent(),_.label=7;case 7:return l=c.next(),[3,5];case 8:return [3,11];case 9:return h=_.sent(),p={error:h},[3,11];case 10:try{l&&!l.done&&(v=c.return)&&v.call(c);}finally{if(p)throw p.error}return [7];case 11:return [4,this._transaction.commit()];case 12:return _.sent(),this._mutex.unlock(),[2,u];case 13:return f=_.sent(),[4,this._transaction.clear()];case 14:throw _.sent(),this._mutex.unlock(),f;case 15:return [3,17];case 16:throw this._transaction.clear(),qr.collectionNotReady;case 17:return [2]}}))}))},e.prototype.remove=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:n.sent(),n.label=2;case 2:return n.trys.push([2,5,,7]),[4,this._requestRemove(e)];case 3:return n.sent(),[4,this._transaction.commit()];case 4:return n.sent(),this._mutex.unlock(),[3,7];case 5:return t=n.sent(),[4,this._transaction.clear()];case 6:throw n.sent(),this._mutex.unlock(),t;case 7:return [3,9];case 8:throw qr.collectionNotReady;case 9:return [2]}}))}))},e.prototype.removeIf=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i$1,s$1,a,o$1,u,c,l,d,h,f,p,v=this;return o(this,(function(y){switch(y.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,15];case 1:y.sent(),y.label=2;case 2:return y.trys.push([2,13,,14]),t=e.where,n=void 0===t?{}:t,r=e.index,i$1=void 0===r?null:r,s$1=e.backward,a=void 0!==s$1&&s$1,o$1=[],[4,new $r({condition:n,blockManager:this._blockManager,backward:a,indexer:this._getIndexerBy(i$1)}).each((function(e){return i(v,void 0,void 0,(function(){var t,r;return o(this,(function(i){if(e.error)throw e.stop(),e.error;return e.hasNext?(t=e.nextValue,Qr(n,t)&&(r=t[this.keyName],o$1.push(r)),e.next()):e.stop(),[2]}))}))}))];case 3:y.sent(),y.label=4;case 4:y.trys.push([4,9,10,11]),u=s(o$1),c=u.next(),y.label=5;case 5:return c.done?[3,8]:(l=c.value,[4,this._requestRemove(l)]);case 6:y.sent(),y.label=7;case 7:return c=u.next(),[3,5];case 8:return [3,11];case 9:return d=y.sent(),f={error:d},[3,11];case 10:try{c&&!c.done&&(p=u.return)&&p.call(u);}finally{if(f)throw f.error}return [7];case 11:return [4,this._transaction.commit()];case 12:return y.sent(),this._mutex.unlock(),[2,o$1];case 13:throw h=y.sent(),this._mutex.unlock(),h;case 14:return [3,16];case 15:throw this._transaction.clear(),qr.collectionNotReady;case 16:return [2]}}))}))},e.prototype.clear=function(){return i(this,void 0,void 0,(function(){var e;return o(this,(function(t){switch(t.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:t.sent(),t.label=2;case 2:return t.trys.push([2,5,,7]),[4,this._requestClear()];case 3:return t.sent(),[4,this._transaction.commit()];case 4:return t.sent(),this._mutex.unlock(),[3,7];case 5:return e=t.sent(),[4,this._transaction.clear()];case 6:throw t.sent(),this._mutex.unlock(),e;case 7:return [3,9];case 8:throw qr.collectionNotReady;case 9:return [2]}}))}))},e.prototype.getBlob=function(e){return i(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return [4,this._blobContainer.get(e)];case 1:return [2,t.sent()]}}))}))},e.prototype.saveBlob=function(e,t){return i(this,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return [4,this._blobContainer.save(e,t)];case 1:return [2,n.sent()]}}))}))},e.prototype.removeBlob=function(e){return i(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return [4,this._blobContainer.remove(e)];case 1:return t.sent(),[2]}}))}))},e.prototype.removeAllBlobs=function(){return i(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return [4,this._blobContainer.clear()];case 1:return e.sent(),[2]}}))}))},e}(),Ti="[NESTDB]",wi=!0,Mi=function(){function e(){}return e.off=function(){wi=!1;},e.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];wi&&console.log.apply(console,c(["".concat(Ti,"[LOG]")],a(e),!1));},e.warning=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];wi&&console.warn.apply(console,c(["".concat(Ti,"[WARNING]")],a(e),!1));},e.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];wi&&console.error.apply(console,c(["".concat(Ti,"[ERROR]")],a(e),!1));},e}(),Si=[{},{a:700400,n:"error"}],Ai=function(){function e(e){var t,n,r;this.encryption=null!==(t=e.encryption)&&void 0!==t?t:R$1,this.itemSizeLimit=null!==(n=e.itemSizeLimit)&&void 0!==n?n:4194304,this.metadataBuffer=null!==(r=e.metadataBuffer)&&void 0!==r?r:256;}return Object.defineProperty(e.prototype,"_encryptionCheckKey",{get:function(){return "".concat(this.dbname,".encrypt")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_reservedKeys",{get:function(){return [this._encryptionCheckKey]},enumerable:!1,configurable:!0}),e.prototype._getRawKey=function(e,t){return void 0===t&&(t=""),"".concat(e).concat(t)},e.prototype._generateShardPostfixArray=function(e){return void 0===e&&(e=1),c([],a(Array(e).keys()),!1)},e.prototype._shardify=function(e){var t=this,n=e.key,r=e.value,i=JSON.stringify(this.encryption.encrypt(r)),s=Math.ceil(i.length/this.adjustedItemSizeLimit);return this._generateShardPostfixArray(s).map((function(e){var r={key:t._getRawKey(n,".".concat(e)),data:i.substring(e*t.adjustedItemSizeLimit,(e+1)*t.adjustedItemSizeLimit)};return 0===e&&(r.metadata={shards:s}),r}))},e.prototype._resetIfEncryptionChanged=function(){return i(this,void 0,void 0,(function(){var e,t,n,r,i,s,a,o$1,u,c=this;return o(this,(function(l){switch(l.label){case 0:return [4,this.get(this._encryptionCheckKey)];case 1:if(e=l.sent(),t={encrypted:Si.map((function(e){var t;return null===(t=c.encryption)||void 0===t?void 0:t.encrypt(e)}))},!(e&&e.encrypted&&Array.isArray(e.encrypted)))return [3,5];for(i in n=e.encrypted,r=[],n)r.push(i);s=0,l.label=2;case 2:return s<r.length?(i=r[s])in n?(a=i,o$1=JSON.stringify(e.encrypted[a]),u=JSON.stringify(t.encrypted[a]),o$1===u?[3,4]:(Mi.warning("Encryption algorithm has changed. Stored data would be cleared."),[4,this.clear()])):[3,4]:[3,5];case 3:return l.sent(),[3,5];case 4:return s++,[3,2];case 5:return [4,this.set({key:this._encryptionCheckKey,value:t})];case 6:return l.sent(),[2]}}))}))},Object.defineProperty(e.prototype,"adjustedItemSizeLimit",{get:function(){return Math.max(this.itemSizeLimit-this.metadataBuffer,4)},enumerable:!1,configurable:!0}),e.prototype.usage=function(){return i(this,void 0,void 0,(function(){var e,t,n,r,i,s$1,a,o$1,u;return o(this,(function(c){switch(c.label){case 0:return e=0,[4,this._getAllRawKeys()];case 1:t=c.sent(),c.label=2;case 2:c.trys.push([2,7,8,9]),n=s(t),r=n.next(),c.label=3;case 3:return r.done?[3,6]:(i=r.value,[4,this._getRaw(i)]);case 4:(s$1=c.sent())&&(e+=JSON.stringify(s$1).length),c.label=5;case 5:return r=n.next(),[3,3];case 6:return [3,9];case 7:return a=c.sent(),o$1={error:a},[3,9];case 8:try{r&&!r.done&&(u=n.return)&&u.call(n);}finally{if(o$1)throw o$1.error}return [7];case 9:return [2,e]}}))}))},e.prototype.getAllKeys=function(){return i(this,void 0,void 0,(function(){var e=this;return o(this,(function(t){switch(t.label){case 0:return [4,this._getAllRawKeys()];case 1:return [2,t.sent().filter((function(e){return e.endsWith(".0")})).map((function(e){return e.replace(/\.0$/,"")})).filter((function(t){return !e._reservedKeys.includes(t)}))]}}))}))},e.prototype.get=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i$1,s,a,o$1=this;return o(this,(function(u){switch(u.label){case 0:return t=this._getRawKey(e,".0"),[4,this._getRaw(t)];case 1:if(!(n=u.sent()))return [3,7];u.label=2;case 2:return u.trys.push([2,6,,7]),r=n.data,(null==(i$1=n.metadata)?void 0:i$1.shards)&&i$1.shards>1?[4,Promise.all(this._generateShardPostfixArray(null==i$1?void 0:i$1.shards).map((function(t){return i(o$1,void 0,void 0,(function(){var n,i;return o(this,(function(s){switch(s.label){case 0:return t>0?(n=this._getRawKey(e,".".concat(t)),[4,this._getRaw(n)]):[3,2];case 1:if(!(i=s.sent()))throw qr.storeBrokenIntegrity;return [2,i.data];case 2:return [2,r]}}))}))})))]:[3,4];case 3:return a=u.sent(),[3,5];case 4:a=[r],u.label=5;case 5:return s=a,[2,this.encryption.decrypt(JSON.parse(s.join("")))];case 6:return u.sent(),[2,null];case 7:return [2,null]}}))}))},e.prototype.set=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n$1){switch(n$1.label){case 0:return t=this._shardify(e),[4,this._setRaw(t)];case 1:return n$1.sent(),[2,n({},e.value)]}}))}))},e.prototype.setMany=function(e){return i(this,void 0,void 0,(function(){var t,n=this;return o(this,(function(r){switch(r.label){case 0:return t=[],[4,this._setRaw(t.concat.apply(t,c([],a(e.map((function(e){return n._shardify(e)}))),!1)))];case 1:return r.sent(),[2,e.map((function(e){return e.value}))]}}))}))},e.prototype.remove=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i=this;return o(this,(function(s){switch(s.label){case 0:return t=this._getRawKey(e,".0"),[4,this._getRaw(t)];case 1:return (n=s.sent())?(r=n.metadata,[4,this._removeRaw(this._generateShardPostfixArray(null==r?void 0:r.shards).map((function(t){return i._getRawKey(e,".".concat(t))})))]):[3,3];case 2:return s.sent(),[2,!0];case 3:return [2,!1]}}))}))},e.prototype.removeMany=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,s$1,a$1,o$1,u,c$1,l=this;return o(this,(function(d){switch(d.label){case 0:t=[],n=function(e){var n,i,s;return o(this,(function(a$1){switch(a$1.label){case 0:return n=r._getRawKey(e,".0"),[4,r._getRaw(n)];case 1:return (i=a$1.sent())&&(s=i.metadata,t.push.apply(t,c([],a(r._generateShardPostfixArray(null==s?void 0:s.shards).map((function(t){return l._getRawKey(e,".".concat(t))}))),!1))),[2]}}))},r=this,d.label=1;case 1:d.trys.push([1,6,7,8]),i=s(e),s$1=i.next(),d.label=2;case 2:return s$1.done?[3,5]:(a$1=s$1.value,[5,n(a$1)]);case 3:d.sent(),d.label=4;case 4:return s$1=i.next(),[3,2];case 5:return [3,8];case 6:return o$1=d.sent(),u={error:o$1},[3,8];case 7:try{s$1&&!s$1.done&&(c$1=i.return)&&c$1.call(i);}finally{if(u)throw u.error}return [7];case 8:return t.length>0?[4,this._removeRaw(t)]:[3,10];case 9:d.sent(),d.label=10;case 10:return [2,e]}}))}))},e}(),Ni={},Ui=function(t$1){function n$1(e){void 0===e&&(e={});var n$1,r=this;r=t$1.call(this,n(n({},e),{itemSizeLimit:null!==(n$1=e.itemSizeLimit)&&void 0!==n$1?n$1:4194304}))||this;var i=e.delay,s=void 0===i?1:i;return r.delay=s,r.observer={},r}return t(n$1,t$1),Object.defineProperty(n$1.prototype,"rawData",{get:function(){return Ni[this.dbname]},set:function(e){Ni[this.dbname]=e;},enumerable:!1,configurable:!0}),n$1.prototype._getAllRawKeys=function(){return i(this,void 0,void 0,(function(){return o(this,(function(e){if(Ni[this.dbname])return [2,Object.keys(Ni[this.dbname])];throw qr.storeNotAvailable}))}))},n$1.prototype._getRaw=function(e){return i(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return Ni[this.dbname]?[4,jr(this.delay)]:[3,2];case 1:return t.sent(),[2,Ni[this.dbname][e]?n({key:e},Ni[this.dbname][e]):null];case 2:throw qr.storeNotAvailable}}))}))},n$1.prototype._setRaw=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,s$1,a,o$1,u;return o(this,(function(c){switch(c.label){case 0:return Ni[this.dbname]?[4,jr(this.delay)]:[3,2];case 1:c.sent();try{for(t=s(e),n=t.next();!n.done;n=t.next())r=n.value,i=r.key,s$1=r.data,a=r.metadata,Ni[this.dbname][i]=Object.freeze({data:s$1,metadata:a});}catch(e){o$1={error:e};}finally{try{n&&!n.done&&(u=t.return)&&u.call(t);}finally{if(o$1)throw o$1.error}}return [3,3];case 2:throw qr.storeNotAvailable;case 3:return [2]}}))}))},n$1.prototype._removeRaw=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,s$1;return o(this,(function(a){switch(a.label){case 0:return Ni[this.dbname]?[4,jr(this.delay)]:[3,2];case 1:a.sent();try{for(t=s(e),n=t.next();!n.done;n=t.next())r=n.value,Ni[this.dbname][r]&&delete Ni[this.dbname][r];}catch(e){i={error:e};}finally{try{n&&!n.done&&(s$1=t.return)&&s$1.call(t);}finally{if(i)throw i.error}}return [3,3];case 2:throw qr.storeNotAvailable;case 3:return [2]}}))}))},n$1.prototype.observe=function(e,t,n){var r=this;this.observer[e]||(this.observer[e]={}),t.forEach((function(t){return r.observer[e][t]=n}));},n$1.prototype.checkAvailability=function(){return i(this,void 0,void 0,(function(){return o(this,(function(e){return [2]}))}))},n$1.prototype.init=function(e){return i(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return this.dbname=e,Ni[this.dbname]||(Ni[this.dbname]={}),[4,this._resetIfEncryptionChanged()];case 1:return t.sent(),[2]}}))}))},n$1.prototype.set=function(e){return i(this,void 0,void 0,(function(){var n,r;return o(this,(function(i){if((n=this.observer[e.key])&&"function"==typeof n.set&&(r=n.set()))throw r;return [2,t$1.prototype.set.call(this,e)]}))}))},n$1.prototype.setMany=function(e){return i(this,void 0,void 0,(function(){var n,r,i,s$1,a,o$1,u;return o(this,(function(c){try{for(n=s(e),r=n.next();!r.done;r=n.next())if(i=r.value,(s$1=this.observer[i.key])&&"function"==typeof s$1.set&&(a=s$1.set()))throw a}catch(e){o$1={error:e};}finally{try{r&&!r.done&&(u=n.return)&&u.call(n);}finally{if(o$1)throw o$1.error}}return [2,t$1.prototype.setMany.call(this,e)]}))}))},n$1.prototype.clear=function(){return i(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return [4,jr(this.delay)];case 1:return e.sent(),Ni[this.dbname]={},[2]}}))}))},n$1}(Ai),Oi="NestDBStore";!function(e){e[e.UNINITIALIZED=0]="UNINITIALIZED",e[e.OPENING=1]="OPENING",e[e.OPEN=2]="OPEN",e[e.CLOSED=3]="CLOSED";}(gi||(gi={}));var Ci=function(t$1){function n$1(e){void 0===e&&(e={});var n$1,r=this;return (r=t$1.call(this,n(n({},e),{itemSizeLimit:null!==(n$1=e.itemSizeLimit)&&void 0!==n$1?n$1:104857600}))||this)._storeName=Oi,r._state=gi.UNINITIALIZED,r._openJobQueue=[],r._window="undefined"!=typeof window?window:void 0,r._indexedDb=r._window?r._window.indexedDB||r._window.mozIndexedDB||r._window.webkitIndexedDB||r._window.msIndexedDB:void 0,r}return t(n$1,t$1),Object.defineProperty(n$1.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),n$1.prototype._openDatabase=function(e){var t=this;return new Promise((function(n,r){if(t._indexedDb){t._state=gi.OPENING;var i=t._indexedDb.open(e);i.addEventListener("upgradeneeded",(function(e){e.target.result.createObjectStore(Oi,{keyPath:"key"});})),i.addEventListener("success",(function(r){t._state=gi.OPEN,t._database=r.target.result,t._openJobQueue.forEach((function(e){return e()})),t._openJobQueue=[],t._database.onclose=function(){t._database=void 0,t._state=gi.OPENING,setTimeout((function(){t._openDatabase(e);}),5);},n(t._database);})),i.addEventListener("error",(function(e){t._state=gi.UNINITIALIZED,r(e.target.error);}));}else r(qr.storeNotAvailable);}))},n$1.prototype._getObjectStore=function(e){return i(this,void 0,void 0,(function(){var t=this;return o(this,(function(n){switch(n.label){case 0:return this._database?[2,this._database.transaction(this._storeName,e).objectStore(this._storeName)]:[3,1];case 1:switch(this._state){case gi.UNINITIALIZED:case gi.OPEN:return [3,2];case gi.OPENING:case gi.CLOSED:return [3,3]}return [3,4];case 2:throw qr.storeNotInitialized;case 3:return [2,new Promise((function(n){t._openJobQueue.push((function(){return n(t._getObjectStore(e))}));}))];case 4:return [4,this._getObjectStore(e)];case 5:return [2,n.sent()]}}))}))},n$1.prototype._getAllRawKeys=function(){return i(this,void 0,void 0,(function(){var e;return o(this,(function(t){switch(t.label){case 0:return [4,this._getObjectStore("readonly")];case 1:return e=t.sent(),[4,new Promise((function(t,n){var r=e.getAllKeys();r.addEventListener("success",(function(e){t(e.target.result);})),r.addEventListener("error",(function(e){return n(e.target.error)}));}))];case 2:return [2,t.sent()]}}))}))},n$1.prototype._getRaw=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return [4,this._getObjectStore("readonly")];case 1:return t=n.sent(),[4,new Promise((function(n,r){var i=t.get(e);i.addEventListener("success",(function(e){var t;n(null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.result);})),i.addEventListener("error",(function(e){return r(e.target.error)}));}))];case 2:return [2,n.sent()]}}))}))},n$1.prototype._setRaw=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return [4,this._getObjectStore("readwrite")];case 1:return t=n.sent(),[4,Promise.all(e.map((function(e){return new Promise((function(n,r){var i=t.put(e);i.addEventListener("success",(function(e){n(e.target.result);})),i.addEventListener("error",(function(){r("Failed to write.");}));}))})))];case 2:return n.sent(),[2]}}))}))},n$1.prototype._removeRaw=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return [4,this._getObjectStore("readwrite")];case 1:return t=n.sent(),[4,Promise.all(e.map((function(e){return new Promise((function(n,r){var i=t.delete(e);i.addEventListener("success",(function(){return n(e)})),i.addEventListener("error",(function(e){return r(e.target.error)}));}))})))];case 2:return n.sent(),[2]}}))}))},n$1.prototype._triggerDatabaseClose=function(){this._database&&this._database.onclose&&this._database.onclose(new Event("dummy"));},n$1.prototype.checkAvailability=function(){return i(this,void 0,void 0,(function(){var e,t=this;return o(this,(function(n){switch(n.label){case 0:if(!((null==(e="undefined"!=typeof window?window:null)?void 0:e.indexedDB)||(null==e?void 0:e.mozIndexedDB)||(null==e?void 0:e.webkitIndexedDB)||(null==e?void 0:e.msIndexedDB)))return [3,6];if(this._indexedDb=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB,!this._window||!yi())return [3,4];if(!(yi()&&navigator.userAgent&&navigator.userAgent.includes("Edge/")))return [3,1];if(!this._window.indexedDB&&(e.PointerEvent||e.MSPointerEvent))throw qr.storeNotAvailableInPrivateBrowsing;return [3,3];case 1:return [4,new Promise((function(e,n){if(t._indexedDb)try{var r=t._indexedDb.open("_testMozilla");r.onerror=function(){return n(qr.storeNotAvailableInPrivateBrowsing)},r.onsuccess=function(){return e()};}catch(e){n(qr.storeNotAvailableInPrivateBrowsing);}else n(qr.storeNotAvailable);}))];case 2:n.sent(),n.label=3;case 3:return [3,5];case 4:throw qr.storeNotAvailable;case 5:return [3,7];case 6:throw qr.storeNotAvailable;case 7:return [2]}}))}))},n$1.prototype.init=function(e){return i(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return this.dbname=e,[4,this.checkAvailability()];case 1:return t.sent(),[4,this._openDatabase(e)];case 2:return t.sent(),[4,this._resetIfEncryptionChanged()];case 3:return t.sent(),[2]}}))}))},n$1.prototype.clear=function(){return i(this,void 0,void 0,(function(){var e;return o(this,(function(t){switch(t.label){case 0:return [4,this._getObjectStore("readwrite")];case 1:return e=t.sent(),[4,new Promise((function(t,n){var r=e.clear();r.addEventListener("success",(function(){return t()})),r.addEventListener("error",(function(e){return n(e.target.error)}));}))];case 2:return [2,t.sent()]}}))}))},n$1}(Ai),Pi=function(t$1){function n$1(e){var n$1=this,r$1=e.AsyncStorage,i=e.itemSizeLimit,s=void 0===i?6291456:i,a=r(e,["AsyncStorage","itemSizeLimit"]);return (n$1=t$1.call(this,n(n({},a),{itemSizeLimit:s}))||this)._asyncStorage=r$1,n$1}return t(n$1,t$1),n$1.prototype._isBelonging=function(e){return e.startsWith("".concat(this.dbname,"/"))},n$1.prototype._getActualKey=function(e){return "".concat(this.dbname,"/").concat(e)},n$1.prototype._getAllRawKeys=function(){return i(this,void 0,void 0,(function(){var e,t=this;return o(this,(function(n){switch(n.label){case 0:return [4,this._asyncStorage.getAllKeys()];case 1:return e=n.sent(),[2,e.filter((function(e){return t._isBelonging(e)})).map((function(e){return e.substring("".concat(t.dbname,"/").length)}))]}}))}))},n$1.prototype._getRaw=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return [4,this._asyncStorage.getItem(this._getActualKey(e))];case 1:return [2,(t=n.sent())?JSON.parse(t):null]}}))}))},n$1.prototype._setRaw=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,s$1,a,o$1;return o(this,(function(u){switch(u.label){case 0:t=[];try{for(n=s(e),r=n.next();!r.done;r=n.next())i=r.value,s$1=i.key,i.data.length<=this.adjustedItemSizeLimit&&t.push([this._getActualKey(s$1),JSON.stringify(i)]);}catch(e){a={error:e};}finally{try{r&&!r.done&&(o$1=n.return)&&o$1.call(n);}finally{if(a)throw a.error}}return [4,this._asyncStorage.multiSet(t)];case 1:return u.sent(),[2]}}))}))},n$1.prototype._removeRaw=function(e){return i(this,void 0,void 0,(function(){var t=this;return o(this,(function(n){switch(n.label){case 0:return [4,this._asyncStorage.multiRemove(e.map((function(e){return t._getActualKey(e)})))];case 1:return n.sent(),[2]}}))}))},n$1.prototype.checkAvailability=function(){return i(this,void 0,void 0,(function(){return o(this,(function(e){if(!this._asyncStorage)throw qr.storeNotAvailable;return [2]}))}))},n$1.prototype.init=function(e){return i(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return this.dbname=e,[4,this._resetIfEncryptionChanged()];case 1:return t.sent(),[2]}}))}))},n$1.prototype.clear=function(){return i(this,void 0,void 0,(function(){var e;return o(this,(function(t){switch(t.label){case 0:return [4,this.getAllKeys()];case 1:return e=t.sent(),[4,this.removeMany(e)];case 2:return t.sent(),[2]}}))}))},n$1}(Ai);!function(t$1){function n$1(e){var n$1,r=this;return (r=t$1.call(this,n(n({},e),{itemSizeLimit:null!==(n$1=e.itemSizeLimit)&&void 0!==n$1?n$1:6291456}))||this)._mmkv=e.MMKV,r}t(n$1,t$1),n$1.prototype._isBelonging=function(e){return e.startsWith("".concat(this.dbname,"/"))},n$1.prototype._getActualKey=function(e){return "".concat(this.dbname,"/").concat(e)},n$1.prototype._getAllRawKeys=function(){return i(this,void 0,void 0,(function(){var e,t=this;return o(this,(function(n){switch(n.label){case 0:return [4,this._mmkv.getAllKeys()];case 1:return e=n.sent(),[2,e.filter((function(e){return t._isBelonging(e)})).map((function(e){return e.substring("".concat(t.dbname,"/").length)}))]}}))}))},n$1.prototype._getRaw=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return [4,this._mmkv.getString(this._getActualKey(e))];case 1:return [2,(t=n.sent())?JSON.parse(t):null]}}))}))},n$1.prototype._setRaw=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,s$1,a;return o(this,(function(o){try{for(t=s(e),n=t.next();!n.done;n=t.next())r=n.value,i=r.key,r.data.length<=this.adjustedItemSizeLimit&&this._mmkv.set(this._getActualKey(i),JSON.stringify(r));}catch(e){s$1={error:e};}finally{try{n&&!n.done&&(a=t.return)&&a.call(t);}finally{if(s$1)throw s$1.error}}return [2]}))}))},n$1.prototype._removeRaw=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,s$1;return o(this,(function(a){try{for(t=s(e),n=t.next();!n.done;n=t.next())r=n.value,this._mmkv.delete(this._getActualKey(r));}catch(e){i={error:e};}finally{try{n&&!n.done&&(s$1=t.return)&&s$1.call(t);}finally{if(i)throw i.error}}return [2]}))}))},n$1.prototype.checkAvailability=function(){return i(this,void 0,void 0,(function(){return o(this,(function(e){if(!this._mmkv)throw qr.storeNotAvailable;return [2]}))}))},n$1.prototype.init=function(e){return i(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return this.dbname=e,[4,this._resetIfEncryptionChanged()];case 1:return t.sent(),[2]}}))}))},n$1.prototype.clear=function(){return i(this,void 0,void 0,(function(){var e;return o(this,(function(t){switch(t.label){case 0:return [4,this.getAllKeys()];case 1:return e=t.sent(),[4,this.removeMany(e)];case 2:return t.sent(),[2]}}))}))};}(Ai);var ki;!function(e){e.INIT="INIT",e.OPENING="OPENING",e.OPENED="OPENED",e.CLOSED="CLOSED";}(ki||(ki={}));var Ri,xi=function(){function e(e){var t=e.name,n=e.version,r=e.store,i=e.config;this.name=t,this._version=n,this._state=ki.INIT,this._config=i||new Lr({dbname:t}),this._store=r,this._event={success:Gr,error:Gr,storeReplaced:Gr,upgrade:Hr},this._collections=new Map,this._globalMutex=new Ii("".concat(this.name,".lock")),this._config.disableLogger&&Mi.off(),new di({dbname:t,limit:this._config.cacheLimit});}return Object.defineProperty(e.prototype,"version",{get:function(){return this._version},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"store",{get:function(){return this._store},enumerable:!1,configurable:!0}),e.prototype.estimateUsage=function(){return i(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return [4,(t=this._store,i(void 0,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return [4,t.usage()];case 1:return [2,e.sent()]}}))})))];case 1:return [2,e.sent()]}var t;}))}))},e.prototype.commitSchema=function(e){return i(this,void 0,void 0,(function(){var t=this;return o(this,(function(n){switch(n.label){case 0:return this._state!==ki.OPENING?[3,2]:[4,Promise.all(e.map((function(e){return i(t,void 0,void 0,(function(){var t,n,r,i,s;return o(this,(function(a){switch(a.label){case 0:return t=e.collectionName,n=e.keyName,r=e.index,i=void 0===r?[]:r,this._collections.has(t)||this._collections.set(t,new Ei({dbname:this.name,collectionName:t,keyName:n,indexes:i,store:this._store})),(s=this._collections.get(t))?[4,s.init()]:[3,2];case 1:a.sent(),a.label=2;case 2:return [2]}}))}))})))];case 1:return n.sent(),[3,3];case 2:throw qr.databaseSchemaNotOnUpgrade;case 3:return [2]}}))}))},e.prototype.open=function(){var e;return i(this,void 0,void 0,(function(){var t,n,r,i$1,s=this;return o(this,(function(a){switch(a.label){case 0:return [4,this._globalMutex.lock()];case 1:if(a.sent(),this._state===ki.OPENED)return [3,12];this._state=ki.OPENING,a.label=2;case 2:return a.trys.push([2,5,,12]),[4,this._store.init(this.name)];case 3:return a.sent(),o$1=this.name,t="".concat(ti(o$1),".metadata"),n={version:0,collectionNames:[]},[4,this._store.get(t)];case 4:return r=null!==(e=a.sent())&&void 0!==e?e:n,[2,new Promise((function(e,n){var i$1=function(e){r.version<s._version?s._event.upgrade(r.version,(function(n){return i(s,void 0,void 0,(function(){var i;return o(this,(function(s){switch(s.label){case 0:if(n)return [3,5];r.version++,r.collectionNames=Array.from(this._collections.keys()),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this._store.set({key:t,value:r})];case 2:return s.sent(),e({continued:!0}),[3,4];case 3:return i=s.sent(),e({continued:!1,err:i}),[3,4];case 4:return [3,6];case 5:e({continued:!1,err:n}),s.label=6;case 6:return [2]}}))}))})):e({continued:!1});},a=function(t){var o$1=t.continued,u=void 0!==o$1&&o$1,c=t.err,l=void 0===c?null:c;if(u)setTimeout((function(){return i$1(a)}),10);else if(l)Mi.error(l.message),s._globalMutex.unlock(),s._event.error(l),n(l);else {var d=[];r.collectionNames.forEach((function(e){var t=s._collections.get(e);t&&t.state===Dr.READY||d.push(i(s,void 0,void 0,(function(){var t,n;return o(this,(function(r){switch(r.label){case 0:return [4,Ei.metadataOf(this.name,e,this._store)];case 1:return (t=r.sent())?(n=new Ei({dbname:this.name,collectionName:e,keyName:t.keyName,indexes:t.indexes,store:this._store}),this._collections.set(e,n),[4,n.init()]):[3,3];case 2:r.sent(),r.label=3;case 3:return [2]}}))})));})),Promise.all(d).then((function(){s._state=ki.OPENED,s._globalMutex.unlock(),s._event.success(),e();})).catch((function(e){Mi.error(e.message),s._globalMutex.unlock(),s._event.error(e),n(e);}));}};i$1(a);}))];case 5:switch(i$1=a.sent(),i$1.code){case ir.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING:return [3,6];case ir.STORE_NOT_AVAILABLE:return [3,8]}return [3,10];case 6:return Mi.warning("Access to the local storage is not allowed. Switched to MemoryStore automatically."),this._store=new Ui({}),this._globalMutex.unlock(),this._event.error(i$1),this._event.storeReplaced(this._store),[4,this.open()];case 7:return a.sent(),[3,11];case 8:return Mi.warning("IndexedDB is not available in this environment. Switched to MemoryStore automatically. Consider using other store to save data persistently (e.g. AsyncStorage)."),this._store=new Ui({}),this._globalMutex.unlock(),this._event.error(i$1),this._event.storeReplaced(this._store),[4,this.open()];case 9:return a.sent(),[3,11];case 10:throw Mi.error(i$1.message),this._globalMutex.unlock(),this._event.error(i$1),i$1;case 11:return [3,12];case 12:return [2]}var o$1;}))}))},e.prototype.close=function(){this._collections.forEach((function(e){return e.close()})),this._state=ki.CLOSED;},e.prototype.clear=function(){return i(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return [4,Promise.all(Array.from(this._collections.values()).map((function(e){return e.clear()})))];case 1:return e.sent(),[2]}}))}))},e.prototype.reset=function(){return i(this,void 0,void 0,(function(){var e,t=this;return o(this,(function(n){switch(n.label){case 0:return this.close(),(e=di.get(this.name))&&e.clearByCondition((function(e){return e.key.startsWith(ti(t.name))})),[4,this._store.clear()];case 1:return n.sent(),[2]}}))}))},e.prototype.on=function(e,t){this._event[e]=t;},e.prototype.off=function(e){if("function"==typeof this._event[e])if("upgrade"===e)this._event[e]=Hr;else this._event[e]=Gr;},e.prototype.collection=function(e){var t=this._collections.get(e);if(t)return t;throw qr.collectionNotReady},e}(),Li=function(){function e(){this.messageTypeFilter=z.ALL,this.customTypesFilter=null,this.senderUserIdsFilter=null,this.replyType=V.NONE;}return e.prototype.clone=function(){var t=new e,n=JSON.parse(JSON.stringify(this));return Object.keys(n).forEach((function(e){t[e]=n[e];})),t},e.prototype.match=function(e){switch(this.messageTypeFilter){case z.USER:if(e.messageType!==P.USER)return !1;break;case z.FILE:if(e.messageType!==P.FILE)return !1;break;case z.ADMIN:if(e.messageType!==P.ADMIN)return !1}if(this.customTypesFilter&&this.customTypesFilter.length>0&&!this.customTypesFilter.includes(e.customType))return !1;if(this.senderUserIdsFilter&&this.senderUserIdsFilter.length>0){if(!(e instanceof De))return !1;if(!this.senderUserIdsFilter.includes(e.sender.userId))return !1}switch(this.replyType){case V.NONE:if(e.parentMessageId>0)return !1;break;case V.ONLY_REPLY_TO_CHANNEL:if(e instanceof De&&e.parentMessageId>0&&!e.replyToChannel)return !1}return !0},e}();!function(e){e.CHANNEL_LATEST="channel_latest",e.NEWEST_CHILD_MESSAGE="newest_child_message";}(Ri||(Ri={}));var Di,qi=function(e){switch(e){case Ri.CHANNEL_LATEST:return ["channelUrl","-createdAt","-messageId"];case Ri.NEWEST_CHILD_MESSAGE:return ["channelUrl","-parentMessageId","-createdAt","-messageId"]}};n(n({},Tt$1),{scheduledAt:void 0});n(n({},bt$1),{scheduledAt:0,file:void 0,fileUrl:void 0,fileName:void 0,mimeType:void 0,fileSize:void 0,thumbnailSizes:void 0,requireAuth:!1});var ji="UnsentMessage",Qi="reqId",Gi={},Vi=function(t$1){function n$1(e){var n=t$1.call(this,e)||this;return n._mutex=new Ii("unsendmessagecache.lock"),Gi[e]=n,n}return t(n$1,t$1),Object.defineProperty(n$1.prototype,"_cacheContext",{get:function(){return _o.of(this._iid).cacheContext},enumerable:!1,configurable:!0}),n$1.of=function(e,t){return void 0===t&&(t=!1),Gi[e]&&!t||(Gi[e]=new n$1(e)),Gi[e]},Object.defineProperty(n$1.prototype,"collection",{get:function(){var e=this._cacheContext.nestdb,t=null==e?void 0:e.collection(ji);if(!t)throw v$1.databaseError;return t},enumerable:!1,configurable:!0}),Object.defineProperty(n$1.prototype,"localCacheEnabled",{get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection},enumerable:!1,configurable:!0}),n$1.prototype._serialize=function(e){if(e.messageId>0)throw v$1.invalidParameters;var t,n$1=n({},e.serialize());return e instanceof je?(e.messageParams&&(n$1.messageParams=Et$1(e.messageParams)),e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams&&(n$1.scheduledInfo.scheduledMessageParams=(t=e.scheduledInfo.scheduledMessageParams,n(n({},Et$1(t)),{scheduledAt:t.scheduledAt})))):e instanceof He?(e.messageParams&&(n$1.messageParams=Nt$1(e.messageParams)),e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams&&(n$1.scheduledInfo.scheduledMessageParams=function(e){return n(n({},Nt$1(e)),{scheduledAt:e.scheduledAt})}(e.scheduledInfo.scheduledMessageParams))):e instanceof Ge&&e.messageParams&&(n$1.messageParams=function(e){return J({fileInfoList:e.fileInfoList,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption})}(e.messageParams)),n$1},n$1.prototype._deserialize=function(e){return e=n(n({},e),{messageId:parseInt(e.messageId)}),Zi.of(this._iid).buildMessageFromSerializedData(e)},n$1.prototype._deserializeWithMessageCreateParams=function(e){var t,n,r;return i(this,void 0,void 0,(function(){var i$1,s,a,o$1,u,c,l=this;return o(this,(function(d){switch(d.label){case 0:return i$1=Zi.of(this._iid),s=this._deserialize(e),e.messageParams?s instanceof je?(o$1=e.messageParams,s.messageParams=i$1.buildUserMessageCreateParamsFromSerializedData(o$1,s),[3,6]):[3,1]:[3,6];case 1:return s instanceof He?(o$1=e.messageParams).fileKey&&"string"==typeof o$1.fileKey&&At$1(null!==(t=o$1.fileType)&&void 0!==t?t:"")?(a=o$1,[4,this.collection.getBlob(o$1.fileKey)]):[3,3]:[3,4];case 2:a.file=null!==(n=d.sent())&&void 0!==n?n:void 0,d.label=3;case 3:return s.messageParams=i$1.buildFileMessageCreateParamsFromSerializedData(o$1,s),[3,6];case 4:return s instanceof Ge&&((o$1=e.messageParams)&&o$1.fileInfoList)?(s.messageParams=i$1.buildMultipleFilesMessageCreateParamsFromSerializedData(o$1,s),[4,Promise.all(s.messageParams.fileInfoList.map((function(e){return i(l,void 0,void 0,(function(){var t,n,r,i,s;return o(this,(function(a){switch(a.label){case 0:return "string"==typeof(null===(n=e._uploadedMetaData)||void 0===n?void 0:n.fileKey)&&At$1(null!==(i=null===(r=e._uploadedMetaData)||void 0===r?void 0:r.fileType)&&void 0!==i?i:"")?(t=e,[4,this.collection.getBlob(e._uploadedMetaData.fileKey)]):[3,2];case 1:t.file=null!==(s=a.sent())&&void 0!==s?s:void 0,a.label=2;case 2:return [2]}}))}))})))]):[3,6];case 5:d.sent(),d.label=6;case 6:return s.scheduledInfo&&e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams?s instanceof je?(u=e.scheduledInfo.scheduledMessageParams,s.scheduledInfo.scheduledMessageParams=i$1.buildScheduledUserMessageCreateParamsFromSerializedData(u,s),[3,10]):[3,7]:[3,10];case 7:return s instanceof He?(u=e.scheduledInfo.scheduledMessageParams).fileKey&&"string"==typeof u.fileKey&&"string"==typeof u.fileType&&At$1(u.fileType)?(c=u,[4,this.collection.getBlob(u.fileKey)]):[3,9]:[3,10];case 8:c.file=null!==(r=d.sent())&&void 0!==r?r:void 0,d.label=9;case 9:s.scheduledInfo.scheduledMessageParams=i$1.buildScheduledFileMessageCreateParamsFromSerializedData(u,s),d.label=10;case 10:return [2,s]}}))}))},n$1.prototype._getFileInfoBlobKey=function(e,t){return "".concat(e,".").concat(t)},n$1.prototype.get=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,this.collection.getByKey("".concat(e))]:[3,2];case 1:if(t=n.sent())return [2,this._deserializeWithMessageCreateParams(t)];n.label=2;case 2:return [2,void 0]}}))}))},n$1.prototype.fetch=function(e){var t=e.channelUrl,n=e.filter,r=void 0===n?new Li:n,i$1=e.order,s=void 0===i$1?Ri.CHANNEL_LATEST:i$1,a=e.sendingStatus,o$1=e.backward,u=void 0!==o$1&&o$1,c=e.parentMessageId;return i(this,void 0,void 0,(function(){var e,n,i$1,o$1,l=this;return o(this,(function(d){switch(d.label){case 0:return this.localCacheEnabled?(e=qi(s),n={"/where":function(e){return !!(s!==Ri.NEWEST_CHILD_MESSAGE||c&&0!==e.parentMessageId&&e.parentMessageId===c)&&r.match(l._deserialize(e))}},t&&(n.channelUrl=t),a&&(n.sendingStatus=a),i$1={where:n,index:e,backward:u},[4,this.collection.query(i$1)]):[3,3];case 1:return [4,d.sent().fetch({})];case 2:return o$1=d.sent(),[2,Promise.all(o$1.map((function(e){return i(l,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return [4,this._deserializeWithMessageCreateParams(e)];case 1:return [2,t.sent()]}}))}))})))];case 3:return [2,[]]}}))}))},n$1.prototype.getAllChildMessages=function(e,t){return void 0===t&&(t=new Li),i(this,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return [4,this.fetch({filter:t,order:Ri.NEWEST_CHILD_MESSAGE,channelUrl:e.channelUrl,backward:!1,parentMessageId:e.messageId})];case 1:return [2,n.sent()]}}))}))},n$1.prototype.upsert=function(e){return i(this,void 0,void 0,(function(){var t=this;return o(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,Promise.all(e.map((function(e){return i(t,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return e instanceof He||e instanceof Ge?[4,this._mutex.lock()]:[3,4];case 1:return n.sent(),[4,this.saveBlob(e)];case 2:return n.sent(),[4,this._mutex.unlock()];case 3:n.sent(),n.label=4;case 4:return t=this._serialize(e),[4,this.collection.upsertOne(t)];case 5:return n.sent(),[2]}}))}))})))]:[3,2];case 1:n.sent(),n.label=2;case 2:return [2]}}))}))},n$1.prototype.upsertChildMessages=function(e){return i(this,void 0,void 0,(function(){var t=this;return o(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,Promise.all(e.map((function(e){return i(t,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return t=[],e.threadInfo&&e.threadInfo.replyCount>0?[4,this.getAllChildMessages(e)]:[3,2];case 1:t=n.sent(),n.label=2;case 2:return t.length>0?(t.forEach((function(t){return t.applyParentMessage(e)})),[4,this.upsert(t)]):[3,4];case 3:n.sent(),n.label=4;case 4:return [2]}}))}))})))]:[3,2];case 1:n.sent(),n.label=2;case 2:return [2]}}))}))},n$1.prototype.remove=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,s$1,a;return o(this,(function(o){switch(o.label){case 0:if(!this.localCacheEnabled)return [3,8];o.label=1;case 1:o.trys.push([1,6,7,8]),t=s(e),n=t.next(),o.label=2;case 2:return n.done?[3,5]:(r=n.value,[4,this.collection.remove(r)]);case 3:o.sent(),o.label=4;case 4:return n=t.next(),[3,2];case 5:return [3,8];case 6:return i=o.sent(),s$1={error:i},[3,8];case 7:try{n&&!n.done&&(a=t.return)&&a.call(t);}finally{if(s$1)throw s$1.error}return [7];case 8:return [2]}}))}))},n$1.prototype.removeMessagesOfChannel=function(e){return i(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:e}})]:[3,2];case 1:t.sent(),t.label=2;case 2:return [2]}}))}))},n$1.prototype.clear=function(){return i(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return [2]}}))}))},n$1.prototype.saveBlob=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i$1=this;return o(this,(function(s){switch(s.label){case 0:return e instanceof He?e.messageParams&&(r=e.messageParams).file&&St$1(r.file)?[4,this.collection.saveBlob(r.file,e.reqId)]:[3,2]:[3,5];case 1:n=s.sent(),r.fileKey=n,r.fileType=mt$1.BLOB,s.label=2;case 2:return e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams&&((t=e.scheduledInfo.scheduledMessageParams).file&&St$1(t.file))?[4,this.collection.saveBlob(t.file,e.reqId)]:[3,4];case 3:n=s.sent(),t.fileKey=n,t.fileType=mt$1.BLOB,s.label=4;case 4:return [3,7];case 5:return e instanceof Ge&&((r=e.messageParams)&&r.fileInfoList&&Array.isArray(r.fileInfoList))?[4,Promise.all(r.fileInfoList.map((function(t,n){return i(i$1,void 0,void 0,(function(){var r;return o(this,(function(i){switch(i.label){case 0:return t.file&&St$1(t.file)?[4,this.collection.saveBlob(t.file,this._getFileInfoBlobKey(e.reqId,n))]:[3,2];case 1:r=i.sent(),t._uploadedMetaData||(t._uploadedMetaData={}),t._uploadedMetaData.fileKey=r,t._uploadedMetaData.fileType=mt$1.BLOB,i.label=2;case 2:return [2]}}))}))})))]:[3,7];case 6:s.sent(),s.label=7;case 7:return [2]}}))}))},n$1}(Fi),Wi={},Hi=function(t$1){function n$1(e){var n=t$1.call(this,e)||this;return Wi[e]=n,n}return t(n$1,t$1),Object.defineProperty(n$1.prototype,"_sdkState",{get:function(){return _o.of(this._iid).sdkState},enumerable:!1,configurable:!0}),Object.defineProperty(n$1.prototype,"_cacheContext",{get:function(){return _o.of(this._iid).cacheContext},enumerable:!1,configurable:!0}),Object.defineProperty(n$1.prototype,"_unsentMessageCache",{get:function(){return Vi.of(this._iid)},enumerable:!1,configurable:!0}),n$1.of=function(e,t){return void 0===t&&(t=!1),Wi[e]&&!t||(Wi[e]=new n$1(e)),Wi[e]},Object.defineProperty(n$1.prototype,"collection",{get:function(){var e=this._cacheContext.nestdb;return Qi$1(!!e).throw(v$1.databaseError),e.collection(dr)},enumerable:!1,configurable:!0}),Object.defineProperty(n$1.prototype,"localCacheEnabled",{get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection},enumerable:!1,configurable:!0}),n$1.prototype._serialize=function(e){return n(n({},e.serialize()),{messageId:"".concat(e.messageId)})},n$1.prototype._deserialize=function(e){return e=n(n({},e),{messageId:parseInt(e.messageId)}),Zi.of(this._iid).buildMessageFromSerializedData(e)},n$1.prototype.get=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,this.collection.getByKey("".concat(e))]:[3,2];case 1:if(t=n.sent())return [2,this._deserialize(t)];n.label=2;case 2:return [2,void 0]}}))}))},n$1.prototype.fetch=function(e){var t=e.channelUrl,n=e.token,r=e.limit,i$1=void 0===r?100:r,s=e.filter,a=void 0===s?new Li:s,o$1=e.order,u=void 0===o$1?Ri.CHANNEL_LATEST:o$1,c=e.backward,l=void 0!==c&&c,d=e.parentMessageId,h=e.isPollOnly,f=void 0!==h&&h,p=e.exactMatch,m=void 0!==p&&p,v=e.inclusive,y=void 0===v||v;return i(this,void 0,void 0,(function(){var e,r,s,o$1=this;return o(this,(function(c){switch(c.label){case 0:return this.localCacheEnabled?(e=qi(u),r={where:{channelUrl:t,"/where":function(e){if(n)switch(u){case Ri.CHANNEL_LATEST:if(m&&e.createdAt!==n)return !1;if(l){if(y&&e.createdAt<n||!y&&e.createdAt<=n)return !1}else if(y&&e.createdAt>n||!y&&e.createdAt>=n)return !1;break;case Ri.NEWEST_CHILD_MESSAGE:if(!d||0===e.parentMessageId||e.parentMessageId!==d)return !1}return !(f&&!e._poll)&&a.match(o$1._deserialize(e))}},index:e,backward:l},[4,this.collection.query(r)]):[3,3];case 1:return [4,c.sent().fetch({limit:null!=i$1?i$1:void 0})];case 2:return s=c.sent(),[2,Promise.all(s.map((function(e){return i(o$1,void 0,void 0,(function(){return o(this,(function(t){return [2,this._deserialize(e)]}))}))})))];case 3:return [2,[]]}}))}))},n$1.prototype.getAllChildMessages=function(e,t){return void 0===t&&(t=new Li),i(this,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return [4,this.fetch({channelUrl:e.channelUrl,token:Date.now(),limit:null,backward:!1,filter:t,order:Ri.NEWEST_CHILD_MESSAGE,parentMessageId:e.messageId})];case 1:return [2,n.sent()]}}))}))},n$1.prototype.upsert=function(e){return i(this,void 0,void 0,(function(){var t,n=this;return o(this,(function(r){switch(r.label){case 0:return this.localCacheEnabled?[4,this.saveBlobs(e)]:[3,5];case 1:return r.sent(),t=e.map((function(e){return n._serialize(e)})),[4,this.collection.upsertMany(t)];case 2:return r.sent(),[4,this.upsertChildMessages(e)];case 3:return r.sent(),[4,this._unsentMessageCache.upsertChildMessages(e)];case 4:r.sent(),r.label=5;case 5:return [2]}}))}))},n$1.prototype.upsertChildMessages=function(e){return i(this,void 0,void 0,(function(){var t=this;return o(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,Promise.all(e.map((function(e){return i(t,void 0,void 0,(function(){var t,n;return o(this,(function(r){switch(r.label){case 0:return t=[],(null===(n=e.threadInfo)||void 0===n?void 0:n.replyCount)&&e.threadInfo.replyCount>0?[4,this.getAllChildMessages(e)]:[3,2];case 1:t=r.sent(),r.label=2;case 2:return t.length>0?(t.forEach((function(t){return t.applyParentMessage(e)})),[4,this.upsert(t)]):[3,4];case 3:r.sent(),r.label=4;case 4:return [2]}}))}))})))]:[3,2];case 1:n.sent(),n.label=2;case 2:return [2]}}))}))},n$1.prototype.remove=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,s$1,a;return o(this,(function(o){switch(o.label){case 0:if(!this.localCacheEnabled)return [3,8];o.label=1;case 1:o.trys.push([1,6,7,8]),t=s(e),n=t.next(),o.label=2;case 2:return n.done?[3,5]:(r=n.value,[4,this.collection.remove("".concat(r))]);case 3:o.sent(),o.label=4;case 4:return n=t.next(),[3,2];case 5:return [3,8];case 6:return i=o.sent(),s$1={error:i},[3,8];case 7:try{n&&!n.done&&(a=t.return)&&a.call(t);}finally{if(s$1)throw s$1.error}return [7];case 8:return [2]}}))}))},n$1.prototype.removeMessagesOfChannel=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:e},index:qi(Ri.CHANNEL_LATEST)})]:[3,6];case 1:return n.sent(),[4,(t=this._cacheContext.preference).remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/sync"))];case 2:return n.sent(),[4,t.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/sync.meta"))];case 3:return n.sent(),[4,t.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/changelogs"))];case 4:return n.sent(),[4,t.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/changelogs.meta"))];case 5:n.sent(),n.label=6;case 6:return [2]}}))}))},n$1.prototype.removeUnderOffset=function(e,t){return i(this,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:e,createdAt:{"<":t}},index:qi(Ri.CHANNEL_LATEST)})]:[3,2];case 1:n.sent(),n.label=2;case 2:return [2]}}))}))},n$1.prototype.clear=function(){return i(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return [2]}}))}))},n$1.prototype.countBetween=function(e,t,n){return i(this,void 0,void 0,(function(){var r,i=this;return o(this,(function(s){switch(s.label){case 0:return this.localCacheEnabled?(r=qi(Ri.CHANNEL_LATEST),[4,this.collection.query({where:{channelUrl:e,"/where":function(e){var r=i._deserialize(e);return n.includes(r.createdAt)&&t.match(r)}},index:r}).count()]):[3,2];case 1:return [2,s.sent()];case 2:return [2,0]}}))}))},n$1.prototype.saveBlobs=function(e){return i(this,void 0,void 0,(function(){var t=this;return o(this,(function(n){switch(n.label){case 0:return [4,Promise.all(e.map((function(e){return i(t,void 0,void 0,(function(){var t,n;return o(this,(function(r){switch(r.label){case 0:return e instanceof He&&e.messageParams&&((t=e.messageParams).file&&St$1(t.file))?[4,this.collection.saveBlob(t.file,e.reqId)]:[3,2];case 1:n=r.sent(),t.fileKey=n,r.label=2;case 2:return [2]}}))}))})))];case 1:return n.sent(),[2]}}))}))},n$1.prototype._getGroupChannelPreferenceSize=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,s,a;return o(this,(function(o){switch(o.label){case 0:return t=0,[4,(n=this._cacheContext.preference).get("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/sync"))];case 1:return r=o.sent(),[4,n.get("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/sync.meta"))];case 2:return i=o.sent(),[4,n.get("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/changelogs"))];case 3:return s=o.sent(),[4,n.get("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/changelogs.meta"))];case 4:return a=o.sent(),r&&(t+=JSON.stringify(r).length),i&&(t+=JSON.stringify(i).length),s&&(t+=JSON.stringify(s).length),a&&(t+=JSON.stringify(a).length),[2,t]}}))}))},n$1}(Fi),Yi={},Ji=function(t$1){function n(e){var n=t$1.call(this,e)||this;return n._observers=new Map,n._dispatcherContext=n._dispatcher.on((function(e){return i(n,void 0,void 0,(function(){var t,n,r,i$1,s,a,o$1,u,c,l,d,h,f,p,m=this;return o(this,(function(v){switch(v.label){case 0:return e instanceof No?(t=e.messages,f=e.source,s=e.isWebSocketEventComing,n=t.filter((function(e){return e.messageId>0})),r=t.filter((function(e){return 0===e.messageId})),n.length>0?[4,mi$1((function(){return i(m,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return [4,this._messageCache.upsert(n)];case 1:return e.sent(),[4,this._unsentMessageCache.remove(n.map((function(e){return e instanceof De?e.reqId:null})).filter((function(e){return null!==e})))];case 2:return e.sent(),[2]}}))}))}))]:[3,2]):[3,5];case 1:v.sent(),s||this._broadcastUpdateEvent(n,f),v.label=2;case 2:return r.length>0?[4,mi$1((function(){return i(m,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return [4,this._unsentMessageCache.upsert(r)];case 1:return e.sent(),[2]}}))}))}))]:[3,4];case 3:v.sent(),s||this._broadcastUpdateEvent(r,f),v.label=4;case 4:return [3,21];case 5:return e instanceof To?(i$1=e.messageIds,f=e.source,s=e.isWebSocketEventComing,[4,mi$1((function(){return i(m,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return [4,this._messageCache.remove(i$1)];case 1:return e.sent(),[2]}}))}))}))]):[3,7];case 6:return v.sent(),s||this._broadcastRemoveEvent(i$1,f),[3,21];case 7:return e instanceof So?(a=e.reqId,f=e.source,[4,mi$1((function(){return i(m,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return [4,this._unsentMessageCache.remove([a])];case 1:return e.sent(),[2]}}))}))}))]):[3,9];case 8:return v.sent(),this._broadcastRemoveUnsentEvent(a,f),[3,21];case 9:return e instanceof Ao?(o$1=e.polls,f=e.source,this._cacheContext.localCacheEnabled?(u=o$1.map((function(e){return e.messageId})),[4,Promise.all(u.map((function(e){return m._messageCache.get(e)})))]):[3,12]):[3,13];case 10:return (c=v.sent().filter((function(e){return e}))).length>0&&o$1.forEach((function(e){var t=c.find((function(t){return t.messageId===e.messageId}));t&&t.applyPoll(e);})),[4,mi$1((function(){return i(m,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return [4,this._messageCache.upsert(c)];case 1:return [2,e.sent()]}}))}))}))];case 11:v.sent(),v.label=12;case 12:return this._broadcastPollChangeLogEvent(o$1,f),[3,21];case 13:return e instanceof Co?(l=e.event,f=e.source,[4,this._messageCache.get(l.messageId)]):[3,17];case 14:return (d=v.sent())&&d.isUserMessage()&&d.poll&&d.poll.applyPollUpdateEvent(l)?[4,mi$1((function(){return i(m,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return [4,this._messageCache.upsert([d])];case 1:return [2,e.sent()]}}))}))}))]:[3,16];case 15:v.sent(),v.label=16;case 16:return this._broadcastPollUpdateEvent(l,f),[3,21];case 17:return e instanceof ko?(h=e.event,f=e.source,[4,this._messageCache.get(h.messageId)]):[3,21];case 18:return (p=v.sent())&&p.isUserMessage()&&p.poll&&p.poll.applyPollVoteEvent(h)?[4,mi$1((function(){return i(m,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return [4,this._messageCache.upsert([p])];case 1:return [2,e.sent()]}}))}))}))]:[3,20];case 19:v.sent(),v.label=20;case 20:this._broadcastPollVoteEvent(h,f),v.label=21;case 21:return [2]}}))}))})),n}return t(n,t$1),Object.defineProperty(n.prototype,"_cacheContext",{get:function(){return _o.of(this._iid).cacheContext},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"_dispatcher",{get:function(){return _o.of(this._iid).dispatcher},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"_messageCache",{get:function(){return Hi.of(this._iid)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"_unsentMessageCache",{get:function(){return Vi.of(this._iid)},enumerable:!1,configurable:!0}),n.of=function(e,t){var r;return void 0===t&&(t=!1),Yi[e]&&!t||(Yi[e]&&(null===(r=Yi[e]._dispatcherContext)||void 0===r||r.close()),Yi[e]=new n(e)),Yi[e]},n.prototype._broadcastUpdateEvent=function(e,t){var n,r;try{for(var i=s(this._observers.values()),s$1=i.next();!s$1.done;s$1=i.next()){var a=s$1.value;a.onUpdate&&a.onUpdate(e,t);}}catch(e){n={error:e};}finally{try{s$1&&!s$1.done&&(r=i.return)&&r.call(i);}finally{if(n)throw n.error}}},n.prototype._broadcastPollChangeLogEvent=function(e,t){var n,r;try{for(var i=s(this._observers.values()),s$1=i.next();!s$1.done;s$1=i.next()){var a=s$1.value;a.onPollChangeLogUpdate&&a.onPollChangeLogUpdate(e,t);}}catch(e){n={error:e};}finally{try{s$1&&!s$1.done&&(r=i.return)&&r.call(i);}finally{if(n)throw n.error}}},n.prototype._broadcastPollUpdateEvent=function(e,t){var n,r;try{for(var i=s(this._observers.values()),s$1=i.next();!s$1.done;s$1=i.next()){var a=s$1.value;a.onPollUpdate&&a.onPollUpdate(e,t);}}catch(e){n={error:e};}finally{try{s$1&&!s$1.done&&(r=i.return)&&r.call(i);}finally{if(n)throw n.error}}},n.prototype._broadcastPollVoteEvent=function(e,t){var n,r;try{for(var i=s(this._observers.values()),s$1=i.next();!s$1.done;s$1=i.next()){var a=s$1.value;a.onPollVote&&a.onPollVote(e,t);}}catch(e){n={error:e};}finally{try{s$1&&!s$1.done&&(r=i.return)&&r.call(i);}finally{if(n)throw n.error}}},n.prototype._broadcastRemoveEvent=function(e,t){var n,r;try{for(var i=s(this._observers.values()),s$1=i.next();!s$1.done;s$1=i.next()){var a=s$1.value;a.onRemove&&a.onRemove(e,t);}}catch(e){n={error:e};}finally{try{s$1&&!s$1.done&&(r=i.return)&&r.call(i);}finally{if(n)throw n.error}}},n.prototype._broadcastRemoveUnsentEvent=function(e,t){var n,r;try{for(var i=s(this._observers.values()),s$1=i.next();!s$1.done;s$1=i.next()){var a=s$1.value;a.onRemoveUnsent&&a.onRemoveUnsent(e,t);}}catch(e){n={error:e};}finally{try{s$1&&!s$1.done&&(r=i.return)&&r.call(i);}finally{if(n)throw n.error}}},n.prototype.subscribe=function(e,t){this._observers.set(e,t);},n.prototype.unsubscribe=function(e){this._observers.delete(e);},n.prototype.unsubscribeAll=function(){this._observers.clear();},n}(Fi),Xi={},Zi=function(){function e(e,t){var n=t.sdkState,r=t.dispatcher,i=t.requestQueue,s=t.onlineDetector,a=t.cacheContext;this._iid=e,this._sdkState=n,this._requestQueue=i,this._dispatcher=r,this._cacheContext=a,Hi.of(e),Vi.of(e),Ji.of(e),this.fileMessageQueue=new tt(e,{sdkState:n,dispatcher:r,requestQueue:i,onlineDetector:s,cacheContext:a}),Xi[e]=this;}return e.of=function(e){return Xi[e]},e.prototype.buildMessageFromSerializedData=function(e){var t=Wi$1(e);switch(t.messageType){case P.USER:return new je(this._iid,je.payloadify(t));case P.FILE:return Ge._isMultipleFilesMessageSerializedData(t)?new Ge(this._iid,Ge.payloadify(t)):new He(this._iid,He.payloadify(t));case P.ADMIN:return new Be(this._iid,Be.payloadify(t))}throw v$1.invalidParameters},e.prototype.buildUserMessageCreateParamsFromSerializedData=function(e,t){return J($({data:t.data,customType:t.customType,mentionType:t.mentionType,mentionedUserIds:t.mentionedUserIds,mentionedUsers:t.mentionedUsers,mentionedMessageTemplate:t.mentionedMessageTemplate,metaArrays:t.metaArrays,parentMessageId:t.parentMessageId,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption,appleCriticalAlertOptions:t.appleCriticalAlertOptions,reqId:t.reqId,message:t.message,translationTargetLanguages:Object.keys(t.translations),pollId:e.pollId}))},e.prototype.buildFileMessageCreateParamsFromSerializedData=function(e,t){var n;return J($({data:t.data,customType:t.customType,mentionType:t.mentionType,mentionedUserIds:t.mentionedUserIds,mentionedUsers:t.mentionedUsers,mentionedMessageTemplate:t.mentionedMessageTemplate,metaArrays:t.metaArrays,parentMessageId:t.parentMessageId,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption,appleCriticalAlertOptions:t.appleCriticalAlertOptions,reqId:t.reqId,file:e.file,fileKey:e.fileKey,fileUrl:t.plainUrl,fileName:t.name,fileSize:t.size,mimeType:t.type,thumbnailSizes:null===(n=t.thumbnails)||void 0===n?void 0:n.map((function(e){return {maxWidth:e.width,maxHeight:e.height}})),fileType:e.fileType,requireAuth:t.requireAuth}))},e.prototype.buildMultipleFilesMessageCreateParamsFromSerializedData=function(e,t){return J({data:t.data,customType:t.customType,mentionType:t.mentionType,mentionedUserIds:t.mentionedUserIds,mentionedUsers:t.mentionedUsers,mentionedMessageTemplate:t.mentionedMessageTemplate,metaArrays:t.metaArrays,parentMessageId:t.parentMessageId,isReplyToChannel:e.isReplyToChannel,pushNotificationDeliveryOption:e.pushNotificationDeliveryOption,appleCriticalAlertOptions:t.appleCriticalAlertOptions,reqId:t.reqId,fileInfoList:e.fileInfoList})},e.prototype.buildScheduledUserMessageCreateParamsFromSerializedData=function(e,t){return n(n({},this.buildUserMessageCreateParamsFromSerializedData(e,t)),{scheduledAt:e.scheduledAt})},e.prototype.buildScheduledFileMessageCreateParamsFromSerializedData=function(e,t){return n(n({},this.buildFileMessageCreateParamsFromSerializedData(e,t)),{scheduledAt:e.scheduledAt})},e.prototype.buildSenderFromSerializedData=function(e){var t=Wi$1(e);return new Re(this._iid,Re.payloadify(t))},e.prototype.getMessage=function(e){return i(this,void 0,void 0,(function(){var t,n;return o(this,(function(r){switch(r.label){case 0:return t=new ot$1(e),[4,this._requestQueue.send(t)];case 1:return n=r.sent(),[2,n.as(ut$1).message]}}))}))},e.prototype.getScheduledMessage=function(e){return i(this,void 0,void 0,(function(){var t,n;return o(this,(function(r){switch(r.label){case 0:return t=new ft$1(e),[4,this._requestQueue.send(t)];case 1:return n=r.sent(),[2,n.as(pt$1).message]}}))}))},e.prototype.getMessagesByMessageId=function(e,t,n$1,r,i$1){return void 0===i$1&&(i$1=po.REQUEST_MESSAGE),i(this,void 0,void 0,(function(){var s,a,u;return o(this,(function(c){switch(c.label){case 0:return s=new ct$1(n(n({channelType:t,channelUrl:e,token:String(n$1)},rt),r)),[4,this._requestQueue.send(s)];case 1:return a=c.sent(),u=a.as(lt$1).messages,this._dispatcher.dispatch(new No({messages:u,source:i$1})),[2,u]}}))}))},e.prototype.getMessagesByTimestamp=function(e,t,n$1,r,i$1){return void 0===i$1&&(i$1=po.REQUEST_MESSAGE),i(this,void 0,void 0,(function(){var s,a,u;return o(this,(function(c){switch(c.label){case 0:return s=new ct$1(n(n({channelType:t,channelUrl:e,timestamp:n$1},rt),r)),[4,this._requestQueue.send(s)];case 1:return a=c.sent(),u=a.as(lt$1).messages,this._dispatcher.dispatch(new No({messages:u,source:i$1})),[2,u]}}))}))},e.prototype._getMessagesByTimestampForCollection=function(e,t,n$1,r,i$1,s){return void 0===i$1&&(i$1=po.REQUEST_MESSAGE),i(this,void 0,void 0,(function(){var a,u,c,l;return o(this,(function(d){switch(d.label){case 0:return a=new ct$1(n(n(n({channelType:t,channelUrl:e,timestamp:n$1},rt),r),{checkingContinuousMessages:s})),[4,this._requestQueue.send(a)];case 1:return u=d.sent(),c=u.payload,l=u.as(lt$1).messages,this._dispatcher.dispatch(new No({messages:l,source:i$1})),[2,{messages:l,isContinuousMessages:c}]}}))}))},e.prototype.getThreadedMessagesByTimestamp=function(e,t,n$1,r){return void 0===r&&(r=po.REQUEST_THREADED_MESSAGE),i(this,void 0,void 0,(function(){var i,s,a,u;return o(this,(function(c){switch(c.label){case 0:return i=new ct$1(n(n(n({channelUrl:e.channelUrl,channelType:e.channelType,timestamp:t},Fe),n$1),{replyType:V.ALL,parentMessageId:e.messageId,includeThreadInfo:!0})),[4,this._requestQueue.send(i)];case 1:return s=c.sent(),a=s.as(lt$1).messages,(u=a.slice(1)).forEach((function(t){t.parentMessage=e;})),this._dispatcher.dispatch(new No({messages:u,source:r})),[2,{parentMessage:a[0],threadedMessages:u}]}}))}))},e.prototype.getMessageChangelogs=function(e,t,n$1,i$1,s){return void 0===s&&(s=po.REQUEST_MESSAGE_CHANGELOGS),i(this,void 0,void 0,(function(){var u,c,l,d,h,f,p,m;return o(this,(function(v){switch(v.label){case 0:return u=new dt$1(J($(n(n({channelType:t,channelUrl:e,timestamp:"number"==typeof n$1?n$1:null,token:"string"==typeof n$1?n$1:null},st$1),i$1)))),[4,this._requestQueue.send(u)];case 1:return c=v.sent(),l=c.as(ht$1),d=l.updatedMessages,h=l.deletedMessagesInfo,f=l.hasMore,p=l.nextToken,m=h.map((function(e){return e.messageId})),d.length>0&&this._dispatcher.dispatch(new No({messages:d,source:s})),m.length>0&&this._dispatcher.dispatch(new To({messageIds:m,source:s})),[2,{updatedMessages:d,deletedMessageIds:m,hasMore:f,token:p}]}}))}))},e}();(function(t$1){function n(e,n){var r=t$1.call(this,e)||this;r.targetMessageId=0;var i=n.thread_info,s=n.parent_message_id,a=n.channel_url,o=n.channel_type;return i&&w("object",i)&&w("number",s)&&w("string",a)&&w("string",o)&&(r.threadInfo=new Me(e,i),r.targetMessageId=s,r.channelUrl=a,r.channelType=o),r}return t(n,t$1),n})(Fi);var es={channelUrl:"",channelType:x.BASE,messageId:0,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1,includeThreadInfo:!1},ts=function(n){function r(e){var r=e.channelCustomType,i=e.keyword,s=e.limit,a=e.reverse,o=e.exactMatch,u=e.channelUrl,c=e.order,l=e.messageTimestampFrom,d=e.messageTimestampTo,h=e.advancedQuery,f=e.targetFields,p=e.nextToken,m=n.call(this)||this;return m.method=ee.GET,m.path="".concat(ce,"/messages"),m.params={custom_type:r,query:i,limit:s,reverse:a,exact_match:o,channel_url:u,message_ts_from:l,message_ts_to:d,sort_field:c,advanced_query:h,target_fields:f,after:p},m}return t(r,n),r}(Ne$1),ns=function(t$1){function n(e,n){var r=t$1.call(this,e,n)||this;return r.messages=n.results.map((function(t){return We(e,t)})),r.hasNext=n.has_next,r.nextToken=n.end_cursor,r.totalCount=n.total_count,r}return t(n,t$1),n}(Te$1);!function(e){e.SCORE="score",e.TIMESTAMP="ts";}(Di||(Di={}));var rs=function(t$1){function n$1(e,n){var r,i,s,a,o,u,c,l,d,h=this;return (h=t$1.call(this,e,n)||this).keyword="",h.reverse=!1,h.exactMatch=!1,h.channelUrl="",h.channelCustomType="",h.messageTimestampFrom=null,h.messageTimestampTo=null,h.order=Di.SCORE,h.advancedQuery=!1,h.targetFields=null,h._nextToken="",h.totalCount=-1,h.keyword=n.keyword,h.reverse=null!==(r=n.reverse)&&void 0!==r&&r,h.exactMatch=null!==(i=n.exactMatch)&&void 0!==i&&i,h.channelUrl=null!==(s=n.channelUrl)&&void 0!==s?s:"",h.channelCustomType=null!==(a=n.channelCustomType)&&void 0!==a?a:"",h.messageTimestampFrom=null!==(o=n.messageTimestampFrom)&&void 0!==o?o:null,h.messageTimestampTo=null!==(u=n.messageTimestampTo)&&void 0!==u?u:null,h.order=null!==(c=n.order)&&void 0!==c?c:Di.SCORE,h.advancedQuery=null!==(l=n.advancedQuery)&&void 0!==l&&l,h.targetFields=null!==(d=n.targetFields)&&void 0!==d?d:null,h}return t(n$1,t$1),n$1.prototype._validate=function(){return t$1.prototype._validate.call(this)&&w("string",this.keyword)&&this.keyword.length>0&&w("boolean",this.reverse)&&w("boolean",this.exactMatch)&&w("string",this.channelUrl)&&w("string",this.channelCustomType)&&(w("number",this.messageTimestampFrom)||null===this.messageTimestampFrom)&&(w("number",this.messageTimestampTo)||null===this.messageTimestampTo)&&N$1(Di,this.order)&&w("boolean",this.advancedQuery)&&S$1("string",this.targetFields,!0)},n$1.prototype.next=function(){return i(this,void 0,void 0,(function(){var e,t,n$1,r,i,s,u,c;return o(this,(function(l){switch(l.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=_o.of(this._iid).requestQueue,t=new ts($(n(n({},this),{nextToken:this._nextToken?this._nextToken:null}))),[4,e.send(t)]):[3,2]:[3,5];case 1:return n$1=l.sent(),r=n$1.as(ns),i=r.messages,s=r.hasNext,u=r.nextToken,c=r.totalCount,this._nextToken=u,this._hasNext=s,this._isLoading=!1,this.totalCount=c,[2,i];case 2:return [2,[]];case 3:throw v$1.queryInProgress;case 4:return [3,6];case 5:throw v$1.invalidParameters;case 6:return [2]}}))}))},n$1}(Oo),is={channelUrl:"",scheduledMessageId:0},ss=function(t$1){function n$1(){var e=null!==t$1&&t$1.apply(this,arguments)||this;return e.name="message",e}return t(n$1,t$1),n$1.prototype.init=function(e,n){var r=n.sdkState,i=n.dispatcher,s=n.sessionManager,a=n.requestQueue,o=n.logger,u=n.onlineDetector,c=n.cacheContext;t$1.prototype.init.call(this,e,{sdkState:r,dispatcher:i,sessionManager:s,requestQueue:a,logger:o,onlineDetector:u,cacheContext:c}),this._manager=new Zi(e,{sdkState:r,dispatcher:i,requestQueue:a,onlineDetector:u,cacheContext:c});},n$1.prototype.buildMessageFromSerializedData=function(e){return this._manager.buildMessageFromSerializedData(e)},n$1.prototype.buildSenderFromSerializedData=function(e){return this._manager.buildSenderFromSerializedData(e)},n$1.prototype.getMessage=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n$1){return t=n(n({},es),e),Qi$1(function(e){return w("string",e.channelUrl)&&N$1(x,e.channelType)&&w("number",e.messageId)&&w("boolean",e.includeReactions,!0)&&w("boolean",e.includeMetaArray,!0)&&w("boolean",e.includeParentMessageInfo,!0)&&w("boolean",e.includeThreadInfo,!0)}(t)).throw(v$1.invalidParameters),[2,this._manager.getMessage(t)]}))}))},n$1.prototype.getScheduledMessage=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n$1){return t=n(n({},is),e),Qi$1(function(e){return w("string",e.channelUrl)&&""!==e.channelUrl&&w("number",e.scheduledMessageId)&&e.scheduledMessageId>0}(t)).throw(v$1.invalidParameters),[2,this._manager.getScheduledMessage(t)]}))}))},n$1}(fo);

var f$1=function(t$1){function n$1(){var e=null!==t$1&&t$1.apply(this,arguments)||this;return e.name="poll",e}return t(n$1,t$1),n$1.prototype.init=function(e,r){var n=r.sdkState,o=r.dispatcher,i=r.sessionManager,s=r.requestQueue,l=r.logger,u=r.onlineDetector,c=r.cacheContext;t$1.prototype.init.call(this,e,{sdkState:n,dispatcher:o,sessionManager:i,requestQueue:s,logger:l,onlineDetector:u,cacheContext:c}),this._manager=new Zo(e,{sdkState:n,dispatcher:o,sessionManager:i,requestQueue:s,logger:l,onlineDetector:u,cacheContext:c});},n$1.prototype.create=function(t){return i(this,void 0,void 0,(function(){var e;return o(this,(function(a){return e=n(n({},Ho),t),Qi$1(Vo(e)).throw(v$1.invalidParameters),[2,this._manager.create(e)]}))}))},n$1.prototype.get=function(t){return i(this,void 0,void 0,(function(){var e;return o(this,(function(a){return e=n(n({},jo),t),Qi$1(Ko(e)).throw(v$1.invalidParameters),[2,this._manager.get(e)]}))}))},n$1.prototype.getOption=function(t){return i(this,void 0,void 0,(function(){var e;return o(this,(function(a){return e=n(n({},Go),t),Qi$1(qo(e)).throw(v$1.invalidParameters),[2,this._manager.getOption(e)]}))}))},n$1.prototype.buildPollFromSerializedData=function(t){return this._manager.buildPollFromSerializedData(t)},n$1}(fo);

var g,f,E;!function(e){e.LATEST_LAST_MESSAGE="latest_last_message",e.CHRONOLOGICAL="chronological",e.CHANNEL_NAME_ALPHABETICAL="channel_name_alphabetical",e.METADATA_VALUE_ALPHABETICAL="metadata_value_alphabetical";}(g||(g={})),function(e){e.CHRONOLOGICAL="chronological",e.CHANNEL_NAME_ALPHABETICAL="channel_name_alphabetical",e.METADATA_VALUE_ALPHABETICAL="metadata_value_alphabetical";}(f||(f={})),function(e){e.CREATED_AT="created_at",e.SCHEDULED_AT="scheduled_at";}(E||(E={}));var p,C=function(e){switch(e){case g.LATEST_LAST_MESSAGE:return ["-lastMessageUpdatedAt","-createdAt","syncIndex"];case g.CHRONOLOGICAL:return ["-createdAt","syncIndex"];case g.CHANNEL_NAME_ALPHABETICAL:return ["name"];default:return ["-lastMessageUpdatedAt","-createdAt","syncIndex"]}},L=function(t$1){function s(e){var s=e.message,n=t$1.call(this)||this;return n.message=s,n}return t(s,t$1),s}(X),R={},I=function(){function e(e,t){var s=t.localCacheEnabled,n=t.dispatcher,r=t.sdkState,a=t.logger,u=this;this._iid=e,R[e]=this,this._localCacheEnabled=s,this._isProcessingAutoResend=!1,this._autoResendQueue=[],this._dispatcher=n,this._logger=a,this._sdkState=r,this._localCacheEnabled&&n.on((function(e){if(e instanceof ai$1)switch(e.stateType){case ti$1.CONNECTED:u._isProcessingAutoResend||u.processAutoResendRegisteredPendingMessages().then((function(){return u._processNextAutoResend()}));break;case ti$1.INTERNAL_DISCONNECTED:case ti$1.EXTERNAL_DISCONNECTED:u._isProcessingAutoResend=!1;}}));}return e.of=function(e){return R[e]},e.prototype.processNonAutoResendRegisteredPendingMessages=function(){return i(this,void 0,void 0,(function(){var e,t,s$1,a,i,o$1;return o(this,(function(n){switch(n.label){case 0:return [4,this._fetchAllCachedPendingMessages()];case 1:e=n.sent();try{for(t=s(e),s$1=t.next();!s$1.done;s$1=t.next())0===(a=s$1.value).errorCode&&(this._logger.debug("cached pending message is not auto-resend registered. changing its sending status to failed: ",a.reqId),a.sendingStatus=q.FAILED,a.errorCode=u.ACK_TIMEOUT,this._dispatcher.dispatch(new No({messages:[a],source:po.LOCAL_MESSAGE_FAILED})));}catch(e){i={error:e};}finally{try{s$1&&!s$1.done&&(o$1=t.return)&&o$1.call(t);}finally{if(i)throw i.error}}return [2]}}))}))},e.prototype.processAutoResendRegisteredPendingMessages=function(){return i(this,void 0,void 0,(function(){var e,t,s$1,i,o$1,c,l,_;return o(this,(function(n){switch(n.label){case 0:return [4,this._fetchAllCachedPendingMessages()];case 1:e=n.sent();try{for(t=s(e),s$1=t.next();!s$1.done;s$1=t.next())(i=s$1.value).errorCode&&C$1(i.errorCode)&&(o$1=(new Date).getTime(),c=i.createdAt+2592e5,o$1<=c?this._autoResendQueue.map((function(e){return e.reqId})).indexOf(i.reqId)<0&&this._autoResendQueue.push(i):(this._logger.debug("auto-resend registered pending messaged expired. expiration date: ",new Date(c).toLocaleString()),i.sendingStatus=q.FAILED,this._dispatcher.dispatch(new No({messages:[i],source:po.LOCAL_MESSAGE_FAILED}))));}catch(e){l={error:e};}finally{try{s$1&&!s$1.done&&(_=t.return)&&_.call(t);}finally{if(l)throw l.error}}return [2]}}))}))},e.prototype.completeCurrentAndProcessNextAutoResend=function(e){if(this._localCacheEnabled&&(e.sendingStatus===q.SUCCEEDED||e.sendingStatus===q.FAILED&&!C$1(e.errorCode))){var t=this.indexOf(e);t>=0&&this._autoResendQueue.splice(t,1),0===t&&this._processNextAutoResend();}},e.prototype._fetchAllCachedPendingMessages=function(){return i(this,void 0,void 0,(function(){var e,t;return o(this,(function(s){switch(s.label){case 0:return (e=Vi.of(this._iid))?[4,e.fetch({sendingStatus:q.PENDING,backward:!0})]:[3,2];case 1:return t=s.sent(),[3,3];case 2:t=[],s.label=3;case 3:return [2,t]}}))}))},e.prototype.indexOf=function(e){return this._autoResendQueue.length>0?this._autoResendQueue.map((function(e){return e.reqId})).indexOf(e.reqId):-1},e.prototype._isNotInQueue=function(e){return -1===this._autoResendQueue.map((function(e){return e.reqId})).indexOf(e.reqId)},e.prototype._processNextAutoResend=function(){return i(this,void 0,void 0,(function(){var e;return o(this,(function(t){if(this._localCacheEnabled&&"foreground"===this._sdkState.appState)try{this._autoResendQueue.length>0?(this._isProcessingAutoResend||(this._logger.debug("auto-resend queue started."),this._isProcessingAutoResend=!0),e=this._autoResendQueue[0],this._dispatcher.dispatch(new L({message:e})),this._logger.debug("processing auto-resend for message request id: ",e.reqId)):(this._logger.debug("auto-resend queue finished."),this._isProcessingAutoResend=!1);}catch(e){this._logger.warn("process auto-resend error: ",e),this._isProcessingAutoResend=!1;}return [2]}))}))},e}();!function(e){e[e.USER_BLOCK=20001]="USER_BLOCK",e[e.USER_UNBLOCK=2e4]="USER_UNBLOCK",e[e.FRIEND_DISCOVERED=20900]="FRIEND_DISCOVERED";}(p||(p={}));var S=function(){function e(e){this.category=e.cat,this.data=e.data;}return e.getDataAsUserBlockEvent=function(e,t){var s=t.data,n=s.blocker,r=s.blockee;return {blocker:new Xi$1(e,n),blockee:new Xi$1(e,r)}},e.getDataAsFriendDiscoveredEvent=function(e,t){var s=t.data.friend_discoveries;return {friendDiscoveries:Array.isArray(s)?s.map((function(t){return new Xi$1(e,t)})):[]}},e}(),N=function(t$1){function s(e,s){var n=s.userId,r=t$1.call(this)||this;return r._iid=e,r.userId=n,r}return t(s,t$1),s}(X),v=function(t$1){function s(){return t$1.call(this)||this}return t(s,t$1),s}(X),D=function(t$1){function s(e,s,n){var r=t$1.call(this,e,"USEV",n)||this;return r.event=new S(n),r}return t(s,t$1),s}(Pe$1);

var e=function(e){return ["-lastMessageUpdatedAt","-createdAt","syncIndex"]};

var it=function(e){this.key=e.key,this.url=e.url;},ot=function(e){this.id=e.id,this.name=e.name,this.url=e.url,this.emojis=e.emojis?e.emojis.map((function(e){return new it(e)})):[];},st=function(e){this.emojiHash=e.emoji_hash||"",this.emojiCategories=e.emoji_categories?e.emoji_categories.map((function(e){return new ot(e)})):[];},at={profileImage:void 0,profileUrl:void 0,nickname:void 0},ut=function(e$1){return {v2:e$1.commitSchema([{collectionName:ur,keyName:cr,index:[C(g.LATEST_LAST_MESSAGE),C(g.CHRONOLOGICAL),C(g.CHANNEL_NAME_ALPHABETICAL)]},{collectionName:dr,keyName:hr,index:[qi(Ri.CHANNEL_LATEST),qi(Ri.NEWEST_CHILD_MESSAGE)]},{collectionName:ji,keyName:Qi,index:[qi(Ri.CHANNEL_LATEST),qi(Ri.NEWEST_CHILD_MESSAGE)]},{collectionName:fr,keyName:pr}]),v3:e$1.commitSchema([{collectionName:vr,keyName:yr,index:[e()]}])}},ct=function(e,t){return function(n,r){switch(n){case 1:e.clear().then((function(){t.clear().then((function(){ut(e).v2.then((function(){return r()})).catch((function(e){return r(e)}));})).catch((function(e){return r(e)}));})).catch((function(e){return r(e)}));break;case 2:ut(e).v3.then((function(){return r()})).catch((function(e){return r(e)}));break;default:r();}}},dt=function(){return "undefined"!=typeof document?document.visibilityState:"visible"},lt=function(e){function t$1(t){var n=t.getVisibilityState,r=void 0===n?dt:n,i=t.initialState,o=void 0===i?"visible":i,s=t.isEnabled,a=void 0===s||s,u=t.pauseCheckDelay,c=void 0===u?3e4:u,d=e.call(this)||this;return d._pauseCheckDelay=3e4,d._currentState="visible",d._getVisibilityState=r,d._pauseCheckDelay=c,d._currentState=o,d._isEnabled=a,d._boundToggleState=d._toggleState.bind(d),d}return t(t$1,e),Object.defineProperty(t$1.prototype,"currentState",{get:function(){return this._currentState},enumerable:!1,configurable:!0}),Object.defineProperty(t$1.prototype,"isAvailable",{get:function(){return "undefined"!=typeof window&&!!window.addEventListener&&!!window.removeEventListener},enumerable:!1,configurable:!0}),t$1.prototype._toggleState=function(){var e=this,t=this._getVisibilityState();"hidden"!==t?"hidden"===this._currentState&&(this._pauseDelayTimer&&(clearTimeout(this._pauseDelayTimer),this._pauseDelayTimer=void 0),this.dispatch("resume")):"hidden"!==this._currentState&&(this._pauseDelayTimer=setTimeout((function(){e._pauseDelayTimer=void 0,e.dispatch("pause");}),this._pauseCheckDelay)),this._currentState=t;},t$1.prototype.start=function(){this._isEnabled&&this.isAvailable&&(this._boundToggleState=this._toggleState.bind(this),window.addEventListener("visibilitychange",this._boundToggleState,{capture:!0}));},t$1.prototype.stop=function(){this._isEnabled&&this.isAvailable&&this._boundToggleState&&window.removeEventListener("visibilitychange",this._boundToggleState,{capture:!0});},t$1}(Q),ht=function(){function e(e){var t=e.logger,n=e.connectionDelegate,r=void 0===n?null:n,i=this;this._onlineWorker=function(){var e;return null===(e=i.connectionDelegate)||void 0===e?void 0:e.reconnect()},this._offlineWorker=function(){var e;return null===(e=i.connectionDelegate)||void 0===e?void 0:e.disconnect()},this.unsubscribes=[],this._onlineListener=function(e){if(i.isAvailableOnWeb)return window.addEventListener("online",e),function(){return window.removeEventListener("online",e,!1)}},this._offlineListener=function(e){if(i.isAvailableOnWeb)return window.addEventListener("offline",e),function(){return window.removeEventListener("offline",e,!1)}},this.logger=t,r&&(this.connectionDelegate=r);}return Object.defineProperty(e.prototype,"isAvailableOnWeb",{get:function(){return "undefined"!=typeof window&&!!window.addEventListener&&"ononline"in window&&"onoffline"in window&&"undefined"!=typeof navigator&&void 0!==navigator.onLine},enumerable:!1,configurable:!0}),e.prototype.setOnlineListener=function(e){Boolean(e)&&"function"==typeof e&&(this._onlineListener=e);},e.prototype.setOfflineListener=function(e){Boolean(e)&&"function"==typeof e&&(this._offlineListener=e);},e.prototype.start=function(){this.unsubscribes=[this._onlineListener(this._onlineWorker),this._offlineListener(this._offlineWorker)];},e.prototype.stop=function(){var e=this;this.unsubscribes.forEach((function(t){try{null==t||t();}catch(t){e.logger.warn(t.message);}})),this.unsubscribes=[];},e.prototype.isOnline=function(){return i(this,void 0,void 0,(function(){return o(this,(function(e){return this.isAvailableOnWeb?[2,navigator.onLine]:[2,new Promise((function(e){fetch("https://www.google.com",{method:ee.GET,mode:"no-cors"}).then((function(){return e(!0)})).catch((function(){return e(!1)}));}))]}))}))},e}(),ft=function(e){function t$1(t){var n=t.userId,r=t.nickname,i=t.profileUrl,o=t.profileImage,s=t.preferredLanguages,a=e.call(this)||this;return a.method=ee.PUT,a.path="".concat(ne,"/").concat(encodeURIComponent(n)),a.params=J($({nickname:r,profile_url:i,profile_file:o,preferred_languages:s})),a}return t(t$1,e),t$1}(Ne$1),pt=function(e){function t$1(t,n$1){var r=e.call(this,t,n$1)||this;return r.user=new Xi$1(t,n({},n$1)),r}return t(t$1,e),t$1}(Te$1),vt=function(e){function t$1(t){var n=t.userId,r=t.token,i=e.call(this)||this;return i.method=ee.POST,i.path="".concat(ne,"/").concat(encodeURIComponent(n),"/push/apns"),i.params={apns_device_token:r,always_push:!0},i}return t(t$1,e),t$1}(Ne$1);!function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.token=n.token,r.type=n.type?f$2[n.type.toLowerCase()]:f$2.UNKNOWN,r.user=new Xi$1(t,n.user),r}t(t$1,e);}(Te$1);var gt=function(e){function t$1(t){var n=t.userId,r=t.token,i=e.call(this)||this;return i.method=ee.POST,i.path="".concat(ne,"/").concat(encodeURIComponent(n),"/push/gcm"),i.params={gcm_reg_token:r,always_push:!0},i}return t(t$1,e),t$1}(Ne$1);!function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.token=n.token,r.type=n.type?f$2[n.type.toLowerCase()]:f$2.UNKNOWN,r.user=new Xi$1(t,n.user),r}t(t$1,e);}(Te$1);var _t=function(e){function t$1(t){var n=t.userId,r=t.token,i=e.call(this)||this;return i.method=ee.DELETE,i.path="".concat(ne,"/").concat(encodeURIComponent(n),"/push/apns/").concat(encodeURIComponent(r)),i}return t(t$1,e),t$1}(Ne$1);!function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.token=n.token,r.user=new Xi$1(t,n.user),r.lastDeletedAt=n.device_token_last_deleted_at,r}t(t$1,e);}(Te$1);var mt=function(e){function t$1(t){var n=t.userId,r=t.token,i=e.call(this)||this;return i.method=ee.DELETE,i.path="".concat(ne,"/").concat(encodeURIComponent(n),"/push/gcm/").concat(encodeURIComponent(r)),i}return t(t$1,e),t$1}(Ne$1);!function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.token=n.token,r.user=new Xi$1(t,n.user),r.lastDeletedAt=n.device_token_last_deleted_at,r}t(t$1,e);}(Te$1);var bt=function(e){function t$1(t){var n=t.userId,r=e.call(this)||this;return r.method=ee.DELETE,r.path="".concat(ne,"/").concat(encodeURIComponent(n),"/push/apns"),r}return t(t$1,e),t$1}(Ne$1);!function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.type=n.type?f$2[n.type.toLowerCase()]:f$2.UNKNOWN,r.user=new Xi$1(t,n.user),r.lastDeletedAt=n.device_token_last_deleted_at,r}t(t$1,e);}(Te$1);var yt=function(e){function t$1(t){var n=t.userId,r=e.call(this)||this;return r.method=ee.DELETE,r.path="".concat(ne,"/").concat(encodeURIComponent(n),"/push/gcm"),r}return t(t$1,e),t$1}(Ne$1);!function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.type=n.type?f$2[n.type.toLowerCase()]:f$2.UNKNOWN,r.user=new Xi$1(t,n.user),r.lastDeletedAt=n.device_token_last_deleted_at,r}t(t$1,e);}(Te$1);var wt=function(e){function t$1(t){var n=t.userId,r=t.type,i=t.token,o=t.ts,s=e.call(this)||this;return s.method=ee.GET,s.path="".concat(ne,"/").concat(encodeURIComponent(n),"/push/").concat(encodeURIComponent(r),"/device_tokens"),s.params={created_ts:o,token:i},s}return t(t$1,e),t$1}(Ne$1),It=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.pushTokens={type:n.type?f$2[n.type.toLowerCase()]:f$2.UNKNOWN,deviceTokens:n.device_tokens,hasMore:n.has_more,token:n.token},r}return t(t$1,e),t$1}(Te$1),kt=function(e){function t$1(t){var n=t.userId,r=e.call(this)||this;return r.method=ee.GET,r.path="".concat(ne,"/").concat(encodeURIComponent(n),"/channel_invitation_preference"),r}return t(t$1,e),t$1}(Ne$1),Ct=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.autoAccept=n.auto_accept,r}return t(t$1,e),t$1}(Te$1),St=function(e){function t$1(t){var n=t.userId,r=t.willAutoAccept,i=e.call(this)||this;return i.method=ee.PUT,i.path="".concat(ne,"/").concat(encodeURIComponent(n),"/channel_invitation_preference"),i.params={auto_accept:r},i}return t(t$1,e),t$1}(Ne$1),Tt=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.autoAccept=n.auto_accept,r}return t(t$1,e),t$1}(Te$1),Et=function(e){function t$1(t){var n=t.userId,r=e.call(this)||this;return r.method=ee.GET,r.path="".concat(ne,"/").concat(encodeURIComponent(n),"/push_preference"),r}return t(t$1,e),t$1}(Ne$1),Pt=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.preference={doNotDisturbOn:n.do_not_disturb,startHour:n.start_hour,startMin:n.start_min,endHour:n.end_hour,endMin:n.end_min,timezone:n.timezone},r}return t(t$1,e),t$1}(Te$1),Ut=function(e){function t$1(t){var n=t.userId,r=t.doNotDisturbOn,i=t.startHour,o=t.startMin,s=t.endHour,a=t.endMin,u=t.timezone,l=e.call(this)||this;return l.method=ee.PUT,l.path="".concat(ne,"/").concat(encodeURIComponent(n),"/push_preference"),l.params={do_not_disturb:r,start_hour:i,start_min:o,end_hour:s,end_min:a,timezone:u},l}return t(t$1,e),t$1}(Ne$1),Dt=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.preference={doNotDisturbOn:n.do_not_disturb,startHour:n.start_hour,startMin:n.start_min,endHour:n.end_hour,endMin:n.end_min,timezone:n.timezone},r}return t(t$1,e),t$1}(Te$1),Ot=function(e){function t$1(t){var n=t.userId,r=e.call(this)||this;return r.method=ee.GET,r.path="".concat(ne,"/").concat(encodeURIComponent(n),"/push_preference"),r}return t(t$1,e),t$1}(Ne$1),At=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.snoozePeriod={isSnoozeOn:n.snooze_enabled},"number"==typeof n.snooze_start_ts&&(r.snoozePeriod.startTs=n.snooze_start_ts),"number"==typeof n.snooze_end_ts&&(r.snoozePeriod.endTs=n.snooze_end_ts),r}return t(t$1,e),t$1}(Te$1),Lt=function(e){function t$1(t){var n=t.userId,r=t.snoozeOn,i=t.startTs,o=t.endTs,s=e.call(this)||this;return s.method=ee.PUT,s.path="".concat(ne,"/").concat(encodeURIComponent(n),"/push_preference"),s.params={snooze_enabled:r,snooze_start_ts:i,snooze_end_ts:o},s}return t(t$1,e),t$1}(Ne$1),Nt=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.snoozePeriod={isSnoozeOn:n.snooze_enabled},"number"==typeof n.snooze_start_ts&&(r.snoozePeriod.startTs=n.snooze_start_ts),"number"==typeof n.snooze_end_ts&&(r.snoozePeriod.endTs=n.snooze_end_ts),r}return t(t$1,e),t$1}(Te$1),Mt=function(e){function t$1(t){var n=t.userId,r=t.blockedUserId,i=e.call(this)||this;return i.method=ee.POST,i.path="".concat(ne,"/").concat(encodeURIComponent(n),"/block"),i.params={target_id:r},i}return t(t$1,e),t$1}(Ne$1);!function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.user=new Xi$1(t,n),r}t(t$1,e);}(Te$1);var Rt=function(e){function t$1(t){var n=t.userId,r=t.unblockedUserId,i=e.call(this)||this;return i.method=ee.DELETE,i.path="".concat(ne,"/").concat(encodeURIComponent(n),"/block/").concat(encodeURIComponent(r)),i}return t(t$1,e),t$1}(Ne$1);!function(e){function t$1(){return null!==e&&e.apply(this,arguments)||this}t(t$1,e);}(Te$1);var zt=function(e){function t$1(t){var n=t.userId,r=e.call(this)||this;return r.method=ee.GET,r.path="".concat(ne,"/").concat(encodeURIComponent(n),"/push_preference"),r}return t(t$1,e),t$1}(Ne$1),Qt=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.pushTriggerOption=n.push_trigger_option,r}return t(t$1,e),t$1}(Te$1),jt=function(e){function t$1(t){var n=t.userId,r=t.pushTriggerOption,i=e.call(this)||this;return i.method=ee.PUT,i.path="".concat(ne,"/").concat(encodeURIComponent(n),"/push_preference"),i.params={push_trigger_option:r},i}return t(t$1,e),t$1}(Ne$1),qt=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.pushTriggerOption=n.push_trigger_option,r}return t(t$1,e),t$1}(Te$1),Ft=function(e){function t$1(t){var n=t.userId,r=e.call(this)||this;return r.method=ee.GET,r.path="".concat(ne,"/").concat(encodeURIComponent(n),"/push/template"),r}return t(t$1,e),t$1}(Ne$1),Ht=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.name=n.name,r}return t(t$1,e),t$1}(Te$1),xt=function(e){function t$1(t){var n=t.userId,r=t.templateName,i=e.call(this)||this;return i.method=ee.PUT,i.path="".concat(ne,"/").concat(encodeURIComponent(n),"/push/template"),i.params={name:r},i}return t(t$1,e),t$1}(Ne$1),Gt=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.name=n.name,r}return t(t$1,e),t$1}(Te$1),Wt=function(e){function t$1(t){var n=t.userId,r=t.token,i=e.call(this)||this;return i.method=ee.GET,i.path="".concat(ne,"/").concat(encodeURIComponent(n),"/friends/changelogs"),i.params={token:r},i}return t(t$1,e),t$1}(Ne$1),Bt=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.changelogs={addedUsers:n.added.map((function(e){return new Xi$1(t,e)})),updatedUsers:n.updated.map((function(e){return new Xi$1(t,e)})),deletedUserIds:n.deleted,hasMore:n.has_more,token:n.next},r}return t(t$1,e),t$1}(Te$1),Kt=function(e){function t$1(t){var n=t.userId,r=t.discoveries,i=e.call(this)||this;return i.method=ee.PUT,i.path="".concat(ne,"/").concat(encodeURIComponent(n),"/friend_discoveries"),i.params={friend_discoveries:r.map((function(e){return {friend_discovery_key:e.friendDiscoveryKey,friend_name:e.friendName}}))},i}return t(t$1,e),t$1}(Ne$1),Vt=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.friendDiscoveryRequestId=n.friend_discovery_request_id,r}return t(t$1,e),t$1}(Te$1),Jt=function(e){function t$1(t){var n=t.userId,r=t.discoveryKeys,i=e.call(this)||this;return i.method=ee.DELETE,i.path="".concat(ne,"/").concat(encodeURIComponent(n),"/friend_discoveries"),i.params={friend_discovery_keys:r},i}return t(t$1,e),t$1}(Ne$1);!function(e){function t$1(){return null!==e&&e.apply(this,arguments)||this}t(t$1,e);}(Te$1);var Xt=function(e){function t$1(t){var n=t.userId,r=t.userIds,i=e.call(this)||this;return i.method=ee.POST,i.path="".concat(ne,"/").concat(encodeURIComponent(n),"/friends"),i.params={user_ids:r},i}return t(t$1,e),t$1}(Ne$1),Yt=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.users=n.users.map((function(e){return new Xi$1(t,e)})),r}return t(t$1,e),t$1}(Te$1),Zt=function(e){function t$1(t){var n=t.userId,r=t.userIds,i=e.call(this)||this;return i.method=ee.DELETE,i.path="".concat(ne,"/").concat(encodeURIComponent(n),"/friends"),i.params={user_ids:r},i}return t(t$1,e),t$1}(Ne$1);!function(e){function t$1(){return null!==e&&e.apply(this,arguments)||this}t(t$1,e);}(Te$1);var $t=function(e){function t$1(t){var n=t.userId,r=e.call(this)||this;return r.method=ee.GET,r.path="".concat(ne,"/").concat(n,"/allow_friend_discovery"),r.params={},r}return t(t$1,e),t$1}(Ne$1),en=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.allowFriendDiscovery=n.allow_friend_discovery,r}return t(t$1,e),t$1}(Te$1),tn=function(e){function t$1(t){var n=t.userId,r=t.allowFriendDiscovery,i=e.call(this)||this;return i.method=ee.PUT,i.path="".concat(ne,"/").concat(n,"/allow_friend_discovery"),i.params={allow_friend_discovery:r},i}return t(t$1,e),t$1}(Ne$1);!function(e){function t$1(){return null!==e&&e.apply(this,arguments)||this}t(t$1,e);}(Te$1);var nn,rn=function(e){function t$1(){var t=e.call(this)||this;return t.method=ee.GET,t.path=he,t}return t(t$1,e),t$1}(Ne$1),on=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.emojiContainer=new st(n),r}return t(t$1,e),t$1}(Te$1),sn=function(e){function t$1(t){var n=t.categoryId,r=e.call(this)||this;return r.method=ee.GET,r.path="".concat(he,"/").concat(n),r}return t(t$1,e),t$1}(Ne$1),an=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.emojiCategory=new ot(n),r}return t(t$1,e),t$1}(Te$1),un=function(e){function t$1(t){var n=t.key,r=e.call(this)||this;return r.method=ee.GET,r.path="".concat(le,"/").concat(n),r}return t(t$1,e),t$1}(Ne$1),cn=function(e){function t$1(t,n){var r=e.call(this,t,n)||this;return r.emoji=new it(n),r}return t(t$1,e),t$1}(Te$1),dn=function(e){function t$1(){var t=e.call(this)||this;return t.method=ee.GET,t.path="".concat(fe),t}return t(t$1,e),t$1}(Ne$1),ln=function(e){function t$1(t,n){var r,i=this,o=null!=n?n:{};return (i=e.call(this,t,n)||this).uikitConfiguration={string:JSON.stringify(o),json:o},i.updatedAt=null!==(r=null==n?void 0:n.updated_at)&&void 0!==r?r:0,i}return t(t$1,e),t$1}(Te$1);(function(){function t(e,t,n){var r=this;this._storeInitialized=!1,this._iid=e,this.options=t;var i$1=_o.of(e),s=i$1.sdkState,u=i$1.cacheContext,c=i$1.dispatcher,d=i$1.sessionManager,l=i$1.requestQueue,h=i$1.logger,f=i$1.userEventHandlers,p$1=i$1.appStateToggleEnabled;this._onlineDetector=new ht({logger:h,connectionDelegate:{reconnect:function(){var t=_o.of(e),n=t.sdkState,r=t.connectionManager,i=t.sessionManager;i.auth.hasSession?"foreground"===n.appState&&r.resetAndReconnect():r.connect(i.auth.authToken);},disconnect:function(){_o.of(e).connectionManager.disconnect();}}});var v=new I(e,{localCacheEnabled:u.localCacheEnabled,dispatcher:c,sdkState:s,logger:h});n.forEach((function(t){t.init(e,{sdkState:s,cacheContext:u,dispatcher:c,sessionManager:d,requestQueue:l,logger:h,onlineDetector:r._onlineDetector}),r[t.name]=t;})),this._appStateChangeDetector=new lt({isEnabled:p$1}),this._appStateChangeDetector.on("resume",(function(){h.debug("the page resumes from freeze"),r.setForegroundState();})).on("pause",(function(){h.debug("the page freezes"),r.setBackgroundState();})),c.on((function(t){var n;if(t instanceof ai$1){if(t.stateType===ti$1.CONNECTED)v.processNonAutoResendRegisteredPendingMessages();}else if(t instanceof Pe$1){if("USEV"===t.code){var i$1=t.as(D).event;if(i$1.category===p.FRIEND_DISCOVERED){var c=S.getDataAsFriendDiscoveredEvent(e,i$1).friendDiscoveries;bi$1((function(){return i(r,void 0,void 0,(function(){return o(this,(function(e){return [2,f.forEach((function(e){e.onFriendsDiscovered&&e.onFriendsDiscovered(c);}))]}))}))}));}}}else if(t instanceof ii$1){var d=_o.of(r._iid).subscribedUnreadMessageCount,l=!1,p$1=t.ts;if("number"==typeof p$1&&p$1>d.ts){if(d.all!==t.all&&(l=!0),d.all=t.all>=0?t.all:0,t.customTypes)for(var g in t.customTypes)d.customTypes[g]!==t.customTypes[g]&&(l=!0),d.customTypes[g]=t.customTypes[g];l=l&&d.ts>0,d.ts=p$1;}l&&bi$1((function(){return i(r,void 0,void 0,(function(){return o(this,(function(e){return [2,f.forEach((function(e){e.onTotalUnreadMessageCountChanged&&e.onTotalUnreadMessageCountChanged({groupChannelCount:d.all,feedChannelCount:d.feed,customTypeUnreadCount:d.customTypes}),e.onTotalUnreadMessageCountUpdated&&e.onTotalUnreadMessageCountUpdated(d.all,d.customTypes);}))]}))}))}));}else t instanceof Ji$1?(u.preference.set(r._getUserProfileCacheKey(s.userId),$i.payloadify(t.userProfile)),(null===(n=t.userProfile.appInfo.notificationInfo)||void 0===n?void 0:n.isEnabled)&&u.preference.set(xi$1(r.appId),{value:!0})):t instanceof Ae$1&&t.error&&(t.error.isSessionRevokedError||t.error.isUserAuthDeactivedError||t.error.isUserAuthDeletedOrNotFoundError)&&(h.debug("session revoked."),r.disconnect());}));}return t.init=function(e){var n=e.appId,r=e.appVersion,i=e.modules,o=void 0===i?[]:i,s=e.options,a$1=void 0===s?new I$1:s,u=e.debugMode,c$1=void 0!==u&&u,d=e.customApiHost,l=e.customWebSocketHost,h=e.newInstance,f=void 0!==h&&h,p=e.logLevel,v=e.localCacheEnabled,g=void 0!==v&&v,_=e.localCacheConfig,m=void 0===_?new K:_,b=e.localCacheEncryption,y=e.useAsyncStorageStore,w=void 0===y?null:y,I=e.appStateToggleEnabled,k=void 0===I||I;if(!nn||f){var C="su-".concat(Z()),S=null!=b?b:{encrypt:function(e){return e},decrypt:function(e){return e}},T=new Ui({encryption:S});c$1||(T=De$1()?w?new Pi({AsyncStorage:w,encryption:S}):new Ui({encryption:S}):new Ci({encryption:S})),new _o(C,{appId:n,appVersion:r,options:a$1,apiHost:null!=d?d:"https://api-".concat(n,".sendbird.com"),websocketHost:null!=l?l:"wss://ws-".concat(n,".sendbird.com"),store:T,encryption:S,logLevel:p,localCacheEnabled:g,localCacheConfig:m,debugMode:c$1,appStateToggleEnabled:k});var E=[new ss,new f$1],P=new t(C,a$1,c(c([],a(o),!1),a(E),!1));return nn||(nn=P),P}return nn},Object.defineProperty(t,"instance",{get:function(){return nn},enumerable:!1,configurable:!0}),Object.defineProperty(t,"version",{get:function(){return l},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"appId",{get:function(){return _o.of(this._iid).sdkState.appId},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"appInfo",{get:function(){var e=_o.of(this._iid).appInfo;return null!=e?e:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"appVersion",{get:function(){var e;return null!==(e=_o.of(this._iid).sdkState.appVersion)&&void 0!==e?e:""},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"debugMode",{get:function(){return !!_o.of(this._iid).debugMode},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"logLevel",{get:function(){return _o.of(this._iid).logger.level},set:function(e){_o.of(this._iid).logger.level=e;},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isCacheEnabled",{get:function(){return _o.of(this._iid).cacheContext.localCacheEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localCacheConfig",{get:function(){var e=_o.of(this._iid).cacheContext;return e.localCacheEnabled?e.localCacheConfig:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ekey",{get:function(){return _o.of(this._iid).sessionManager.ekey},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentUser",{get:function(){var e;return null!==(e=_o.of(this._iid).sessionManager.currentUser)&&void 0!==e?e:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"connectionState",{get:function(){var e=_o.of(this._iid).connectionManager;return e.isConnected?$r$1.OPEN:e.isConnecting?$r$1.CONNECTING:$r$1.CLOSED},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lastConnectedAt",{get:function(){var e=_o.of(this._iid),t=e.connectedAt;return e.connectionManager.isConnected?t:0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fcmPushToken",{get:function(){var e;return null!==(e=this._fcmPushToken)&&void 0!==e?e:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"apnsPushToken",{get:function(){var e;return null!==(e=this._apnsPushToken)&&void 0!==e?e:null},enumerable:!1,configurable:!0}),t.prototype._getNestDBVersion=function(){return 3},t.prototype._getCurrentPreferenceVersion=function(){return 1},t.prototype._getPreferenceCacheKey=function(e){return "sendbird@".concat(this.appId,"/").concat(e,".pref")},t.prototype._getUserProfileCacheKey=function(e){return "sendbird@".concat(this.appId,"/").concat(e,".profile")},t.prototype.getMemoryStoreForDebugging=function(){var e=_o.of(this._iid),t=e.debugMode,n=e.cacheContext;if(t)return n.store instanceof Ui?n.store:null;throw v$1.debugModeRequired},t.prototype.addExtension=function(e,t){var n=_o.of(this._iid).sdkState;["sb_uikit","sb_syncmanager","device-os-platform"].indexOf(e)>-1&&n.extensions&&(n.extensions[e]=t);},t.prototype.addSendbirdExtensions=function(e,t,n){var r,i,o=_o.of(this._iid),s$1=o.logger,a$1=o.sdkState,u=new RegExp(xe$1);if(0===e.length)return s$1.debug("sb.addSendbirdExtensions() has failed because the given sendbirdExtensions is empty."),!1;if(e.find((function(e){return !u.test(e.version)})))return s$1.debug("sb.addSendbirdExtensions() has failed because the given version did not satisfy the SemVer specification."),!1;if(n)try{for(var c=s(Object.entries(n)),d=c.next();!d.done;d=c.next()){var l=a(d.value,2),h=l[0],f=l[1];if(/&|=/.test(h)||/&|=/.test(f))return s$1.debug("sb.addSendbirdExtensions() has failed because the given customData includes at least one invalid character: = or &."),!1}}catch(e){r={error:e};}finally{try{d&&!d.done&&(i=c.return)&&i.call(c);}finally{if(r)throw r.error}}return a$1.sendbirdRuntimeEnvironment={sendbirdExtensions:e,deviceOS:t,customData:n},!0},t.prototype.setOnlineListener=function(e){this._onlineDetector.setOnlineListener(e);},t.prototype.setOfflineListener=function(e){this._onlineDetector.setOfflineListener(e);},t.prototype._safeInitializeStore=function(e){return i(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:t=_o.of(this._iid).cacheContext,n.label=1;case 1:return n.trys.push([1,3,,5]),[4,t.store.init(e)];case 2:return n.sent(),this._storeInitialized=!0,[3,5];case 3:return n.sent(),t.replaceStore(new Ui),[4,this._safeInitializeStore(e)];case 4:return n.sent(),[3,5];case 5:return [2]}}))}))},t.prototype.initializeCache=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,o$1,s,u,c,d;return o(this,(function(a){switch(a.label){case 0:return t=_o.of(this._iid),n=t.sdkState,r=t.cacheContext,i=t.connectionManager,o$1=t.dispatcher,s=t.logger,n.userId&&n.userId===e?[3,10]:[4,i.logout()];case 1:if(a.sent(),u="sendbird@".concat(n.appId,"/").concat(e,".db"),!r.localCacheEnabled)return [3,8];a.label=2;case 2:return a.trys.push([2,5,,7]),r.nestdb&&r.nestdb.state!==ki.CLOSED&&r.nestdb.name===u?[3,4]:((c=r.nestdb=new xi({name:"sendbird@".concat(n.appId,"/").concat(e,".db"),version:this._getNestDBVersion(),store:r.store})).on("upgrade",ct(c,r.store)),c.on("storeReplaced",(function(e){r.replaceStore(e),r.localCacheEnabled=!1,c.on("upgrade",ct(c,r.store));})),[4,c.open()]);case 3:a.sent(),this._storeInitialized=!0,o$1.dispatch(new N(this._iid,{userId:e})),a.label=4;case 4:return n.userId=e,[3,7];case 5:return d=a.sent(),s.warn("Nest DB Open Failed. ",d),[4,this._safeInitializeStore(u)];case 6:throw a.sent(),n.userId=e,v$1.databaseError;case 7:return [3,10];case 8:return [4,this._safeInitializeStore(u)];case 9:a.sent(),n.userId=e,a.label=10;case 10:return [2]}}))}))},t.prototype.getCacheDataSize=function(){return i(this,void 0,void 0,(function(){var e;return o(this,(function(t){switch(t.label){case 0:return (e=_o.of(this._iid).cacheContext).localCacheEnabled&&e.nestdb?[4,e.nestdb.estimateUsage()]:[3,2];case 1:return [2,t.sent()];case 2:return [2,0]}}))}))},t.prototype.clearCachedData=function(){return i(this,void 0,void 0,(function(){var e;return o(this,(function(t){switch(t.label){case 0:return (e=_o.of(this._iid).cacheContext).localCacheEnabled&&e.nestdb?[4,e.nestdb.clear()]:[3,2];case 1:t.sent(),t.label=2;case 2:return this._storeInitialized?[4,e.preference.clear()]:[3,4];case 3:t.sent(),t.label=4;case 4:return [2]}}))}))},t.prototype.clearCachedMessages=function(e){return i(this,void 0,void 0,(function(){var t,n,r=this;return o(this,(function(i$1){switch(i$1.label){case 0:return Qi$1(S$1("string",e)).throw(v$1.invalidParameters),t=Hi.of(this._iid),n=Vi.of(this._iid),t&&n?[4,Promise.all(e.map((function(e){return i(r,void 0,void 0,(function(){return o(this,(function(r){switch(r.label){case 0:return [4,t.removeMessagesOfChannel(e)];case 1:return r.sent(),[4,n.removeMessagesOfChannel(e)];case 2:return r.sent(),[2]}}))}))})))]:[3,2];case 1:i$1.sent(),i$1.label=2;case 2:return [2]}}))}))},t.prototype.connect=function(e,t){return i(this,void 0,void 0,(function(){var r,i,o$1,s,u,c,d;return o(this,(function(a){switch(a.label){case 0:Qi$1(w("string",e)&&w("string",t,!0)).throw(v$1.invalidParameters),r=_o.of(this._iid),i=r.sdkState,o$1=r.cacheContext,s=r.connectionManager,u=r.statLogCollector,a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.initializeCache(e)];case 2:return a.sent(),_o.of(this._iid).dispatcher.dispatch(new v),[3,4];case 3:return a.sent(),c=_o.of(this._iid).logger,o$1.localCacheEnabled=!1,c.warn("Cache initialization failed - cache is not available."),[3,4];case 4:return [4,o$1.preference.init(this._getPreferenceCacheKey(e),this._getCurrentPreferenceVersion())];case 5:return a.sent(),[4,o$1.preference.get(this._getUserProfileCacheKey(e))];case 6:return (d=a.sent())&&new $i(this._iid,d).apply(),[4,u.init("sendbird@".concat(i.appId,"/").concat(e,".statlog"))];case 7:a.sent(),a.label=8;case 8:return a.trys.push([8,,10,11]),[4,s.connect(t)];case 9:return a.sent(),[3,11];case 10:return this._onlineDetector.start(),this._appStateChangeDetector.start(),[7];case 11:return [2,this.currentUser]}}))}))},t.prototype.reconnect=function(){var e=_o.of(this._iid),t=e.connectionManager,n=e.sdkState,r=e.sessionManager.auth.hasSession;return r&&(this._appStateChangeDetector.start(),this._onlineDetector.start(),t.resetAndReconnect().then((function(){n.appState="foreground";})).catch((function(){}))),r},t.prototype.disconnect=function(){return i(this,void 0,void 0,(function(){var e,t,n;return o(this,(function(r){switch(r.label){case 0:return e=_o.of(this._iid),t=e.connectionManager,n=e.requestQueue,this._appStateChangeDetector.stop(),this._onlineDetector.stop(),n.cancelAll(),[4,t.logout()];case 1:return r.sent(),[4,this.clearCachedData()];case 2:return r.sent(),[2]}}))}))},t.prototype.disconnectWebSocket=function(){return i(this,void 0,void 0,(function(){var e,t,n;return o(this,(function(r){switch(r.label){case 0:return e=_o.of(this._iid),t=e.connectionManager,n=e.requestQueue,this._appStateChangeDetector.stop(),this._onlineDetector.stop(),n.cancelAll(),[4,t.disconnectWebSocket()];case 1:return r.sent(),[2]}}))}))},t.prototype.setBackgroundState=function(){var e=_o.of(this._iid),t=e.connectionManager,n=e.sdkState,r=e.logger;"foreground"===n.appState&&(n.appState="background",r.debug("going background state"),t.background());},t.prototype.setForegroundState=function(){var e=_o.of(this._iid),t=e.connectionManager,n=e.sdkState,r=e.logger;"background"===n.appState&&(n.appState="foreground",r.debug("going foreground state"),t.resetAndReconnect());},t.prototype.setSessionHandler=function(e){Qi$1(e instanceof wr).throw(v$1.invalidParameters),_o.of(this._iid).sessionManager.handler=e;},t.prototype.addUserEventHandler=function(e,t){Qi$1(w("string",e)&&t instanceof Mr).throw(v$1.invalidParameters),_o.of(this._iid).userEventHandlers.set(e,t);},t.prototype.removeUserEventHandler=function(e){_o.of(this._iid).userEventHandlers.delete(e);},t.prototype.removeAllUserEventHandler=function(){_o.of(this._iid).userEventHandlers.clear();},t.prototype.addConnectionHandler=function(e,t){Qi$1(w("string",e)&&t instanceof Tr).throw(v$1.invalidParameters),_o.of(this._iid).connectionHandlers.set(e,t);},t.prototype.removeConnectionHandler=function(e){_o.of(this._iid).connectionHandlers.delete(e);},t.prototype.removeAllConnectionHandler=function(){_o.of(this._iid).connectionHandlers.clear();},t.prototype.createApplicationUserListQuery=function(e){return void 0===e&&(e={}),new Nr(this._iid,e)},t.prototype.createBlockedUserListQuery=function(e){return void 0===e&&(e={}),new Cr(this._iid,e)},t.prototype.createFriendListQuery=function(e){return void 0===e&&(e={}),new Rr(this._iid,e)},t.prototype.createMessageSearchQuery=function(e){return new rs(this._iid,e)},t.prototype.createPollListQuery=function(e){return new Yo(this._iid,n({},e))},t.prototype.createPollVoterListQuery=function(e){return new $o(this._iid,n({},e))},t.prototype.buildUserFromSerializedData=function(e){var t=Wi$1(e);return new Xi$1(this._iid,Xi$1.payloadify(t))},t.prototype.updateCurrentUserInfo=function(t){return void 0===t&&(t={}),i(this,void 0,void 0,(function(){var r,i,o$1,s,u,c,d;return o(this,(function(a){switch(a.label){case 0:return r=n(n({},at),t),Qi$1(function(t){return k(t.profileImage,!0)&&w("string",t.profileUrl,!0)&&w("string",t.nickname,!0)}(r)).throw(v$1.invalidParameters),this.currentUser?(i=_o.of(this._iid),o$1=i.sdkState,s=i.requestQueue,u=new ft(n({userId:o$1.userId},r)),[4,s.send(u)]):[3,2];case 1:return c=a.sent(),d=c.as(pt).user,this.currentUser&&(r.nickname&&(this.currentUser.nickname=d.nickname),(r.profileUrl||r.profileImage)&&(this.currentUser.plainProfileUrl=d.profileUrl)),[2,d];case 2:throw v$1.connectionRequired}}))}))},t.prototype.updateCurrentUserInfoWithPreferredLanguages=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,o$1,s;return o(this,(function(a){switch(a.label){case 0:return Qi$1(S$1("string",e)).throw(v$1.invalidParameters),this.currentUser?(t=_o.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new ft({userId:n.userId,preferredLanguages:e}),[4,r.send(i)]):[3,2];case 1:return o$1=a.sent(),s=o$1.as(pt).user,this.currentUser&&(this.currentUser.preferredLanguages=s.preferredLanguages),[2,s];case 2:throw v$1.connectionRequired}}))}))},t.prototype.registerFCMPushTokenForCurrentUser=function(e){return i(this,void 0,void 0,(function(){var t,r,i$1,s,u,c=this;return o(this,(function(d$1){switch(d$1.label){case 0:if(Qi$1(w("string",e)).throw(v$1.invalidParameters),!this.currentUser)return [3,6];d$1.label=1;case 1:return d$1.trys.push([1,4,,5]),t=_o.of(this._iid),r=t.sessionManager,i$1=t.sdkState,s=t.requestQueue,r.hasDeviceToken(f$2.FCM,e)?[2,d.SUCCESS]:(u=new gt({userId:i$1.userId,token:e}),[4,s.send(u)]);case 2:return d$1.sent(),[4,mi$1((function(){return i(c,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return r.setDeviceToken(f$2.FCM,e),[4,r.saveDeviceToken()];case 1:return t.sent(),[2]}}))}))}))];case 3:return d$1.sent(),this._fcmPushToken="",[2,d.SUCCESS];case 4:return d$1.sent(),[2,d.ERROR];case 5:return [3,7];case 6:return this._fcmPushToken=e,[2,d.PENDING];case 7:return [2]}}))}))},t.prototype.unregisterFCMPushTokenForCurrentUser=function(e){return i(this,void 0,void 0,(function(){var t,r,i$1,s,u,c,d$1=this;return o(this,(function(l){switch(l.label){case 0:if(Qi$1(w("string",e)).throw(v$1.invalidParameters),!this.currentUser)return [3,6];l.label=1;case 1:return l.trys.push([1,4,,5]),t=_o.of(this._iid),r=t.sessionManager,i$1=t.sdkState,s=t.requestQueue,u=new mt({userId:i$1.userId,token:e}),[4,s.send(u)];case 2:return c=l.sent().lastDeletedAt,[4,mi$1((function(){return i(d$1,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return r.unsetDeviceToken(f$2.FCM,e),r.setDeviceTokenDeletedAt(c),[4,r.saveDeviceToken()];case 1:return t.sent(),[2]}}))}))}))];case 3:return l.sent(),this._fcmPushToken="",[2,d.SUCCESS];case 4:return l.sent(),[2,d.ERROR];case 5:return [3,7];case 6:return this._fcmPushToken=e,[2,d.PENDING];case 7:return [2]}}))}))},t.prototype.unregisterFCMPushTokenAllForCurrentUser=function(){return i(this,void 0,void 0,(function(){var e,t,n,r,i$1,s,u=this;return o(this,(function(c){switch(c.label){case 0:return this.currentUser?(e=_o.of(this._iid),t=e.sessionManager,n=e.sdkState,r=e.requestQueue,i$1=new yt({userId:n.userId}),[4,r.send(i$1)]):[3,3];case 1:return s=c.sent().lastDeletedAt,[4,mi$1((function(){return i(u,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return t.unsetDeviceTokens(f$2.FCM),t.setDeviceTokenDeletedAt(s),[4,t.saveDeviceToken()];case 1:return e.sent(),[2]}}))}))}))];case 2:c.sent(),c.label=3;case 3:return [2]}}))}))},t.prototype.registerAPNSPushTokenForCurrentUser=function(e){return i(this,void 0,void 0,(function(){var t,r,i$1,s,u,c=this;return o(this,(function(d$1){switch(d$1.label){case 0:if(Qi$1(w("string",e)).throw(v$1.invalidParameters),!this.currentUser)return [3,6];d$1.label=1;case 1:return d$1.trys.push([1,4,,5]),t=_o.of(this._iid),r=t.sessionManager,i$1=t.sdkState,s=t.requestQueue,r.hasDeviceToken(f$2.APNS,e)?[2,d.SUCCESS]:(u=new vt({userId:i$1.userId,token:e}),[4,s.send(u)]);case 2:return d$1.sent(),[4,mi$1((function(){return i(c,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return r.setDeviceToken(f$2.APNS,e),[4,r.saveDeviceToken()];case 1:return t.sent(),[2]}}))}))}))];case 3:return d$1.sent(),this._apnsPushToken="",[2,d.SUCCESS];case 4:return d$1.sent(),[2,d.ERROR];case 5:return [3,7];case 6:return this._apnsPushToken=e,[2,d.PENDING];case 7:return [2]}}))}))},t.prototype.unregisterAPNSPushTokenForCurrentUser=function(e){return i(this,void 0,void 0,(function(){var t,r,i$1,s,u,c,d$1=this;return o(this,(function(l){switch(l.label){case 0:if(Qi$1(w("string",e)).throw(v$1.invalidParameters),!this.currentUser)return [3,6];l.label=1;case 1:return l.trys.push([1,4,,5]),t=_o.of(this._iid),r=t.sessionManager,i$1=t.sdkState,s=t.requestQueue,u=new _t({userId:i$1.userId,token:e}),[4,s.send(u)];case 2:return c=l.sent().lastDeletedAt,[4,mi$1((function(){return i(d$1,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return r.unsetDeviceToken(f$2.APNS,e),r.setDeviceTokenDeletedAt(c),[4,r.saveDeviceToken()];case 1:return t.sent(),[2]}}))}))}))];case 3:return l.sent(),this._apnsPushToken="",[2,d.SUCCESS];case 4:return l.sent(),[2,d.ERROR];case 5:return [3,7];case 6:return this._apnsPushToken=e,[2,d.PENDING];case 7:return [2]}}))}))},t.prototype.unregisterAPNSPushTokenAllForCurrentUser=function(){return i(this,void 0,void 0,(function(){var e,t,n,r,i$1,s,u=this;return o(this,(function(c){switch(c.label){case 0:return this.currentUser?(e=_o.of(this._iid),t=e.sessionManager,n=e.sdkState,r=e.requestQueue,i$1=new bt({userId:n.userId}),[4,r.send(i$1)]):[3,3];case 1:return s=c.sent().lastDeletedAt,[4,mi$1((function(){return i(u,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return t.unsetDeviceTokens(f$2.APNS),t.setDeviceTokenDeletedAt(s),[4,t.saveDeviceToken()];case 1:return e.sent(),[2]}}))}))}))];case 2:c.sent(),c.label=3;case 3:return [2]}}))}))},t.prototype.getChannelInvitationPreference=function(){return i(this,void 0,void 0,(function(){var e,t,n,r,i;return o(this,(function(o){switch(o.label){case 0:return e=_o.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new kt({userId:t.userId}),[4,n.send(r)];case 1:return i=o.sent(),[2,{autoAccept:i.as(Ct).autoAccept}]}}))}))},t.prototype.setChannelInvitationPreference=function(e){return i(this,void 0,void 0,(function(){var t,r,i,o$1,s;return o(this,(function(a){switch(a.label){case 0:return Qi$1(w("boolean",e)).throw(v$1.invalidParameters),t=_o.of(this._iid),r=t.sdkState,i=t.requestQueue,o$1=new St({userId:r.userId,willAutoAccept:e}),[4,i.send(o$1)];case 1:return s=a.sent(),[2,{autoAccept:s.as(Tt).autoAccept}]}}))}))},t.prototype.getDoNotDisturb=function(){return i(this,void 0,void 0,(function(){var e,t,n,r,i;return o(this,(function(o){switch(o.label){case 0:return e=_o.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new Et({userId:t.userId}),[4,n.send(r)];case 1:return i=o.sent(),[2,i.as(Pt).preference]}}))}))},t.prototype.setDoNotDisturb=function(e,t,r,i$1,s,u){return void 0===t&&(t=0),void 0===r&&(r=0),void 0===i$1&&(i$1=0),void 0===s&&(s=0),void 0===u&&(u=""),i(this,void 0,void 0,(function(){var o$1,c,d,l,h;return o(this,(function(a){switch(a.label){case 0:return Qi$1(w("boolean",e)&&w("number",t)&&w("number",r)&&w("number",i$1)&&w("number",s)&&w("string",u)).throw(v$1.invalidParameters),o$1=_o.of(this._iid),c=o$1.sdkState,d=o$1.requestQueue,l=new Ut({userId:c.userId,doNotDisturbOn:e,startHour:t,startMin:r,endHour:i$1,endMin:s,timezone:u}),[4,d.send(l)];case 1:return h=a.sent(),[2,h.as(Dt).preference]}}))}))},t.prototype.getSnoozePeriod=function(){return i(this,void 0,void 0,(function(){var e,t,n,r,i;return o(this,(function(o){switch(o.label){case 0:return e=_o.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new Ot({userId:t.userId}),[4,n.send(r)];case 1:return i=o.sent(),[2,i.as(At).snoozePeriod]}}))}))},t.prototype.setSnoozePeriod=function(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=0),i(this,void 0,void 0,(function(){var i,o$1,s,u,c;return o(this,(function(a){switch(a.label){case 0:return Qi$1(w("boolean",e)&&w("number",t)&&w("number",r)).throw(v$1.invalidParameters),i=_o.of(this._iid),o$1=i.sdkState,s=i.requestQueue,u=new Lt({userId:o$1.userId,snoozeOn:e,startTs:t,endTs:r}),[4,s.send(u)];case 1:return c=a.sent(),[2,c.as(Nt).snoozePeriod]}}))}))},t.prototype.getMyPushTokensByToken=function(e,t){return i(this,void 0,void 0,(function(){var r,i,o$1,s$1,u,c,d,l,h,f,p,v;return o(this,(function(a){switch(a.label){case 0:return Qi$1(w("string",e)&&N$1(f$2,t)).throw(v$1.invalidParameters),r=_o.of(this._iid),i=r.sdkState,o$1=r.requestQueue,s$1=r.sessionManager,u=new wt({userId:i.userId,type:t,token:e}),[4,o$1.send(u)];case 1:c=a.sent(),d=c.as(It).pushTokens;try{for(l=s(d.deviceTokens),h=l.next();!h.done;h=l.next())f=h.value,s$1.setDeviceToken(d.type,f);}catch(e){p={error:e};}finally{try{h&&!h.done&&(v=l.return)&&v.call(l);}finally{if(p)throw p.error}}return [4,s$1.saveDeviceToken()];case 2:return a.sent(),[2,d]}}))}))},t.prototype.getPushTriggerOption=function(){return i(this,void 0,void 0,(function(){var e,t,n,r;return o(this,(function(i){switch(i.label){case 0:return e=_o.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new zt({userId:t.userId}),[4,n.send(r)];case 1:return [2,i.sent().as(Qt).pushTriggerOption]}}))}))},t.prototype.setPushTriggerOption=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i;return o(this,(function(o){switch(o.label){case 0:return Qi$1(N$1(_,e)).throw(v$1.invalidParameters),t=_o.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new jt({userId:n.userId,pushTriggerOption:e}),[4,r.send(i)];case 1:return [2,o.sent().as(qt).pushTriggerOption]}}))}))},t.prototype.getPushTemplate=function(){return i(this,void 0,void 0,(function(){var e,t,n,r;return o(this,(function(i){switch(i.label){case 0:return e=_o.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new Ft({userId:t.userId}),[4,n.send(r)];case 1:return [2,i.sent().as(Ht).name]}}))}))},t.prototype.setPushTemplate=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i;return o(this,(function(o){switch(o.label){case 0:return Qi$1(N$1(p$1,e)).throw(v$1.invalidParameters),t=_o.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new xt({userId:n.userId,templateName:e}),[4,r.send(i)];case 1:return [2,o.sent().as(Gt).name]}}))}))},t.prototype.blockUser=function(e){return i(this,void 0,void 0,(function(){var t,r,i,o$1;return o(this,(function(s){switch(s.label){case 0:return Qi$1(e instanceof Xi$1||w("string",e)).throw(v$1.invalidParameters),t=_o.of(this._iid),r=t.sdkState,i=t.requestQueue,o$1=new Mt({userId:r.userId,blockedUserId:e instanceof Xi$1?e.userId:e}),[4,i.send(o$1)];case 1:return s.sent(),[2]}}))}))},t.prototype.blockUserWithUserId=function(e){return i(this,void 0,void 0,(function(){return o(this,(function(t){return [2,this.blockUser(e)]}))}))},t.prototype.unblockUser=function(e){return i(this,void 0,void 0,(function(){var t,r,i,o$1;return o(this,(function(s){switch(s.label){case 0:return Qi$1(e instanceof Xi$1||w("string",e)).throw(v$1.invalidParameters),t=_o.of(this._iid),r=t.sdkState,i=t.requestQueue,o$1=new Rt({userId:r.userId,unblockedUserId:e instanceof Xi$1?e.userId:e}),[4,i.send(o$1)];case 1:return s.sent(),[2]}}))}))},t.prototype.unblockUserWithUserId=function(e){return i(this,void 0,void 0,(function(){return o(this,(function(t){return [2,this.unblockUser(e)]}))}))},t.prototype.getFriendChangeLogsByToken=function(e){return i(this,void 0,void 0,(function(){var t,r,i,o$1,s;return o(this,(function(a){switch(a.label){case 0:return Qi$1(w("string",e)).throw(v$1.invalidParameters),t=_o.of(this._iid),r=t.sdkState,i=t.requestQueue,o$1=new Wt({userId:r.userId,token:e}),[4,i.send(o$1)];case 1:return s=a.sent(),[2,s.as(Bt).changelogs]}}))}))},t.prototype.getAllowFriendDiscovery=function(){return i(this,void 0,void 0,(function(){var e,t,n,r,i;return o(this,(function(o){switch(o.label){case 0:return e=_o.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new $t({userId:t.userId}),[4,n.send(r)];case 1:return i=o.sent(),[2,i.as(en).allowFriendDiscovery]}}))}))},t.prototype.setAllowFriendDiscovery=function(e){return i(this,void 0,void 0,(function(){var t,r,i,o$1;return o(this,(function(s){switch(s.label){case 0:return Qi$1(w("boolean",e)).throw(v$1.invalidParameters),t=_o.of(this._iid),r=t.sdkState,i=t.requestQueue,o$1=new tn({userId:r.userId,allowFriendDiscovery:e}),[4,i.send(o$1)];case 1:return s.sent(),[2,e]}}))}))},t.prototype.uploadFriendDiscoveries=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,o$1;return o(this,(function(s){switch(s.label){case 0:return t=_o.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new Kt({userId:n.userId,discoveries:e}),[4,r.send(i)];case 1:return o$1=s.sent(),[2,o$1.as(Vt).friendDiscoveryRequestId]}}))}))},t.prototype.deleteFriendDiscovery=function(e){return i(this,void 0,void 0,(function(){return o(this,(function(t){return [2,this.deleteFriendDiscoveries([e])]}))}))},t.prototype.deleteFriendDiscoveries=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i;return o(this,(function(o){switch(o.label){case 0:return Qi$1(S$1("string",e)).throw(v$1.invalidParameters),t=_o.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new Jt({userId:n.userId,discoveryKeys:e}),[4,r.send(i)];case 1:return o.sent(),[2]}}))}))},t.prototype.addFriends=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i,o$1;return o(this,(function(s){switch(s.label){case 0:return Qi$1(S$1("string",e)).throw(v$1.invalidParameters),t=_o.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new Xt({userId:n.userId,userIds:e}),[4,r.send(i)];case 1:return o$1=s.sent(),[2,o$1.as(Yt).users]}}))}))},t.prototype.deleteFriend=function(e){return i(this,void 0,void 0,(function(){return o(this,(function(t){return [2,this.deleteFriends([e])]}))}))},t.prototype.deleteFriends=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i;return o(this,(function(o){switch(o.label){case 0:return Qi$1(S$1("string",e)).throw(v$1.invalidParameters),t=_o.of(this._iid),n=t.sdkState,r=t.requestQueue,i=new Zt({userId:n.userId,userIds:e}),[4,r.send(i)];case 1:return o.sent(),[2]}}))}))},t.prototype.getAllEmoji=function(){return i(this,void 0,void 0,(function(){var e,t,n;return o(this,(function(r){switch(r.label){case 0:return e=_o.of(this._iid).requestQueue,t=new rn,[4,e.send(t)];case 1:return n=r.sent(),[2,n.as(on).emojiContainer]}}))}))},t.prototype.getEmojiCategory=function(e){return i(this,void 0,void 0,(function(){var t,n,r;return o(this,(function(i){switch(i.label){case 0:return t=_o.of(this._iid).requestQueue,n=new sn({categoryId:e}),[4,t.send(n)];case 1:return r=i.sent(),[2,r.as(an).emojiCategory]}}))}))},t.prototype.getEmoji=function(e){return i(this,void 0,void 0,(function(){var t,n,r;return o(this,(function(i){switch(i.label){case 0:return t=_o.of(this._iid).requestQueue,n=new un({key:e}),[4,t.send(n)];case 1:return r=i.sent(),[2,r.as(cn).emoji]}}))}))},t.prototype.getUIKitConfiguration=function(){return i(this,void 0,void 0,(function(){var e,t,n,r;return o(this,(function(i){switch(i.label){case 0:return e=_o.of(this._iid),Qi$1(e.hasExtension("sb_uikit")).throw(v$1.notSupportedError),t=e.requestQueue,n=new dn,[4,t.send(n)];case 1:return r=i.sent(),[2,r.as(ln).uikitConfiguration]}}))}))},t})();

var version = "1.1.3";

var _debug = false;
var _sendbird;
var _platform = Ie.WEB;
var _deskApiHost;
var DESK_SDK_VERSION = version;
var MIN_SENDBIRD_VERSION = '4.9.6';
/**
 * @since 1.0.0
 * @ignore
 */
var Config = /** @class */ (function () {
    function Config() {
    }
    Object.defineProperty(Config, "sendbird", {
        /**
         * @static
         * @since 1.0.5
         * @ignore
         * @desc Get Sendbird instance.
         */
        get: function () {
            return _sendbird;
        },
        /**
         * @static
         * @since 1.0.5
         * @ignore
         * @desc Set Sendbird instance.
         */
        set: function (sb) {
            _sendbird = sb;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(Config, "platform", {
        /**
         * @static
         * @since 1.1.0
         * @ignore
         * @desc Get platform for setting in SendbirdInstance.
         * @default DeviceOsPlatform.WEB
         */
        get: function () {
            return _platform;
        },
        /**
         * @static
         * @since 1.1.0
         * @ignore
         * @desc Set platform for setting in SendbirdInstance.
         */
        set: function (platform) {
            _platform = platform;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(Config, "isDebugMode", {
        /**
         * @static
         * @since 1.0.0
         * @ignore
         * @desc Check if SDK is in debug mode.
         */
        get: function () {
            return _debug;
        },
        enumerable: false,
        configurable: true
    });
    /**
     * @static
     * @since 1.0.0
     * @ignore
     * @desc Set SDK to debug mode which leads to change API endpoint and app ID into development server.
     */
    Config.setDebugMode = function () {
        _debug = true;
    };
    /**
     * @static
     * @since 1.0.0
     * @ignore
     * @desc Set SDK to production mode which leads to change API endpoint and app ID into production server.
     */
    Config.unsetDebugMode = function () {
        _debug = false;
    };
    Object.defineProperty(Config, "apiHost", {
        /**
         * @ignore
         */
        get: function () {
            if (!_deskApiHost) {
                var sb = _sendbird;
                _deskApiHost = "https://desk-api-".concat(sb.appId, ".sendbird.com/sapi");
            }
            return _deskApiHost;
        },
        /**
         * @ignore
         */
        set: function (val) {
            _deskApiHost = val;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(Config, "sdkVersion", {
        /**
         * @ignore
         */
        get: function () {
            return DESK_SDK_VERSION;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(Config, "minSendbirdVersion", {
        /**
         * @ignore
         */
        get: function () {
            return MIN_SENDBIRD_VERSION;
        },
        enumerable: false,
        configurable: true
    });
    /**
     * @static
     * @since 1.0.0
     * @ignore
     * @desc Check if Sendbird SDK version meets the min supported version.
     * @returns {boolean} - true if it's compatible.
     */
    Config.isSendbirdSdkCompatible = function (version) {
        var _minSupportedVersion = MIN_SENDBIRD_VERSION.split('.');
        var _targetVersion = version.split('.');
        if (_minSupportedVersion.length === _targetVersion.length) {
            for (var i in _minSupportedVersion) {
                if (parseInt(_minSupportedVersion[i]) < parseInt(_targetVersion[i])) {
                    return true;
                }
                else if (parseInt(_minSupportedVersion[i]) > parseInt(_targetVersion[i])) {
                    return false;
                }
            }
            return true;
        }
        return false;
    };
    return Config;
}());

/**
 * @since 1.0.0
 * @desc Sendbird Desk specific errors.
 * @property {IErrorType} ERROR_SENDBIRD_SDK_MISSING - 100
 * @property {IErrorType} ERROR_SENDBIRD_SDK_VERSION_NOT_SUPPORTED - 101
 * @property {IErrorType} ERROR_SENDBIRD_DESK_INIT_MISSING - 102
 * @property {IErrorType} ERROR_SENDBIRD_SDK_MESSAGE_LIST_FAILED - 200
 * @property {IErrorType} ERROR_INVALID_PARAMETER - 403
 * @property {IErrorType} ERROR_DATA_NOT_FOUND - 404
 * @property {IErrorType} ERROR_REQUEST - 500
 * @property {IErrorType} ERROR_REQUEST_CANCELED - 501
 */
var ErrorType = {
    ERROR_SENDBIRD_SDK_MISSING: {
        code: 100,
        message: 'Sendbird SDK is missing.',
    },
    ERROR_SENDBIRD_SDK_VERSION_NOT_SUPPORTED: {
        code: 101,
        message: 'This Sendbird SDK version is not supported.',
    },
    ERROR_SENDBIRD_DESK_INIT_MISSING: {
        code: 102,
        message: 'Sendbird Desk SDK is not initialized. It should be done before authentication.',
    },
    ERROR_SENDBIRD_DESK_AUTH_FAILED: {
        code: 103,
        message: 'Sendbird Desk authentication failed.',
    },
    ERROR_SENDBIRD_SDK_MESSAGE_LIST_FAILED: {
        code: 200,
        message: 'Cannot load messages in SDK client.',
    },
    ERROR_INVALID_PARAMETER: {
        code: 403,
        message: 'Invalid parameter.',
    },
    ERROR_DATA_NOT_FOUND: {
        code: 404,
        message: 'Data not found.',
    },
    ERROR_REQUEST_TIMEOUT: {
        code: 409,
        message: 'Request timed-out.',
    },
    ERROR_REQUEST: {
        code: 500,
        message: 'Request failed.',
    },
    ERROR_REQUEST_CANCELED: {
        code: 501,
        message: 'Request canceled.',
    },
};
/**
 * An error class for Desk.
 * @extends {Error}
 * @since 1.0.0
 */
var SendbirdDeskError = /** @class */ (function (_super) {
    __extends(SendbirdDeskError, _super);
    /**
     * @since 1.0.0
     * @param {string} message - Error message.
     * @param {number} code - Error code.
     */
    function SendbirdDeskError(message, code) {
        var _this = _super.call(this, message) || this;
        if (typeof Error.captureStackTrace === 'function') {
            Error.captureStackTrace(_this, _this.constructor);
        }
        else {
            _this.stack = new Error(message).stack;
        }
        _this.name = 'SendbirdDeskError';
        _this.code = code;
        return _this;
    }
    Object.defineProperty(SendbirdDeskError, "Type", {
        get: function () {
            return ErrorType;
        },
        enumerable: false,
        configurable: true
    });
    /**
     * @static
     * @since 1.0.5
     * @ignore
     * @desc Create an error.
     */
    SendbirdDeskError.create = function (type) {
        return type ? new SendbirdDeskError(type.message, type.code) : new Error('SendbirdDeskError type missing.');
    };
    /**
     * @static
     * @since 1.0.0
     * @ignore
     * @desc Throw an error.
     */
    SendbirdDeskError.throw = function (type) {
        throw new SendbirdDeskError(type.message, type.code);
    };
    return SendbirdDeskError;
}(Error));

/**
 * @since 1.0.1
 * @ignore
 */
var Logger = /** @class */ (function () {
    function Logger() {
    }
    Logger.write = function () {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            args[_i] = arguments[_i];
        }
        if (Config.isDebugMode) {
            // eslint-disable-next-line no-console
            console.log.apply(console, __spreadArray([], __read(args), false));
        }
    };
    Logger.error = function () {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            args[_i] = arguments[_i];
        }
        if (Config.isDebugMode) {
            // eslint-disable-next-line no-console
            console.error.apply(console, __spreadArray([], __read(args), false));
        }
    };
    return Logger;
}());

var _privateData = {};
/**
 * @since 1.0.0
 * @ignore
 */
var Auth = /** @class */ (function () {
    function Auth() {
    }
    /**
     * @static
     * @since 1.0.0
     * @ignore
     * @desc Authenticate and connect to Desk server.
     */
    Auth.connect = function (userId, accessToken) {
        return __awaiter(this, void 0, void 0, function () {
            var sb, res, data;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        sb = Config.sendbird;
                        sb.addSendbirdExtensions([
                            {
                                product: ke$1.DESK,
                                version: version,
                                platform: Oe$1.JS,
                            },
                        ], {
                            platform: Config.platform,
                        });
                        if (!sb) return [3 /*break*/, 3];
                        return [4 /*yield*/, fetch("".concat(Config.apiHost, "/customers/auth/"), {
                                method: 'POST',
                                headers: {
                                    sendbirdAccessToken: accessToken || '',
                                    'content-type': 'application/json',
                                },
                                body: JSON.stringify({
                                    sendbirdAppId: sb.appId,
                                    sendbirdId: userId,
                                }),
                            })];
                    case 1:
                        res = _a.sent();
                        return [4 /*yield*/, res.json()];
                    case 2:
                        data = _a.sent();
                        _privateData.deskToken = data.token;
                        Logger.write('[REQ] connection established');
                        return [3 /*break*/, 4];
                    case 3: throw SendbirdDeskError.create(SendbirdDeskError.Type.ERROR_SENDBIRD_SDK_MISSING);
                    case 4: return [2 /*return*/];
                }
            });
        });
    };
    Object.defineProperty(Auth, "header", {
        /**
         * @ignore
         */
        get: function () {
            if (_privateData.deskToken) {
                return {
                    sendbirdDeskToken: _privateData.deskToken,
                    'content-type': 'application/json',
                    'user-agent': "desk-js@".concat(version),
                };
            }
            throw SendbirdDeskError.create(SendbirdDeskError.Type.ERROR_SENDBIRD_DESK_INIT_MISSING);
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(Auth, "getParam", {
        /**
         * @ignore
         */
        get: function () {
            var sb = Config.sendbird;
            return sb ? "sendbirdAppId=".concat(sb.appId) : '';
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(Auth, "postParam", {
        /**
         * @ignore
         */
        get: function () {
            var sb = Config.sendbird;
            return sb ? { sendbirdAppId: sb.appId } : {};
        },
        enumerable: false,
        configurable: true
    });
    return Auth;
}());

/**
 * @module Agent
 * @ignore
 */
/**
 * @since 1.0.0
 */
var Agent = /** @class */ (function () {
    /**
     * @since 1.0.0
     * @private
     * @desc Create an agent.
     */
    function Agent(params) {
        this.fetchFromJSON(params);
    }
    /**
     * @since 1.0.0
     * @private
     * @desc Parse JSON data and patch Agent object.
     */
    Agent.prototype.fetchFromJSON = function (params) {
        var _a, _b, _c, _d, _e;
        if ('id' in params) {
            this.userId = params.id;
            this.name = (_a = params.displayName) !== null && _a !== void 0 ? _a : '';
            this.profileUrl = (_b = params.photoThumbnailUrl) !== null && _b !== void 0 ? _b : '';
            this.sendbirdId = params.sendbirdId;
            return;
        }
        // legacy
        this.userId = (_c = params.user) !== null && _c !== void 0 ? _c : 0;
        this.name = (_d = params.displayName) !== null && _d !== void 0 ? _d : '';
        this.profileUrl = (_e = params.photoThumbnailUrl) !== null && _e !== void 0 ? _e : '';
    };
    return Agent;
}());

/**
 * @classdesc RelatedChannel
 * @since 1.0.14
 */
var RelatedChannel = /** @class */ (function () {
    /**
     * @since 1.0.14
     * @private
     * @desc Create a related channel
     */
    function RelatedChannel(params) {
        this.fetchFromJSON(params);
    }
    /**
     * @since 1.0.14
     * @private
     * @desc Parse JSON data and patch RelatedChannel object.
     */
    RelatedChannel.prototype.fetchFromJSON = function (params) {
        var _a, _b;
        this.channelUrl = (_a = params.channel_url) !== null && _a !== void 0 ? _a : '';
        this.name = (_b = params.name) !== null && _b !== void 0 ? _b : '';
    };
    return RelatedChannel;
}());

// --------- Misc Types --------- //
// Enums arent good match for runtime values.
// Would they work? Yeah.. but they would be annoying for customer
// to use. They just need to call create(..., 'URGENT', ...) instead of
// create(..., TicketPriority.URGENT, ...)
// to use. So we use const-enums instead.
var TicketPriorityMap = {
    URGENT: 'URGENT',
    HIGH: 'HIGH',
    MEDIUM: 'MEDIUM',
    LOW: 'LOW',
};
var TicketStatusMap = {
    INITIALIZED: 'INITIALIZED',
    PROACTIVE: 'PROACTIVE',
    UNASSIGNED: 'UNASSIGNED',
    ASSIGNED: 'ASSIGNED',
    OPEN: 'OPEN',
    CLOSED: 'CLOSED',
};

function mapCreateTicketArgs(args) {
    if ((args === null || args === void 0 ? void 0 : args.length) < 3 || (args === null || args === void 0 ? void 0 : args.length) > 8) {
        Logger.error('[REQ] Close ticket should have at least 1 param.');
        throw SendbirdDeskError.create(SendbirdDeskError.Type.ERROR_INVALID_PARAMETER);
    }
    if (args.length === 3) {
        var _a = __read(args, 3), title = _a[0], name_1 = _a[1], cb = _a[2];
        return { title: title, name: name_1, cb: cb };
    }
    if (args.length === 4) {
        var _b = __read(args, 4), title = _b[0], name_2 = _b[1], groupKey = _b[2], cb = _b[3];
        return { title: title, name: name_2, groupKey: groupKey, cb: cb };
    }
    if (args.length === 5) {
        var _c = __read(args, 5), title = _c[0], name_3 = _c[1], groupKey = _c[2], customFields = _c[3], cb = _c[4];
        return { title: title, name: name_3, groupKey: groupKey, customFields: customFields, cb: cb };
    }
    if (args.length === 6) {
        var _d = __read(args, 6), title = _d[0], name_4 = _d[1], groupKey = _d[2], customFields = _d[3], priority = _d[4], cb = _d[5];
        return { title: title, name: name_4, groupKey: groupKey, customFields: customFields, priority: priority, cb: cb };
    }
    if (args.length === 7) {
        var _e = __read(args, 7), title = _e[0], name_5 = _e[1], groupKey = _e[2], customFields = _e[3], priority = _e[4], relatedChannelUrls = _e[5], cb = _e[6];
        return { title: title, name: name_5, groupKey: groupKey, customFields: customFields, priority: priority, relatedChannelUrls: relatedChannelUrls, cb: cb };
    }
    if (args.length === 8) {
        var _f = __read(args, 8), title = _f[0], name_6 = _f[1], groupKey = _f[2], customFields = _f[3], priority = _f[4], relatedChannelUrls = _f[5], botKey = _f[6], cb = _f[7];
        return { title: title, name: name_6, groupKey: groupKey, customFields: customFields, priority: priority, relatedChannelUrls: relatedChannelUrls, botKey: botKey, cb: cb };
    }
    // TS dont know that we have checked for length
    Logger.error('[REQ] Create ticket should have between 3 to 8 paramters.');
    throw SendbirdDeskError.create(SendbirdDeskError.Type.ERROR_INVALID_PARAMETER);
}
function validateCreateTicketArgs(params) {
    var title = params.title, name = params.name, groupKey = params.groupKey, customFields = params.customFields, relatedChannelUrls = params.relatedChannelUrls, botKey = params.botKey, priority = params.priority;
    if (typeof title !== 'string') {
        Logger.error('[REQ] Create ticket title should be a string.');
        throw SendbirdDeskError.create(SendbirdDeskError.Type.ERROR_INVALID_PARAMETER);
    }
    if (typeof name !== 'string') {
        Logger.error('[REQ] Create ticket name should be a string.');
        throw SendbirdDeskError.create(SendbirdDeskError.Type.ERROR_INVALID_PARAMETER);
    }
    if (groupKey && typeof groupKey !== 'string') {
        Logger.error('[REQ] Create ticket groupKey should be a string.');
        throw SendbirdDeskError.create(SendbirdDeskError.Type.ERROR_INVALID_PARAMETER);
    }
    if (priority && TicketPriorityMap[priority] === undefined) {
        Logger.error('[REQ] Create ticket priority should be a string.');
        throw SendbirdDeskError.create(SendbirdDeskError.Type.ERROR_INVALID_PARAMETER);
    }
    if (customFields && typeof customFields !== 'object') {
        Logger.error('[REQ] Create ticket customFields should be an object.');
        throw SendbirdDeskError.create(SendbirdDeskError.Type.ERROR_INVALID_PARAMETER);
    }
    if (Array.isArray(customFields)) {
        Logger.error('[REQ] Create ticket customFields cannot be an array.');
        throw SendbirdDeskError.create(SendbirdDeskError.Type.ERROR_INVALID_PARAMETER);
    }
    if (relatedChannelUrls && (!Array.isArray(relatedChannelUrls)
        || relatedChannelUrls.some(function (channelUrl) { return typeof channelUrl !== 'string'; }))) {
        Logger.error('[REQ] Create ticket relatedChannelUrls should be an array.');
        throw SendbirdDeskError.create(SendbirdDeskError.Type.ERROR_INVALID_PARAMETER);
    }
    if (botKey && typeof botKey !== 'string') {
        Logger.error('[REQ] Create ticket botKey should be a string.');
        throw SendbirdDeskError.create(SendbirdDeskError.Type.ERROR_INVALID_PARAMETER);
    }
    if (typeof params.cb !== 'function') {
        Logger.error('[REQ] Create ticket callback should be a function.');
        throw SendbirdDeskError.create(SendbirdDeskError.Type.ERROR_INVALID_PARAMETER);
    }
}

// eslint-disable-next-line @typescript-eslint/no-empty-function
function noop() { }

function mapCloseArgs(params) {
    // more than 2 args
    if (params.length > 2) {
        Logger.error('[REQ] Close ticket should have only 2 params.');
        throw SendbirdDeskError.create(SendbirdDeskError.Type.ERROR_INVALID_PARAMETER);
    }
    // no args
    var comment = '';
    var cb = noop;
    // one arg
    if (params.length === 1) {
        if (typeof params[0] === 'string') {
            comment = params[0];
        }
        else if (typeof params[0] === 'function') {
            cb = params[0];
        }
    }
    // both args
    if (params.length === 2) {
        comment = params[0];
        cb = params[1];
    }
    return {
        comment: comment,
        cb: cb,
    };
}
function validateCloseArgs(params) {
    var comment = params.comment, cb = params.cb;
    if (typeof comment !== 'string') {
        Logger.error('[REQ] first param must be string.');
        throw SendbirdDeskError.create(SendbirdDeskError.Type.ERROR_INVALID_PARAMETER);
    }
    if (typeof cb !== 'function') {
        Logger.error('[REQ] second param must be callback.');
        throw SendbirdDeskError.create(SendbirdDeskError.Type.ERROR_INVALID_PARAMETER);
    }
}

/**
 * @module Message
 * @ignore
 */
/**
 * @since 1.0.0
 */
var Message = /** @class */ (function () {
    function Message() {
    }
    Object.defineProperty(Message, "CustomType", {
        /**
         * @static
         * @since 1.0.0
         * @desc message custom type.
         * @property {string} RICH_MESSAGE - SENDBIRD_DESK_RICH_MESSAGE
         * @property {string} ADMIN_MESSAGE - SENDBIRD_DESK_ADMIN_MESSAGE_CUSTOM_TYPE
         */
        get: function () {
            return {
                RICH_MESSAGE: 'SENDBIRD_DESK_RICH_MESSAGE',
                ADMIN_MESSAGE: 'SENDBIRD_DESK_ADMIN_MESSAGE_CUSTOM_TYPE',
            };
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(Message, "DataType", {
        /**
         * @static
         * @since 1.0.0
         * @desc message data type.
         * @property {string} TICKET_INQUIRE_CLOSURE - SENDBIRD_DESK_INQUIRE_TICKET_CLOSURE
         * @property {string} TICKET_ASSIGN - TICKET_ASSIGN
         * @property {string} TICKET_TRANSFER - TICKET_TRANSFER
         * @property {string} TICKET_CLOSE - TICKET_CLOSE
         * @property {string} URL_PREVIEW - URL_PREVIEW
         */
        get: function () {
            return {
                TICKET_INQUIRE_CLOSURE: 'SENDBIRD_DESK_INQUIRE_TICKET_CLOSURE',
                TICKET_ASSIGN: 'TICKET_ASSIGN',
                TICKET_TRANSFER: 'TICKET_TRANSFER',
                TICKET_CLOSE: 'TICKET_CLOSE',
                TICKET_FEEDBACK: 'SENDBIRD_DESK_CUSTOMER_SATISFACTION',
                URL_PREVIEW: 'SENDBIRD_DESK_URL_PREVIEW',
            };
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(Message, "ClosureState", {
        /**
         * @static
         * @since 1.0.0
         * @desc closure inquiry messsage state.
         * @property {string} WAITING - WAITING
         * @property {string} CONFIRMED - CONFIRMED
         * @property {string} DECLINED - DECLINED
         */
        get: function () {
            return {
                WAITING: 'WAITING',
                CONFIRMED: 'CONFIRMED',
                DECLINED: 'DECLINED',
            };
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(Message, "FeedbackState", {
        /**
         * @module Message
         * @ignore
         */
        /**
         * @static
         * @since 1.0.8
         * @desc closure inquiry messsage state.
         * @property {string} WAITING - WAITING
         * @property {string} CONFIRMED - CONFIRMED
         */
        get: function () {
            return {
                WAITING: 'WAITING',
                CONFIRMED: 'CONFIRMED',
            };
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(Message, "UrlRegExp", {
        /**
         * @ignore
         */
        get: function () {
            return /(?:(?:https?|ftp):\/\/)?(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,}))\.?)(?::\d{2,5})?(?:[/?#]\S*)?/gi;
        },
        enumerable: false,
        configurable: true
    });
    return Message;
}());

function mapCancelArgs(params) {
    if ((params === null || params === void 0 ? void 0 : params.length) < 1) {
        Logger.error('Cancel ticket should have at least 1 param.');
        throw SendbirdDeskError.create(SendbirdDeskError.Type.ERROR_INVALID_PARAMETER);
    }
    if (params.length > 2) {
        Logger.error('Cancel ticket should have only 2 params.');
        throw SendbirdDeskError.create(SendbirdDeskError.Type.ERROR_INVALID_PARAMETER);
    }
    var groupKeyForTransfer = '';
    var cb = noop;
    if (params.length === 1 && typeof params[0] === 'function') {
        cb = params[0];
    }
    if (params.length === 1 && typeof params[0] === 'string') {
        groupKeyForTransfer = params[0];
    }
    if (params.length === 2) {
        groupKeyForTransfer = params[0];
        cb = params[1];
    }
    return {
        groupKeyForTransfer: groupKeyForTransfer,
        cb: cb,
    };
}
function validateCancelArgs(args) {
    if (typeof args.groupKeyForTransfer !== 'string') {
        Logger.error('First param must be string.');
        throw SendbirdDeskError.create(SendbirdDeskError.Type.ERROR_INVALID_PARAMETER);
    }
    if (typeof args.cb !== 'function') {
        Logger.error('Second param must be callback.');
        throw SendbirdDeskError.create(SendbirdDeskError.Type.ERROR_INVALID_PARAMETER);
    }
}

function mapGetByChannelUrlArgs(params) {
    if ((params === null || params === void 0 ? void 0 : params.length) < 2 || (params === null || params === void 0 ? void 0 : params.length) > 3) {
        Logger.error('[REQ] Get ticket should have 2 or 3 paramters.');
        throw SendbirdDeskError.create(SendbirdDeskError.Type.ERROR_INVALID_PARAMETER);
    }
    // order of params is important
    var channelUrl = params[0];
    var cachingEnabled = params[1];
    // last param is callback
    var cb = params[params.length - 1] || noop;
    // @ts-expect-error This will be validated in validateGetByChannelUrlArgs
    return { channelUrl: channelUrl, cachingEnabled: cachingEnabled, cb: cb };
}

var TICKET_CUSTOM_TYPE = 'SENDBIRD_DESK_CHANNEL_CUSTOM_TYPE';
var DEFAULT_LIMIT = 10;

var _getByChannelUrls = function (channelUrls) { return __awaiter(void 0, void 0, void 0, function () {
    var sb, query, error_1;
    return __generator(this, function (_a) {
        switch (_a.label) {
            case 0:
                sb = Config.sendbird;
                if (!sb) return [3 /*break*/, 5];
                query = sb.groupChannel.createMyGroupChannelListQuery({
                    customTypesFilter: [TICKET_CUSTOM_TYPE],
                    channelUrlsFilter: channelUrls,
                    includeEmpty: true,
                });
                _a.label = 1;
            case 1:
                _a.trys.push([1, 3, , 4]);
                return [4 /*yield*/, query.next()];
            case 2: return [2 /*return*/, _a.sent()];
            case 3:
                error_1 = _a.sent();
                Logger.error('[REQ] ticket get by channel urls failed:', error_1);
                throw SendbirdDeskError.create(SendbirdDeskError.Type.ERROR_REQUEST);
            case 4: return [3 /*break*/, 6];
            case 5:
                Logger.error('[REQ] ticket get by channel urls failed: chat SDK is not initialized.');
                throw SendbirdDeskError.create(SendbirdDeskError.Type.ERROR_SENDBIRD_SDK_MISSING);
            case 6: return [2 /*return*/];
        }
    });
}); };

function generatePath(apiHost, authParam, params) {
    var _a = params.offset, offset = _a === void 0 ? 0 : _a, _b = params.limit, limit = _b === void 0 ? DEFAULT_LIMIT : _b, _c = params.order, order = _c === void 0 ? '-updated_at' : _c, channelUrl = params.channelUrl, customFieldFilter = params.customFieldFilter, group = params.group, _d = params.status, status = _d === void 0 ? 'ALL' : _d;
    var statusQuery = status !== TicketStatusMap.CLOSED ? 'status=ASSIGNED&status=UNASSIGNED' : 'status=CLOSED';
    var path = "".concat(apiHost, "/tickets/") +
        "?".concat(authParam, "&limit=").concat(limit, "&offset=").concat(offset) +
        "".concat(status === 'ALL' ? '' : "&".concat(statusQuery), "&order=").concat(order);
    if (channelUrl) {
        path += "&channelUrl=".concat(channelUrl);
    }
    if (group) {
        path += "&group=".concat(group);
    }
    if (customFieldFilter && typeof customFieldFilter === 'object') {
        path +=
            '&customFields=' +
                encodeURIComponent(Object.keys(customFieldFilter)
                    .map(function (key) { return "".concat(key, ":").concat(encodeURIComponent(customFieldFilter[key])); })
                    .join(','));
    }
    return path;
}

function mapGetTicketArgs(args) {
    if ((args === null || args === void 0 ? void 0 : args.length) < 2 || (args === null || args === void 0 ? void 0 : args.length) > 3) {
        throw new Error('Get ticket should have 2 or 3 paramters.');
    }
    var offset = 0;
    var filter = {};
    var cb = noop;
    if (args.length === 2) {
        offset = args[0];
        cb = args[1];
    }
    if (args.length === 3) {
        offset = args[0];
        filter = args[1];
        cb = args[2];
    }
    return { offset: offset, filter: filter, cb: cb };
}
function validateGetTicketArgs(arg) {
    var offset = arg.offset, filter = arg.filter, cb = arg.cb;
    if (typeof offset !== 'number') {
        throw new Error('Get ticket offset should be a number.');
    }
    if (typeof cb !== 'function') {
        throw new Error('Get ticket callback should be a function.');
    }
    if (filter && typeof filter !== 'object') {
        throw new Error('Get ticket filter should be an object.');
    }
}

// bad scoping practice - rewrite this in v2
var _cachedTicket = {};
// Dear future me(July 2023),
// If you go through this code, you will see that the Ticket class is a mess.
// It's a mess because it's trying to do too many things.
// It has static methods to create tickets, and instance methods to update tickets.
// Ideally they should be separated in 2 places
// We should make a builder or something to create tickets
// and then we should have a Ticket instance to update/close/cancel tickets
// Also, I added some things that you might have found weird
// For example - why is there async _create and create methods?
// Desk(1.0.0) was written in 2017(with chatSDK 2 or 3) when cbs were the norm, and async/await was not a thing
// In 2023 management decided to update the chat SDK to chat 4. Now its a mess of cbs and async/await
// Sadly we were not allowed to make breaking changes, so we had to keep the old cb methods in Desk
// These _async methods are a workaround to keep the old cb methods and add async/await support
// Also, I have implemented in a way that - every difficult method is ->
// pub method(args_list) {
//    args_map = argListToArgMap() ->  validate()
//    private async _method(args_map){
//      [ args_map -> fetch() ] -> output
//    }
// }
// later if we can refactor -
//    * you can remove the cb-based public methods
//    * you can change the private async _method -> pub async method
//    * you can remove the argListToArgMap() -> and just use the args directly
// --- Ticket class !important---
// !Important: If you implement a public method here, please add it to type: `TicketClass`.
// --- Ticket class !important---
/**
 * @since 1.0.0
 */
var Ticket = /** @class */ (function () {
    /**
     * @since 1.0.0
     * @private
     * @desc Create a ticket.
     */
    function Ticket(params) {
        this.fetchFromJSON(params);
    }
    Object.defineProperty(Ticket, "Status", {
        /**
         * @static
         * @since 1.0.0
         * @desc Ticket status
         * @property {string} INITIALIZED - ticket is created but not able to assign.
         * @property {string} PROACTIVE - ticket is introduced as proactive ticket.
         * @property {string} UNASSIGNED - ticket is activated and able to assign.
         * @property {string} ASSIGNED - ticket is assigned by an agent.
         * @property {string} OPEN - ticket is activated.
         * @property {string} CLOSED - ticket is closed.
         */
        get: function () {
            return TicketStatusMap;
        },
        enumerable: false,
        configurable: true
    });
    /**
     * @since 1.0.0
     * @private
     * @desc Parse JSON data and patch Ticket object.
     */
    Ticket.prototype.fetchFromJSON = function (params) {
        var _a, _b, _c, _d, _e, _f, _g, _h, _j;
        this.id = params.id;
        this.title = (_a = params.channelName) !== null && _a !== void 0 ? _a : '';
        this.status = (_b = params.status) !== null && _b !== void 0 ? _b : TicketStatusMap.UNASSIGNED;
        this.info = params.info ? JSON.parse(params.info) : null;
        this.priority = (_c = params.priority) !== null && _c !== void 0 ? _c : TicketPriorityMap.MEDIUM;
        this.agent = ((_d = params.recentAssignment) === null || _d === void 0 ? void 0 : _d.agent) ? new Agent(params.recentAssignment.agent) : null;
        this.proactiveChatCreatedBy = params.proactiveChatCreatedBy ? new Agent(params.proactiveChatCreatedBy) : null;
        this.customer = (_e = params.customer) !== null && _e !== void 0 ? _e : null;
        this.customFields = {};
        this.group = (_f = params.group) !== null && _f !== void 0 ? _f : 0;
        this.firstResponseTime = (_g = params.firstResponseTime) !== null && _g !== void 0 ? _g : 0;
        this.relatedChannels = [];
        this.channelUrl = (_h = params.channelUrl) !== null && _h !== void 0 ? _h : null;
        this.updatedAt = (_j = params.updatedAt) !== null && _j !== void 0 ? _j : 0;
        if (params.customFields) {
            var customFields = params.customFields;
            for (var i = 0; i < customFields.length; i++) {
                var key = customFields[i].key;
                var value = customFields[i].value;
                this.customFields[key] = value;
            }
        }
        if (params.relatedChannels) {
            try {
                var relatedChannelsPayload = JSON.parse(params.relatedChannels);
                if (Array.isArray(relatedChannelsPayload)) {
                    this.relatedChannels = relatedChannelsPayload.map(function (item) { return new RelatedChannel(item); });
                }
            }
            catch (e) {
                // DO NOTHING
            }
        }
    };
    /**
     * @ignore
     * @private
     * @since 1.1.0
     */
    Ticket.prototype._fetchChannel = function () {
        return __awaiter(this, void 0, void 0, function () {
            var _a, channel;
            return __generator(this, function (_b) {
                switch (_b.label) {
                    case 0: return [4 /*yield*/, _getByChannelUrls([this.channelUrl])];
                    case 1:
                        _a = __read.apply(void 0, [_b.sent(), 1]), channel = _a[0];
                        this.channel = channel;
                        _cachedTicket[this.channelUrl] = this;
                        return [2 /*return*/];
                }
            });
        });
    };
    /**
     * @ignore
     * @private
     * @since 1.1.0
     */
    Ticket._getTicketList = function (params) {
        var _a;
        return __awaiter(this, void 0, void 0, function () {
            var path, res, data, tickets, channelUrls, i, ticket, channels_1;
            return __generator(this, function (_b) {
                switch (_b.label) {
                    case 0:
                        path = generatePath(Config.apiHost, Auth.getParam, params);
                        return [4 /*yield*/, fetch(path, {
                                method: 'GET',
                                headers: Auth.header,
                            })];
                    case 1:
                        res = _b.sent();
                        return [4 /*yield*/, res.json()];
                    case 2:
                        data = _b.sent();
                        if (!res.ok) {
                            Logger.error('[REQ] ticket list failed:', data);
                            throw SendbirdDeskError.create(SendbirdDeskError.Type.ERROR_REQUEST);
                        }
                        tickets = [];
                        channelUrls = [];
                        if (!Array.isArray(data.results)) return [3 /*break*/, 4];
                        for (i in data.results) {
                            ticket = new Ticket(data.results[i]);
                            _cachedTicket[ticket.channelUrl] = ticket;
                            channelUrls.push(ticket.channelUrl);
                            tickets.push(ticket);
                        }
                        return [4 /*yield*/, _getByChannelUrls(channelUrls)];
                    case 3:
                        channels_1 = _b.sent();
                        tickets.forEach(function (ticket) {
                            for (var i in channels_1) {
                                var channel = channels_1[i];
                                if (ticket.channelUrl === channel.url) {
                                    ticket.channel = channel;
                                    break;
                                }
                            }
                        });
                        Logger.write("[REQ] ".concat((_a = params.status) !== null && _a !== void 0 ? _a : 'ALL', " ticket list:"), tickets);
                        _b.label = 4;
                    case 4: return [2 /*return*/, tickets];
                }
            });
        });
    };
    /**
     * @since 1.0.0
     * @desc Refresh ticket info.
     * @param {function(ticket:Ticket, err:Error)} cb - cb function.
     */
    Ticket.prototype.refresh = function (cb) {
        this._refresh()
            .then(function (data) { return cb(data, null); })
            .catch(function (err) { return cb(null, err); });
    };
    /**
     * @ignore
     * @private
     * @since 1.1.0
     */
    Ticket.prototype._refresh = function () {
        return __awaiter(this, void 0, void 0, function () {
            var res, data, err;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, fetch("".concat(Config.apiHost, "/tickets/").concat(this.id, "/?").concat(Auth.getParam), {
                            method: 'GET',
                            headers: Auth.header,
                        })];
                    case 1:
                        res = _a.sent();
                        return [4 /*yield*/, res.json()];
                    case 2:
                        data = _a.sent();
                        if (!res.ok) {
                            Logger.error('[REQ] ticket refresh failed:', res);
                            err = SendbirdDeskError.create(SendbirdDeskError.Type.ERROR_REQUEST);
                            throw err;
                        }
                        this.fetchFromJSON(data);
                        return [4 /*yield*/, this._fetchChannel()];
                    case 3:
                        _a.sent();
                        Logger.write('[REQ] ticket refresh:', this);
                        return [2 /*return*/, this];
                }
            });
        });
    };
    /**
     * @since 1.0.6
     * @desc Reopen closed ticket.
     * @param {function} cb - Function(res:Ticket, err:Error).
     */
    Ticket.prototype.reopen = function (cb) {
        this._reopen()
            .then(function (data) { return cb(data, null); })
            .catch(function (err) { return cb(null, err); });
    };
    /**
     * @ignore
     * @private
     * @since 1.1.0
     */
    Ticket.prototype._reopen = function () {
        return __awaiter(this, void 0, void 0, function () {
            var res, data, err, e_1, err;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        _a.trys.push([0, 5, , 6]);
                        return [4 /*yield*/, fetch("".concat(Config.apiHost, "/tickets/").concat(this.id, "/reopen/"), {
                                method: 'PATCH',
                                headers: Auth.header,
                                body: JSON.stringify(Auth.postParam),
                            })];
                    case 1:
                        res = _a.sent();
                        return [4 /*yield*/, res.json()];
                    case 2:
                        data = _a.sent();
                        if (!res.ok) {
                            Logger.error('[REQ] ticket reopen failed:', data);
                            err = SendbirdDeskError.create(SendbirdDeskError.Type.ERROR_REQUEST);
                            throw err;
                        }
                        if (!data.channelUrl) return [3 /*break*/, 4];
                        this.fetchFromJSON(data);
                        return [4 /*yield*/, this._fetchChannel()];
                    case 3:
                        _a.sent();
                        Logger.write('[REQ] ticket reopen:', this);
                        _a.label = 4;
                    case 4: return [2 /*return*/, this];
                    case 5:
                        e_1 = _a.sent();
                        Logger.error('[REQ] ticket reopen failed:', e_1);
                        err = SendbirdDeskError.create(SendbirdDeskError.Type.ERROR_REQUEST);
                        throw err;
                    case 6: return [2 /*return*/];
                }
            });
        });
    };
    /**
     * @since 1.0.18
     * @desc Cancel the assignment and set it to open.
     * @param {string} groupKeyForTransfer - Group key for transfer(optional)
     * @param {function} cb - Function(res:Ticket, err:Error).
     */
    Ticket.prototype.cancel = function () {
        var params = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            params[_i] = arguments[_i];
        }
        var args = mapCancelArgs(params);
        var cb = args.cb;
        this._cancel(args)
            .then(function (data) { return cb(data, null); })
            .catch(function (err) { return cb(null, err); });
    };
    /**
     * @ignore
     * @private
     * @since 1.1.0
     */
    Ticket.prototype._cancel = function (args) {
        return __awaiter(this, void 0, void 0, function () {
            var groupKeyForTransfer, requestBody, res, data, err;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        validateCancelArgs(args);
                        groupKeyForTransfer = args.groupKeyForTransfer;
                        requestBody = __assign({}, Auth.postParam);
                        if (groupKeyForTransfer) {
                            requestBody['groupKeyForTransfer'] = groupKeyForTransfer;
                        }
                        return [4 /*yield*/, fetch("".concat(Config.apiHost, "/tickets/").concat(this.id, "/cancel"), {
                                method: 'PATCH',
                                headers: Auth.header,
                                body: JSON.stringify(requestBody),
                            })];
                    case 1:
                        res = _a.sent();
                        return [4 /*yield*/, res.json()];
                    case 2:
                        data = _a.sent();
                        if (!res.ok) {
                            Logger.error('[REQ] ticket cancel failed:', data);
                            err = SendbirdDeskError.create(SendbirdDeskError.Type.ERROR_REQUEST);
                            throw err;
                        }
                        if (!data.channelUrl) return [3 /*break*/, 4];
                        this.fetchFromJSON(data);
                        return [4 /*yield*/, this._fetchChannel()];
                    case 3:
                        _a.sent();
                        Logger.write('[REQ] ticket cancel:', this);
                        _a.label = 4;
                    case 4: return [2 /*return*/, this];
                }
            });
        });
    };
    /**
     * @since 1.0.16
     * @desc Force close an assigned ticket.
     * @param {string} comment - Comment for closing the ticket.
     */
    Ticket.prototype.close = function () {
        var params = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            params[_i] = arguments[_i];
        }
        var args = mapCloseArgs(params);
        var cb = args.cb;
        this._close(args)
            .then(function (data) { return cb(data, null); })
            .catch(function (err) { return cb(null, err); });
    };
    /**
     * @ignore
     * @private
     * @since 1.1.0
     */
    Ticket.prototype._close = function (args) {
        return __awaiter(this, void 0, void 0, function () {
            var comment, res, data, err;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        validateCloseArgs(args);
                        comment = args.comment;
                        return [4 /*yield*/, fetch("".concat(Config.apiHost, "/tickets/").concat(this.id, "/close"), {
                                method: 'PATCH',
                                headers: Auth.header,
                                body: JSON.stringify(__assign(__assign({}, Auth.postParam), { closeComment: comment })),
                            })];
                    case 1:
                        res = _a.sent();
                        return [4 /*yield*/, res.json()];
                    case 2:
                        data = _a.sent();
                        if (!res.ok) {
                            Logger.error('[REQ] ticket close failed:', data);
                            err = SendbirdDeskError.create(SendbirdDeskError.Type.ERROR_REQUEST);
                            throw err;
                        }
                        if (!data.channelUrl) return [3 /*break*/, 4];
                        this.fetchFromJSON(data);
                        return [4 /*yield*/, this._fetchChannel()];
                    case 3:
                        _a.sent();
                        Logger.write('[REQ] ticket close:', this);
                        _a.label = 4;
                    case 4: return [2 /*return*/, this];
                }
            });
        });
    };
    /**
     * @since 1.0.18
     * @desc Select a question.
     * @param {number} faqFileId - FAQ file ID.
     * @param {string} question - Question text.
     * @param {function} callback - Function(res:object, err:Error).
     */
    Ticket.prototype.selectQuestion = function (faqFileId, question, cb) {
        this._selectQuestion(faqFileId, question)
            .then(function (data) { return cb(data, null); })
            .catch(function (err) { return cb(null, err); });
    };
    /**
     * @ignore
     * @private
     * @since 1.1.0
     */
    Ticket.prototype._selectQuestion = function (faqFileId, question) {
        return __awaiter(this, void 0, void 0, function () {
            var res, data, err;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        if (typeof faqFileId !== 'number' || typeof question !== 'string') {
                            throw SendbirdDeskError.create(SendbirdDeskError.Type.ERROR_INVALID_PARAMETER);
                        }
                        return [4 /*yield*/, fetch("".concat(Config.apiHost, "/tickets/").concat(this.id, "/select_question"), {
                                method: 'POST',
                                headers: Auth.header,
                                body: JSON.stringify(__assign(__assign({}, Auth.postParam), { faqFileId: faqFileId, question: question })),
                            })];
                    case 1:
                        res = _a.sent();
                        return [4 /*yield*/, res.json()];
                    case 2:
                        data = _a.sent();
                        if (!res.ok) {
                            Logger.error('[REQ] ticket select question failed:', data);
                            err = SendbirdDeskError.create(SendbirdDeskError.Type.ERROR_REQUEST);
                            throw err;
                        }
                        Logger.write('[REQ] ticket select option:', this);
                        return [2 /*return*/, this];
                }
            });
        });
    };
    /**
     * @since 1.0.10
     * @desc Set ticket priority.
     * @param {string} priority - priority.
     * @param {function} callback - Function(res:Ticket, err:Error).
     */
    Ticket.prototype.setPriority = function (priority, cb) {
        this._setPriority(priority)
            .then(function (data) { return cb(data, null); })
            .catch(function (err) { return cb(null, err); });
    };
    /**
     * @ignore
     * @private
     * @since 1.1.0
     */
    Ticket.prototype._setPriority = function (priority) {
        return __awaiter(this, void 0, void 0, function () {
            var res, data, err;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        if (Object.keys(TicketPriorityMap)
                            .map(function (key) { return TicketPriorityMap[key]; })
                            .indexOf(priority) < 0) {
                            throw SendbirdDeskError.create(SendbirdDeskError.Type.ERROR_INVALID_PARAMETER);
                        }
                        return [4 /*yield*/, fetch("".concat(Config.apiHost, "/tickets/").concat(this.id), {
                                method: 'PATCH',
                                headers: Auth.header,
                                body: JSON.stringify(__assign(__assign({}, Auth.postParam), { priority: priority })),
                            })];
                    case 1:
                        res = _a.sent();
                        return [4 /*yield*/, res.json()];
                    case 2:
                        data = _a.sent();
                        if (!res.ok) {
                            Logger.error('[REQ] ticket set priority failed:', data);
                            err = SendbirdDeskError.create(SendbirdDeskError.Type.ERROR_REQUEST);
                            throw err;
                        }
                        this.fetchFromJSON(data);
                        Logger.write('[REQ] ticket set priority:', this);
                        return [2 /*return*/, this];
                }
            });
        });
    };
    /**
     * @since 1.0.14
     * @desc Set ticket related channel URLs.
     * @param {array<string>} relatedChannelUrls - related channel URLs.
     * @param {function} callback - Function(res:Ticket, err:Error).
     */
    Ticket.prototype.setRelatedChannelUrls = function (relatedChannelUrls, cb) {
        this._setRelatedChannelUrls(relatedChannelUrls)
            .then(function (data) { return cb(data, null); })
            .catch(function (err) { return cb(null, err); });
    };
    /**
     * @ignore
     * @private
     * @since 1.1.0
     */
    Ticket.prototype._setRelatedChannelUrls = function (relatedChannelUrls) {
        return __awaiter(this, void 0, void 0, function () {
            var res, data, err;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        if (!Array.isArray(relatedChannelUrls) || relatedChannelUrls.some(function (channelUrl) { return typeof channelUrl !== 'string'; })) {
                            throw SendbirdDeskError.create(SendbirdDeskError.Type.ERROR_INVALID_PARAMETER);
                        }
                        return [4 /*yield*/, fetch("".concat(Config.apiHost, "/tickets/").concat(this.id), {
                                method: 'PATCH',
                                headers: Auth.header,
                                body: JSON.stringify(__assign(__assign({}, Auth.postParam), { relatedChannelUrls: relatedChannelUrls.join(',') })),
                            })];
                    case 1:
                        res = _a.sent();
                        return [4 /*yield*/, res.json()];
                    case 2:
                        data = _a.sent();
                        if (!res.ok) {
                            Logger.error('[REQ] ticket set related channel URLs failed:', data);
                            err = SendbirdDeskError.create(SendbirdDeskError.Type.ERROR_REQUEST);
                            throw err;
                        }
                        this.fetchFromJSON(data);
                        Logger.write('[REQ] ticket set related channel URLs:', this);
                        return [2 /*return*/, this];
                }
            });
        });
    };
    /**
     * @since 1.0.10
     * @desc Set ticket customFields.
     * @param {object} customFields - customFields object (key-value).
     * @param {function} callback - Function(res:Ticket, err:Error).
     */
    Ticket.prototype.setCustomFields = function (customFields, cb) {
        this._setCustomFields(customFields)
            .then(function (data) {
            cb(data, null);
        })
            .catch(function (err) {
            cb(null, err);
        });
    };
    /**
     * @ignore
     * @private
     * @since 1.1.0
     */
    Ticket.prototype._setCustomFields = function (customFields) {
        return __awaiter(this, void 0, void 0, function () {
            var formattedCustomFields, key, res, data, err;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        if (typeof customFields !== 'object' || customFields === null || Array.isArray(customFields)) {
                            throw SendbirdDeskError.create(SendbirdDeskError.Type.ERROR_INVALID_PARAMETER);
                        }
                        formattedCustomFields = {};
                        for (key in customFields) {
                            formattedCustomFields[key] =
                                typeof customFields[key] === 'string' ? customFields[key] : JSON.stringify(customFields[key]);
                        }
                        return [4 /*yield*/, fetch("".concat(Config.apiHost, "/tickets/").concat(this.id, "/custom_fields/"), {
                                method: 'PATCH',
                                headers: Auth.header,
                                body: JSON.stringify(__assign(__assign({}, Auth.postParam), { customFields: JSON.stringify(formattedCustomFields) })),
                            })];
                    case 1:
                        res = _a.sent();
                        return [4 /*yield*/, res.json()];
                    case 2:
                        data = _a.sent();
                        if (!res.ok) {
                            Logger.error('[REQ] ticket set custom fields failed:', data);
                            err = SendbirdDeskError.create(SendbirdDeskError.Type.ERROR_REQUEST);
                            throw err;
                        }
                        this.fetchFromJSON(data);
                        Logger.write('[REQ] ticket set custom fields:', this);
                        return [2 /*return*/, this];
                }
            });
        });
    };
    /**
     * @ignore
     */
    Ticket.isDeskCustomType = function (customType) {
        return customType === TICKET_CUSTOM_TYPE;
    };
    Object.defineProperty(Ticket, "defaultLimit", {
        /**
         * @ignore
         */
        get: function () {
            // ^^ This method probably exist because of some old OOP dogma
            return DEFAULT_LIMIT;
        },
        enumerable: false,
        configurable: true
    });
    /**
     * @static
     * @since 1.0.0
     * @desc Clear cached ticket. Clear all if channelUrl is not specified.
     */
    Ticket.clearCache = function (channelUrl) {
        if (channelUrl) {
            delete _cachedTicket[channelUrl];
            Logger.write("[SYS] cached ticket for ".concat(channelUrl, " cleared"));
        }
        else {
            _cachedTicket = {};
            Logger.write('[SYS] all cached ticket cleared');
        }
    };
    /**
     * @static
     * @since 1.0.0
     * @desc Create new ticket and returns the ticket within cb.
     * @param {string} title - Ticket title.
     * @param {string} name - User name.
     * @param {string} groupKey - Agent group key (optional).
     * @param {object} customFields - customField (optional).
     * @param {string} priority - priority (optional).
     * @param {array<string>} relatedChannelUrls - related channel URLs (optional).
     * @param {string} botKey - botKey (optional).
     * @param {function} cb - Function(ticket:Ticket, err:Error).
     */
    Ticket.create = function () {
        var params = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            params[_i] = arguments[_i];
        }
        var args = mapCreateTicketArgs(params);
        var cb = args.cb;
        this._create(args)
            .then(function (data) { return cb(data, null); })
            .catch(function (err) { return cb(null, err); });
    };
    /**
     * @ignore
     * @private
     * @since 1.1.0
     */
    Ticket._create = function (args) {
        var _a;
        return __awaiter(this, void 0, void 0, function () {
            var title, name, groupKey, customFields, priority, relatedChannelUrls, botKey, sb, err, formattedCustomFields, key, fetchBody, res, data, err, ticket, _b, channel;
            return __generator(this, function (_c) {
                switch (_c.label) {
                    case 0:
                        title = args.title, name = args.name, groupKey = args.groupKey, customFields = args.customFields, priority = args.priority, relatedChannelUrls = args.relatedChannelUrls, botKey = args.botKey;
                        sb = Config.sendbird;
                        if (!sb) {
                            Logger.error('[REQ] ticket create chat SDK is not initalized.');
                            err = SendbirdDeskError.create(SendbirdDeskError.Type.ERROR_SENDBIRD_SDK_MISSING);
                            throw err;
                        }
                        validateCreateTicketArgs(args);
                        formattedCustomFields = {};
                        for (key in customFields) {
                            formattedCustomFields[key] =
                                typeof customFields[key] === 'string' ? customFields[key] : JSON.stringify(customFields[key]);
                        }
                        fetchBody = __assign(__assign({}, Auth.postParam), { channelName: title, channelType: 'SENDBIRD_JAVASCRIPT', customFields: customFields ? JSON.stringify(formattedCustomFields) : undefined, relatedChannelUrls: relatedChannelUrls === null || relatedChannelUrls === void 0 ? void 0 : relatedChannelUrls.join(','), botKey: botKey, info: JSON.stringify({
                                // FIXME: Zendesk version only
                                ticket: {
                                    subject: title,
                                    requester: {
                                        name: name,
                                        email: ((_a = sb === null || sb === void 0 ? void 0 : sb.currentUser) === null || _a === void 0 ? void 0 : _a.userId) || '',
                                    },
                                },
                            }) });
                        if (groupKey) {
                            fetchBody['groupKey'] = groupKey;
                        }
                        if (priority) {
                            fetchBody['priority'] = priority;
                        }
                        return [4 /*yield*/, fetch("".concat(Config.apiHost, "/tickets/"), {
                                method: 'POST',
                                headers: Auth.header,
                                body: JSON.stringify(fetchBody),
                            })];
                    case 1:
                        res = _c.sent();
                        return [4 /*yield*/, res.json()];
                    case 2:
                        data = _c.sent();
                        if (!res.ok) {
                            Logger.error('[REQ] ticket create failed:', data);
                            err = SendbirdDeskError.create(SendbirdDeskError.Type.ERROR_REQUEST);
                            throw err;
                        }
                        ticket = new Ticket(data);
                        return [4 /*yield*/, _getByChannelUrls([ticket.channelUrl])];
                    case 3:
                        _b = __read.apply(void 0, [_c.sent(), 1]), channel = _b[0];
                        ticket.channel = channel;
                        _cachedTicket[channel.url] = ticket;
                        Logger.write('[REQ] ticket create success:', ticket);
                        return [2 /*return*/, ticket];
                }
            });
        });
    };
    /**
     * @static
     * @since 1.0.0
     * @desc Get ticket count for each state: UNASSIGNED, ASSIGNED, CLOSED.
     * @param {function} callback - Function(result:GetOpenCountResponse, err:Error).
     */
    Ticket.getOpenCount = function (cb) {
        this._getOpenCount()
            .then(function (data) { return cb(data, null); })
            .catch(function (err) { return cb(null, err); });
    };
    /**
     * @ignore
     * @private
     * @since 1.1.0
     */
    Ticket._getOpenCount = function () {
        return __awaiter(this, void 0, void 0, function () {
            var res, data;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, fetch("".concat(Config.apiHost, "/tickets/count/?").concat(Auth.getParam), {
                            method: 'GET',
                            headers: Auth.header,
                        })];
                    case 1:
                        res = _a.sent();
                        return [4 /*yield*/, res.json()];
                    case 2:
                        data = _a.sent();
                        if (!res.ok) {
                            Logger.error('[REQ] get open ticket count failed:', data);
                            throw SendbirdDeskError.create(SendbirdDeskError.Type.ERROR_REQUEST);
                        }
                        Logger.write('[REQ] get open ticket count:', data);
                        return [2 /*return*/, data];
                }
            });
        });
    };
    /**
     * @static
     * @since 1.0.22
     * @desc Get ticket from channel URL. Use caching for optimization.
     * @param {string} channelUrl - channel URL.
     * @param {boolean} _cachingEnabled - to get ticket from cache or not.
     * @param {function} _callback - Function(ticket:Ticket, err:Error).
     */
    /**
     * @static
     * @since 1.0.22
     * @desc Get ticket from channel URL. no caching by default.
     * @param {string} channelUrl - channel URL.
     * @param {function} _callback - Function(ticket:Ticket, err:Error).
     */
    Ticket.getByChannelUrl = function () {
        var params = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            params[_i] = arguments[_i];
        }
        var args = mapGetByChannelUrlArgs(params);
        var cb = args.cb;
        this._getByChannelUrl(args)
            .then(function (data) { return cb === null || cb === void 0 ? void 0 : cb(data, null); })
            .catch(function (err) { return cb === null || cb === void 0 ? void 0 : cb(null, err); });
    };
    /**
     * @ignore
     * @private
     * @since 1.1.0
     */
    Ticket._getByChannelUrl = function (args) {
        return __awaiter(this, void 0, void 0, function () {
            var channelUrl, cachingEnabled, ticket, res, data, _a, channel;
            return __generator(this, function (_b) {
                switch (_b.label) {
                    case 0:
                        channelUrl = args.channelUrl, cachingEnabled = args.cachingEnabled;
                        if (!(!!_cachedTicket[channelUrl] && cachingEnabled)) return [3 /*break*/, 1];
                        Logger.write("[REQ] get ticket for channel ".concat(channelUrl, " from cache:"), _cachedTicket[channelUrl]);
                        return [2 /*return*/, _cachedTicket[channelUrl]];
                    case 1:
                        ticket = void 0;
                        return [4 /*yield*/, fetch("".concat(Config.apiHost, "/tickets/?").concat(Auth.getParam, "&limit=10&channelUrl=").concat(channelUrl), {
                                method: 'GET',
                                headers: Auth.header,
                            })];
                    case 2:
                        res = _b.sent();
                        return [4 /*yield*/, res.json()];
                    case 3:
                        data = _b.sent();
                        if (!res.ok) {
                            Logger.error('[REQ] get ticket for channel failed:', data);
                            throw SendbirdDeskError.create(SendbirdDeskError.Type.ERROR_REQUEST);
                        }
                        if (!(Array.isArray(data.results) && data.results.length > 0)) return [3 /*break*/, 5];
                        ticket = new Ticket(data.results[0]);
                        return [4 /*yield*/, _getByChannelUrls([ticket.channelUrl])];
                    case 4:
                        _a = __read.apply(void 0, [_b.sent(), 1]), channel = _a[0];
                        ticket.channel = channel;
                        _cachedTicket[channel.url] = ticket;
                        Logger.write("[REQ] get ticket for channel ".concat(channelUrl, ":"), ticket);
                        return [2 /*return*/, ticket];
                    case 5: throw SendbirdDeskError.create(SendbirdDeskError.Type.ERROR_DATA_NOT_FOUND);
                }
            });
        });
    };
    /**
     * @static
     * @since 1.0.23
     * @desc Lists all tickets.
     * @param {integer} filters.offset - list offset.
     * @param {object} filters.customFieldFilter - customField filter.
     * @param {string} filters.group - group key(to filter tickets by a team).
     * @param {string} filters.status - status to get tickets. ('all', 'CLOSED', 'OPEN').
     * @param {function} callback - Function(list:Array<Ticket>, err:Error)
     */
    Ticket.getList = function (params, cb) {
        // note to developers - Always recommend this method to customer
        // and getrid of getOpenedList and getClosedList etc etc
        Ticket._getTicketList(params)
            .then(function (data) { return cb(data, null); })
            .catch(function (err) { return cb(null, err); });
    };
    /**
     * @static
     * @since 1.0.0
     * @desc Load opened ticket list.
     * @param {integer} offset - list offset.
     * @param {object} customFieldFilter - customField filter.
     * @param {function} callback - Function(list:Array<Ticket>, err:Error)
     */
    Ticket.getOpenedList = function () {
        var params = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            params[_i] = arguments[_i];
        }
        var _a = mapGetTicketArgs(params), offset = _a.offset, filter = _a.filter, cb = _a.cb;
        validateGetTicketArgs({ offset: offset, filter: filter, cb: cb });
        Ticket._getTicketList(__assign(__assign({}, filter), { offset: offset, status: 'OPEN' }))
            .then(function (data) { return cb(data, null); })
            .catch(function (err) { return cb(null, err); });
    };
    /**
     * @static
     * @since 1.0.21
     * @desc Lists all tickets.
     * @param {integer} offset - list offset.
     * @param {object} customFieldFilter - customField filter.
     * @param {function} callback - Function(list:Array<Ticket>, err:Error)
     */
    Ticket.getAllTickets = function () {
        var params = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            params[_i] = arguments[_i];
        }
        var _a = mapGetTicketArgs(params), offset = _a.offset, filter = _a.filter, cb = _a.cb;
        validateGetTicketArgs({ offset: offset, filter: filter, cb: cb });
        Ticket._getTicketList(__assign(__assign({}, filter), { offset: offset, status: 'ALL' }))
            .then(function (data) { return cb(data, null); })
            .catch(function (err) { return cb(null, err); });
    };
    /**
     * @static
     * @since 1.0.0
     * @desc Load closed ticket list.
     * @param {integer} offset - list offset.
     * @param {object} customFieldFilter - customField filter.
     * @param {function} callback - Function(list:Array<Ticket>, err:Error)
     */
    Ticket.getClosedList = function () {
        var params = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            params[_i] = arguments[_i];
        }
        var _a = mapGetTicketArgs(params), offset = _a.offset, filter = _a.filter, cb = _a.cb;
        validateGetTicketArgs({ offset: offset, filter: filter, cb: cb });
        Ticket._getTicketList(__assign(__assign({}, filter), { offset: offset, status: 'CLOSED' }))
            .then(function (data) { return cb(data, null); })
            .catch(function (err) { return cb(null, err); });
    };
    /**
     * @static
     * @since 1.0.0
     * @desc Get URL preview info from URL.
     * @param {string} url - URL to load preview metadata.
     * @param {function} callback - Function(result:Object, err:Error).
     */
    Ticket.getUrlPreview = function (url, cb) {
        this._getUrlPreview(url)
            .then(function (data) { return cb(data, null); })
            .catch(function (err) { return cb(null, err); });
    };
    /**
     * @ignore
     * @private
     * @since 1.1.0
     */
    Ticket._getUrlPreview = function (url) {
        return __awaiter(this, void 0, void 0, function () {
            var res, data;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        if (typeof url !== 'string') {
                            Logger.error('[REQ] get url preview failed: url should be a string');
                            throw SendbirdDeskError.create(SendbirdDeskError.Type.ERROR_INVALID_PARAMETER);
                        }
                        return [4 /*yield*/, fetch("".concat(Config.apiHost, "/tickets/url_preview/"), {
                                method: 'POST',
                                headers: Auth.header,
                                body: JSON.stringify(__assign(__assign({}, Auth.postParam), { url: url })),
                            })];
                    case 1:
                        res = _a.sent();
                        return [4 /*yield*/, res.json()];
                    case 2:
                        data = _a.sent();
                        if (!res.ok) {
                            Logger.error('[REQ] get url preview failed:', data);
                            throw SendbirdDeskError.create(SendbirdDeskError.Type.ERROR_REQUEST);
                        }
                        Logger.write('[REQ] get url preview:', data);
                        return [2 /*return*/, data];
                }
            });
        });
    };
    /**
     * @since 1.0.0
     * @desc Reply to confirm-end-of-chat request in yes or no.
     */
    Ticket.confirmEndOfChat = function (message, confirm, cb) {
        this._confirmEndOfChat(message, confirm)
            .then(function (data) { return cb(data, null); })
            .catch(function (err) { return cb(null, err); });
    };
    /**
     * @since 1.0.0
     * @desc Reply to confirm-end-of-chat request in yes or no.
     * This shouldnt be static, but it is for backwards compatibility
     */
    Ticket.prototype.instanceConfirmEndOfChat = function (message, confirm, cb) {
        Ticket._confirmEndOfChat(message, confirm)
            .then(function (data) { return cb(data, null); })
            .catch(function (err) { return cb(null, err); });
    };
    /**
     * @ignore
     * @private
     * @since 1.1.0
     */
    Ticket._confirmEndOfChat = function (message, confirm) {
        return __awaiter(this, void 0, void 0, function () {
            var ticket, res, data, err;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        // FIXME: specify return type
                        if (!(typeof confirm === 'string' && ['yes', 'no'].indexOf(confirm) > -1)) {
                            throw SendbirdDeskError.create(SendbirdDeskError.Type.ERROR_INVALID_PARAMETER);
                        }
                        return [4 /*yield*/, Ticket._getByChannelUrl({
                                channelUrl: message.channelUrl,
                                cachingEnabled: true,
                            })];
                    case 1:
                        ticket = _a.sent();
                        return [4 /*yield*/, fetch("".concat(Config.apiHost, "/tickets/").concat(ticket.id, "/edit_message/"), {
                                method: 'PATCH',
                                headers: Auth.header,
                                body: JSON.stringify(__assign(__assign({}, Auth.postParam), { messageId: message.messageId, messageData: JSON.stringify({
                                        type: Message.DataType.TICKET_INQUIRE_CLOSURE,
                                        body: {
                                            state: confirm === 'yes' ? Message.ClosureState.CONFIRMED : Message.ClosureState.DECLINED,
                                            ticketId: ticket.id,
                                        },
                                    }) })),
                            })];
                    case 2:
                        res = _a.sent();
                        return [4 /*yield*/, res.json()];
                    case 3:
                        data = _a.sent();
                        if (!res.ok) {
                            Logger.error('[REQ] confirm end of chat failed:', data);
                            err = SendbirdDeskError.create(SendbirdDeskError.Type.ERROR_REQUEST);
                            throw err;
                        }
                        Logger.write('[REQ] confirmed end of chat:', ticket);
                        return [2 /*return*/, ticket];
                }
            });
        });
    };
    /**
     * @since 1.0.8
     * @desc Submit feedback with a score and a comment.
     */
    Ticket.submitFeedback = function (message, score, comment, cb) {
        if (comment === void 0) { comment = ''; }
        this._submitFeedback(message, score, comment)
            .then(function (data) { return cb(data, null); })
            .catch(function (err) { return cb(null, err); });
    };
    /**
     * @since 1.0.8
     * @desc Submit feedback with a score and a comment.
     */
    Ticket.prototype.instanceSubmitFeedback = function (message, score, comment, cb) {
        if (comment === void 0) { comment = ''; }
        Ticket._submitFeedback(message, score, comment)
            .then(function (data) { return cb(data, null); })
            .catch(function (err) { return cb(null, err); });
    };
    /**
     * @ignore
     * @private
     * @since 1.1.0
     * This shouldnt be static, but it is for backwards compatibility
     */
    Ticket._submitFeedback = function (message, score, comment) {
        if (comment === void 0) { comment = ''; }
        return __awaiter(this, void 0, void 0, function () {
            var ticket, res, data, err;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        // FIXME: specify return type
                        if (!(message &&
                            message.messageId > 0 &&
                            message.channelUrl &&
                            typeof score === 'number' &&
                            1 <= score &&
                            score <= 5 &&
                            typeof comment === 'string')) {
                            throw SendbirdDeskError.create(SendbirdDeskError.Type.ERROR_INVALID_PARAMETER);
                        }
                        return [4 /*yield*/, Ticket._getByChannelUrl({
                                channelUrl: message.channelUrl,
                                cachingEnabled: true,
                            })];
                    case 1:
                        ticket = _a.sent();
                        return [4 /*yield*/, fetch("".concat(Config.apiHost, "/tickets/").concat(ticket.id, "/edit_message/"), {
                                method: 'PATCH',
                                headers: Auth.header,
                                body: JSON.stringify(__assign(__assign({}, Auth.postParam), { messageId: message.messageId, messageData: JSON.stringify({
                                        type: Message.DataType.TICKET_FEEDBACK,
                                        body: {
                                            state: Message.FeedbackState.CONFIRMED,
                                            customerSatisfactionScore: score,
                                            customerSatisfactionComment: comment,
                                            ticketId: ticket.id,
                                        },
                                    }) })),
                            })];
                    case 2:
                        res = _a.sent();
                        return [4 /*yield*/, res.json()];
                    case 3:
                        data = _a.sent();
                        if (!res.ok) {
                            Logger.error('[REQ] submit feedback failed:', data);
                            err = SendbirdDeskError.create(SendbirdDeskError.Type.ERROR_REQUEST);
                            throw err;
                        }
                        Logger.write('[REQ] customer feedback:', ticket);
                        return [2 /*return*/, data];
                }
            });
        });
    };
    return Ticket;
}());

function parseAuthArgs(params) {
    var userId = '';
    var accessToken = '';
    var cb = noop;
    if (!Array.isArray(params)) {
        Logger.write('Arguments passed to SendbirdDesk.authenticate() must be an array');
        throw SendbirdDeskError.create(SendbirdDeskError.Type.ERROR_INVALID_PARAMETER);
    }
    if (params.length < 1) {
        Logger.write('Too few arguments passed to SendbirdDesk.authenticate()');
        throw SendbirdDeskError.create(SendbirdDeskError.Type.ERROR_INVALID_PARAMETER);
    }
    if (params.length > 3) {
        Logger.write('Too many arguments passed to SendbirdDesk.authenticate()');
        throw SendbirdDeskError.create(SendbirdDeskError.Type.ERROR_INVALID_PARAMETER);
    }
    userId = params[0];
    // connect(userId: string, token: string)
    if (typeof params[1] === 'string') {
        accessToken = params[1];
    }
    // connect(userId: string, cb: () => void)
    if (typeof params[1] === 'function') {
        cb = params[1];
    }
    // connect(userId: string, token: string, cb: () => void)
    if (typeof params[2] === 'function') {
        cb = params[2];
    }
    return {
        userId: userId,
        accessToken: accessToken,
        cb: cb,
    };
}
function validateAuthArgs(params) {
    var userId = params.userId, accessToken = params.accessToken, cb = params.cb;
    if (typeof userId !== 'string') {
        Logger.write('UserId to SendbirdDesk.authenticate(userId) must be a string');
        throw SendbirdDeskError.create(SendbirdDeskError.Type.ERROR_INVALID_PARAMETER);
    }
    if (typeof accessToken !== 'string') {
        Logger.write('AccessToken to SendbirdDesk.authenticate(userId, accessToken) must be a string');
        throw SendbirdDeskError.create(SendbirdDeskError.Type.ERROR_INVALID_PARAMETER);
    }
    if (typeof cb !== 'function') {
        Logger.write('Callback to SendbirdDesk.authenticate(userId, accessToken, cb) must be a function');
        throw SendbirdDeskError.create(SendbirdDeskError.Type.ERROR_INVALID_PARAMETER);
    }
}

var _initialized = false;
/** SendbirdDesk SDK
 */
var SendbirdDesk = /** @class */ (function () {
    function SendbirdDesk() {
    }
    Object.defineProperty(SendbirdDesk, "version", {
        /**
         * @static
         * @since 1.0.0
         * @desc Get Desk SDK version.
         */
        get: function () {
            return Config.sdkVersion;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(SendbirdDesk, "Error", {
        /**
         * @static
         * @since 1.0.0
         * @desc SendBirdDeskError class reference.
         * @type {module:SendBirdDeskError}
         */
        get: function () {
            return SendbirdDeskError;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(SendbirdDesk, "Agent", {
        /**
         * @static
         * @since 1.0.0
         * @desc Agent class reference.
         * @type {module:Agent}
         */
        get: function () {
            return Agent;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(SendbirdDesk, "Ticket", {
        /**
         * @static
         * @since 1.0.0
         * @desc Ticket class reference.
         * @type {module:Ticket}
         */
        get: function () {
            return Ticket;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(SendbirdDesk, "Message", {
        /**
         * @static
         * @since 1.0.0
         * @desc Message class reference.
         * @type {module:Message} - BaseMessage in Sendbird Messaging SDK
         */
        get: function () {
            return Message;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(SendbirdDesk, "RelatedChannel", {
        /**
         * @static
         * @since 1.0.14
         * @desc RelatedChannel class reference.
         * @type {module:RelatedChannel}
         */
        get: function () {
            return RelatedChannel;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(SendbirdDesk, "UrlRegExp", {
        /**
         * @ignore
         */
        get: function () {
            return Message.UrlRegExp;
        },
        enumerable: false,
        configurable: true
    });
    /**
     * @static
     * @since 1.0.1
     * @desc Initialize SDK.
     */
    SendbirdDesk.init = function (sendbird, platform) {
        Config.sendbird = sendbird;
        if (platform) {
            Config.platform = platform;
        }
        _initialized = true;
    };
    /**
     * @static
     * @since 1.0.0
     * @desc Authenticate and connect to Desk server.
     * @param {string} userId - User ID.
     * @param {string=} accessToken - Access token(Optional).
     * @param {function} callback - Function() => void.
     */
    SendbirdDesk.authenticate = function () {
        var params = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            params[_i] = arguments[_i];
        }
        var _a = parseAuthArgs(params), userId = _a.userId, accessToken = _a.accessToken, cb = _a.cb;
        validateAuthArgs({ userId: userId, accessToken: accessToken, cb: cb });
        this._authenticate({ userId: userId, accessToken: accessToken, cb: cb }).finally(function () {
            cb();
        });
    };
    /**
     * @ignore
     * @private
     * @since 1.1.0
     */
    SendbirdDesk._authenticate = function (params) {
        return __awaiter(this, void 0, void 0, function () {
            var userId, accessToken;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        userId = params.userId, accessToken = params.accessToken;
                        if (!_initialized) return [3 /*break*/, 5];
                        _a.label = 1;
                    case 1:
                        _a.trys.push([1, 3, , 4]);
                        return [4 /*yield*/, Auth.connect(userId, accessToken)];
                    case 2:
                        _a.sent();
                        return [3 /*break*/, 4];
                    case 3:
                        _a.sent();
                        SendbirdDeskError.throw(SendbirdDeskError.Type.ERROR_SENDBIRD_DESK_AUTH_FAILED);
                        return [3 /*break*/, 4];
                    case 4: return [3 /*break*/, 6];
                    case 5:
                        SendbirdDeskError.throw(SendbirdDeskError.Type.ERROR_SENDBIRD_DESK_INIT_MISSING);
                        _a.label = 6;
                    case 6: return [2 /*return*/];
                }
            });
        });
    };
    /**
     * @static
     * @since 1.0.1
     * @desc Check if the channel belongs to Desk.
     */
    SendbirdDesk.isDeskChannel = function (channel) {
        return Ticket.isDeskCustomType(channel.customType);
    };
    /**
     * @ignore
     */
    SendbirdDesk.setApiHost = function (host) {
        Config.apiHost = host;
    };
    /**
     * @static
     * @since 1.0.0
     * @desc Set SDK to debug mode which adds internal logging on desk event.
     */
    SendbirdDesk.setDebugMode = function () {
        Config.setDebugMode();
    };
    /**
     * @static
     * @since 1.0.8
     * @desc Set customer customFields(Must be defined in dashboard).
     * @param {object} customFields - customFields object (key-value).
     * @param {function} callback - Function(res: object, err: Error).
     */
    SendbirdDesk.setCustomerCustomFields = function (customFields, cb) {
        this._setCustomerCustomFields(customFields).then(function (res) {
            cb(res, null);
        }).catch(function (err) {
            cb(null, err);
        });
    };
    /**
     * @ignore
     * @private
     * @since 1.1.0
     */
    SendbirdDesk._setCustomerCustomFields = function (customFields) {
        return __awaiter(this, void 0, void 0, function () {
            var formattedCustomFields, key, val, res, data;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        if (typeof customFields !== 'object' || customFields === null || Array.isArray(customFields)) {
                            throw SendbirdDeskError.create(SendbirdDeskError.Type.ERROR_INVALID_PARAMETER);
                        }
                        formattedCustomFields = {};
                        for (key in customFields) {
                            val = customFields[key];
                            if (typeof val === 'string') {
                                formattedCustomFields[key] = val;
                            }
                            else {
                                formattedCustomFields[key] = JSON.stringify(val);
                            }
                        }
                        return [4 /*yield*/, fetch("".concat(Config.apiHost, "/customers/custom_fields/"), {
                                method: 'PATCH',
                                headers: Auth.header,
                                body: JSON.stringify(__assign(__assign({}, Auth.postParam), { customFields: JSON.stringify(formattedCustomFields) })),
                            })];
                    case 1:
                        res = _a.sent();
                        return [4 /*yield*/, res.json()];
                    case 2:
                        data = _a.sent();
                        // handle errors
                        if (!res.ok) {
                            throw new Error(JSON.stringify(data));
                        }
                        // handle success
                        return [2 /*return*/, this._resToCustomFields(data.customFields)];
                }
            });
        });
    };
    SendbirdDesk._resToCustomFields = function (data) {
        var e_1, _a;
        var customFields = {};
        try {
            for (var data_1 = __values(data), data_1_1 = data_1.next(); !data_1_1.done; data_1_1 = data_1.next()) {
                var item = data_1_1.value;
                customFields[item.key] = item.value;
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (data_1_1 && !data_1_1.done && (_a = data_1.return)) _a.call(data_1);
            }
            finally { if (e_1) throw e_1.error; }
        }
        return customFields;
    };
    return SendbirdDesk;
}());

export { Agent, RelatedChannel, SendbirdDeskError, Ticket, SendbirdDesk as default };
